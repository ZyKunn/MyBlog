<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.63">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="./img/logo.png"><title>day01-微服务保护 | ZyKunのBlog</title><meta name="description" content="">
    <link rel="preload" href="/MyBlog/assets/style-57272a59.css" as="style"><link rel="stylesheet" href="/MyBlog/assets/style-57272a59.css">
    <link rel="modulepreload" href="/MyBlog/assets/app-a153c100.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-1f3f5c2b.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-fffdfb9c.js"><link rel="prefetch" href="/MyBlog/assets/index.html-ab0151fa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1249ab5a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d02565e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1c68c797.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93acf26d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2bc953d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c526d7c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-636c9f52.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4177c6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7624decc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d0b4a798.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa378d7b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ddd44d65.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbb7f41.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-34576599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1079a374.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-88d4ebe7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5e927142.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a6f13b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c85da23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-69e813d7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545062a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd7a4fcb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-910949e0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-459b0c71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a036060.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f62ffe74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-841a86c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b31c8bb6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85bae056.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73555735.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d5456cd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d2dfbeec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-746091c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9cc627ff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d411448a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4454f425.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57aa84f4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2ce52087.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76657200.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90d9409e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d6ba5e7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-41bc7856.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6140daf4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ea30461d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00114784.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3fa86cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-386f0bd2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b46ac77e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-256a258e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4ebf55b3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7268161e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a8852c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19373782.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4e33bb6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-de5ff178.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd5da14a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dbee5a73.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64025c89.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9bd15ac7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4812edff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3f85e131.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1d66d048.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-67b1b38e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-17f10f72.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ad1b5dc8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b14e7669.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa35810b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-acb9b7bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2ba9a88.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-abdb28e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b3cc33e9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ef13eee8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73fa0dcc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6f7449c7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3857ef8d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e5af1d8f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5d14c1f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-94a8b9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3931e4d3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0978879b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-617bd5bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fe008c8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0e33aa95.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00725025.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8e05ec6e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-72ca6b4c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-427c5181.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b3baf42.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-40a790c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9709e7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8eb00d02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c849262.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eda16f63.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81242655.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9f6820.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79188b74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5775eee0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eff0510c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-305de307.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e83a5de7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-761a9548.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c12ae66e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-87a73e5c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d720473a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b960b5b6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bbd98f93.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76195dca.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3bd0cfa7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8c87d147.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bac2e853.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ee6bc34.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ab7381d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5b97f6b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd33ca6f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-684189de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-63731ad7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-895bfca1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d1ff4c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b71bf26f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ce6f983b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c185f9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-29c62d64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-52c91de2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-55aa1c06.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c87ef63a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff1d9f51.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a12aedeb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-298f19f2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f881f599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c32406a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4217479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7edb7ce1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8671126f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da565d04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9deb3ec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee7cf1b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-270d6327.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ec786b75.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e98adf02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7233a0e2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79c193cf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9714081e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5dea51d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a235e4bb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e3209a23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cdce2101.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-389e66df.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-652ee4f6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-025e6f4e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-60711e70.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6edc93de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11bd39b1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53015219.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74dcd8ae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dd727db.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11b329fb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b6f3614.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-70ce719f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f6ca4d92.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a6833de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bf03220c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2edab58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f1e5cf7a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-21d4e18d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5235fca9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dc704c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57630906.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff165209.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6ec253a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9e4f0c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-664b232d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adf015a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4667c0e6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cc407710.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1752d212.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9b5d99c4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-43c48ae2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e8a616b7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93e7405b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-22a72a56.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-42ce3023.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f8eeab22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dd50991a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-af520db8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5ab2bfac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-965bc04f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81ebef01.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79d19f4d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9600bdfb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-560df48d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fb22a4f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd4caa82.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-370323f9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f673ebfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78d88460.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8b54347c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d30f0340.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e26bc4de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7d37b036.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3aa565ce.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c69f238.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76d60030.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7116a5e4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8f649cc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbbb7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90bb86fd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e23936a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19ad952b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-07245162.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-038b3afd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-084fe5c1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-098421fe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7baefce4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8c9612c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-05c42fda.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e1615934.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da824146.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa2d32f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545dbea7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3ca58cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b9e2188a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fc5f1f7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ec5c70d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cbf2aa55.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8beb0c08.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee54da9f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd28b91d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-98aa51a1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-03f9381a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9009c5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-71b7cfbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1759170e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa84186f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53160af7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51b685b4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ecb8e229.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9c507901.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6362722.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-faf67dd8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d7f20950.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a088985c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93b7982c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b76e6179.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d976d39c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b16efd78.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1301757e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c3240cbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2ddd21c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74fb5e20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-128f5026.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8fd9f38a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-82e84e23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-007ef014.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3dd860c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-382a2bae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b6beaec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2eb17cfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6f50213.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c8aef39.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-133f4d38.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cffd2be1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a798219d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b5fde77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-13275b71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4b6a02c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f179a12.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f45bc33f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0574e5e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0921816f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-631fbc02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8586017d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c4dbf09b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-967486c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aad17dde.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff644d77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78a4df64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d2180e8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53fbcd20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a3387e5e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-979f5ac4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0938c506.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51707e22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b1e917a0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b56a071.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d15eb498.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b0a97c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fda196b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bcc5faac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-490c208f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dce28479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62825d3c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b5a4af15.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eb40da96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d6d1c61.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-618cf3f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2a35430.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64f564d2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bca2187b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85181f96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f689b28.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62aa623a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b0c39cc5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73b8fff0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5466ae58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fbd0bcfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-5f041a2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/MyBlog/" class=""><!----><span class="site-name can-hide">ZyKunのBlog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="🌱Home"><!--[--><!--]--> 🌱Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🥝Java"><span class="title">🥝Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🥝Java"><span class="title">🥝Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="基础语法"><!--[--><!--]--> 基础语法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="面向对象编程"><!--[--><!--]--> 面向对象编程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="常用类&amp;集合框架"><!--[--><!--]--> 常用类&amp;集合框架 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Java高级"><!--[--><!--]--> Java高级 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🐍Python"><span class="title">🐍Python</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🐍Python"><span class="title">🐍Python</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Python入门"><!--[--><!--]--> Python入门 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🌋微服务"><span class="title">🌋微服务</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🌋微服务"><span class="title">🌋微服务</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="实用篇"><!--[--><!--]--> 实用篇 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="router-link-active" aria-label="高级篇"><!--[--><!--]--> 高级篇 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="🍓Mysql"><!--[--><!--]--> 🍓Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🍤前端"><span class="title">🍤前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🍤前端"><span class="title">🍤前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🎢Project"><span class="title">🎢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🎢Project"><span class="title">🎢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="🍍随笔"><!--[--><!--]--> 🍍随笔 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="🌱Home"><!--[--><!--]--> 🌱Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🥝Java"><span class="title">🥝Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🥝Java"><span class="title">🥝Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="基础语法"><!--[--><!--]--> 基础语法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="面向对象编程"><!--[--><!--]--> 面向对象编程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="常用类&amp;集合框架"><!--[--><!--]--> 常用类&amp;集合框架 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Java高级"><!--[--><!--]--> Java高级 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🐍Python"><span class="title">🐍Python</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🐍Python"><span class="title">🐍Python</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Python入门"><!--[--><!--]--> Python入门 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🌋微服务"><span class="title">🌋微服务</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🌋微服务"><span class="title">🌋微服务</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="实用篇"><!--[--><!--]--> 实用篇 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="router-link-active" aria-label="高级篇"><!--[--><!--]--> 高级篇 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="🍓Mysql"><!--[--><!--]--> 🍓Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🍤前端"><span class="title">🍤前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🍤前端"><span class="title">🍤前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🎢Project"><span class="title">🎢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🎢Project"><span class="title">🎢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="🍍随笔"><!--[--><!--]--> 🍍随笔 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/MyBlog/notes/microservices/02/" class="router-link-active sidebar-item sidebar-heading active" aria-label="高級篇"><!--[--><!--]--> 高級篇 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="day01-微服务保护"><!--[--><!--]--> day01-微服务保护 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-雪崩问题及解决方案" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.雪崩问题及解决方案"><!--[--><!--]--> 1.1.雪崩问题及解决方案 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-1-雪崩问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.1.雪崩问题"><!--[--><!--]--> 1.1.1.雪崩问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-2-超时处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.2.超时处理"><!--[--><!--]--> 1.1.2.超时处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-3-仓壁模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.3.仓壁模式"><!--[--><!--]--> 1.1.3.仓壁模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-4-断路器" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.4.断路器"><!--[--><!--]--> 1.1.4.断路器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-5-限流" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.5.限流"><!--[--><!--]--> 1.1.5.限流 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-6-总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.6.总结"><!--[--><!--]--> 1.1.6.总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-2-服务保护技术对比" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.服务保护技术对比"><!--[--><!--]--> 1.2.服务保护技术对比 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-3-sentinel-介绍和安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3.Sentinel 介绍和安装"><!--[--><!--]--> 1.3.Sentinel 介绍和安装 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-3-1-初识-sentinel" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3.1.初识 Sentinel"><!--[--><!--]--> 1.3.1.初识 Sentinel <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-3-2-安装-sentinel" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3.2.安装 Sentinel"><!--[--><!--]--> 1.3.2.安装 Sentinel <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-4-微服务整合-sentinel" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.4.微服务整合 Sentinel"><!--[--><!--]--> 1.4.微服务整合 Sentinel <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#理解-qps-和线程数的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="理解 QPS 和线程数的区别？"><!--[--><!--]--> 理解 QPS 和线程数的区别？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-1-簇点链路" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.簇点链路"><!--[--><!--]--> 2.1.簇点链路 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-1-快速入门" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.快速入门"><!--[--><!--]--> 2.1.快速入门 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-1-1-示例" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.1.示例"><!--[--><!--]--> 2.1.1.示例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-1-2-练习" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.2.练习："><!--[--><!--]--> 2.1.2.练习： <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-2-流控模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.流控模式"><!--[--><!--]--> 2.2.流控模式 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-2-1-关联模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.1.关联模式"><!--[--><!--]--> 2.2.1.关联模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-2-2-链路模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2.链路模式"><!--[--><!--]--> 2.2.2.链路模式 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-添加查询商品方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="1）添加查询商品方法"><!--[--><!--]--> 1）添加查询商品方法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-查询订单时-查询商品" class="router-link-active router-link-exact-active sidebar-item" aria-label="2）查询订单时，查询商品"><!--[--><!--]--> 2）查询订单时，查询商品 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-新增订单-查询商品" class="router-link-active router-link-exact-active sidebar-item" aria-label="3）新增订单，查询商品"><!--[--><!--]--> 3）新增订单，查询商品 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-给查询商品添加资源标记" class="router-link-active router-link-exact-active sidebar-item" aria-label="4）给查询商品添加资源标记"><!--[--><!--]--> 4）给查询商品添加资源标记 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-添加流控规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="5）添加流控规则"><!--[--><!--]--> 5）添加流控规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_6-jmeter-测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="6）Jmeter 测试"><!--[--><!--]--> 6）Jmeter 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-2-3-总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.3.总结"><!--[--><!--]--> 2.2.3.总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-3-流控效果" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.流控效果"><!--[--><!--]--> 2.3.流控效果 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-3-1-warm-up" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.1.warm up"><!--[--><!--]--> 2.3.1.warm up <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-配置流控规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="1）配置流控规则："><!--[--><!--]--> 1）配置流控规则： <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-jmeter-测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="2）Jmeter 测试"><!--[--><!--]--> 2）Jmeter 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-3-2-排队等待" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.2.排队等待"><!--[--><!--]--> 2.3.2.排队等待 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-添加流控规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="1）添加流控规则"><!--[--><!--]--> 1）添加流控规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-jmeter-测试-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="2）Jmeter 测试"><!--[--><!--]--> 2）Jmeter 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-3-3-总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.3.总结"><!--[--><!--]--> 2.3.3.总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-4-热点参数限流" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.热点参数限流"><!--[--><!--]--> 2.4.热点参数限流 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-4-1-全局参数限流" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.1.全局参数限流"><!--[--><!--]--> 2.4.1.全局参数限流 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-4-2-热点参数限流" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.2.热点参数限流"><!--[--><!--]--> 2.4.2.热点参数限流 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-4-4-案例" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.4.案例"><!--[--><!--]--> 2.4.4.案例 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-标记资源" class="router-link-active router-link-exact-active sidebar-item" aria-label="1）标记资源"><!--[--><!--]--> 1）标记资源 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-热点参数限流规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="2）热点参数限流规则"><!--[--><!--]--> 2）热点参数限流规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-jmeter-测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="3）Jmeter 测试"><!--[--><!--]--> 3）Jmeter 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-1-feignclient-整合-sentinel" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.FeignClient 整合 Sentinel"><!--[--><!--]--> 3.1.FeignClient 整合 Sentinel <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-1-1-修改配置-开启-sentinel-功能" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.1.修改配置，开启 sentinel 功能"><!--[--><!--]--> 3.1.1.修改配置，开启 sentinel 功能 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-1-2-编写失败降级逻辑" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.2.编写失败降级逻辑"><!--[--><!--]--> 3.1.2.编写失败降级逻辑 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-1-3-总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.3.总结"><!--[--><!--]--> 3.1.3.总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-2-线程隔离-舱壁模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.线程隔离（舱壁模式）"><!--[--><!--]--> 3.2.线程隔离（舱壁模式） <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-2-1-线程隔离的实现方式" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.1.线程隔离的实现方式"><!--[--><!--]--> 3.2.1.线程隔离的实现方式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-2-2-sentinel-的线程隔离" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.2.sentinel 的线程隔离"><!--[--><!--]--> 3.2.2.sentinel 的线程隔离 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-配置隔离规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="1）配置隔离规则"><!--[--><!--]--> 1）配置隔离规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-jmeter-测试-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="2）Jmeter 测试"><!--[--><!--]--> 2）Jmeter 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-2-3-总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.3.总结"><!--[--><!--]--> 3.2.3.总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-3-熔断降级" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.熔断降级"><!--[--><!--]--> 3.3.熔断降级 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-3-1-慢调用" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.1.慢调用"><!--[--><!--]--> 3.3.1.慢调用 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-设置慢调用" class="router-link-active router-link-exact-active sidebar-item" aria-label="1）设置慢调用"><!--[--><!--]--> 1）设置慢调用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-设置熔断规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="2）设置熔断规则"><!--[--><!--]--> 2）设置熔断规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="3）测试"><!--[--><!--]--> 3）测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-3-2-异常比例、异常数" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.2.异常比例、异常数"><!--[--><!--]--> 3.3.2.异常比例、异常数 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-设置异常请求" class="router-link-active router-link-exact-active sidebar-item" aria-label="1）设置异常请求"><!--[--><!--]--> 1）设置异常请求 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-设置熔断规则-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="2）设置熔断规则"><!--[--><!--]--> 2）设置熔断规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-测试-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="3）测试"><!--[--><!--]--> 3）测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-授权规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.授权规则"><!--[--><!--]--> 4.1.授权规则 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-1-基本规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.1.基本规则"><!--[--><!--]--> 4.1.1.基本规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-2-如何获取-origin" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.2.如何获取 origin"><!--[--><!--]--> 4.1.2.如何获取 origin <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-3-给网关添加请求头" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.3.给网关添加请求头"><!--[--><!--]--> 4.1.3.给网关添加请求头 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-4-配置授权规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.4.配置授权规则"><!--[--><!--]--> 4.1.4.配置授权规则 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-2-自定义异常结果" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.自定义异常结果"><!--[--><!--]--> 4.2.自定义异常结果 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-2-1-异常类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.1.异常类型"><!--[--><!--]--> 4.2.1.异常类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-2-2-自定义异常处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.2.自定义异常处理"><!--[--><!--]--> 4.2.2.自定义异常处理 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-1-规则管理模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1.规则管理模式"><!--[--><!--]--> 5.1.规则管理模式 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-1-1-pull-模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1.1.pull 模式"><!--[--><!--]--> 5.1.1.pull 模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-1-2-push-模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1.2.push 模式"><!--[--><!--]--> 5.1.2.push 模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-2-实现-push-模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2.实现 push 模式"><!--[--><!--]--> 5.2.实现 push 模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/MyBlog/notes/microservices/02/Jmeter%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" class="sidebar-item" aria-label="Jmeter 快速入门 🧙"><!--[--><!--]--> Jmeter 快速入门 🧙 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/sentinel%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96/" class="sidebar-item" aria-label="Sentinel 规则持久化 🧙"><!--[--><!--]--> Sentinel 规则持久化 🧙 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/day02-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="sidebar-item" aria-label="day02-分布式事务"><!--[--><!--]--> day02-分布式事务 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90/" class="sidebar-item" aria-label="seata 的部署和集成 🧙"><!--[--><!--]--> seata 的部署和集成 🧙 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/day03-%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98/" class="sidebar-item" aria-label="day03-分布式缓存"><!--[--><!--]--> day03-分布式缓存 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/Redis%E9%9B%86%E7%BE%A4/" class="sidebar-item" aria-label="Redis 集群 🧙"><!--[--><!--]--> Redis 集群 🧙 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/" class="sidebar-item" aria-label="day05-服务异步通信-高级篇"><!--[--><!--]--> day05-服务异步通信-高级篇 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" class="sidebar-item" aria-label="RabbitMQ 部署指南 🧙"><!--[--><!--]--> RabbitMQ 部署指南 🧙 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="day01-微服务保护" tabindex="-1"><a class="header-anchor" href="#day01-微服务保护" aria-hidden="true">#</a> day01-微服务保护</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-雪崩问题及解决方案" class="router-link-active router-link-exact-active">1.1.雪崩问题及解决方案</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-1-雪崩问题" class="router-link-active router-link-exact-active">1.1.1.雪崩问题</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-2-超时处理" class="router-link-active router-link-exact-active">1.1.2.超时处理</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-3-仓壁模式" class="router-link-active router-link-exact-active">1.1.3.仓壁模式</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-4-断路器" class="router-link-active router-link-exact-active">1.1.4.断路器</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-5-限流" class="router-link-active router-link-exact-active">1.1.5.限流</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-1-6-总结" class="router-link-active router-link-exact-active">1.1.6.总结</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-2-服务保护技术对比" class="router-link-active router-link-exact-active">1.2.服务保护技术对比</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-3-sentinel-介绍和安装" class="router-link-active router-link-exact-active">1.3.Sentinel 介绍和安装</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-3-1-初识-sentinel" class="router-link-active router-link-exact-active">1.3.1.初识 Sentinel</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-3-2-安装-sentinel" class="router-link-active router-link-exact-active">1.3.2.安装 Sentinel</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_1-4-微服务整合-sentinel" class="router-link-active router-link-exact-active">1.4.微服务整合 Sentinel</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#理解-qps-和线程数的区别" class="router-link-active router-link-exact-active">理解 QPS 和线程数的区别？</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-1-簇点链路" class="router-link-active router-link-exact-active">2.1.簇点链路</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-1-快速入门" class="router-link-active router-link-exact-active">2.1.快速入门</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-1-1-示例" class="router-link-active router-link-exact-active">2.1.1.示例</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-1-2-练习" class="router-link-active router-link-exact-active">2.1.2.练习：</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-2-流控模式" class="router-link-active router-link-exact-active">2.2.流控模式</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-2-1-关联模式" class="router-link-active router-link-exact-active">2.2.1.关联模式</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-2-2-链路模式" class="router-link-active router-link-exact-active">2.2.2.链路模式</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-2-3-总结" class="router-link-active router-link-exact-active">2.2.3.总结</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-3-流控效果" class="router-link-active router-link-exact-active">2.3.流控效果</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-3-1-warm-up" class="router-link-active router-link-exact-active">2.3.1.warm up</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-3-2-排队等待" class="router-link-active router-link-exact-active">2.3.2.排队等待</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-3-3-总结" class="router-link-active router-link-exact-active">2.3.3.总结</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-4-热点参数限流" class="router-link-active router-link-exact-active">2.4.热点参数限流</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-4-1-全局参数限流" class="router-link-active router-link-exact-active">2.4.1.全局参数限流</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-4-2-热点参数限流" class="router-link-active router-link-exact-active">2.4.2.热点参数限流</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_2-4-4-案例" class="router-link-active router-link-exact-active">2.4.4.案例</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-1-feignclient-整合-sentinel" class="router-link-active router-link-exact-active">3.1.FeignClient 整合 Sentinel</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-1-1-修改配置-开启-sentinel-功能" class="router-link-active router-link-exact-active">3.1.1.修改配置，开启 sentinel 功能</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-1-2-编写失败降级逻辑" class="router-link-active router-link-exact-active">3.1.2.编写失败降级逻辑</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-1-3-总结" class="router-link-active router-link-exact-active">3.1.3.总结</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-2-线程隔离-舱壁模式" class="router-link-active router-link-exact-active">3.2.线程隔离（舱壁模式）</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-2-1-线程隔离的实现方式" class="router-link-active router-link-exact-active">3.2.1.线程隔离的实现方式</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-2-2-sentinel-的线程隔离" class="router-link-active router-link-exact-active">3.2.2.sentinel 的线程隔离</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-2-3-总结" class="router-link-active router-link-exact-active">3.2.3.总结</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-3-熔断降级" class="router-link-active router-link-exact-active">3.3.熔断降级</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-3-1-慢调用" class="router-link-active router-link-exact-active">3.3.1.慢调用</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_3-3-2-异常比例、异常数" class="router-link-active router-link-exact-active">3.3.2.异常比例、异常数</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-授权规则" class="router-link-active router-link-exact-active">4.1.授权规则</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-1-基本规则" class="router-link-active router-link-exact-active">4.1.1.基本规则</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-2-如何获取-origin" class="router-link-active router-link-exact-active">4.1.2.如何获取 origin</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-3-给网关添加请求头" class="router-link-active router-link-exact-active">4.1.3.给网关添加请求头</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-1-4-配置授权规则" class="router-link-active router-link-exact-active">4.1.4.配置授权规则</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-2-自定义异常结果" class="router-link-active router-link-exact-active">4.2.自定义异常结果</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-2-1-异常类型" class="router-link-active router-link-exact-active">4.2.1.异常类型</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_4-2-2-自定义异常处理" class="router-link-active router-link-exact-active">4.2.2.自定义异常处理</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-1-规则管理模式" class="router-link-active router-link-exact-active">5.1.规则管理模式</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-1-1-pull-模式" class="router-link-active router-link-exact-active">5.1.1.pull 模式</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-1-2-push-模式" class="router-link-active router-link-exact-active">5.1.2.push 模式</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#_5-2-实现-push-模式" class="router-link-active router-link-exact-active">5.2.实现 push 模式</a></li></ul></nav><h1 id="_1-初识-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-初识-sentinel" aria-hidden="true">#</a> 1.初识 Sentinel</h1><h2 id="_1-1-雪崩问题及解决方案" tabindex="-1"><a class="header-anchor" href="#_1-1-雪崩问题及解决方案" aria-hidden="true">#</a> 1.1.雪崩问题及解决方案</h2><h3 id="_1-1-1-雪崩问题" tabindex="-1"><a class="header-anchor" href="#_1-1-1-雪崩问题" aria-hidden="true">#</a> 1.1.1.雪崩问题</h3><p>微服务中，服务间调用关系错综复杂，一个微服务往往依赖于多个其它微服务。</p><p><img src="/MyBlog/assets/1533829099748-3e0d816a.png" alt="1533829099748"></p><p>如图，如果服务提供者 I 发生了故障，当前的应用的部分业务因为依赖于服务 I，因此也会被阻塞。此时，其它不依赖于服务 I 的业务似乎不受影响。</p><p><img src="/MyBlog/assets/1533829198240-c22dfe1b.png" alt="1533829198240"></p><p>但是，依赖服务 I 的业务请求被阻塞，用户不会得到响应，则 tomcat 的这个线程不会释放，于是越来越多的用户请求到来，越来越多的线程会阻塞：</p><p><img src="/MyBlog/assets/1533829307389-35e693fc.png" alt="1533829307389"></p><p>服务器支持的线程和并发数有限，请求一直阻塞，会导致服务器资源耗尽，从而导致所有其它服务都不可用，那么当前服务也就不可用了。</p><p>那么，依赖于当前服务的其它服务随着时间的推移，最终也都会变的不可用，形成级联失败，雪崩就发生了：</p><p><img src="/MyBlog/assets/image-20210715172710340-9bbb7b5c.png" alt="image-20210715172710340"></p><h3 id="_1-1-2-超时处理" tabindex="-1"><a class="header-anchor" href="#_1-1-2-超时处理" aria-hidden="true">#</a> 1.1.2.超时处理</h3><p>解决雪崩问题的常见方式有四种：</p><p>•超时处理：设定超时时间，请求超过一定时间没有响应就返回错误信息，不会无休止等待</p><p><img src="/MyBlog/assets/image-20210715172820438-4373eec4.png" alt="image-20210715172820438"></p><h3 id="_1-1-3-仓壁模式" tabindex="-1"><a class="header-anchor" href="#_1-1-3-仓壁模式" aria-hidden="true">#</a> 1.1.3.仓壁模式</h3><p>方案 2：仓壁模式</p><p>仓壁模式来源于船舱的设计：</p><p><img src="/MyBlog/assets/image-20210715172946352-8dc14eb7.png" alt="image-20210715172946352"></p><p>船舱都会被隔板分离为多个独立空间，当船体破损时，只会导致部分空间进入，将故障控制在一定范围内，避免整个船体都被淹没。</p><p>于此类似，我们可以限定每个业务能使用的线程数，避免耗尽整个 tomcat 的资源，因此也叫线程隔离。</p><p><img src="/MyBlog/assets/image-20210715173215243-8b265628.png" alt="image-20210715173215243"></p><h3 id="_1-1-4-断路器" tabindex="-1"><a class="header-anchor" href="#_1-1-4-断路器" aria-hidden="true">#</a> 1.1.4.断路器</h3><p>断路器模式：由<strong>断路器</strong>统计业务执行的异常比例，如果超出阈值则会<strong>熔断</strong>该业务，拦截访问该业务的一切请求。</p><p>断路器会统计访问某个服务的请求数量，异常比例：</p><p><img src="/MyBlog/assets/image-20210715173327075-3c69db34.png" alt="image-20210715173327075"></p><p>当发现访问服务 D 的请求异常比例过高时，认为服务 D 有导致雪崩的风险，会拦截访问服务 D 的一切请求，形成熔断：</p><p><img src="/MyBlog/assets/image-20210715173428073-fe839882.png" alt="image-20210715173428073"></p><h3 id="_1-1-5-限流" tabindex="-1"><a class="header-anchor" href="#_1-1-5-限流" aria-hidden="true">#</a> 1.1.5.限流</h3><p><strong>流量控制</strong>：限制业务访问的 QPS，避免服务因流量的突增而故障。</p><p><img src="/MyBlog/assets/image-20210715173555158-67302b64.png" alt="image-20210715173555158"></p><h3 id="_1-1-6-总结" tabindex="-1"><a class="header-anchor" href="#_1-1-6-总结" aria-hidden="true">#</a> 1.1.6.总结</h3><p>什么是雪崩问题？</p><ul><li>微服务之间相互调用，因为调用链中的一个服务故障，引起整个链路都无法访问的情况。</li></ul><p>可以认为：</p><p><strong>限流</strong>是对服务的保护，避免因瞬间高并发流量而导致服务故障，进而避免雪崩。是一种<strong>预防</strong>措施。</p><p><strong>超时处理、线程隔离、降级熔断</strong>是在部分服务故障时，将故障控制在一定范围，避免雪崩。是一种<strong>补救</strong>措施。</p><h2 id="_1-2-服务保护技术对比" tabindex="-1"><a class="header-anchor" href="#_1-2-服务保护技术对比" aria-hidden="true">#</a> 1.2.服务保护技术对比</h2><p>在 SpringCloud 当中支持多种服务保护技术：</p><ul><li><a href="https://github.com/Netflix/Hystrix" target="_blank" rel="noopener noreferrer">Netfix Hystrix<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/resilience4j/resilience4j" target="_blank" rel="noopener noreferrer">Resilience4J<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>早期比较流行的是 Hystrix 框架，但目前国内实用最广泛的还是阿里巴巴的 Sentinel 框架，这里我们做下对比：</p><table><thead><tr><th></th><th><strong>Sentinel</strong></th><th><strong>Hystrix</strong></th></tr></thead><tbody><tr><td>隔离策略</td><td>信号量隔离</td><td>线程池隔离/信号量隔离</td></tr><tr><td>熔断降级策略</td><td>基于慢调用比例或异常比例</td><td>基于失败比率</td></tr><tr><td>实时指标实现</td><td>滑动窗口</td><td>滑动窗口（基于 RxJava）</td></tr><tr><td>规则配置</td><td>支持多种数据源</td><td>支持多种数据源</td></tr><tr><td>扩展性</td><td>多个扩展点</td><td>插件的形式</td></tr><tr><td>基于注解的支持</td><td>支持</td><td>支持</td></tr><tr><td>限流</td><td>基于 QPS，支持基于调用关系的限流</td><td>有限的支持</td></tr><tr><td>流量整形</td><td>支持慢启动、匀速排队模式</td><td>不支持</td></tr><tr><td>系统自适应保护</td><td>支持</td><td>不支持</td></tr><tr><td>控制台</td><td>开箱即用，可配置规则、查看秒级监控、机器发现等</td><td>不完善</td></tr><tr><td>常见框架的适配</td><td>Servlet、Spring Cloud、Dubbo、gRPC 等</td><td>Servlet、Spring Cloud Netflix</td></tr></tbody></table><h2 id="_1-3-sentinel-介绍和安装" tabindex="-1"><a class="header-anchor" href="#_1-3-sentinel-介绍和安装" aria-hidden="true">#</a> 1.3.Sentinel 介绍和安装</h2><h3 id="_1-3-1-初识-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-3-1-初识-sentinel" aria-hidden="true">#</a> 1.3.1.初识 Sentinel</h3><p>Sentinel 是阿里巴巴开源的一款微服务流量控制组件。官网地址：https://sentinelguard.io/zh-cn/index.html</p><p>Sentinel 具有以下特征:</p><p>•<strong>丰富的应用场景</strong>：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</p><p>•<strong>完备的实时监控</strong>：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</p><p>•<strong>广泛的开源生态</strong>：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。</p><p>•<strong>完善的</strong> <strong>SPI</strong> <strong>扩展点</strong>：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</p><h3 id="_1-3-2-安装-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-3-2-安装-sentinel" aria-hidden="true">#</a> 1.3.2.安装 Sentinel</h3><p>1）下载</p><p>sentinel 官方提供了 UI 控制台，方便我们对系统做限流设置。大家可以在<a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>下载。</p><p>课前资料也提供了下载好的 jar 包：</p><p><img src="/MyBlog/assets/image-20210715174252531-a2e83d34.png" alt="image-20210715174252531"></p><p>2）运行</p><p>将 jar 包放到任意非中文目录，执行命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.1.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果要修改 Sentinel 的默认端口、账户、密码，可以通过下列配置：</p><table><thead><tr><th><strong>配置项</strong></th><th><strong>默认值</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>server.port</td><td>8080</td><td>服务端口</td></tr><tr><td>sentinel.dashboard.auth.username</td><td>sentinel</td><td>默认用户名</td></tr><tr><td>sentinel.dashboard.auth.password</td><td>sentinel</td><td>默认密码</td></tr></tbody></table><p>例如，修改端口：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span>  <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.1.jar <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8090</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）访问</p><p>访问 http://localhost:8080 页面，就可以看到 sentinel 的控制台了：</p><p><img src="/MyBlog/assets/image-20210715190827846-b8bc8951.png" alt="image-20210715190827846"></p><p>登录后，发现一片空白，什么都没有：</p><p><img src="/MyBlog/assets/image-20210715191134448-f663fc31.png" alt="image-20210715191134448"></p><p>这是因为我们还没有与微服务整合。</p><p><code>如果需要修改Sentinel的默认端口，账户，密码，可以通过以下配置：</code></p><h2 id="_1-4-微服务整合-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-4-微服务整合-sentinel" aria-hidden="true">#</a> 1.4.微服务整合 Sentinel</h2><p>我们在 order-service 中整合 sentinel，并连接 sentinel 的控制台，步骤如下：</p><p>1）引入 sentinel 依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--sentinel--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）配置控制台</p><p>修改 application.yaml 文件，添加下面内容：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8088</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3）访问 order-service 的任意端点</p><p>打开浏览器，访问 http://localhost:8088/order/101，这样才能触发 sentinel 的监控。</p><p>然后再访问 sentinel 的控制台，查看效果：</p><p><img src="/MyBlog/assets/image-20210715191241799-f258d66c.png" alt="image-20210715191241799"></p><h2 id="理解-qps-和线程数的区别" tabindex="-1"><a class="header-anchor" href="#理解-qps-和线程数的区别" aria-hidden="true">#</a> 理解 QPS 和线程数的区别？</h2><ol><li><p>QPS 类似于银行的保安 &gt;</p><p>所有的请求到<code>Sentinel</code>后,他会根据阈值放行,超过报错</p></li><li><p>线程数类似于银行的窗口&gt;</p><p>所有的请求会被放进来,但如果阈值设置为 1 那么,其他的请求就会报错</p><p>也就是,银行里只有一个窗口,一个人在办理业务中,其他人跑过来则会告诉你,不行,没到你</p></li></ol><p><strong>区别对比图</strong></p><p><img src="/MyBlog/assets/1682088290338-9edfefa7.png" alt="1682088290338"></p><h1 id="_2-流量控制" tabindex="-1"><a class="header-anchor" href="#_2-流量控制" aria-hidden="true">#</a> 2.流量控制</h1><p>雪崩问题虽然有四种方案，但是限流是避免服务因突发的流量而发生故障，是对微服务雪崩问题的预防。我们先学习这种模式。</p><h2 id="_2-1-簇点链路" tabindex="-1"><a class="header-anchor" href="#_2-1-簇点链路" aria-hidden="true">#</a> 2.1.簇点链路</h2><p>当请求进入微服务时，首先会访问 DispatcherServlet，然后进入 Controller、Service、Mapper，这样的一个调用链就叫做<strong>簇点链路</strong>。簇点链路中被监控的每一个接口就是一个<strong>资源</strong>。</p><p>默认情况下 sentinel 会监控 SpringMVC 的每一个端点（Endpoint，也就是 controller 中的方法），因此 SpringMVC 的每一个端点（Endpoint）就是调用链路中的一个资源。</p><p>例如，我们刚才访问的 order-service 中的 OrderController 中的端点：/order/{orderId}</p><p><img src="/MyBlog/assets/image-20210715191757319-be4ee86b.png" alt="image-20210715191757319"></p><p>流控、熔断等都是针对簇点链路中的资源来设置的，因此我们可以点击对应资源后面的按钮来设置规则：</p><ul><li>流控：流量控制</li><li>降级：降级熔断</li><li>热点：热点参数限流，是限流的一种</li><li>授权：请求的权限控制</li></ul><h2 id="_2-1-快速入门" tabindex="-1"><a class="header-anchor" href="#_2-1-快速入门" aria-hidden="true">#</a> 2.1.快速入门</h2><h3 id="_2-1-1-示例" tabindex="-1"><a class="header-anchor" href="#_2-1-1-示例" aria-hidden="true">#</a> 2.1.1.示例</h3><p>点击资源/order/{orderId}后面的流控按钮，就可以弹出表单。</p><p><img src="/MyBlog/assets/image-20210715191757319-be4ee86b.png" alt="image-20210715191757319"></p><p>表单中可以填写限流规则，如下：</p><p><img src="/MyBlog/assets/image-20210715192010657-b055366b.png" alt="image-20210715192010657"></p><p>其含义是限制 /order/{orderId}这个资源的单机 QPS 为 1，即每秒只允许 1 次请求，超出的请求会被拦截并报错。</p><h3 id="_2-1-2-练习" tabindex="-1"><a class="header-anchor" href="#_2-1-2-练习" aria-hidden="true">#</a> 2.1.2.练习：</h3><p>需求：给 /order/{orderId}这个资源设置流控规则，QPS 不能超过 5，然后测试。</p><p>1）首先在 sentinel 控制台添加限流规则</p><p><img src="/MyBlog/assets/image-20210715192455429-f5092835.png" alt="image-20210715192455429"></p><p>2）利用 jmeter 测试</p><p>如果没有用过 jmeter，可以参考课前资料提供的文档《Jmeter 快速入门.md》</p><p>课前资料提供了编写好的 Jmeter 测试样例：</p><p><img src="/MyBlog/assets/image-20210715200431615-b6c96cdb.png" alt="image-20210715200431615"></p><p>打开 jmeter，导入课前资料提供的测试样例：</p><p><img src="/MyBlog/assets/image-20210715200537171-b57a9890.png" alt="image-20210715200537171"></p><p>选择：</p><p><img src="/MyBlog/assets/image-20210715200635414-38ee2ff9.png" alt="image-20210715200635414"></p><p>20 个用户，2 秒内运行完，QPS 是 10，超过了 5.</p><p>选中<code>流控入门，QPS&lt;5</code>右键运行：</p><p><img src="/MyBlog/assets/image-20210715200804594-c644264a.png" alt="image-20210715200804594"></p><blockquote><p>注意，不要点击菜单中的执行按钮来运行。</p></blockquote><p>结果：</p><p><img src="/MyBlog/assets/image-20210715200853671-253bd5b0.png" alt="image-20210715200853671"></p><p>可以看到，成功的请求每次只有 5 个</p><h2 id="_2-2-流控模式" tabindex="-1"><a class="header-anchor" href="#_2-2-流控模式" aria-hidden="true">#</a> 2.2.流控模式</h2><p>在添加限流规则时，点击高级选项，可以选择三种<strong>流控模式</strong>：</p><ul><li>直接：<code>统计当前资源的请求，触发阈值时对当前资源直接限流，也是默认的模式</code></li><li>关联：<code>统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流</code></li><li>链路：<code>统计从指定链路访问到本资源的请求，触发阈值时，对指定链路限流</code></li></ul><p><img src="/MyBlog/assets/image-20210715201827886-93263c29.png" alt="image-20210715201827886"></p><p>快速入门测试的就是直接模式。</p><h3 id="_2-2-1-关联模式" tabindex="-1"><a class="header-anchor" href="#_2-2-1-关联模式" aria-hidden="true">#</a> 2.2.1.关联模式</h3><p><strong>关联模式</strong>：统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流</p><p><strong>配置规则</strong>：</p><p><img src="/MyBlog/assets/image-20210715202540786-698b37ee.png" alt="image-20210715202540786"></p><p><strong>语法说明</strong>：当/write 资源访问量触发阈值时，就会对/read 资源限流，避免影响/write 资源。</p><p><strong>使用场景</strong>：比如用户支付时需要修改订单状态，同时用户要查询订单。查询和修改操作会争抢数据库锁，产生竞争。业务需求是优先支付和更新订单的业务，因此当修改订单业务触发阈值时，需要对查询订单业务限流。</p><p><strong>需求说明</strong>：</p><ul><li><p>在 OrderController 新建两个端点：/order/query 和/order/update，无需实现业务</p></li><li><p>配置流控规则，当/order/ update 资源被访问的 QPS 超过 5 时，对/order/query 请求限流</p></li></ul><p>1）定义/order/query 端点，模拟订单查询</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/query&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;查询订单成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）定义/order/update 端点，模拟订单更新</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/update&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">updateOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;更新订单成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启服务，查看 sentinel 控制台的簇点链路：</p><p><img src="/MyBlog/assets/image-20210716101805951-1cfd4226.png" alt="image-20210716101805951"></p><p>3）配置流控规则</p><p>对哪个端点限流，就点击哪个端点后面的按钮。我们是对订单查询/order/query 限流，因此点击它后面的按钮：</p><p><img src="/MyBlog/assets/image-20210716101934499-da670e09.png" alt="image-20210716101934499"></p><p>在表单中填写流控规则：</p><p><img src="/MyBlog/assets/image-20210716102103814-36e8840d.png" alt="image-20210716102103814"></p><p>4）在 Jmeter 测试</p><p>选择《流控模式-关联》：</p><p><img src="/MyBlog/assets/image-20210716102416266-af3b8d11.png" alt="image-20210716102416266"></p><p>可以看到 1000 个用户，100 秒，因此 QPS 为 10，超过了我们设定的阈值：5</p><p>查看 http 请求：</p><p><img src="/MyBlog/assets/image-20210716102532554-c63137a1.png" alt="image-20210716102532554"></p><p>请求的目标是/order/update，这样这个断点就会触发阈值。</p><p>但限流的目标是/order/query，我们在浏览器访问，可以发现：</p><p><img src="/MyBlog/assets/image-20210716102636030-47bb28b2.png" alt="image-20210716102636030"></p><p>确实被限流了。</p><p>5）总结</p><p><img src="/MyBlog/assets/image-20210716103143002-c72f4c56.png" alt="image-20210716103143002"></p><h3 id="_2-2-2-链路模式" tabindex="-1"><a class="header-anchor" href="#_2-2-2-链路模式" aria-hidden="true">#</a> 2.2.2.链路模式</h3><p><strong>链路模式</strong>：只针对从指定链路访问到本资源的请求做统计，判断是否超过阈值。</p><p><strong>配置示例</strong>：</p><p>例如有两条请求链路：</p><ul><li><p>/test1 --&gt; /common</p></li><li><p>/test2 --&gt; /common</p></li></ul><p>如果只希望统计从/test2 进入到/common 的请求，则可以这样配置：</p><p><img src="/MyBlog/assets/image-20210716103536346-1d3b17ca.png" alt="image-20210716103536346"></p><p><strong>实战案例</strong></p><p>需求：有查询订单和创建订单业务，两者都需要查询商品。针对从查询订单进入到查询商品的请求统计，并设置限流。</p><p>步骤：</p><ol><li><p>在 OrderService 中添加一个 queryGoods 方法，不用实现业务</p></li><li><p>在 OrderController 中，改造/order/query 端点，调用 OrderService 中的 queryGoods 方法</p></li><li><p>在 OrderController 中添加一个/order/save 的端点，调用 OrderService 的 queryGoods 方法</p></li><li><p>给 queryGoods 设置限流规则，从/order/query 进入 queryGoods 的方法限制 QPS 必须小于 2</p></li></ol><p>实现：</p><h4 id="_1-添加查询商品方法" tabindex="-1"><a class="header-anchor" href="#_1-添加查询商品方法" aria-hidden="true">#</a> 1）添加查询商品方法</h4><p>在 order-service 服务中，给 OrderService 类添加一个 queryGoods 方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询商品&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-查询订单时-查询商品" tabindex="-1"><a class="header-anchor" href="#_2-查询订单时-查询商品" aria-hidden="true">#</a> 2）查询订单时，查询商品</h4><p>在 order-service 的 OrderController 中，修改/order/query 端点的业务逻辑：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/query&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 查询商品</span>
    orderService<span class="token punctuation">.</span><span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 查询订单</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询订单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;查询订单成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-新增订单-查询商品" tabindex="-1"><a class="header-anchor" href="#_3-新增订单-查询商品" aria-hidden="true">#</a> 3）新增订单，查询商品</h4><p>在 order-service 的 OrderController 中，修改/order/save 端点，模拟新增订单：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/save&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 查询商品</span>
    orderService<span class="token punctuation">.</span><span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 查询订单</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;新增订单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;新增订单成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-给查询商品添加资源标记" tabindex="-1"><a class="header-anchor" href="#_4-给查询商品添加资源标记" aria-hidden="true">#</a> 4）给查询商品添加资源标记</h4><p>默认情况下，OrderService 中的方法是不被 Sentinel 监控的，需要我们自己通过注解来标记要监控的方法。</p><p>给 OrderService 的 queryGoods 方法添加@SentinelResource 注解：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span><span class="token string">&quot;goods&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询商品&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>链路模式中，是对不同来源的两个链路做监控。但是 sentinel 默认会给进入 SpringMVC 的所有请求设置同一个 root 资源，会导致链路模式失效。</p><p>我们需要关闭这种对 SpringMVC 的资源聚合，修改 order-service 服务的 application.yml 文件：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">web-context-unify</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 关闭context整合</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启服务，访问/order/query 和/order/save，可以查看到 sentinel 的簇点链路规则中，出现了新的资源：</p><p><img src="/MyBlog/assets/image-20210716105227163-e1f0d7e8.png" alt="image-20210716105227163"></p><h4 id="_5-添加流控规则" tabindex="-1"><a class="header-anchor" href="#_5-添加流控规则" aria-hidden="true">#</a> 5）添加流控规则</h4><p>点击 goods 资源后面的流控按钮，在弹出的表单中填写下面信息：</p><p><img src="/MyBlog/assets/image-20210716105408723-dedf1657.png" alt="image-20210716105408723"></p><p>只统计从/order/query 进入/goods 的资源，QPS 阈值为 2，超出则被限流。</p><h4 id="_6-jmeter-测试" tabindex="-1"><a class="header-anchor" href="#_6-jmeter-测试" aria-hidden="true">#</a> 6）Jmeter 测试</h4><p>选择《流控模式-链路》：</p><p><img src="/MyBlog/assets/image-20210716105612312-61048c71.png" alt="image-20210716105612312"></p><p>可以看到这里 200 个用户，50 秒内发完，QPS 为 4，超过了我们设定的阈值 2</p><p>一个 http 请求是访问/order/save：</p><p><img src="/MyBlog/assets/image-20210716105812789-b84c2672.png" alt="image-20210716105812789"></p><p>运行的结果：</p><p><img src="/MyBlog/assets/image-20210716110027064-f221a5d4.png" alt="image-20210716110027064"></p><p>完全不受影响。</p><p>另一个是访问/order/query：</p><p><img src="/MyBlog/assets/image-20210716105855951-52b19a3f.png" alt="image-20210716105855951"></p><p>运行结果：</p><p><img src="/MyBlog/assets/image-20210716105956401-61d515f4.png" alt="image-20210716105956401"></p><p>每次只有 2 个通过。</p><h3 id="_2-2-3-总结" tabindex="-1"><a class="header-anchor" href="#_2-2-3-总结" aria-hidden="true">#</a> 2.2.3.总结</h3><p>流控模式有哪些？</p><p>•直接：对当前资源限流</p><p>•关联：高优先级资源触发阈值，对低优先级资源限流。</p><p>•链路：阈值统计时，只统计从指定资源进入当前资源的请求，是对请求来源的限流</p><h2 id="_2-3-流控效果" tabindex="-1"><a class="header-anchor" href="#_2-3-流控效果" aria-hidden="true">#</a> 2.3.流控效果</h2><p>在流控的高级选项中，还有一个流控效果选项：</p><p><img src="/MyBlog/assets/image-20210716110225104-906b2937.png" alt="image-20210716110225104"></p><p>流控效果是指请求达到流控阈值时应该采取的措施，包括三种：</p><ul><li><p>快速失败：达到阈值后，新的请求会被立即拒绝并抛出 FlowException 异常。是默认的处理方式。</p></li><li><p>warm up：预热模式，对超出阈值的请求同样是拒绝并抛出异常。但这种模式阈值会动态变化，从一个较小值逐渐增加到最大阈值。</p></li><li><p>排队等待：让所有的请求按照先后次序排队执行，两个请求的间隔不能小于指定时长</p></li></ul><h3 id="_2-3-1-warm-up" tabindex="-1"><a class="header-anchor" href="#_2-3-1-warm-up" aria-hidden="true">#</a> 2.3.1.warm up</h3><p>阈值一般是一个微服务能承担的最大 QPS，但是一个服务刚刚启动时，一切资源尚未初始化（<strong>冷启动</strong>），如果直接将 QPS 跑到最大值，可能导致服务瞬间宕机。</p><p>warm up 也叫<strong>预热模式</strong>，是应对服务冷启动的一种方案。请求阈值初始值是 maxThreshold / coldFactor，持续指定时长后，逐渐提高到 maxThreshold 值。而 coldFactor 的默认值是 3.</p><p>例如，我设置 QPS 的 maxThreshold 为 10，预热时间为 5 秒，那么初始阈值就是 10 / 3 ，也就是 3，然后在 5 秒后逐渐增长到 10.</p><p><img src="/MyBlog/assets/image-20210716110629796-e86a579a.png" alt="image-20210716110629796"></p><p><strong>案例</strong></p><p>需求：给/order/{orderId}这个资源设置限流，最大 QPS 为 10，利用 warm up 效果，预热时长为 5 秒</p><h4 id="_1-配置流控规则" tabindex="-1"><a class="header-anchor" href="#_1-配置流控规则" aria-hidden="true">#</a> 1）配置流控规则：</h4><p><img src="/MyBlog/assets/image-20210716111012387-c64fb3e0.png" alt="image-20210716111012387"></p><h4 id="_2-jmeter-测试" tabindex="-1"><a class="header-anchor" href="#_2-jmeter-测试" aria-hidden="true">#</a> 2）Jmeter 测试</h4><p>选择《流控效果，warm up》：</p><p><img src="/MyBlog/assets/image-20210716111136699-0489d50a.png" alt="image-20210716111136699"></p><p>QPS 为 10.</p><p>刚刚启动时，大部分请求失败，成功的只有 3 个，说明 QPS 被限定在 3：</p><p><img src="/MyBlog/assets/image-20210716111303701-9b7e2d1f.png" alt="image-20210716111303701"></p><p>随着时间推移，成功比例越来越高：</p><p><img src="/MyBlog/assets/image-20210716111404717-8186fcf8.png" alt="image-20210716111404717"></p><p>到 Sentinel 控制台查看实时监控：</p><p><img src="/MyBlog/assets/image-20210716111526480-e1dc86da.png" alt="image-20210716111526480"></p><p>一段时间后：</p><p><img src="/MyBlog/assets/image-20210716111658541-dd63abbd.png" alt="image-20210716111658541"></p><h3 id="_2-3-2-排队等待" tabindex="-1"><a class="header-anchor" href="#_2-3-2-排队等待" aria-hidden="true">#</a> 2.3.2.排队等待</h3><p>当请求超过 QPS 阈值时，快速失败和 warm up 会拒绝新的请求并抛出异常。</p><p>而排队等待则是让所有请求进入一个队列中，然后按照阈值允许的时间间隔依次执行。后来的请求必须等待前面执行完成，如果请求预期的等待时间超出最大时长，则会被拒绝。</p><p>工作原理</p><p>例如：QPS = 5，意味着每 200ms 处理一个队列中的请求；timeout = 2000，意味着<strong>预期等待时长</strong>超过 2000ms 的请求会被拒绝并抛出异常。</p><p>那什么叫做预期等待时长呢？</p><p>比如现在一下子来了 12 个请求，因为每 200ms 执行一个请求，那么：</p><ul><li>第 6 个请求的<strong>预期等待时长</strong> = 200 * （6 - 1） = 1000ms</li><li>第 12 个请求的预期等待时长 = 200 * （12-1） = 2200ms</li></ul><p>现在，第 1 秒同时接收到 10 个请求，但第 2 秒只有 1 个请求，此时 QPS 的曲线这样的：</p><p><img src="/MyBlog/assets/image-20210716113147176-f9568f94.png" alt="image-20210716113147176"></p><p>如果使用队列模式做流控，所有进入的请求都要排队，以固定的 200ms 的间隔执行，QPS 会变的很平滑：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAssAAAFeCAYAAABzS1K2AAAOrUlEQVR4nO3dO1IbaReA4dN/zVIkBy5WIK0AOyFySiaFkEw24WSToBAyp0ROjFYgrYAicPde+g/E1eZgDJL69jxVVGEbzGdu887htLqo67oOAADgF/9r+gAAANBWYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiecuKomj6CAAAbIlY3qK7UBbMAAD9IJYBACAhlrfk52my6TIAQPeJZQAASIjlLcimyKbLAADdJpYBACAhlgEAICGW3+l3qxZWMQAAukssAwBAQiwDAEBCLL/Da1csrGIAAHSTWAYAgIRY3hPTZQCA7hHLbyR+AQD6TywDAEBCLL/BW6fKptEAAN3yV9MH6KK6rp/9/ccxnL0MAADdYbIMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAAiW7GclVFtVzEYj6P6XQa0/kiqle/6jLm02kURfHwNJ3GfLF89d8BAMAwFHVd100f4lWqRUyPL2O9Xv/6Z5OzKFcnMfrtXzGN8ekzr3//98zianUeh288YlEU98935d0KAECuO5Pl8uYhlCeTmMxmMZv8wetXizi+C+XJWVyVddR1HXVdRnk1i0lExPoiPs2XWz44AABd1Z1YHv8dZVluAne1itX5eRwdvP7Vl/+dxjrifgp9eD+GHsXo8DxWV7PNLy/+jYV9DAAAokuxPBrFaPS7RYvMMr5dbJ6bfPn8/LrG4VFscnkdl9/VMgAAXYrl96h+xHVEREziy+csuA/j6Ha4vL787mI/AAAGEsvlzWYFIw7iwwvD6fHH2yXo9U2UezgWAADtNohYrn5cN30EAAA6aBCx/FqjD39wxSAAAL0nlp91HT8sLQMADJ5YftbLu80AAAyDWAYAgIRYfsSFgAAAPDaIWH64cO/lXeTy5u522B9jvPNTAQDQdoOI5cd357tJH0C5ivvB8sGH5+/yBwDAoAwjlmMcd/cbufi2fP5Fqu9xeTtYnh0d7udYAAC02kBieRQn/9zey/riU0wXP+1iVMuYH59u7vI3OYu/tTIAADGYWI6Iw/O4uu3l9ek4imIa0+k0ptMiivGnuNiUcpx9PbGCAQBARAwpliPi8LyMq7NZbDYy1rFer2N9u3oRk1lclas4UcoAANwq6rqumz5EI6oq7pcxRqOtTJOLorh/fqjvVgCAPhluLO+AWAYA6JdBrWEAAMCfEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkPir6QNAHxRF0djbruu6sbcNAH0nluEFTUbwa733jGIbAHJiGaIbUbwrb/m3C+ynhvz5A33l+xx3xDKDs4uwafKbahOh9ta32fX/+IhigOERy/Re39cU3nu+fQag2ASga8QyvfSnUdb2IN6lt/zbRe/zhvx5BNBXYpleEMf79db3X9cj2+cNwPCIZTrtNfElcNrDxwKArhHLdI5ABgD2RSzTGb+LZIEMAGybWKbVBDIA0CSxTCuJZACgDcQyrfJSJAtkAGDfxDKtIJIBgDYSyzQuC2WRDAA0TSzTGJEMALSdWGbvRDIA0BVimb16LpRFMgDQVmKZvTBNBgC6SCyzc6bJAEBXiWV2xjQZAOg6scxOmCYDAH3wv6YPQP8IZQCgL0yW2aqfQ1kkAwBdJpbZCtNkAKCPrGHwbkIZAOgrscy7CGUAoM+sYfBm9pMBgL4zWeZNhDIAMARimT8mlAGAoRDL/BGhDAAMiVjm1YQyADA0YplXEcoAwBCJZX5LKAMAQyWWeZFQBgCGTCyTEsoAwNCJZZ4llAEAxDLPEMoAABtimSeEMgDAA7HMPaEMAPCUWCYihDIAwHPEMgAAJMQypsoAAAmxPHBCGQAgJ5a5J5QBAJ4SywP281QZAICnxPJAWb8AAPg9sTxAQhkA4HXE8sAJZQCAnFgeGHvKAACvJ5YHxPoFAMCfEcsDJZQBAH5PLA/E46myUAYAeB2xPAD2lAEA3kYsD4ypMgDA64nlnjNVBgB4O7HcYx79AgDgfcTyQAhlAIA/J5Z7yvoFAMD7ieUesn4BALAdYrnnhDIAwNuJ5Z6xfgEAsD1iucdMlQEA3kcs94ipMgDAdonlnjJVBgB4P7HcE6bKAADbJ5Z7yFQZAGA7xHIPPJ4qC2UAgO0Ryx1n/QIAYHfEco+YKgMAbJdY7jBTZQCA3RLLPWGqDACwfWK5o0yVAQB2Tyz3gKkyAMBuiOUOMlUGANgPsdxxpsoAALsjljvGVBkAYH/EcoeZKgMA7JZYBgCAhFjukMcrGKbKAAC7J5YBACAhljvCVBkAYP/EMgAAJMRyB3i4OACAZojljrGCAQCwP2K55UyVAQCaI5Y7xFQZAGC/xHKLmSoDADRLLHeEqTIAwP6JZQAASIjllrKCAQDQPLHcAVYwAACaIZZbyFQZAKAdxHLLmSoDADRHLAMAQEIst8zjFQxTZQCAZollAABIiGUAAEiI5RaxggEA0C5iGQAAEmK5JTy2MgBA+4jlFrKCAQDQDmIZAAASYrkFXNgHANBOYhkAABJiGQAAEmK5YVYwAADaSywDAEBCLAMAQEIsN8gKBgBAu4llAABIiGUAAEiI5YZYwQAAaD+xDAAACbEMAAAJsdwAKxgAAN0glgEAICGWAQAgIZb3zAoGAEB3iGUAAEiIZQAASIjlPXq8ggEAQPuJ5YbYVwYAaD+xDAAACbG8J1YwAAC6Ryw3wAoGAEA3iGUAAEiIZQAASIjlPbCvDADQTWJ5z+wrAwB0h1gGAICEWAYAgIRY3rHH+8pWMAAAukUsAwBAQiwDAEBCLO+Qh4wDAOg2sbwn9pUBALpHLAMAQEIsAwBAQizviH1lAIDuE8t7YF8ZAKCbxPKemDQDAHSPWAYAgIRY3rG6rk2VAQA6SiwDAECi17FcVcuYT6dRFMXD03Qa88Uyqj2dwVQZAKC7irqnD9VQLaYxPl3nLzCZxdXqPA63+DZ/F8Y9fVcDAD1y1zO6ZaOfk+VqEcd3oTw5i6uyjrquo67LKK9mMYmIWF/Ep/myyVMCALTW45/MD1kvJ8vLeRGfLiJichbl6iRGv75AFJsXiLNyFSe/vMDbvPTJ1MN3MwDQQ35S/lQPJ8vL+HaxeW7y5fOvoRwRcXgUs4iIWMfl931tLwMAdN/QJs79i+XqR1xHRMQkvnzORsaHcbSp5Vhfft/5xX5D+z8wAHiLoUVYHwzhY9a/WC5vYrOtfBAfXlivGH+cbJ5Z30S5h2MBAPRZX8O5d7Fc/bhu+ghPmCoDAEPTp2juXSy/1ujDQdNHAFqgr5MQgDbow/fYv5o+QPOu40cVcfjOR8TIPgm6/MkBQ+PrFdrD1yNtMdjJ8oOXd5sBABguk2UAAHaiD9duDTaWt30hYF3XT35k1IdPDhgCX7fQHr4e22EbKzB9+vj1bg3j4cK9zS5ypry5ux32xxhv6W1vbqld9+oTBADgNfraQb2L5cd357tJH0C5ivvB8sGH5+/yBwDsVV9jq8+G8DHrXyzHOO7uN3Lxbfn8i1Tf4/J2sDw7OtzPsYBWGsI3eoBtGtr3zR7G8ihO/rm9l/XFp5guftrFqJYxPz7d3OVvchZ/a2UAgBcNLZAfK+qe/quX8yI+Xdz9ahKTSUTEOtbrh987K1dxYgcDAOCeCy2f6m0sR1SxXPwX/55exPrnP5rM4urr+btvRAIAQL/1OJYfqaq4X8YYjVzQBwDAqwwjlgEA4A16eIEfANAZ1TLm02lMp0UUxdOn6XQei+ULN02APTBZBgCaUy1iOj799fqixyZnUa5OrFHSCJNlAKBBn+OfqzLKsn7y8GR1eRVns9sbJ6xP4/jnh4KFPTFZBgBa6/6hYE2XaYjJMgDQWodHtzcaW99E2exRGCixDAC01/hjbJYxruOHTQwa8FfTBwDYu6qKqvwe37/dxOX1dcTBl/h67se70Erlze3FfwfxwRcpDRDLwDBUi5geX8Z6/dw191/2fhzgdZbfLjbPTD7GuNmjMFDWMIBhKG8eQnkyiclsFncX2gMtVS3i37tW/vLZT39ohFgGhmH8d5RluXlIqtUqVufncXTQ9KGAXBWL49vHX56cxdcTqUwzrGEAwzAamUpBhyzn4zjdlHKcfXVNAc0xWQYAWmU5n24eWzkmMbtahaEyTTJZBgBaoorlfPwklM8Pmz4TQyeWAYAWqGIxfbR6UZoo0w7WMACAZlXLmN+F8mQWV0KZFjFZBgAaUy3ncfzp4v5RL8qVi/loF7EMADSiWs5jvFlQjslZGSvjZFrIGgYA0Iwf1/fPrk/HURTFy0/TRVQNHpdhEssAAJCwhgEANGJ0sor6pOlTwMtMlgEAICGWAQAgIZYBACAhlgEAICGWAQAgUdR1XTd9CAAAaCOTZQAASIhlAABIiGUAAEiIZQAASIhlAABIiGUAAEiIZQAASIhlAABIiGUAAEiIZQAASIhlAABI/B9dL2XCBqYOYgAAAABJRU5ErkJggg==" alt="image-20210716113426524"></p><p>平滑的 QPS 曲线，对于服务器来说是更友好的。</p><p><strong>案例</strong></p><p>需求：给/order/{orderId}这个资源设置限流，最大 QPS 为 10，利用排队的流控效果，超时时长设置为 5s</p><h4 id="_1-添加流控规则" tabindex="-1"><a class="header-anchor" href="#_1-添加流控规则" aria-hidden="true">#</a> 1）添加流控规则</h4><p><img src="/MyBlog/assets/image-20210716114048918-7e3e83a4.png" alt="image-20210716114048918"></p><h4 id="_2-jmeter-测试-1" tabindex="-1"><a class="header-anchor" href="#_2-jmeter-测试-1" aria-hidden="true">#</a> 2）Jmeter 测试</h4><p>选择《流控效果，队列》：</p><p><img src="/MyBlog/assets/image-20210716114243558-73f78da1.png" alt="image-20210716114243558"></p><p>QPS 为 15，已经超过了我们设定的 10。</p><p>如果是之前的 快速失败、warmup 模式，超出的请求应该会直接报错。</p><p>但是我们看看队列模式的运行结果：</p><p><img src="/MyBlog/assets/image-20210716114429361-fb78dba3.png" alt="image-20210716114429361"></p><p>全部都通过了。</p><p>再去 sentinel 查看实时监控的 QPS 曲线：</p><p><img src="/MyBlog/assets/image-20210716114522935-c3046df2.png" alt="image-20210716114522935"></p><p>QPS 非常平滑，一致保持在 10，但是超出的请求没有被拒绝，而是放入队列。因此<strong>响应时间</strong>（等待时间）会越来越长。</p><p>当队列满了以后，才会有部分请求失败：</p><p><img src="/MyBlog/assets/image-20210716114651137-9ec9884a.png" alt="image-20210716114651137"></p><h3 id="_2-3-3-总结" tabindex="-1"><a class="header-anchor" href="#_2-3-3-总结" aria-hidden="true">#</a> 2.3.3.总结</h3><p>流控效果有哪些？</p><ul><li><p>快速失败：QPS 超过阈值时，拒绝新的请求</p></li><li><p>warm up： QPS 超过阈值时，拒绝新的请求；QPS 阈值是逐渐提升的，可以避免冷启动时高并发导致服务宕机。</p></li><li><p>排队等待：请求会进入队列，按照阈值允许的时间间隔依次执行请求；如果请求预期等待时长大于超时时间，直接拒绝</p></li></ul><h2 id="_2-4-热点参数限流" tabindex="-1"><a class="header-anchor" href="#_2-4-热点参数限流" aria-hidden="true">#</a> 2.4.热点参数限流</h2><p>之前的限流是统计访问某个资源的所有请求，判断是否超过 QPS 阈值。而热点参数限流是<strong>分别统计参数值相同的请求</strong>，判断是否超过 QPS 阈值。</p><h3 id="_2-4-1-全局参数限流" tabindex="-1"><a class="header-anchor" href="#_2-4-1-全局参数限流" aria-hidden="true">#</a> 2.4.1.全局参数限流</h3><p>例如，一个根据 id 查询商品的接口：</p><p><img src="/MyBlog/assets/image-20210716115014663-ff61aa96.png" alt="image-20210716115014663"></p><p>访问/goods/{id}的请求中，id 参数值会有变化，热点参数限流会根据参数值分别统计 QPS，统计结果：</p><p><img src="/MyBlog/assets/image-20210716115131463-dff069a4.png" alt="image-20210716115131463"></p><p>当 id=1 的请求触发阈值被限流时，id 值不为 1 的请求不受影响。</p><p>配置示例：</p><p><img src="/MyBlog/assets/image-20210716115232426-b04249f5.png" alt="image-20210716115232426"></p><p>代表的含义是：对 hot 这个资源的 0 号参数（第一个参数）做统计，每 1 秒<strong>相同参数值</strong>的请求数不能超过 5</p><h3 id="_2-4-2-热点参数限流" tabindex="-1"><a class="header-anchor" href="#_2-4-2-热点参数限流" aria-hidden="true">#</a> 2.4.2.热点参数限流</h3><p>刚才的配置中，对查询商品这个接口的所有商品一视同仁，QPS 都限定为 5.</p><p>而在实际开发中，可能部分商品是热点商品，例如秒杀商品，我们希望这部分商品的 QPS 限制与其它商品不一样，高一些。那就需要配置热点参数限流的高级选项了：</p><p><img src="/MyBlog/assets/image-20210716115717523-1f16a98a.png" alt="image-20210716115717523"></p><p>结合上一个配置，这里的含义是对 0 号的 long 类型参数限流，每 1 秒相同参数的 QPS 不能超过 5，有两个例外：</p><p>•如果参数值是 100，则每 1 秒允许的 QPS 为 10</p><p>•如果参数值是 101，则每 1 秒允许的 QPS 为 15</p><h3 id="_2-4-4-案例" tabindex="-1"><a class="header-anchor" href="#_2-4-4-案例" aria-hidden="true">#</a> 2.4.4.案例</h3><p><strong>案例需求</strong>：给/order/{orderId}这个资源添加热点参数限流，规则如下：</p><p>•默认的热点参数规则是每 1 秒请求量不超过 2</p><p>•给 102 这个参数设置例外：每 1 秒请求量不超过 4</p><p>•给 103 这个参数设置例外：每 1 秒请求量不超过 10</p><p><strong>注意事项</strong>：热点参数限流对默认的 SpringMVC 资源无效，需要利用@SentinelResource 注解标记资源</p><h4 id="_1-标记资源" tabindex="-1"><a class="header-anchor" href="#_1-标记资源" aria-hidden="true">#</a> 1）标记资源</h4><p>给 order-service 中的 OrderController 中的/order/{orderId}资源添加注解：</p><p><img src="/MyBlog/assets/image-20210716120033572-a99d7812.png" alt="image-20210716120033572"></p><h4 id="_2-热点参数限流规则" tabindex="-1"><a class="header-anchor" href="#_2-热点参数限流规则" aria-hidden="true">#</a> 2）热点参数限流规则</h4><p>访问该接口，可以看到我们标记的 hot 资源出现了：</p><p><img src="/MyBlog/assets/image-20210716120208509-85d376c6.png" alt="image-20210716120208509"></p><p>这里不要点击 hot 后面的按钮，页面有 BUG</p><p>点击左侧菜单中<strong>热点规则</strong>菜单：</p><p><img src="/MyBlog/assets/image-20210716120319009-e9b5d00a.png" alt="image-20210716120319009"></p><p>点击新增，填写表单：</p><p><img src="/MyBlog/assets/image-20210716120536714-743201ba.png" alt="image-20210716120536714"></p><h4 id="_3-jmeter-测试" tabindex="-1"><a class="header-anchor" href="#_3-jmeter-测试" aria-hidden="true">#</a> 3）Jmeter 测试</h4><p>选择《热点参数限流 QPS1》：</p><p><img src="/MyBlog/assets/image-20210716120754527-bb05298e.png" alt="image-20210716120754527"></p><p>这里发起请求的 QPS 为 5.</p><p>包含 3 个 http 请求：</p><p>普通参数，QPS 阈值为 2</p><p><img src="/MyBlog/assets/image-20210716120840501-67b6176a.png" alt="image-20210716120840501"></p><p>运行结果：</p><p><img src="/MyBlog/assets/image-20210716121105567-cf06d596.png" alt="image-20210716121105567"></p><p>例外项，QPS 阈值为 4</p><p><img src="/MyBlog/assets/image-20210716120900365-1ab22a6c.png" alt="image-20210716120900365"></p><p>运行结果：</p><p><img src="/MyBlog/assets/image-20210716121201630-ffc4d49e.png" alt="image-20210716121201630"></p><p>例外项，QPS 阈值为 10</p><p><img src="/MyBlog/assets/image-20210716120919131-09512dc7.png" alt="image-20210716120919131"></p><p>运行结果：</p><p><img src="/MyBlog/assets/image-20210716121220305-9c447b50.png" alt="image-20210716121220305"></p><h1 id="_3-隔离和降级" tabindex="-1"><a class="header-anchor" href="#_3-隔离和降级" aria-hidden="true">#</a> 3.隔离和降级</h1><p>限流是一种预防措施，虽然限流可以尽量避免因高并发而引起的服务故障，但服务还会因为其它原因而故障。</p><p>而要将这些故障控制在一定范围，避免雪崩，就要靠<strong>线程隔离</strong>（舱壁模式）和<strong>熔断降级</strong>手段了。</p><p><strong>线程隔离</strong>之前讲到过：调用者在调用服务提供者时，给每个调用的请求分配独立线程池，出现故障时，最多消耗这个线程池内资源，避免把调用者的所有资源耗尽。</p><p><img src="/MyBlog/assets/image-20210715173215243-8b265628.png" alt="image-20210715173215243"></p><p><strong>熔断降级</strong>：是在调用方这边加入断路器，统计对服务提供者的调用，如果调用的失败比例过高，则熔断该业务，不允许访问该服务的提供者了。</p><p><img src="/MyBlog/assets/image-20210715173428073-fe839882.png" alt="image-20210715173428073"></p><p>可以看到，不管是线程隔离还是熔断降级，都是对<strong>客户端</strong>（调用方）的保护。需要在<strong>调用方</strong> 发起远程调用时做线程隔离、或者服务熔断。</p><p>而我们的微服务远程调用都是基于 Feign 来完成的，因此我们需要将 Feign 与 Sentinel 整合，在 Feign 里面实现线程隔离和服务熔断。</p><h2 id="_3-1-feignclient-整合-sentinel" tabindex="-1"><a class="header-anchor" href="#_3-1-feignclient-整合-sentinel" aria-hidden="true">#</a> 3.1.FeignClient 整合 Sentinel</h2><p>SpringCloud 中，微服务调用都是通过 Feign 来实现的，因此做客户端保护必须整合 Feign 和 Sentinel。</p><h3 id="_3-1-1-修改配置-开启-sentinel-功能" tabindex="-1"><a class="header-anchor" href="#_3-1-1-修改配置-开启-sentinel-功能" aria-hidden="true">#</a> 3.1.1.修改配置，开启 sentinel 功能</h3><p>修改 OrderService 的 application.yml 文件，开启 Feign 的 Sentinel 功能：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开启feign对sentinel的支持</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-1-2-编写失败降级逻辑" tabindex="-1"><a class="header-anchor" href="#_3-1-2-编写失败降级逻辑" aria-hidden="true">#</a> 3.1.2.编写失败降级逻辑</h3><p>业务失败后，不能直接报错，而应该返回用户一个友好提示或者默认结果，这个就是失败降级逻辑。</p><p>给 FeignClient 编写失败后的降级逻辑</p><p>① 方式一：FallbackClass，无法对远程调用的异常做处理</p><p>② 方式二：FallbackFactory，可以对远程调用的异常做处理，我们选择这种</p><p>这里我们演示方式二的失败降级处理。</p><p><strong>步骤一</strong>：在 feing-api 项目中定义类，实现 FallbackFactory：</p><p><img src="/MyBlog/assets/image-20210716122403502-3e481e26.png" alt="image-20210716122403502"></p><p>代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>fallback</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>clients<span class="token punctuation">.</span></span><span class="token class-name">UserClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">feign<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span><span class="token class-name">FallbackFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserClientFallbackFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserClient</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserClient</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;查询用户异常&quot;</span><span class="token punctuation">,</span> throwable<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤二</strong>：在 feing-api 项目中的 DefaultFeignConfiguration 类中将 UserClientFallbackFactory 注册为一个 Bean：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UserClientFallbackFactory</span> <span class="token function">userClientFallbackFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserClientFallbackFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤三</strong>：在 feing-api 项目中的 UserClient 接口中使用 UserClientFallbackFactory：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span></span><span class="token class-name">UserClientFallbackFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userservice&quot;</span><span class="token punctuation">,</span> fallbackFactory <span class="token operator">=</span> <span class="token class-name">UserClientFallbackFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启后，访问一次订单查询业务，然后查看 sentinel 控制台，可以看到新的簇点链路：</p><p><img src="/MyBlog/assets/image-20210716123705780-91c41bb6.png" alt="image-20210716123705780"></p><h3 id="_3-1-3-总结" tabindex="-1"><a class="header-anchor" href="#_3-1-3-总结" aria-hidden="true">#</a> 3.1.3.总结</h3><p>Sentinel 支持的雪崩解决方案：</p><ul><li>线程隔离（仓壁模式）</li><li>降级熔断</li></ul><p>Feign 整合 Sentinel 的步骤：</p><ul><li>在 application.yml 中配置：feign.sentienl.enable=true</li><li>给 FeignClient 编写 FallbackFactory 并注册为 Bean</li><li>将 FallbackFactory 配置到 FeignClient</li></ul><h2 id="_3-2-线程隔离-舱壁模式" tabindex="-1"><a class="header-anchor" href="#_3-2-线程隔离-舱壁模式" aria-hidden="true">#</a> 3.2.线程隔离（舱壁模式）</h2><h3 id="_3-2-1-线程隔离的实现方式" tabindex="-1"><a class="header-anchor" href="#_3-2-1-线程隔离的实现方式" aria-hidden="true">#</a> 3.2.1.线程隔离的实现方式</h3><p>线程隔离有两种方式实现：</p><ul><li><p>线程池隔离</p></li><li><p>信号量隔离（Sentinel 默认采用）</p></li></ul><p>如图：</p><p><img src="/MyBlog/assets/image-20210716123036937-d171ddfc.png" alt="image-20210716123036937"></p><p><strong>线程池隔离</strong>：给每个服务调用业务分配一个线程池，利用线程池本身实现隔离效果</p><p><strong>信号量隔离</strong>：不创建线程池，而是计数器模式，记录业务使用的线程数量，达到信号量上限时，禁止新的请求。</p><p>两者的优缺点：</p><p><img src="/MyBlog/assets/image-20210716123240518-f549fc62.png" alt="image-20210716123240518"></p><h3 id="_3-2-2-sentinel-的线程隔离" tabindex="-1"><a class="header-anchor" href="#_3-2-2-sentinel-的线程隔离" aria-hidden="true">#</a> 3.2.2.sentinel 的线程隔离</h3><p><strong>用法说明</strong>：</p><p>在添加限流规则时，可以选择两种阈值类型：</p><p><img src="/MyBlog/assets/image-20210716123411217-5f0f4f3d.png" alt="image-20210716123411217"></p><ul><li><p>QPS：就是每秒的请求数，在快速入门中已经演示过</p></li><li><p>线程数：是该资源能使用用的 tomcat 线程数的最大值。也就是通过限制线程数量，实现<strong>线程隔离</strong>（舱壁模式）。</p></li></ul><p><strong>案例需求</strong>：给 order-service 服务中的 UserClient 的查询用户接口设置流控规则，线程数不能超过 2。然后利用 jemeter 测试。</p><h4 id="_1-配置隔离规则" tabindex="-1"><a class="header-anchor" href="#_1-配置隔离规则" aria-hidden="true">#</a> 1）配置隔离规则</h4><p>选择 feign 接口后面的流控按钮：</p><p><img src="/MyBlog/assets/image-20210716123831992-d115a12e.png" alt="image-20210716123831992"></p><p>填写表单：</p><p><img src="/MyBlog/assets/image-20210716123936844-0fe6b391.png" alt="image-20210716123936844"></p><h4 id="_2-jmeter-测试-2" tabindex="-1"><a class="header-anchor" href="#_2-jmeter-测试-2" aria-hidden="true">#</a> 2）Jmeter 测试</h4><p>选择《阈值类型-线程数&lt;2》：</p><p><img src="/MyBlog/assets/image-20210716124229894-42536f47.png" alt="image-20210716124229894"></p><p>一次发生 10 个请求，有较大概率并发线程数超过 2，而超出的请求会走之前定义的失败降级逻辑。</p><p>查看运行结果：</p><p><img src="/MyBlog/assets/image-20210716124147820-9cf7ddd8.png" alt="image-20210716124147820"></p><p>发现虽然结果都是通过了，不过部分请求得到的响应是降级返回的 null 信息。</p><h3 id="_3-2-3-总结" tabindex="-1"><a class="header-anchor" href="#_3-2-3-总结" aria-hidden="true">#</a> 3.2.3.总结</h3><p>线程隔离的两种手段是？</p><ul><li><p>信号量隔离</p></li><li><p>线程池隔离</p></li></ul><p>信号量隔离的特点是？</p><ul><li>基于计数器模式，简单，开销小</li></ul><p>线程池隔离的特点是？</p><ul><li>基于线程池模式，有额外开销，但隔离控制更强</li></ul><h2 id="_3-3-熔断降级" tabindex="-1"><a class="header-anchor" href="#_3-3-熔断降级" aria-hidden="true">#</a> 3.3.熔断降级</h2><p>熔断降级是解决雪崩问题的重要手段。其思路是由<strong>断路器</strong>统计服务调用的异常比例、慢请求比例，如果超出阈值则会<strong>熔断</strong>该服务。即拦截访问该服务的一切请求；而当服务恢复时，断路器会放行访问该服务的请求。</p><p>断路器控制熔断和放行是通过状态机来完成的：</p><p><img src="/MyBlog/assets/image-20210716130958518-816f3f6c.png" alt="image-20210716130958518"></p><p>状态机包括三个状态：</p><ul><li>closed：关闭状态，断路器放行所有请求，并开始统计异常比例、慢请求比例。超过阈值则切换到 open 状态</li><li>open：打开状态，服务调用被<strong>熔断</strong>，访问被熔断服务的请求会被拒绝，快速失败，直接走降级逻辑。Open 状态 5 秒后会进入 half-open 状态</li><li>half-open：半开状态，放行一次请求，根据执行结果来判断接下来的操作。 <ul><li>请求成功：则切换到 closed 状态</li><li>请求失败：则切换到 open 状态</li></ul></li></ul><p>断路器熔断策略有三种：慢调用、异常比例、异常数</p><h3 id="_3-3-1-慢调用" tabindex="-1"><a class="header-anchor" href="#_3-3-1-慢调用" aria-hidden="true">#</a> 3.3.1.慢调用</h3><p><strong>慢调用</strong>：业务的响应时长（RT）大于指定时长的请求认定为慢调用请求。在指定时间内，如果请求数量超过设定的最小数量，慢调用比例大于设定的阈值，则触发熔断。</p><p>例如：</p><p><img src="/MyBlog/assets/image-20210716145934347-915ebdad.png" alt="image-20210716145934347"></p><p>解读：RT 超过 500ms 的调用是慢调用，统计最近 10000ms 内的请求，如果请求量超过 10 次，并且慢调用比例不低于 0.5，则触发熔断，熔断时长为 5 秒。然后进入 half-open 状态，放行一次请求做测试。</p><p><strong>案例</strong></p><p>需求：给 UserClient 的查询用户接口设置降级规则，慢调用的 RT 阈值为 50ms，统计时间为 1 秒，最小请求数量为 5，失败阈值比例为 0.4，熔断时长为 5</p><h4 id="_1-设置慢调用" tabindex="-1"><a class="header-anchor" href="#_1-设置慢调用" aria-hidden="true">#</a> 1）设置慢调用</h4><p>修改 user-service 中的/user/{id}这个接口的业务。通过休眠模拟一个延迟时间：</p><p><img src="/MyBlog/assets/image-20210716150234787-61bd6ca6.png" alt="image-20210716150234787"></p><p>此时，orderId=101 的订单，关联的是 id 为 1 的用户，调用时长为 60ms：</p><p><img src="/MyBlog/assets/image-20210716150510956-c3be6efe.png" alt="image-20210716150510956"></p><p>orderId=102 的订单，关联的是 id 为 2 的用户，调用时长为非常短；</p><p><img src="/MyBlog/assets/image-20210716150605208-4b2c648a.png" alt="image-20210716150605208"></p><h4 id="_2-设置熔断规则" tabindex="-1"><a class="header-anchor" href="#_2-设置熔断规则" aria-hidden="true">#</a> 2）设置熔断规则</h4><p>下面，给 feign 接口设置降级规则：</p><p><img src="/MyBlog/assets/image-20210716150654094-7c7b9642.png" alt="image-20210716150654094"></p><p>规则：</p><p><img src="/MyBlog/assets/image-20210716150740434-0a925941.png" alt="image-20210716150740434"></p><p>超过 50ms 的请求都会被认为是慢请求</p><h4 id="_3-测试" tabindex="-1"><a class="header-anchor" href="#_3-测试" aria-hidden="true">#</a> 3）测试</h4><p>在浏览器访问：http://localhost:8088/order/101，快速刷新 5 次，可以发现：</p><p><img src="/MyBlog/assets/image-20210716150911004-188aea78.png" alt="image-20210716150911004"></p><p>触发了熔断，请求时长缩短至 5ms，快速失败了，并且走降级逻辑，返回的 null</p><p>在浏览器访问：http://localhost:8088/order/102，竟然也被熔断了：</p><p><img src="/MyBlog/assets/image-20210716151107785-92a6ed5c.png" alt="image-20210716151107785"></p><h3 id="_3-3-2-异常比例、异常数" tabindex="-1"><a class="header-anchor" href="#_3-3-2-异常比例、异常数" aria-hidden="true">#</a> 3.3.2.异常比例、异常数</h3><p><strong>异常比例或异常数</strong>：统计指定时间内的调用，如果调用次数超过指定请求数，并且出现异常的比例达到设定的比例阈值（或超过指定异常数），则触发熔断。</p><p>例如，一个异常比例设置：</p><p><img src="/MyBlog/assets/image-20210716131430682-a06c4deb.png" alt="image-20210716131430682"></p><p>解读：统计最近 1000ms 内的请求，如果请求量超过 10 次，并且异常比例不低于 0.4，则触发熔断。</p><p>一个异常数设置：</p><p><img src="/MyBlog/assets/image-20210716131522912-911e1bf9.png" alt="image-20210716131522912"></p><p>解读：统计最近 1000ms 内的请求，如果请求量超过 10 次，并且异常比例不低于 2 次，则触发熔断。</p><p><strong>案例</strong></p><p>需求：给 UserClient 的查询用户接口设置降级规则，统计时间为 1 秒，最小请求数量为 5，失败阈值比例为 0.4，熔断时长为 5s</p><h4 id="_1-设置异常请求" tabindex="-1"><a class="header-anchor" href="#_1-设置异常请求" aria-hidden="true">#</a> 1）设置异常请求</h4><p>首先，修改 user-service 中的/user/{id}这个接口的业务。手动抛出异常，以触发异常比例的熔断：</p><p><img src="/MyBlog/assets/image-20210716151348183-4a7c8b46.png" alt="image-20210716151348183"></p><p>也就是说，id 为 2 时，就会触发异常</p><h4 id="_2-设置熔断规则-1" tabindex="-1"><a class="header-anchor" href="#_2-设置熔断规则-1" aria-hidden="true">#</a> 2）设置熔断规则</h4><p>下面，给 feign 接口设置降级规则：</p><p><img src="/MyBlog/assets/image-20210716150654094-7c7b9642.png" alt="image-20210716150654094"></p><p>规则：</p><p><img src="/MyBlog/assets/image-20210716151538785-066849e8.png" alt="image-20210716151538785"></p><p>在 5 次请求中，只要异常比例超过 0.4，也就是有 2 次以上的异常，就会触发熔断。</p><h4 id="_3-测试-1" tabindex="-1"><a class="header-anchor" href="#_3-测试-1" aria-hidden="true">#</a> 3）测试</h4><p>在浏览器快速访问：http://localhost:8088/order/102，快速刷新 5 次，触发熔断：</p><p><img src="/MyBlog/assets/image-20210716151722916-2084ab48.png" alt="image-20210716151722916"></p><p>此时，我们去访问本来应该正常的 103：</p><p><img src="/MyBlog/assets/image-20210716151844817-fd55013c.png" alt="image-20210716151844817"></p><h1 id="_4-授权规则" tabindex="-1"><a class="header-anchor" href="#_4-授权规则" aria-hidden="true">#</a> 4.授权规则</h1><p>授权规则可以对请求方来源做判断和控制。</p><p>前言：我们以前学过 SpringCloud Gateway 作为把门的（看门大爷） 所有请求进入网关由网关验证权限规则，再路由到各个微服务，怎么到这又要整一个权限呢?</p><p>试想一下，万一公司出现了内鬼，把微服务地址泄露出去给了些不怀好意的人，那这些哥们就可以绕过网关直接访问微服务了，那么任凭你网关配置的再强大，也是隔靴搔痒，无济于事了，所以 sentinel 的授权规则就是结果这一系列问题的。(如果是从网关过来的就放行，如果是从别的地方过来的就拦截)</p><h2 id="_4-1-授权规则" tabindex="-1"><a class="header-anchor" href="#_4-1-授权规则" aria-hidden="true">#</a> 4.1.授权规则</h2><h3 id="_4-1-1-基本规则" tabindex="-1"><a class="header-anchor" href="#_4-1-1-基本规则" aria-hidden="true">#</a> 4.1.1.基本规则</h3><p>授权规则可以对调用方的来源做控制，有白名单和黑名单两种方式。</p><ul><li><p>白名单：来源（origin）在白名单内的调用者允许访问</p></li><li><p>黑名单：来源（origin）在黑名单内的调用者不允许访问</p></li></ul><p>点击左侧菜单的授权，可以看到授权规则：</p><p><img src="/MyBlog/assets/image-20210716152010750-91077ac9.png" alt="image-20210716152010750"></p><ul><li><p>资源名：就是受保护的资源，例如/order/{orderId}</p></li><li><p>流控应用：是来源者的名单，</p><ul><li>如果是勾选白名单，则名单中的来源被许可访问。</li><li>如果是勾选黑名单，则名单中的来源被禁止访问。</li></ul></li></ul><p>比如：</p><p><img src="/MyBlog/assets/image-20210716152349191-ac1bd26d.png" alt="image-20210716152349191"></p><p>我们允许请求从 gateway 到 order-service，不允许浏览器访问 order-service，那么白名单中就要填写<strong>网关的来源名称（origin）</strong>。</p><h3 id="_4-1-2-如何获取-origin" tabindex="-1"><a class="header-anchor" href="#_4-1-2-如何获取-origin" aria-hidden="true">#</a> 4.1.2.如何获取 origin</h3><p>Sentinel 是通过 RequestOriginParser 这个接口的 parseOrigin 来获取请求的来源的。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RequestOriginParser</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 从请求request对象中获取origin，获取方式自定义
     */</span>
    <span class="token class-name">String</span> <span class="token function">parseOrigin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个方法的作用就是从 request 对象中，获取请求者的 origin 值并返回。</p><p>默认情况下，sentinel 不管请求者从哪里来，返回值永远是 default，也就是说一切请求的来源都被认为是一样的值 default。</p><p>因此，我们需要自定义这个接口的实现，让<strong>不同的请求，返回不同的 origin</strong>。</p><p>例如 order-service 服务中，我们定义一个 RequestOriginParser 的实现类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>order<span class="token punctuation">.</span>sentinel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>webmvc<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">RequestOriginParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeaderOriginParser</span> <span class="token keyword">implements</span> <span class="token class-name">RequestOriginParser</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">parseOrigin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.获取请求头</span>
        <span class="token class-name">String</span> origin <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.非空判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            origin <span class="token operator">=</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> origin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们会尝试从 request-header 中获取 origin 值。</p><h3 id="_4-1-3-给网关添加请求头" tabindex="-1"><a class="header-anchor" href="#_4-1-3-给网关添加请求头" aria-hidden="true">#</a> 4.1.3.给网关添加请求头</h3><p>既然获取请求 origin 的方式是从 reques-header 中获取 origin 值，我们必须让<strong>所有从 gateway 路由到微服务的请求都带上 origin 头</strong>。</p><p>这个需要利用之前学习的一个 GatewayFilter 来实现，AddRequestHeaderGatewayFilter。</p><p>修改 gateway 服务中的 application.yml，添加一个 defaultFilter：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestHeader=origin<span class="token punctuation">,</span>gateway
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token comment"># ...略</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，从 gateway 路由的所有请求都会带上 origin 头，值为 gateway。而从其它地方到达微服务的请求则没有这个头。</p><h3 id="_4-1-4-配置授权规则" tabindex="-1"><a class="header-anchor" href="#_4-1-4-配置授权规则" aria-hidden="true">#</a> 4.1.4.配置授权规则</h3><p>接下来，我们添加一个授权规则，放行 origin 值为 gateway 的请求。</p><p><img src="/MyBlog/assets/image-20210716153250134-3ce40c88.png" alt="image-20210716153250134"></p><p>配置如下：</p><p><img src="/MyBlog/assets/image-20210716153301069-5e528ac5.png" alt="image-20210716153301069"></p><p>现在，我们直接跳过网关，访问 order-service 服务：</p><p><img src="/MyBlog/assets/image-20210716153348396-a34f41a1.png" alt="image-20210716153348396"></p><p>通过网关访问：</p><p><img src="/MyBlog/assets/image-20210716153434095-4b569350.png" alt="image-20210716153434095"></p><h2 id="_4-2-自定义异常结果" tabindex="-1"><a class="header-anchor" href="#_4-2-自定义异常结果" aria-hidden="true">#</a> 4.2.自定义异常结果</h2><p>默认情况下，发生限流、降级、授权拦截时，都会抛出异常到调用方。异常结果都是 flow limmiting（限流）。这样不够友好，无法得知是限流还是降级还是授权拦截。</p><h3 id="_4-2-1-异常类型" tabindex="-1"><a class="header-anchor" href="#_4-2-1-异常类型" aria-hidden="true">#</a> 4.2.1.异常类型</h3><p>而如果要自定义异常时的返回结果，需要实现 BlockExceptionHandler 接口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BlockExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 处理请求被限流、降级、授权拦截时抛出的异常：BlockException
     */</span>
    <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个方法有三个参数：</p><ul><li>HttpServletRequest request：request 对象</li><li>HttpServletResponse response：response 对象</li><li>BlockException e：被 sentinel 拦截时抛出的异常</li></ul><p>这里的 BlockException 包含多个不同的子类：</p><table><thead><tr><th><strong>异常</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>FlowException</td><td>限流异常</td></tr><tr><td>ParamFlowException</td><td>热点参数限流的异常</td></tr><tr><td>DegradeException</td><td>降级异常</td></tr><tr><td>AuthorityException</td><td>授权规则异常</td></tr><tr><td>SystemBlockException</td><td>系统规则异常</td></tr></tbody></table><h3 id="_4-2-2-自定义异常处理" tabindex="-1"><a class="header-anchor" href="#_4-2-2-自定义异常处理" aria-hidden="true">#</a> 4.2.2.自定义异常处理</h3><p>下面，我们就在 order-service 定义一个自定义异常处理类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>order<span class="token punctuation">.</span>sentinel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>webmvc<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">BlockExceptionHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">AuthorityException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>degrade<span class="token punctuation">.</span></span><span class="token class-name">DegradeException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span></span><span class="token class-name">FlowException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>param<span class="token punctuation">.</span></span><span class="token class-name">ParamFlowException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SentinelExceptionHandler</span> <span class="token keyword">implements</span> <span class="token class-name">BlockExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;未知异常&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> status <span class="token operator">=</span> <span class="token number">429</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">FlowException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;请求被限流了&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">ParamFlowException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;请求被热点参数限流&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">DegradeException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;请求被降级了&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">AuthorityException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;没有权限访问&quot;</span><span class="token punctuation">;</span>
            status <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;msg\&quot;: &quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;, \&quot;status\&quot;: &quot;</span> <span class="token operator">+</span> status <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启测试，在不同场景下，会返回不同的异常消息.</p><p>限流：</p><p><img src="/MyBlog/assets/image-20210716153938887-5dc7d0a6.png" alt="image-20210716153938887"></p><p>授权拦截时：</p><p><img src="/MyBlog/assets/image-20210716154012736-a3b63401.png" alt="image-20210716154012736"></p><h1 id="_5-规则持久化" tabindex="-1"><a class="header-anchor" href="#_5-规则持久化" aria-hidden="true">#</a> 5.规则持久化</h1><p>现在，sentinel 的所有规则都是内存存储，重启后所有规则都会丢失。在生产环境下，我们必须确保这些规则的持久化，避免丢失。</p><h2 id="_5-1-规则管理模式" tabindex="-1"><a class="header-anchor" href="#_5-1-规则管理模式" aria-hidden="true">#</a> 5.1.规则管理模式</h2><p>规则是否能持久化，取决于规则管理模式，sentinel 支持三种规则管理模式：</p><ul><li>原始模式：Sentinel 的默认模式，将规则保存在内存，重启服务会丢失。</li><li>pull 模式</li><li>push 模式</li></ul><h3 id="_5-1-1-pull-模式" tabindex="-1"><a class="header-anchor" href="#_5-1-1-pull-模式" aria-hidden="true">#</a> 5.1.1.pull 模式</h3><p>pull 模式：控制台将配置的规则推送到 Sentinel 客户端，而客户端会将配置规则保存在本地文件或数据库中。以后会定时去本地文件或数据库中查询，更新本地规则。</p><p><img src="/MyBlog/assets/image-20210716154155238-e30dbc83.png" alt="image-20210716154155238"></p><h3 id="_5-1-2-push-模式" tabindex="-1"><a class="header-anchor" href="#_5-1-2-push-模式" aria-hidden="true">#</a> 5.1.2.push 模式</h3><p>push 模式：控制台将配置规则推送到远程配置中心，例如 Nacos。Sentinel 客户端监听 Nacos，获取配置变更的推送消息，完成本地配置更新。</p><p><img src="/MyBlog/assets/image-20210716154215456-77dd36e5.png" alt="image-20210716154215456"></p><h2 id="_5-2-实现-push-模式" tabindex="-1"><a class="header-anchor" href="#_5-2-实现-push-模式" aria-hidden="true">#</a> 5.2.实现 push 模式</h2><p>详细步骤可以参考课前资料的《sentinel 规则持久化》：</p><p><img src="/MyBlog/assets/image-20210716154255466-b7af0c43.png" alt="image-20210716154255466"></p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ZyKunn/edit/main/notes/microservices/02/day01-微服务保护/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 814342838@qq.com">ZyKun</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/MyBlog/notes/microservices/02/Jmeter%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" class="" aria-label="Jmeter 快速入门 🧙"><!--[--><!--]--> Jmeter 快速入门 🧙 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/MyBlog/assets/app-a153c100.js" defer></script>
  </body>
</html>
