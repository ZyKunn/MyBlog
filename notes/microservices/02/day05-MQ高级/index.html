<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.63">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="./img/logo.png"><title>day05-æœåŠ¡å¼‚æ­¥é€šä¿¡-é«˜çº§ç¯‡ | ZyKunã®Blog</title><meta name="description" content="">
    <link rel="preload" href="/MyBlog/assets/style-57272a59.css" as="style"><link rel="stylesheet" href="/MyBlog/assets/style-57272a59.css">
    <link rel="modulepreload" href="/MyBlog/assets/app-a153c100.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-1d66d048.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-05c42fda.js"><link rel="prefetch" href="/MyBlog/assets/index.html-ab0151fa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1249ab5a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d02565e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1c68c797.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93acf26d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2bc953d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c526d7c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-636c9f52.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4177c6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7624decc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d0b4a798.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa378d7b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ddd44d65.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbb7f41.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-34576599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1079a374.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-88d4ebe7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5e927142.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a6f13b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c85da23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-69e813d7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545062a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd7a4fcb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-910949e0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-459b0c71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a036060.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f62ffe74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-841a86c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b31c8bb6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85bae056.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73555735.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d5456cd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d2dfbeec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-746091c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9cc627ff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d411448a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4454f425.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57aa84f4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2ce52087.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76657200.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90d9409e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d6ba5e7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-41bc7856.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6140daf4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ea30461d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00114784.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3fa86cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-386f0bd2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b46ac77e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-256a258e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4ebf55b3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7268161e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a8852c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19373782.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4e33bb6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-de5ff178.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd5da14a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dbee5a73.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64025c89.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9bd15ac7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4812edff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1f3f5c2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3f85e131.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-67b1b38e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-17f10f72.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ad1b5dc8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b14e7669.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa35810b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-acb9b7bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2ba9a88.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-abdb28e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b3cc33e9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ef13eee8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73fa0dcc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6f7449c7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3857ef8d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e5af1d8f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5d14c1f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-94a8b9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3931e4d3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0978879b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-617bd5bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fe008c8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0e33aa95.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00725025.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8e05ec6e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-72ca6b4c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-427c5181.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b3baf42.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-40a790c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9709e7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8eb00d02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c849262.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eda16f63.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81242655.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9f6820.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79188b74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5775eee0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eff0510c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-305de307.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e83a5de7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-761a9548.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c12ae66e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-87a73e5c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d720473a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b960b5b6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bbd98f93.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76195dca.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3bd0cfa7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8c87d147.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bac2e853.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ee6bc34.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ab7381d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5b97f6b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd33ca6f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-684189de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-63731ad7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-895bfca1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d1ff4c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b71bf26f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ce6f983b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c185f9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-29c62d64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-52c91de2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-55aa1c06.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c87ef63a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff1d9f51.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a12aedeb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-298f19f2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f881f599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c32406a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4217479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7edb7ce1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8671126f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da565d04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9deb3ec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee7cf1b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-270d6327.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ec786b75.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e98adf02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7233a0e2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79c193cf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9714081e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5dea51d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a235e4bb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e3209a23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cdce2101.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-389e66df.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-652ee4f6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-025e6f4e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-60711e70.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6edc93de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11bd39b1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53015219.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74dcd8ae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dd727db.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11b329fb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b6f3614.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-70ce719f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f6ca4d92.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a6833de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bf03220c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2edab58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f1e5cf7a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-21d4e18d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5235fca9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dc704c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57630906.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff165209.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6ec253a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9e4f0c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-664b232d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adf015a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4667c0e6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cc407710.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1752d212.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9b5d99c4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-43c48ae2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e8a616b7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93e7405b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-22a72a56.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-42ce3023.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f8eeab22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dd50991a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-af520db8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5ab2bfac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-965bc04f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81ebef01.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79d19f4d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9600bdfb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-560df48d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fb22a4f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd4caa82.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-370323f9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f673ebfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78d88460.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8b54347c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d30f0340.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e26bc4de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7d37b036.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3aa565ce.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c69f238.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76d60030.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7116a5e4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8f649cc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbbb7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90bb86fd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e23936a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19ad952b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-07245162.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-038b3afd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-084fe5c1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-098421fe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7baefce4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fffdfb9c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8c9612c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e1615934.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da824146.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa2d32f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545dbea7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3ca58cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b9e2188a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fc5f1f7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ec5c70d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cbf2aa55.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8beb0c08.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee54da9f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd28b91d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-98aa51a1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-03f9381a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9009c5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-71b7cfbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1759170e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa84186f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53160af7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51b685b4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ecb8e229.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9c507901.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6362722.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-faf67dd8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d7f20950.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a088985c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93b7982c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b76e6179.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d976d39c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b16efd78.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1301757e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c3240cbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2ddd21c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74fb5e20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-128f5026.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8fd9f38a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-82e84e23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-007ef014.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3dd860c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-382a2bae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b6beaec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2eb17cfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6f50213.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c8aef39.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-133f4d38.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cffd2be1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a798219d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b5fde77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-13275b71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4b6a02c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f179a12.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f45bc33f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0574e5e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0921816f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-631fbc02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8586017d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c4dbf09b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-967486c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aad17dde.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff644d77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78a4df64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d2180e8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53fbcd20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a3387e5e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-979f5ac4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0938c506.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51707e22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b1e917a0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b56a071.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d15eb498.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b0a97c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fda196b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bcc5faac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-490c208f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dce28479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62825d3c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b5a4af15.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eb40da96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d6d1c61.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-618cf3f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2a35430.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64f564d2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bca2187b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85181f96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f689b28.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62aa623a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b0c39cc5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73b8fff0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5466ae58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fbd0bcfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-5f041a2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/MyBlog/" class=""><!----><span class="site-name can-hide">ZyKunã®Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="router-link-active" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="router-link-active" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/MyBlog/notes/microservices/02/" class="router-link-active sidebar-item sidebar-heading active" aria-label="é«˜ç´šç¯‡"><!--[--><!--]--> é«˜ç´šç¯‡ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/MyBlog/notes/microservices/02/day01-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/" class="sidebar-item" aria-label="day01-å¾®æœåŠ¡ä¿æŠ¤"><!--[--><!--]--> day01-å¾®æœåŠ¡ä¿æŠ¤ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/Jmeter%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" class="sidebar-item" aria-label="Jmeter å¿«é€Ÿå…¥é—¨ ğŸ§™"><!--[--><!--]--> Jmeter å¿«é€Ÿå…¥é—¨ ğŸ§™ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/sentinel%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96/" class="sidebar-item" aria-label="Sentinel è§„åˆ™æŒä¹…åŒ– ğŸ§™"><!--[--><!--]--> Sentinel è§„åˆ™æŒä¹…åŒ– ğŸ§™ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/day02-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="sidebar-item" aria-label="day02-åˆ†å¸ƒå¼äº‹åŠ¡"><!--[--><!--]--> day02-åˆ†å¸ƒå¼äº‹åŠ¡ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90/" class="sidebar-item" aria-label="seata çš„éƒ¨ç½²å’Œé›†æˆ ğŸ§™"><!--[--><!--]--> seata çš„éƒ¨ç½²å’Œé›†æˆ ğŸ§™ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/day03-%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98/" class="sidebar-item" aria-label="day03-åˆ†å¸ƒå¼ç¼“å­˜"><!--[--><!--]--> day03-åˆ†å¸ƒå¼ç¼“å­˜ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/microservices/02/Redis%E9%9B%86%E7%BE%A4/" class="sidebar-item" aria-label="Redis é›†ç¾¤ ğŸ§™"><!--[--><!--]--> Redis é›†ç¾¤ ğŸ§™ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="day05-æœåŠ¡å¼‚æ­¥é€šä¿¡-é«˜çº§ç¯‡"><!--[--><!--]--> day05-æœåŠ¡å¼‚æ­¥é€šä¿¡-é«˜çº§ç¯‡ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-1-ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤"><!--[--><!--]--> 1.1.ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-1-1-ä¿®æ”¹é…ç½®" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.1.ä¿®æ”¹é…ç½®"><!--[--><!--]--> 1.1.1.ä¿®æ”¹é…ç½® <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-1-2-å®šä¹‰-return-å›è°ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.2.å®šä¹‰ Return å›è°ƒ"><!--[--><!--]--> 1.1.2.å®šä¹‰ Return å›è°ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-1-3-å®šä¹‰-confirmcallback" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1.3.å®šä¹‰ ConfirmCallback"><!--[--><!--]--> 1.1.3.å®šä¹‰ ConfirmCallback <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-2-æ¶ˆæ¯æŒä¹…åŒ–" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.æ¶ˆæ¯æŒä¹…åŒ–"><!--[--><!--]--> 1.2.æ¶ˆæ¯æŒä¹…åŒ– <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-2-1-äº¤æ¢æœºæŒä¹…åŒ–" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.1.äº¤æ¢æœºæŒä¹…åŒ–"><!--[--><!--]--> 1.2.1.äº¤æ¢æœºæŒä¹…åŒ– <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-2-2-é˜Ÿåˆ—æŒä¹…åŒ–" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.2.é˜Ÿåˆ—æŒä¹…åŒ–"><!--[--><!--]--> 1.2.2.é˜Ÿåˆ—æŒä¹…åŒ– <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-2-3-æ¶ˆæ¯æŒä¹…åŒ–" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.3.æ¶ˆæ¯æŒä¹…åŒ–"><!--[--><!--]--> 1.2.3.æ¶ˆæ¯æŒä¹…åŒ– <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-3-æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3.æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤"><!--[--><!--]--> 1.3.æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-3-1-æ¼”ç¤º-none-æ¨¡å¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3.1.æ¼”ç¤º none æ¨¡å¼"><!--[--><!--]--> 1.3.1.æ¼”ç¤º none æ¨¡å¼ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-3-2-æ¼”ç¤º-auto-æ¨¡å¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3.2.æ¼”ç¤º auto æ¨¡å¼"><!--[--><!--]--> 1.3.2.æ¼”ç¤º auto æ¨¡å¼ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-4-æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.4.æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶"><!--[--><!--]--> 1.4.æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-4-1-æœ¬åœ°é‡è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.4.1.æœ¬åœ°é‡è¯•"><!--[--><!--]--> 1.4.1.æœ¬åœ°é‡è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-4-2-å¤±è´¥ç­–ç•¥" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.4.2.å¤±è´¥ç­–ç•¥"><!--[--><!--]--> 1.4.2.å¤±è´¥ç­–ç•¥ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-5-æ€»ç»“" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.5.æ€»ç»“"><!--[--><!--]--> 1.5.æ€»ç»“ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-1-åˆè¯†æ­»ä¿¡äº¤æ¢æœº" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.åˆè¯†æ­»ä¿¡äº¤æ¢æœº"><!--[--><!--]--> 2.1.åˆè¯†æ­»ä¿¡äº¤æ¢æœº <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-1-1-ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.1.ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº"><!--[--><!--]--> 2.1.1.ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-1-2-åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶æ­»ä¿¡-æ‹“å±•" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.2.åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶æ­»ä¿¡ï¼ˆæ‹“å±•ï¼‰"><!--[--><!--]--> 2.1.2.åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶æ­»ä¿¡ï¼ˆæ‹“å±•ï¼‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-1-3-æ€»ç»“" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.3.æ€»ç»“"><!--[--><!--]--> 2.1.3.æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-ttl" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.TTL"><!--[--><!--]--> 2.2.TTL <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-1-æ¥æ”¶è¶…æ—¶æ­»ä¿¡çš„æ­»ä¿¡äº¤æ¢æœº" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.1.æ¥æ”¶è¶…æ—¶æ­»ä¿¡çš„æ­»ä¿¡äº¤æ¢æœº"><!--[--><!--]--> 2.2.1.æ¥æ”¶è¶…æ—¶æ­»ä¿¡çš„æ­»ä¿¡äº¤æ¢æœº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-2-å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—-å¹¶ä¸”æŒ‡å®š-ttl" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2.å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”æŒ‡å®š TTL"><!--[--><!--]--> 2.2.2.å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”æŒ‡å®š TTL <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-3-å‘é€æ¶ˆæ¯æ—¶-è®¾å®š-ttl" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.3.å‘é€æ¶ˆæ¯æ—¶ï¼Œè®¾å®š TTL"><!--[--><!--]--> 2.2.3.å‘é€æ¶ˆæ¯æ—¶ï¼Œè®¾å®š TTL <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-4-æ€»ç»“" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.4.æ€»ç»“"><!--[--><!--]--> 2.2.4.æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-å»¶è¿Ÿé˜Ÿåˆ—" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.å»¶è¿Ÿé˜Ÿåˆ—"><!--[--><!--]--> 2.3.å»¶è¿Ÿé˜Ÿåˆ— <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-1-å®‰è£…-delayexchange-æ’ä»¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.1.å®‰è£… DelayExchange æ’ä»¶"><!--[--><!--]--> 2.3.1.å®‰è£… DelayExchange æ’ä»¶ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-2-delayexchange-åŸç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.2.DelayExchange åŸç†"><!--[--><!--]--> 2.3.2.DelayExchange åŸç† <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-3-ä½¿ç”¨-delayexchange" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.3.ä½¿ç”¨ DelayExchange"><!--[--><!--]--> 2.3.3.ä½¿ç”¨ DelayExchange <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-å£°æ˜-delayexchange-äº¤æ¢æœº" class="router-link-active router-link-exact-active sidebar-item" aria-label="1ï¼‰å£°æ˜ DelayExchange äº¤æ¢æœº"><!--[--><!--]--> 1ï¼‰å£°æ˜ DelayExchange äº¤æ¢æœº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-å‘é€æ¶ˆæ¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="2ï¼‰å‘é€æ¶ˆæ¯"><!--[--><!--]--> 2ï¼‰å‘é€æ¶ˆæ¯ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-4-æ€»ç»“" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.4.æ€»ç»“"><!--[--><!--]--> 2.3.4.æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-1-æ¶ˆæ¯å †ç§¯é—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.æ¶ˆæ¯å †ç§¯é—®é¢˜"><!--[--><!--]--> 3.1.æ¶ˆæ¯å †ç§¯é—®é¢˜ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-2-æƒ°æ€§é˜Ÿåˆ—" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.æƒ°æ€§é˜Ÿåˆ—"><!--[--><!--]--> 3.2.æƒ°æ€§é˜Ÿåˆ— <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-2-1-åŸºäºå‘½ä»¤è¡Œè®¾ç½®-lazy-queue" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.1.åŸºäºå‘½ä»¤è¡Œè®¾ç½® lazy-queue"><!--[--><!--]--> 3.2.1.åŸºäºå‘½ä»¤è¡Œè®¾ç½® lazy-queue <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-2-2-åŸºäº-bean-å£°æ˜-lazy-queue" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.2.åŸºäº@Bean å£°æ˜ lazy-queue"><!--[--><!--]--> 3.2.2.åŸºäº@Bean å£°æ˜ lazy-queue <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-2-3-åŸºäº-rabbitlistener-å£°æ˜-lazyqueue" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.3.åŸºäº@RabbitListener å£°æ˜ LazyQueue"><!--[--><!--]--> 3.2.3.åŸºäº@RabbitListener å£°æ˜ LazyQueue <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-3-æ€»ç»“" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.æ€»ç»“"><!--[--><!--]--> 3.3.æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-1-é›†ç¾¤åˆ†ç±»" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.é›†ç¾¤åˆ†ç±»"><!--[--><!--]--> 4.1.é›†ç¾¤åˆ†ç±» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-2-æ™®é€šé›†ç¾¤" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.æ™®é€šé›†ç¾¤"><!--[--><!--]--> 4.2.æ™®é€šé›†ç¾¤ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-2-1-é›†ç¾¤ç»“æ„å’Œç‰¹å¾" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.1.é›†ç¾¤ç»“æ„å’Œç‰¹å¾"><!--[--><!--]--> 4.2.1.é›†ç¾¤ç»“æ„å’Œç‰¹å¾ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-2-2-éƒ¨ç½²" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.2.éƒ¨ç½²"><!--[--><!--]--> 4.2.2.éƒ¨ç½² <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-3-é•œåƒé›†ç¾¤" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.é•œåƒé›†ç¾¤"><!--[--><!--]--> 4.3.é•œåƒé›†ç¾¤ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-3-1-é›†ç¾¤ç»“æ„å’Œç‰¹å¾" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.1.é›†ç¾¤ç»“æ„å’Œç‰¹å¾"><!--[--><!--]--> 4.3.1.é›†ç¾¤ç»“æ„å’Œç‰¹å¾ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-3-2-éƒ¨ç½²" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.2.éƒ¨ç½²"><!--[--><!--]--> 4.3.2.éƒ¨ç½² <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-ä»²è£é˜Ÿåˆ—" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.ä»²è£é˜Ÿåˆ—"><!--[--><!--]--> 4.4.ä»²è£é˜Ÿåˆ— <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-1-é›†ç¾¤ç‰¹å¾" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.1.é›†ç¾¤ç‰¹å¾"><!--[--><!--]--> 4.4.1.é›†ç¾¤ç‰¹å¾ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-2-éƒ¨ç½²" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.2.éƒ¨ç½²"><!--[--><!--]--> 4.4.2.éƒ¨ç½² <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-3-java-ä»£ç åˆ›å»ºä»²è£é˜Ÿåˆ—" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3.Java ä»£ç åˆ›å»ºä»²è£é˜Ÿåˆ—"><!--[--><!--]--> 4.4.3.Java ä»£ç åˆ›å»ºä»²è£é˜Ÿåˆ— <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-4-springamqp-è¿æ¥-mq-é›†ç¾¤" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.4.SpringAMQP è¿æ¥ MQ é›†ç¾¤"><!--[--><!--]--> 4.4.4.SpringAMQP è¿æ¥ MQ é›†ç¾¤ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/MyBlog/notes/microservices/02/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" class="sidebar-item" aria-label="RabbitMQ éƒ¨ç½²æŒ‡å— ğŸ§™"><!--[--><!--]--> RabbitMQ éƒ¨ç½²æŒ‡å— ğŸ§™ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="day05-æœåŠ¡å¼‚æ­¥é€šä¿¡-é«˜çº§ç¯‡" tabindex="-1"><a class="header-anchor" href="#day05-æœåŠ¡å¼‚æ­¥é€šä¿¡-é«˜çº§ç¯‡" aria-hidden="true">#</a> day05-æœåŠ¡å¼‚æ­¥é€šä¿¡-é«˜çº§ç¯‡</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-1-ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤" class="router-link-active router-link-exact-active">1.1.ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-1-1-ä¿®æ”¹é…ç½®" class="router-link-active router-link-exact-active">1.1.1.ä¿®æ”¹é…ç½®</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-1-2-å®šä¹‰-return-å›è°ƒ" class="router-link-active router-link-exact-active">1.1.2.å®šä¹‰ Return å›è°ƒ</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-1-3-å®šä¹‰-confirmcallback" class="router-link-active router-link-exact-active">1.1.3.å®šä¹‰ ConfirmCallback</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-2-æ¶ˆæ¯æŒä¹…åŒ–" class="router-link-active router-link-exact-active">1.2.æ¶ˆæ¯æŒä¹…åŒ–</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-2-1-äº¤æ¢æœºæŒä¹…åŒ–" class="router-link-active router-link-exact-active">1.2.1.äº¤æ¢æœºæŒä¹…åŒ–</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-2-2-é˜Ÿåˆ—æŒä¹…åŒ–" class="router-link-active router-link-exact-active">1.2.2.é˜Ÿåˆ—æŒä¹…åŒ–</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-2-3-æ¶ˆæ¯æŒä¹…åŒ–" class="router-link-active router-link-exact-active">1.2.3.æ¶ˆæ¯æŒä¹…åŒ–</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-3-æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤" class="router-link-active router-link-exact-active">1.3.æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-3-1-æ¼”ç¤º-none-æ¨¡å¼" class="router-link-active router-link-exact-active">1.3.1.æ¼”ç¤º none æ¨¡å¼</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-3-2-æ¼”ç¤º-auto-æ¨¡å¼" class="router-link-active router-link-exact-active">1.3.2.æ¼”ç¤º auto æ¨¡å¼</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-4-æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶" class="router-link-active router-link-exact-active">1.4.æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-4-1-æœ¬åœ°é‡è¯•" class="router-link-active router-link-exact-active">1.4.1.æœ¬åœ°é‡è¯•</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-4-2-å¤±è´¥ç­–ç•¥" class="router-link-active router-link-exact-active">1.4.2.å¤±è´¥ç­–ç•¥</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_1-5-æ€»ç»“" class="router-link-active router-link-exact-active">1.5.æ€»ç»“</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-1-åˆè¯†æ­»ä¿¡äº¤æ¢æœº" class="router-link-active router-link-exact-active">2.1.åˆè¯†æ­»ä¿¡äº¤æ¢æœº</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-1-1-ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº" class="router-link-active router-link-exact-active">2.1.1.ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-1-2-åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶æ­»ä¿¡-æ‹“å±•" class="router-link-active router-link-exact-active">2.1.2.åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶æ­»ä¿¡ï¼ˆæ‹“å±•ï¼‰</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-1-3-æ€»ç»“" class="router-link-active router-link-exact-active">2.1.3.æ€»ç»“</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-ttl" class="router-link-active router-link-exact-active">2.2.TTL</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-1-æ¥æ”¶è¶…æ—¶æ­»ä¿¡çš„æ­»ä¿¡äº¤æ¢æœº" class="router-link-active router-link-exact-active">2.2.1.æ¥æ”¶è¶…æ—¶æ­»ä¿¡çš„æ­»ä¿¡äº¤æ¢æœº</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-2-å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—-å¹¶ä¸”æŒ‡å®š-ttl" class="router-link-active router-link-exact-active">2.2.2.å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”æŒ‡å®š TTL</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-3-å‘é€æ¶ˆæ¯æ—¶-è®¾å®š-ttl" class="router-link-active router-link-exact-active">2.2.3.å‘é€æ¶ˆæ¯æ—¶ï¼Œè®¾å®š TTL</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-2-4-æ€»ç»“" class="router-link-active router-link-exact-active">2.2.4.æ€»ç»“</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-å»¶è¿Ÿé˜Ÿåˆ—" class="router-link-active router-link-exact-active">2.3.å»¶è¿Ÿé˜Ÿåˆ—</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-1-å®‰è£…-delayexchange-æ’ä»¶" class="router-link-active router-link-exact-active">2.3.1.å®‰è£… DelayExchange æ’ä»¶</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-2-delayexchange-åŸç†" class="router-link-active router-link-exact-active">2.3.2.DelayExchange åŸç†</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-3-ä½¿ç”¨-delayexchange" class="router-link-active router-link-exact-active">2.3.3.ä½¿ç”¨ DelayExchange</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_2-3-4-æ€»ç»“" class="router-link-active router-link-exact-active">2.3.4.æ€»ç»“</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-1-æ¶ˆæ¯å †ç§¯é—®é¢˜" class="router-link-active router-link-exact-active">3.1.æ¶ˆæ¯å †ç§¯é—®é¢˜</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-2-æƒ°æ€§é˜Ÿåˆ—" class="router-link-active router-link-exact-active">3.2.æƒ°æ€§é˜Ÿåˆ—</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-2-1-åŸºäºå‘½ä»¤è¡Œè®¾ç½®-lazy-queue" class="router-link-active router-link-exact-active">3.2.1.åŸºäºå‘½ä»¤è¡Œè®¾ç½® lazy-queue</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-2-2-åŸºäº-bean-å£°æ˜-lazy-queue" class="router-link-active router-link-exact-active">3.2.2.åŸºäº@Bean å£°æ˜ lazy-queue</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-2-3-åŸºäº-rabbitlistener-å£°æ˜-lazyqueue" class="router-link-active router-link-exact-active">3.2.3.åŸºäº@RabbitListener å£°æ˜ LazyQueue</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_3-3-æ€»ç»“" class="router-link-active router-link-exact-active">3.3.æ€»ç»“</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-1-é›†ç¾¤åˆ†ç±»" class="router-link-active router-link-exact-active">4.1.é›†ç¾¤åˆ†ç±»</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-2-æ™®é€šé›†ç¾¤" class="router-link-active router-link-exact-active">4.2.æ™®é€šé›†ç¾¤</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-2-1-é›†ç¾¤ç»“æ„å’Œç‰¹å¾" class="router-link-active router-link-exact-active">4.2.1.é›†ç¾¤ç»“æ„å’Œç‰¹å¾</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-2-2-éƒ¨ç½²" class="router-link-active router-link-exact-active">4.2.2.éƒ¨ç½²</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-3-é•œåƒé›†ç¾¤" class="router-link-active router-link-exact-active">4.3.é•œåƒé›†ç¾¤</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-3-1-é›†ç¾¤ç»“æ„å’Œç‰¹å¾" class="router-link-active router-link-exact-active">4.3.1.é›†ç¾¤ç»“æ„å’Œç‰¹å¾</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-3-2-éƒ¨ç½²" class="router-link-active router-link-exact-active">4.3.2.éƒ¨ç½²</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-ä»²è£é˜Ÿåˆ—" class="router-link-active router-link-exact-active">4.4.ä»²è£é˜Ÿåˆ—</a><ul><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-1-é›†ç¾¤ç‰¹å¾" class="router-link-active router-link-exact-active">4.4.1.é›†ç¾¤ç‰¹å¾</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-2-éƒ¨ç½²" class="router-link-active router-link-exact-active">4.4.2.éƒ¨ç½²</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-3-java-ä»£ç åˆ›å»ºä»²è£é˜Ÿåˆ—" class="router-link-active router-link-exact-active">4.4.3.Java ä»£ç åˆ›å»ºä»²è£é˜Ÿåˆ—</a></li><li><a aria-current="page" href="/MyBlog/notes/microservices/02/day05-MQ%E9%AB%98%E7%BA%A7/#_4-4-4-springamqp-è¿æ¥-mq-é›†ç¾¤" class="router-link-active router-link-exact-active">4.4.4.SpringAMQP è¿æ¥ MQ é›†ç¾¤</a></li></ul></li></ul></nav><p>æ¶ˆæ¯é˜Ÿåˆ—åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé¢ä¸´ç€å¾ˆå¤šå®é™…é—®é¢˜éœ€è¦æ€è€ƒï¼š</p><p><img src="/MyBlog/assets/image-20210718155003157-f574cd5e.png" alt="image-20210718155003157"></p><h1 id="_1-æ¶ˆæ¯å¯é æ€§" tabindex="-1"><a class="header-anchor" href="#_1-æ¶ˆæ¯å¯é æ€§" aria-hidden="true">#</a> 1.æ¶ˆæ¯å¯é æ€§</h1><p>æ¶ˆæ¯ä»å‘é€ï¼Œåˆ°æ¶ˆè´¹è€…æ¥æ”¶ï¼Œä¼šç»ç†å¤šä¸ªè¿‡ç¨‹ï¼š</p><p><img src="/MyBlog/assets/image-20210718155059371-0e786510.png" alt="image-20210718155059371"></p><p>å…¶ä¸­çš„æ¯ä¸€æ­¥éƒ½å¯èƒ½å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå¸¸è§çš„ä¸¢å¤±åŸå› åŒ…æ‹¬ï¼š</p><ul><li>å‘é€æ—¶ä¸¢å¤±ï¼š <ul><li>ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯æœªé€è¾¾ exchange</li><li>æ¶ˆæ¯åˆ°è¾¾ exchange åæœªåˆ°è¾¾ queue</li></ul></li><li>MQ å®•æœºï¼Œqueue å°†æ¶ˆæ¯ä¸¢å¤±</li><li>consumer æ¥æ”¶åˆ°æ¶ˆæ¯åæœªæ¶ˆè´¹å°±å®•æœº</li></ul><p>é’ˆå¯¹è¿™äº›é—®é¢˜ï¼ŒRabbitMQ åˆ†åˆ«ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</li><li>mq æŒä¹…åŒ–</li><li>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</li><li>å¤±è´¥é‡è¯•æœºåˆ¶</li></ul><p>ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡æ¡ˆä¾‹æ¥æ¼”ç¤ºæ¯ä¸€ä¸ªæ­¥éª¤ã€‚</p><p>é¦–å…ˆï¼Œå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„ demo å·¥ç¨‹ï¼š</p><p><img src="/MyBlog/assets/image-20210718155328927-a126a2ed.png" alt="image-20210718155328927"></p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20210718155448734-a5e010c5.png" alt="image-20210718155448734"></p><h2 id="_1-1-ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤" tabindex="-1"><a class="header-anchor" href="#_1-1-ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤" aria-hidden="true">#</a> 1.1.ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤</h2><p>RabbitMQ æä¾›äº† publisher confirm æœºåˆ¶æ¥é¿å…æ¶ˆæ¯å‘é€åˆ° MQ è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚è¿™ç§æœºåˆ¶å¿…é¡»ç»™æ¯ä¸ªæ¶ˆæ¯æŒ‡å®šä¸€ä¸ªå”¯ä¸€ IDã€‚æ¶ˆæ¯å‘é€åˆ° MQ ä»¥åï¼Œä¼šè¿”å›ä¸€ä¸ªç»“æœç»™å‘é€è€…ï¼Œè¡¨ç¤ºæ¶ˆæ¯æ˜¯å¦å¤„ç†æˆåŠŸã€‚</p><p>è¿”å›ç»“æœæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>publisher-confirmï¼Œå‘é€è€…ç¡®è®¤ <ul><li>æ¶ˆæ¯æˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœºï¼Œè¿”å› ack</li><li>æ¶ˆæ¯æœªæŠ•é€’åˆ°äº¤æ¢æœºï¼Œè¿”å› nack</li></ul></li><li>publisher-returnï¼Œå‘é€è€…å›æ‰§ <ul><li>æ¶ˆæ¯æŠ•é€’åˆ°äº¤æ¢æœºäº†ï¼Œä½†æ˜¯æ²¡æœ‰è·¯ç”±åˆ°é˜Ÿåˆ—ã€‚è¿”å› ACKï¼ŒåŠè·¯ç”±å¤±è´¥åŸå› ã€‚</li></ul></li></ul><p><img src="/MyBlog/assets/image-20210718160907166-587a7cc9.png" alt="image-20210718160907166"></p><p>æ³¨æ„ï¼š</p><p><img src="/MyBlog/assets/image-20210718161707992-2d5637f9.png" alt="image-20210718161707992"></p><h3 id="_1-1-1-ä¿®æ”¹é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-1-1-ä¿®æ”¹é…ç½®" aria-hidden="true">#</a> 1.1.1.ä¿®æ”¹é…ç½®</h3><p>é¦–å…ˆï¼Œä¿®æ”¹ publisher æœåŠ¡ä¸­çš„ application.yml æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> correlated
    <span class="token key atrule">publisher-returns</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">template</span><span class="token punctuation">:</span>
      <span class="token key atrule">mandatory</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜ï¼š</p><ul><li><code>publish-confirm-type</code>ï¼šå¼€å¯ publisher-confirmï¼Œè¿™é‡Œæ”¯æŒä¸¤ç§ç±»å‹ï¼š <ul><li><code>simple</code>ï¼šåŒæ­¥ç­‰å¾… confirm ç»“æœï¼Œç›´åˆ°è¶…æ—¶</li><li><code>correlated</code>ï¼šå¼‚æ­¥å›è°ƒï¼Œå®šä¹‰ ConfirmCallbackï¼ŒMQ è¿”å›ç»“æœæ—¶ä¼šå›è°ƒè¿™ä¸ª ConfirmCallback</li></ul></li><li><code>publish-returns</code>ï¼šå¼€å¯ publish-return åŠŸèƒ½ï¼ŒåŒæ ·æ˜¯åŸºäº callback æœºåˆ¶ï¼Œä¸è¿‡æ˜¯å®šä¹‰ ReturnCallback</li><li><code>template.mandatory</code>ï¼šå®šä¹‰æ¶ˆæ¯è·¯ç”±å¤±è´¥æ—¶çš„ç­–ç•¥ã€‚trueï¼Œåˆ™è°ƒç”¨ ReturnCallbackï¼›falseï¼šåˆ™ç›´æ¥ä¸¢å¼ƒæ¶ˆæ¯</li></ul><h3 id="_1-1-2-å®šä¹‰-return-å›è°ƒ" tabindex="-1"><a class="header-anchor" href="#_1-1-2-å®šä¹‰-return-å›è°ƒ" aria-hidden="true">#</a> 1.1.2.å®šä¹‰ Return å›è°ƒ</h3><p>æ¯ä¸ª RabbitTemplate åªèƒ½é…ç½®ä¸€ä¸ª ReturnCallbackï¼Œå› æ­¤éœ€è¦åœ¨é¡¹ç›®åŠ è½½æ—¶é…ç½®ï¼š</p><p>ä¿®æ”¹ publisher æœåŠ¡ï¼Œæ·»åŠ ä¸€ä¸ªï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeansException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContextAware</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonConfig</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–RabbitTemplate</span>
        <span class="token class-name">RabbitTemplate</span> rabbitTemplate <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®ReturnCallback</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> replyCode<span class="token punctuation">,</span> replyText<span class="token punctuation">,</span> exchange<span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŠ•é€’å¤±è´¥ï¼Œè®°å½•æ—¥å¿—</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œåº”ç­”ç {}ï¼ŒåŸå› {}ï¼Œäº¤æ¢æœº{}ï¼Œè·¯ç”±é”®{},æ¶ˆæ¯{}&quot;</span><span class="token punctuation">,</span>
                     replyCode<span class="token punctuation">,</span> replyText<span class="token punctuation">,</span> exchange<span class="token punctuation">,</span> routingKey<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¦‚æœæœ‰ä¸šåŠ¡éœ€è¦ï¼Œå¯ä»¥é‡å‘æ¶ˆæ¯</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-1-3-å®šä¹‰-confirmcallback" tabindex="-1"><a class="header-anchor" href="#_1-1-3-å®šä¹‰-confirmcallback" aria-hidden="true">#</a> 1.1.3.å®šä¹‰ ConfirmCallback</h3><p>ConfirmCallback å¯ä»¥åœ¨å‘é€æ¶ˆæ¯æ—¶æŒ‡å®šï¼Œå› ä¸ºæ¯ä¸ªä¸šåŠ¡å¤„ç† confirm æˆåŠŸæˆ–å¤±è´¥çš„é€»è¾‘ä¸ä¸€å®šç›¸åŒã€‚</p><p>åœ¨ publisher æœåŠ¡çš„ cn.itcast.mq.spring.SpringAmqpTest ç±»ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendMessage2SimpleQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.æ¶ˆæ¯ä½“</span>
    <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;hello, spring amqp!&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.å…¨å±€å”¯ä¸€çš„æ¶ˆæ¯IDï¼Œéœ€è¦å°è£…åˆ°CorrelationDataä¸­</span>
    <span class="token class-name">CorrelationData</span> correlationData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.æ·»åŠ callback</span>
    correlationData<span class="token punctuation">.</span><span class="token function">getFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>
        result <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 3.1.ackï¼Œæ¶ˆæ¯æˆåŠŸ</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸ, ID:{}&quot;</span><span class="token punctuation">,</span> correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">// 3.2.nackï¼Œæ¶ˆæ¯å¤±è´¥</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€å¤±è´¥, ID:{}, åŸå› {}&quot;</span><span class="token punctuation">,</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ex <span class="token operator">-&gt;</span> log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€å¼‚å¸¸, ID:{}, åŸå› {}&quot;</span><span class="token punctuation">,</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4.å‘é€æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;task.direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;task&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> correlationData<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä¼‘çœ ä¸€ä¼šå„¿ï¼Œç­‰å¾…ackå›æ‰§</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-2-æ¶ˆæ¯æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-2-æ¶ˆæ¯æŒä¹…åŒ–" aria-hidden="true">#</a> 1.2.æ¶ˆæ¯æŒä¹…åŒ–</h2><p>ç”Ÿäº§è€…ç¡®è®¤å¯ä»¥ç¡®ä¿æ¶ˆæ¯æŠ•é€’åˆ° RabbitMQ çš„é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯æ¶ˆæ¯å‘é€åˆ° RabbitMQ ä»¥åï¼Œå¦‚æœçªç„¶å®•æœºï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚</p><p>è¦æƒ³ç¡®ä¿æ¶ˆæ¯åœ¨ RabbitMQ ä¸­å®‰å…¨ä¿å­˜ï¼Œå¿…é¡»å¼€å¯æ¶ˆæ¯æŒä¹…åŒ–æœºåˆ¶ã€‚</p><ul><li>äº¤æ¢æœºæŒä¹…åŒ–</li><li>é˜Ÿåˆ—æŒä¹…åŒ–</li><li>æ¶ˆæ¯æŒä¹…åŒ–</li></ul><h3 id="_1-2-1-äº¤æ¢æœºæŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-2-1-äº¤æ¢æœºæŒä¹…åŒ–" aria-hidden="true">#</a> 1.2.1.äº¤æ¢æœºæŒä¹…åŒ–</h3><p>RabbitMQ ä¸­äº¤æ¢æœºé»˜è®¤æ˜¯éæŒä¹…åŒ–çš„ï¼Œmq é‡å¯åå°±ä¸¢å¤±ã€‚</p><p>SpringAMQP ä¸­å¯ä»¥é€šè¿‡ä»£ç æŒ‡å®šäº¤æ¢æœºæŒä¹…åŒ–ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">simpleExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ã€æ˜¯å¦æŒä¹…åŒ–ã€å½“æ²¡æœ‰queueä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;simple.direct&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>äº‹å®ä¸Šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”± SpringAMQP å£°æ˜çš„äº¤æ¢æœºéƒ½æ˜¯æŒä¹…åŒ–çš„ã€‚</p><p>å¯ä»¥åœ¨ RabbitMQ æ§åˆ¶å°çœ‹åˆ°æŒä¹…åŒ–çš„äº¤æ¢æœºéƒ½ä¼šå¸¦ä¸Š<code>D</code>çš„æ ‡ç¤ºï¼š</p><p><img src="/MyBlog/assets/image-20210718164412450-f53b9dd0.png" alt="image-20210718164412450"></p><h3 id="_1-2-2-é˜Ÿåˆ—æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-2-2-é˜Ÿåˆ—æŒä¹…åŒ–" aria-hidden="true">#</a> 1.2.2.é˜Ÿåˆ—æŒä¹…åŒ–</h3><p>RabbitMQ ä¸­é˜Ÿåˆ—é»˜è®¤æ˜¯éæŒä¹…åŒ–çš„ï¼Œmq é‡å¯åå°±ä¸¢å¤±ã€‚</p><p>SpringAMQP ä¸­å¯ä»¥é€šè¿‡ä»£ç æŒ‡å®šäº¤æ¢æœºæŒä¹…åŒ–ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">simpleQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ä½¿ç”¨QueueBuilderæ„å»ºé˜Ÿåˆ—ï¼Œdurableå°±æ˜¯æŒä¹…åŒ–çš„</span>
    <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>äº‹å®ä¸Šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”± SpringAMQP å£°æ˜çš„é˜Ÿåˆ—éƒ½æ˜¯æŒä¹…åŒ–çš„ã€‚</p><p>å¯ä»¥åœ¨ RabbitMQ æ§åˆ¶å°çœ‹åˆ°æŒä¹…åŒ–çš„é˜Ÿåˆ—éƒ½ä¼šå¸¦ä¸Š<code>D</code>çš„æ ‡ç¤ºï¼š</p><p><img src="/MyBlog/assets/image-20210718164729543-7aabab46.png" alt="image-20210718164729543"></p><h3 id="_1-2-3-æ¶ˆæ¯æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-2-3-æ¶ˆæ¯æŒä¹…åŒ–" aria-hidden="true">#</a> 1.2.3.æ¶ˆæ¯æŒä¹…åŒ–</h3><p>åˆ©ç”¨ SpringAMQP å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥è®¾ç½®æ¶ˆæ¯çš„å±æ€§ï¼ˆMessagePropertiesï¼‰ï¼ŒæŒ‡å®š delivery-modeï¼š</p><ul><li>1ï¼šéæŒä¹…åŒ–</li><li>2ï¼šæŒä¹…åŒ–</li></ul><p>ç”¨ java ä»£ç æŒ‡å®šï¼š</p><p><img src="/MyBlog/assets/image-20210718165100016-b12857ed.png" alt="image-20210718165100016"></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringAMQP å‘å‡ºçš„ä»»ä½•æ¶ˆæ¯éƒ½æ˜¯æŒä¹…åŒ–çš„ï¼Œä¸ç”¨ç‰¹æ„æŒ‡å®šã€‚</p><h2 id="_1-3-æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤" tabindex="-1"><a class="header-anchor" href="#_1-3-æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤" aria-hidden="true">#</a> 1.3.æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤</h2><p>RabbitMQ æ˜¯<strong>é˜…åå³ç„š</strong>æœºåˆ¶ï¼ŒRabbitMQ ç¡®è®¤æ¶ˆæ¯è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åä¼šç«‹åˆ»åˆ é™¤ã€‚</p><p>è€Œ RabbitMQ æ˜¯é€šè¿‡æ¶ˆè´¹è€…å›æ‰§æ¥ç¡®è®¤æ¶ˆè´¹è€…æ˜¯å¦æˆåŠŸå¤„ç†æ¶ˆæ¯çš„ï¼šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œåº”è¯¥å‘ RabbitMQ å‘é€ ACK å›æ‰§ï¼Œè¡¨æ˜è‡ªå·±å·²ç»å¤„ç†æ¶ˆæ¯ã€‚</p><p>è®¾æƒ³è¿™æ ·çš„åœºæ™¯ï¼š</p><ul><li>1ï¼‰RabbitMQ æŠ•é€’æ¶ˆæ¯ç»™æ¶ˆè´¹è€…</li><li>2ï¼‰æ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œè¿”å› ACK ç»™ RabbitMQ</li><li>3ï¼‰RabbitMQ åˆ é™¤æ¶ˆæ¯</li><li>4ï¼‰æ¶ˆè´¹è€…å®•æœºï¼Œæ¶ˆæ¯å°šæœªå¤„ç†</li></ul><p>è¿™æ ·ï¼Œæ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚å› æ­¤æ¶ˆè´¹è€…è¿”å› ACK çš„æ—¶æœºéå¸¸é‡è¦ã€‚</p><p>è€Œ SpringAMQP åˆ™å…è®¸é…ç½®ä¸‰ç§ç¡®è®¤æ¨¡å¼ï¼š</p><p>â€¢manualï¼šæ‰‹åŠ¨ ackï¼Œéœ€è¦åœ¨ä¸šåŠ¡ä»£ç ç»“æŸåï¼Œè°ƒç”¨ api å‘é€ ackã€‚</p><p>â€¢autoï¼šè‡ªåŠ¨ ackï¼Œç”± spring ç›‘æµ‹ listener ä»£ç æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸åˆ™è¿”å› ackï¼›æŠ›å‡ºå¼‚å¸¸åˆ™è¿”å› nack</p><p>â€¢noneï¼šå…³é—­ ackï¼ŒMQ å‡å®šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åä¼šæˆåŠŸå¤„ç†ï¼Œå› æ­¤æ¶ˆæ¯æŠ•é€’åç«‹å³è¢«åˆ é™¤</p><p>ç”±æ­¤å¯çŸ¥ï¼š</p><ul><li>none æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯æŠ•é€’æ˜¯ä¸å¯é çš„ï¼Œå¯èƒ½ä¸¢å¤±</li><li>auto æ¨¡å¼ç±»ä¼¼äº‹åŠ¡æœºåˆ¶ï¼Œå‡ºç°å¼‚å¸¸æ—¶è¿”å› nackï¼Œæ¶ˆæ¯å›æ»šåˆ° mqï¼›æ²¡æœ‰å¼‚å¸¸ï¼Œè¿”å› ack</li><li>manualï¼šè‡ªå·±æ ¹æ®ä¸šåŠ¡æƒ…å†µï¼Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¯¥ ack</li></ul><p>ä¸€èˆ¬ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨é»˜è®¤çš„ auto å³å¯ã€‚</p><h3 id="_1-3-1-æ¼”ç¤º-none-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_1-3-1-æ¼”ç¤º-none-æ¨¡å¼" aria-hidden="true">#</a> 1.3.1.æ¼”ç¤º none æ¨¡å¼</h3><p>ä¿®æ”¹ consumer æœåŠ¡çš„ application.yml æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢å†…å®¹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token key atrule">acknowledge-mode</span><span class="token punctuation">:</span> none <span class="token comment"># å…³é—­ack</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹ consumer æœåŠ¡çš„ SpringRabbitListener ç±»ä¸­çš„æ–¹æ³•ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªæ¶ˆæ¯å¤„ç†å¼‚å¸¸ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenSimpleQueue</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€{}ã€‘&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ¨¡æ‹Ÿå¼‚å¸¸</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å¤„ç†å®Œæˆï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•å¯ä»¥å‘ç°ï¼Œå½“æ¶ˆæ¯å¤„ç†æŠ›å¼‚å¸¸æ—¶ï¼Œæ¶ˆæ¯ä¾ç„¶è¢« RabbitMQ åˆ é™¤äº†ã€‚</p><h3 id="_1-3-2-æ¼”ç¤º-auto-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_1-3-2-æ¼”ç¤º-auto-æ¨¡å¼" aria-hidden="true">#</a> 1.3.2.æ¼”ç¤º auto æ¨¡å¼</h3><p>å†æ¬¡æŠŠç¡®è®¤æœºåˆ¶ä¿®æ”¹ä¸º auto:</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token key atrule">acknowledge-mode</span><span class="token punctuation">:</span> auto <span class="token comment"># å…³é—­ack</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¼‚å¸¸ä½ç½®æ‰“æ–­ç‚¹ï¼Œå†æ¬¡å‘é€æ¶ˆæ¯ï¼Œç¨‹åºå¡åœ¨æ–­ç‚¹æ—¶ï¼Œå¯ä»¥å‘ç°æ­¤æ—¶æ¶ˆæ¯çŠ¶æ€ä¸º unackï¼ˆæœªç¡®å®šçŠ¶æ€ï¼‰ï¼š</p><p><img src="/MyBlog/assets/image-20210718171705383-d4a6ae35.png" alt="image-20210718171705383"></p><p>æŠ›å‡ºå¼‚å¸¸åï¼Œå› ä¸º Spring ä¼šè‡ªåŠ¨è¿”å› nackï¼Œæ‰€ä»¥æ¶ˆæ¯æ¢å¤è‡³ Ready çŠ¶æ€ï¼Œå¹¶ä¸”æ²¡æœ‰è¢« RabbitMQ åˆ é™¤ï¼š</p><p><img src="/MyBlog/assets/image-20210718171759179-334fb00e.png" alt="image-20210718171759179"></p><h2 id="_1-4-æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_1-4-æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶" aria-hidden="true">#</a> 1.4.æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶</h2><p>å½“æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸åï¼Œæ¶ˆæ¯ä¼šä¸æ–­ requeueï¼ˆé‡å…¥é˜Ÿï¼‰åˆ°é˜Ÿåˆ—ï¼Œå†é‡æ–°å‘é€ç»™æ¶ˆè´¹è€…ï¼Œç„¶åå†æ¬¡å¼‚å¸¸ï¼Œå†æ¬¡ requeueï¼Œæ— é™å¾ªç¯ï¼Œå¯¼è‡´ mq çš„æ¶ˆæ¯å¤„ç†é£™å‡ï¼Œå¸¦æ¥ä¸å¿…è¦çš„å‹åŠ›ï¼š</p><p><img src="/MyBlog/assets/image-20210718172746378-dcfa0a67.png" alt="image-20210718172746378"></p><p>æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h3 id="_1-4-1-æœ¬åœ°é‡è¯•" tabindex="-1"><a class="header-anchor" href="#_1-4-1-æœ¬åœ°é‡è¯•" aria-hidden="true">#</a> 1.4.1.æœ¬åœ°é‡è¯•</h3><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Spring çš„ retry æœºåˆ¶ï¼Œåœ¨æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸æ—¶åˆ©ç”¨æœ¬åœ°é‡è¯•ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶çš„ requeue åˆ° mq é˜Ÿåˆ—ã€‚</p><p>ä¿®æ”¹ consumer æœåŠ¡çš„ application.yml æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token key atrule">retry</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•</span>
          <span class="token key atrule">initial-interval</span><span class="token punctuation">:</span> <span class="token number">1000</span> <span class="token comment"># åˆè¯†çš„å¤±è´¥ç­‰å¾…æ—¶é•¿ä¸º1ç§’</span>
          <span class="token key atrule">multiplier</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># å¤±è´¥çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = multiplier * last-interval</span>
          <span class="token key atrule">max-attempts</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment"># æœ€å¤§é‡è¯•æ¬¡æ•°</span>
          <span class="token key atrule">stateless</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># trueæ— çŠ¶æ€ï¼›falseæœ‰çŠ¶æ€ã€‚å¦‚æœä¸šåŠ¡ä¸­åŒ…å«äº‹åŠ¡ï¼Œè¿™é‡Œæ”¹ä¸ºfalse</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯ consumer æœåŠ¡ï¼Œé‡å¤ä¹‹å‰çš„æµ‹è¯•ã€‚å¯ä»¥å‘ç°ï¼š</p><ul><li>åœ¨é‡è¯• 3 æ¬¡åï¼ŒSpringAMQP ä¼šæŠ›å‡ºå¼‚å¸¸ AmqpRejectAndDontRequeueExceptionï¼Œè¯´æ˜æœ¬åœ°é‡è¯•è§¦å‘äº†</li><li>æŸ¥çœ‹ RabbitMQ æ§åˆ¶å°ï¼Œå‘ç°æ¶ˆæ¯è¢«åˆ é™¤äº†ï¼Œè¯´æ˜æœ€å SpringAMQP è¿”å›çš„æ˜¯ ackï¼Œmq åˆ é™¤æ¶ˆæ¯äº†</li></ul><p>ç»“è®ºï¼š</p><ul><li>å¼€å¯æœ¬åœ°é‡è¯•æ—¶ï¼Œæ¶ˆæ¯å¤„ç†è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ä¼š requeue åˆ°é˜Ÿåˆ—ï¼Œè€Œæ˜¯åœ¨æ¶ˆè´¹è€…æœ¬åœ°é‡è¯•</li><li>é‡è¯•è¾¾åˆ°æœ€å¤§æ¬¡æ•°åï¼ŒSpring ä¼šè¿”å› ackï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ</li></ul><h3 id="_1-4-2-å¤±è´¥ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_1-4-2-å¤±è´¥ç­–ç•¥" aria-hidden="true">#</a> 1.4.2.å¤±è´¥ç­–ç•¥</h3><p>åœ¨ä¹‹å‰çš„æµ‹è¯•ä¸­ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ˜¯ç”± Spring å†…éƒ¨æœºåˆ¶å†³å®šçš„ã€‚</p><p>åœ¨å¼€å¯é‡è¯•æ¨¡å¼åï¼Œé‡è¯•æ¬¡æ•°è€—å°½ï¼Œå¦‚æœæ¶ˆæ¯ä¾ç„¶å¤±è´¥ï¼Œåˆ™éœ€è¦æœ‰ MessageRecovery æ¥å£æ¥å¤„ç†ï¼Œå®ƒåŒ…å«ä¸‰ç§ä¸åŒçš„å®ç°ï¼š</p><ul><li><p>RejectAndDontRequeueRecovererï¼šé‡è¯•è€—å°½åï¼Œç›´æ¥ rejectï¼Œä¸¢å¼ƒæ¶ˆæ¯ã€‚é»˜è®¤å°±æ˜¯è¿™ç§æ–¹å¼</p></li><li><p>ImmediateRequeueMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œè¿”å› nackï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ</p></li><li><p>RepublishMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œå°†å¤±è´¥æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šçš„äº¤æ¢æœº</p></li></ul><p>æ¯”è¾ƒä¼˜é›…çš„ä¸€ç§å¤„ç†æ–¹æ¡ˆæ˜¯ RepublishMessageRecovererï¼Œå¤±è´¥åå°†æ¶ˆæ¯æŠ•é€’åˆ°ä¸€ä¸ªæŒ‡å®šçš„ï¼Œä¸“é—¨å­˜æ”¾å¼‚å¸¸æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œåç»­ç”±äººå·¥é›†ä¸­å¤„ç†ã€‚</p><p>1ï¼‰åœ¨ consumer æœåŠ¡ä¸­å®šä¹‰å¤„ç†å¤±è´¥æ¶ˆæ¯çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">errorMessageExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;error.direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">errorQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;error.queue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">errorBinding</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> errorQueue<span class="token punctuation">,</span> <span class="token class-name">DirectExchange</span> errorMessageExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>errorQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>errorMessageExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰å®šä¹‰ä¸€ä¸ª RepublishMessageRecovererï¼Œå…³è”é˜Ÿåˆ—å’Œäº¤æ¢æœº</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">MessageRecoverer</span> <span class="token function">republishMessageRecoverer</span><span class="token punctuation">(</span><span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RepublishMessageRecoverer</span><span class="token punctuation">(</span>rabbitTemplate<span class="token punctuation">,</span> <span class="token string">&quot;error.direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæ•´ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Binding</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">BindingBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">DirectExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Queue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>retry<span class="token punctuation">.</span></span><span class="token class-name">MessageRecoverer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>retry<span class="token punctuation">.</span></span><span class="token class-name">RepublishMessageRecoverer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorMessageConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">errorMessageExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;error.direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">errorQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;error.queue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">errorBinding</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> errorQueue<span class="token punctuation">,</span> <span class="token class-name">DirectExchange</span> errorMessageExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>errorQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>errorMessageExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">MessageRecoverer</span> <span class="token function">republishMessageRecoverer</span><span class="token punctuation">(</span><span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RepublishMessageRecoverer</span><span class="token punctuation">(</span>rabbitTemplate<span class="token punctuation">,</span> <span class="token string">&quot;error.direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-5-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_1-5-æ€»ç»“" aria-hidden="true">#</a> 1.5.æ€»ç»“</h2><p>å¦‚ä½•ç¡®ä¿ RabbitMQ æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ</p><ul><li>å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿäº§è€…çš„æ¶ˆæ¯èƒ½åˆ°è¾¾é˜Ÿåˆ—</li><li>å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œç¡®ä¿æ¶ˆæ¯æœªæ¶ˆè´¹å‰åœ¨é˜Ÿåˆ—ä¸­ä¸ä¼šä¸¢å¤±</li><li>å¼€å¯æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ä¸º autoï¼Œç”± spring ç¡®è®¤æ¶ˆæ¯å¤„ç†æˆåŠŸåå®Œæˆ ack</li><li>å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œå¹¶è®¾ç½® MessageRecovererï¼Œå¤šæ¬¡é‡è¯•å¤±è´¥åå°†æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœºï¼Œäº¤ç”±äººå·¥å¤„ç†</li></ul><h1 id="_2-æ­»ä¿¡äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_2-æ­»ä¿¡äº¤æ¢æœº" aria-hidden="true">#</a> 2.æ­»ä¿¡äº¤æ¢æœº</h1><h2 id="_2-1-åˆè¯†æ­»ä¿¡äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_2-1-åˆè¯†æ­»ä¿¡äº¤æ¢æœº" aria-hidden="true">#</a> 2.1.åˆè¯†æ­»ä¿¡äº¤æ¢æœº</h2><h3 id="_2-1-1-ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_2-1-1-ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº" aria-hidden="true">#</a> 2.1.1.ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº</h3><p>ä»€ä¹ˆæ˜¯æ­»ä¿¡ï¼Ÿ</p><p>å½“ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ»¡è¶³ä¸‹åˆ—æƒ…å†µä¹‹ä¸€æ—¶ï¼Œå¯ä»¥æˆä¸ºæ­»ä¿¡ï¼ˆdead letterï¼‰ï¼š</p><ul><li>æ¶ˆè´¹è€…ä½¿ç”¨ basic.reject æˆ– basic.nack å£°æ˜æ¶ˆè´¹å¤±è´¥ï¼Œå¹¶ä¸”æ¶ˆæ¯çš„ requeue å‚æ•°è®¾ç½®ä¸º false</li><li>æ¶ˆæ¯æ˜¯ä¸€ä¸ªè¿‡æœŸæ¶ˆæ¯ï¼Œè¶…æ—¶æ— äººæ¶ˆè´¹</li><li>è¦æŠ•é€’çš„é˜Ÿåˆ—æ¶ˆæ¯æ»¡äº†ï¼Œæ— æ³•æŠ•é€’</li></ul><p>å¦‚æœè¿™ä¸ªåŒ…å«æ­»ä¿¡çš„é˜Ÿåˆ—é…ç½®äº†<code>dead-letter-exchange</code>å±æ€§ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªäº¤æ¢æœºï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸­çš„æ­»ä¿¡å°±ä¼šæŠ•é€’åˆ°è¿™ä¸ªäº¤æ¢æœºä¸­ï¼Œè€Œè¿™ä¸ªäº¤æ¢æœºç§°ä¸º<strong>æ­»ä¿¡äº¤æ¢æœº</strong>ï¼ˆDead Letter Exchangeï¼Œæ£€æŸ¥ DLXï¼‰ã€‚</p><p>å¦‚å›¾ï¼Œä¸€ä¸ªæ¶ˆæ¯è¢«æ¶ˆè´¹è€…æ‹’ç»äº†ï¼Œå˜æˆäº†æ­»ä¿¡ï¼š</p><p><img src="/MyBlog/assets/image-20210718174328383-8bd94c61.png" alt="image-20210718174328383"></p><p>å› ä¸º simple.queue ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœº dl.directï¼Œå› æ­¤æ­»ä¿¡ä¼šæŠ•é€’ç»™è¿™ä¸ªäº¤æ¢æœºï¼š</p><p><img src="/MyBlog/assets/image-20210718174416160-a054c24d.png" alt="image-20210718174416160"></p><p>å¦‚æœè¿™ä¸ªæ­»ä¿¡äº¤æ¢æœºä¹Ÿç»‘å®šäº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆ™æ¶ˆæ¯æœ€ç»ˆä¼šè¿›å…¥è¿™ä¸ªå­˜æ”¾æ­»ä¿¡çš„é˜Ÿåˆ—ï¼š</p><p><img src="/MyBlog/assets/image-20210718174506856-b6f7e1ae.png" alt="image-20210718174506856"></p><p>å¦å¤–ï¼Œé˜Ÿåˆ—å°†æ­»ä¿¡æŠ•é€’ç»™æ­»ä¿¡äº¤æ¢æœºæ—¶ï¼Œå¿…é¡»çŸ¥é“ä¸¤ä¸ªä¿¡æ¯ï¼š</p><ul><li>æ­»ä¿¡äº¤æ¢æœºåç§°</li><li>æ­»ä¿¡äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šçš„ RoutingKey</li></ul><p>è¿™æ ·æ‰èƒ½ç¡®ä¿æŠ•é€’çš„æ¶ˆæ¯èƒ½åˆ°è¾¾æ­»ä¿¡äº¤æ¢æœºï¼Œå¹¶ä¸”æ­£ç¡®çš„è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p><img src="/MyBlog/assets/image-20210821073801398-0bf18f0f.png" alt="image-20210821073801398"></p><h3 id="_2-1-2-åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶æ­»ä¿¡-æ‹“å±•" tabindex="-1"><a class="header-anchor" href="#_2-1-2-åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶æ­»ä¿¡-æ‹“å±•" aria-hidden="true">#</a> 2.1.2.åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶æ­»ä¿¡ï¼ˆæ‹“å±•ï¼‰</h3><p>åœ¨å¤±è´¥é‡è¯•ç­–ç•¥ä¸­ï¼Œé»˜è®¤çš„ RejectAndDontRequeueRecoverer ä¼šåœ¨æœ¬åœ°é‡è¯•æ¬¡æ•°è€—å°½åï¼Œå‘é€ reject ç»™ RabbitMQï¼Œæ¶ˆæ¯å˜æˆæ­»ä¿¡ï¼Œè¢«ä¸¢å¼ƒã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç»™ simple.queue æ·»åŠ ä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºï¼Œç»™æ­»ä¿¡äº¤æ¢æœºç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ã€‚è¿™æ ·æ¶ˆæ¯å˜æˆæ­»ä¿¡åä¹Ÿä¸ä¼šä¸¢å¼ƒï¼Œè€Œæ˜¯æœ€ç»ˆæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œè·¯ç”±åˆ°ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—ã€‚</p><p><img src="/MyBlog/assets/image-20210718174506856-b6f7e1ae.png" alt="image-20210718174506856"></p><p>æˆ‘ä»¬åœ¨ consumer æœåŠ¡ä¸­ï¼Œå®šä¹‰ä¸€ç»„æ­»ä¿¡äº¤æ¢æœºã€æ­»ä¿¡é˜Ÿåˆ—ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// å£°æ˜æ™®é€šçš„ simple.queueé˜Ÿåˆ—ï¼Œå¹¶ä¸”ä¸ºå…¶æŒ‡å®šæ­»ä¿¡äº¤æ¢æœºï¼šdl.direct</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">simpleQueue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šé˜Ÿåˆ—åç§°ï¼Œå¹¶æŒä¹…åŒ–</span>
        <span class="token punctuation">.</span><span class="token function">deadLetterExchange</span><span class="token punctuation">(</span><span class="token string">&quot;dl.direct&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// å£°æ˜æ­»ä¿¡äº¤æ¢æœº dl.direct</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">dlExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;dl.direct&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// å£°æ˜å­˜å‚¨æ­»ä¿¡çš„é˜Ÿåˆ— dl.queue</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">dlQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;dl.queue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// å°†æ­»ä¿¡é˜Ÿåˆ— ä¸ æ­»ä¿¡äº¤æ¢æœºç»‘å®š</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">dlBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">dlQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token function">dlExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;simple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-1-3-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_2-1-3-æ€»ç»“" aria-hidden="true">#</a> 2.1.3.æ€»ç»“</h3><p>ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä¼šæˆä¸ºæ­»ä¿¡ï¼Ÿ</p><ul><li>æ¶ˆæ¯è¢«æ¶ˆè´¹è€… reject æˆ–è€…è¿”å› nack</li><li>æ¶ˆæ¯è¶…æ—¶æœªæ¶ˆè´¹</li><li>é˜Ÿåˆ—æ»¡äº†</li></ul><p>æ­»ä¿¡äº¤æ¢æœºçš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>å¦‚æœé˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºï¼Œæ­»ä¿¡ä¼šæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºï¼›</li><li>å¯ä»¥åˆ©ç”¨æ­»ä¿¡äº¤æ¢æœºæ”¶é›†æ‰€æœ‰æ¶ˆè´¹è€…å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼ˆæ­»ä¿¡ï¼‰ï¼Œäº¤ç”±äººå·¥å¤„ç†ï¼Œè¿›ä¸€æ­¥æé«˜æ¶ˆæ¯é˜Ÿåˆ—çš„å¯é æ€§ã€‚</li></ul><h2 id="_2-2-ttl" tabindex="-1"><a class="header-anchor" href="#_2-2-ttl" aria-hidden="true">#</a> 2.2.TTL</h2><p>ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å¦‚æœè¶…æ—¶æœªæ¶ˆè´¹ï¼Œåˆ™ä¼šå˜ä¸ºæ­»ä¿¡ï¼Œè¶…æ—¶åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li>æ¶ˆæ¯æ‰€åœ¨çš„é˜Ÿåˆ—è®¾ç½®äº†è¶…æ—¶æ—¶é—´</li><li>æ¶ˆæ¯æœ¬èº«è®¾ç½®äº†è¶…æ—¶æ—¶é—´</li></ul><p><img src="/MyBlog/assets/image-20210718182643311-38ab6213.png" alt="image-20210718182643311"></p><h3 id="_2-2-1-æ¥æ”¶è¶…æ—¶æ­»ä¿¡çš„æ­»ä¿¡äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_2-2-1-æ¥æ”¶è¶…æ—¶æ­»ä¿¡çš„æ­»ä¿¡äº¤æ¢æœº" aria-hidden="true">#</a> 2.2.1.æ¥æ”¶è¶…æ—¶æ­»ä¿¡çš„æ­»ä¿¡äº¤æ¢æœº</h3><p>åœ¨ consumer æœåŠ¡çš„ SpringRabbitListener ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªæ–°çš„æ¶ˆè´¹è€…ï¼Œå¹¶ä¸”å£°æ˜ æ­»ä¿¡äº¤æ¢æœºã€æ­»ä¿¡é˜Ÿåˆ—ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;dl.ttl.queue&quot;</span><span class="token punctuation">,</span> durable <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;dl.ttl.direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token string">&quot;ttl&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenDlQueue</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶åˆ° dl.ttl.queueçš„å»¶è¿Ÿæ¶ˆæ¯ï¼š{}&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-2-å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—-å¹¶ä¸”æŒ‡å®š-ttl" tabindex="-1"><a class="header-anchor" href="#_2-2-2-å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—-å¹¶ä¸”æŒ‡å®š-ttl" aria-hidden="true">#</a> 2.2.2.å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”æŒ‡å®š TTL</h3><p>è¦ç»™é˜Ÿåˆ—è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—æ—¶é…ç½® x-message-ttl å±æ€§ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">ttlQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;ttl.queue&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šé˜Ÿåˆ—åç§°ï¼Œå¹¶æŒä¹…åŒ–</span>
        <span class="token punctuation">.</span><span class="token function">ttl</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token comment">// è®¾ç½®é˜Ÿåˆ—çš„è¶…æ—¶æ—¶é—´ï¼Œ10ç§’</span>
        <span class="token punctuation">.</span><span class="token function">deadLetterExchange</span><span class="token punctuation">(</span><span class="token string">&quot;dl.ttl.direct&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œè¿™ä¸ªé˜Ÿåˆ—è®¾å®šäº†æ­»ä¿¡äº¤æ¢æœºä¸º<code>dl.ttl.direct</code></p><p>å£°æ˜äº¤æ¢æœºï¼Œå°† ttl ä¸äº¤æ¢æœºç»‘å®šï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">ttlExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;ttl.direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">ttlBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">ttlQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token function">ttlExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;ttl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘é€æ¶ˆæ¯ï¼Œä½†æ˜¯ä¸è¦æŒ‡å®š TTLï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTTLQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºæ¶ˆæ¯</span>
    <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;hello, ttl queue&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// æ¶ˆæ¯IDï¼Œéœ€è¦å°è£…åˆ°CorrelationDataä¸­</span>
    <span class="token class-name">CorrelationData</span> correlationData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å‘é€æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;ttl.direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ttl&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> correlationData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®°å½•æ—¥å¿—</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘é€æ¶ˆæ¯çš„æ—¥å¿—ï¼š</p><p><img src="/MyBlog/assets/image-20210718191657478-65182d6d.png" alt="image-20210718191657478"></p><p>æŸ¥çœ‹ä¸‹æ¥æ”¶æ¶ˆæ¯çš„æ—¥å¿—ï¼š</p><p><img src="/MyBlog/assets/image-20210718191738706-64272140.png" alt="image-20210718191738706"></p><p>å› ä¸ºé˜Ÿåˆ—çš„ TTL å€¼æ˜¯ 10000msï¼Œä¹Ÿå°±æ˜¯ 10 ç§’ã€‚å¯ä»¥çœ‹åˆ°æ¶ˆæ¯å‘é€ä¸æ¥æ”¶ä¹‹é—´çš„æ—¶å·®åˆšå¥½æ˜¯ 10 ç§’ã€‚</p><h3 id="_2-2-3-å‘é€æ¶ˆæ¯æ—¶-è®¾å®š-ttl" tabindex="-1"><a class="header-anchor" href="#_2-2-3-å‘é€æ¶ˆæ¯æ—¶-è®¾å®š-ttl" aria-hidden="true">#</a> 2.2.3.å‘é€æ¶ˆæ¯æ—¶ï¼Œè®¾å®š TTL</h3><p>åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š TTLï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTTLMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºæ¶ˆæ¯</span>
    <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span>
        <span class="token punctuation">.</span><span class="token function">withBody</span><span class="token punctuation">(</span><span class="token string">&quot;hello, ttl message&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token string">&quot;5000&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ¶ˆæ¯IDï¼Œéœ€è¦å°è£…åˆ°CorrelationDataä¸­</span>
    <span class="token class-name">CorrelationData</span> correlationData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å‘é€æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;ttl.direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ttl&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> correlationData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹å‘é€æ¶ˆæ¯æ—¥å¿—ï¼š</p><p><img src="/MyBlog/assets/image-20210718191939140-4c00060c.png" alt="image-20210718191939140"></p><p>æ¥æ”¶æ¶ˆæ¯æ—¥å¿—ï¼š</p><p><img src="/MyBlog/assets/image-20210718192004662-d82a3197.png" alt="image-20210718192004662"></p><p>è¿™æ¬¡ï¼Œå‘é€ä¸æ¥æ”¶çš„å»¶è¿Ÿåªæœ‰ 5 ç§’ã€‚è¯´æ˜å½“é˜Ÿåˆ—ã€æ¶ˆæ¯éƒ½è®¾ç½®äº† TTL æ—¶ï¼Œä»»æ„ä¸€ä¸ªåˆ°æœŸå°±ä¼šæˆä¸ºæ­»ä¿¡ã€‚</p><h3 id="_2-2-4-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_2-2-4-æ€»ç»“" aria-hidden="true">#</a> 2.2.4.æ€»ç»“</h3><p>æ¶ˆæ¯è¶…æ—¶çš„ä¸¤ç§æ–¹å¼æ˜¯ï¼Ÿ</p><ul><li>ç»™é˜Ÿåˆ—è®¾ç½® ttl å±æ€§ï¼Œè¿›å…¥é˜Ÿåˆ—åè¶…è¿‡ ttl æ—¶é—´çš„æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡</li><li>ç»™æ¶ˆæ¯è®¾ç½® ttl å±æ€§ï¼Œé˜Ÿåˆ—æ¥æ”¶åˆ°æ¶ˆæ¯è¶…è¿‡ ttl æ—¶é—´åå˜ä¸ºæ­»ä¿¡</li></ul><p>å¦‚ä½•å®ç°å‘é€ä¸€ä¸ªæ¶ˆæ¯ 20 ç§’åæ¶ˆè´¹è€…æ‰æ”¶åˆ°æ¶ˆæ¯ï¼Ÿ</p><ul><li>ç»™æ¶ˆæ¯çš„ç›®æ ‡é˜Ÿåˆ—æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</li><li>å°†æ¶ˆè´¹è€…ç›‘å¬çš„é˜Ÿåˆ—ç»‘å®šåˆ°æ­»ä¿¡äº¤æ¢æœº</li><li>å‘é€æ¶ˆæ¯æ—¶ç»™æ¶ˆæ¯è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 20 ç§’</li></ul><h2 id="_2-3-å»¶è¿Ÿé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_2-3-å»¶è¿Ÿé˜Ÿåˆ—" aria-hidden="true">#</a> 2.3.å»¶è¿Ÿé˜Ÿåˆ—</h2><p>åˆ©ç”¨ TTL ç»“åˆæ­»ä¿¡äº¤æ¢æœºï¼Œæˆ‘ä»¬å®ç°äº†æ¶ˆæ¯å‘å‡ºåï¼Œæ¶ˆè´¹è€…å»¶è¿Ÿæ”¶åˆ°æ¶ˆæ¯çš„æ•ˆæœã€‚è¿™ç§æ¶ˆæ¯æ¨¡å¼å°±ç§°ä¸ºå»¶è¿Ÿé˜Ÿåˆ—ï¼ˆDelay Queueï¼‰æ¨¡å¼ã€‚</p><p>å»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li>å»¶è¿Ÿå‘é€çŸ­ä¿¡</li><li>ç”¨æˆ·ä¸‹å•ï¼Œå¦‚æœç”¨æˆ·åœ¨ 15 åˆ†é’Ÿå†…æœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ</li><li>é¢„çº¦å·¥ä½œä¼šè®®ï¼Œ20 åˆ†é’Ÿåè‡ªåŠ¨é€šçŸ¥æ‰€æœ‰å‚ä¼šäººå‘˜</li></ul><p>å› ä¸ºå»¶è¿Ÿé˜Ÿåˆ—çš„éœ€æ±‚éå¸¸å¤šï¼Œæ‰€ä»¥ RabbitMQ çš„å®˜æ–¹ä¹Ÿæ¨å‡ºäº†ä¸€ä¸ªæ’ä»¶ï¼ŒåŸç”Ÿæ”¯æŒå»¶è¿Ÿé˜Ÿåˆ—æ•ˆæœã€‚</p><p>è¿™ä¸ªæ’ä»¶å°±æ˜¯ DelayExchange æ’ä»¶ã€‚å‚è€ƒ RabbitMQ çš„æ’ä»¶åˆ—è¡¨é¡µé¢ï¼šhttps://www.rabbitmq.com/community-plugins.html</p><p><img src="/MyBlog/assets/image-20210718192529342-7c8e7569.png" alt="image-20210718192529342"></p><p>ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒå®˜ç½‘åœ°å€ï¼šhttps://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq</p><h3 id="_2-3-1-å®‰è£…-delayexchange-æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-3-1-å®‰è£…-delayexchange-æ’ä»¶" aria-hidden="true">#</a> 2.3.1.å®‰è£… DelayExchange æ’ä»¶</h3><p>å‚è€ƒè¯¾å‰èµ„æ–™ï¼š</p><p><img src="/MyBlog/assets/image-20210718193409812-53c96e23.png" alt="image-20210718193409812"></p><h3 id="_2-3-2-delayexchange-åŸç†" tabindex="-1"><a class="header-anchor" href="#_2-3-2-delayexchange-åŸç†" aria-hidden="true">#</a> 2.3.2.DelayExchange åŸç†</h3><p>DelayExchange éœ€è¦å°†ä¸€ä¸ªäº¤æ¢æœºå£°æ˜ä¸º delayed ç±»å‹ã€‚å½“æˆ‘ä»¬å‘é€æ¶ˆæ¯åˆ° delayExchange æ—¶ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ¥æ”¶æ¶ˆæ¯</li><li>åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦å…·å¤‡ x-delay å±æ€§</li><li>å¦‚æœæœ‰ x-delay å±æ€§ï¼Œè¯´æ˜æ˜¯å»¶è¿Ÿæ¶ˆæ¯ï¼ŒæŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼Œè¯»å– x-delay å€¼ï¼Œä½œä¸ºå»¶è¿Ÿæ—¶é—´</li><li>è¿”å› routing not found ç»“æœç»™æ¶ˆæ¯å‘é€è€…</li><li>x-delay æ—¶é—´åˆ°æœŸåï¼Œé‡æ–°æŠ•é€’æ¶ˆæ¯åˆ°æŒ‡å®šé˜Ÿåˆ—</li></ul><h3 id="_2-3-3-ä½¿ç”¨-delayexchange" tabindex="-1"><a class="header-anchor" href="#_2-3-3-ä½¿ç”¨-delayexchange" aria-hidden="true">#</a> 2.3.3.ä½¿ç”¨ DelayExchange</h3><p>æ’ä»¶çš„ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼šå£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œäº¤æ¢æœºçš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œåªéœ€è¦è®¾å®š delayed å±æ€§ä¸º true å³å¯ï¼Œç„¶åå£°æ˜é˜Ÿåˆ—ä¸å…¶ç»‘å®šå³å¯ã€‚</p><h4 id="_1-å£°æ˜-delayexchange-äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_1-å£°æ˜-delayexchange-äº¤æ¢æœº" aria-hidden="true">#</a> 1ï¼‰å£°æ˜ DelayExchange äº¤æ¢æœº</h4><p>åŸºäºæ³¨è§£æ–¹å¼ï¼ˆæ¨èï¼‰ï¼š</p><p><img src="/MyBlog/assets/image-20210718193747649-acab4a34.png" alt="image-20210718193747649"></p><p>ä¹Ÿå¯ä»¥åŸºäº@Bean çš„æ–¹å¼ï¼š</p><p><img src="/MyBlog/assets/image-20210718193831076-567bf376.png" alt="image-20210718193831076"></p><h4 id="_2-å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_2-å‘é€æ¶ˆæ¯" aria-hidden="true">#</a> 2ï¼‰å‘é€æ¶ˆæ¯</h4><p>å‘é€æ¶ˆæ¯æ—¶ï¼Œä¸€å®šè¦æºå¸¦ x-delay å±æ€§ï¼ŒæŒ‡å®šå»¶è¿Ÿçš„æ—¶é—´ï¼š</p><p><img src="/MyBlog/assets/image-20210718193917009-36270fc8.png" alt="image-20210718193917009"></p><h3 id="_2-3-4-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_2-3-4-æ€»ç»“" aria-hidden="true">#</a> 2.3.4.æ€»ç»“</h3><p>å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶çš„ä½¿ç”¨æ­¥éª¤åŒ…æ‹¬å“ªäº›ï¼Ÿ</p><p>â€¢å£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œæ·»åŠ  delayed å±æ€§ä¸º true</p><p>â€¢å‘é€æ¶ˆæ¯æ—¶ï¼Œæ·»åŠ  x-delay å¤´ï¼Œå€¼ä¸ºè¶…æ—¶æ—¶é—´</p><h1 id="_3-æƒ°æ€§é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_3-æƒ°æ€§é˜Ÿåˆ—" aria-hidden="true">#</a> 3.æƒ°æ€§é˜Ÿåˆ—</h1><h2 id="_3-1-æ¶ˆæ¯å †ç§¯é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-1-æ¶ˆæ¯å †ç§¯é—®é¢˜" aria-hidden="true">#</a> 3.1.æ¶ˆæ¯å †ç§¯é—®é¢˜</h2><p>å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦è¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå°±ä¼šå¯¼è‡´é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å †ç§¯ï¼Œç›´åˆ°é˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯è¾¾åˆ°ä¸Šé™ã€‚ä¹‹åå‘é€çš„æ¶ˆæ¯å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼Œå¯èƒ½ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™å°±æ˜¯æ¶ˆæ¯å †ç§¯é—®é¢˜ã€‚</p><p><img src="/MyBlog/assets/image-20210718194040498-0b14cf5d.png" alt="image-20210718194040498"></p><p>è§£å†³æ¶ˆæ¯å †ç§¯æœ‰ä¸¤ç§æ€è·¯ï¼š</p><ul><li>å¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„ work queue æ¨¡å¼</li><li>æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™</li></ul><p>è¦æå‡é˜Ÿåˆ—å®¹ç§¯ï¼ŒæŠŠæ¶ˆæ¯ä¿å­˜åœ¨å†…å­˜ä¸­æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚</p><h2 id="_3-2-æƒ°æ€§é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_3-2-æƒ°æ€§é˜Ÿåˆ—" aria-hidden="true">#</a> 3.2.æƒ°æ€§é˜Ÿåˆ—</h2><p>ä» RabbitMQ çš„ 3.6.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå°±å¢åŠ äº† Lazy Queues çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯æƒ°æ€§é˜Ÿåˆ—ã€‚æƒ°æ€§é˜Ÿåˆ—çš„ç‰¹å¾å¦‚ä¸‹ï¼š</p><ul><li>æ¥æ”¶åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜</li><li>æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ¶ˆæ¯æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜</li><li>æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨</li></ul><h3 id="_3-2-1-åŸºäºå‘½ä»¤è¡Œè®¾ç½®-lazy-queue" tabindex="-1"><a class="header-anchor" href="#_3-2-1-åŸºäºå‘½ä»¤è¡Œè®¾ç½®-lazy-queue" aria-hidden="true">#</a> 3.2.1.åŸºäºå‘½ä»¤è¡Œè®¾ç½® lazy-queue</h3><p>è€Œè¦è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼Œåªéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—æ—¶ï¼ŒæŒ‡å®š x-queue-mode å±æ€§ä¸º lazy å³å¯ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå°†ä¸€ä¸ªè¿è¡Œä¸­çš„é˜Ÿåˆ—ä¿®æ”¹ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rabbitmqctl set_policy Lazy <span class="token string">&quot;^lazy-queue$&quot;</span> <span class="token string">&#39;{&quot;queue-mode&quot;:&quot;lazy&quot;}&#39;</span> --apply-to queues
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‘½ä»¤è§£è¯»ï¼š</p><ul><li><code>rabbitmqctl</code> ï¼šRabbitMQ çš„å‘½ä»¤è¡Œå·¥å…·</li><li><code>set_policy</code> ï¼šæ·»åŠ ä¸€ä¸ªç­–ç•¥</li><li><code>Lazy</code> ï¼šç­–ç•¥åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</li><li><code>&quot;^lazy-queue$&quot;</code> ï¼šç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é˜Ÿåˆ—çš„åå­—</li><li><code>&#39;{&quot;queue-mode&quot;:&quot;lazy&quot;}&#39;</code> ï¼šè®¾ç½®é˜Ÿåˆ—æ¨¡å¼ä¸º lazy æ¨¡å¼</li><li><code>--apply-to queues </code>ï¼šç­–ç•¥çš„ä½œç”¨å¯¹è±¡ï¼Œæ˜¯æ‰€æœ‰çš„é˜Ÿåˆ—</li></ul><h3 id="_3-2-2-åŸºäº-bean-å£°æ˜-lazy-queue" tabindex="-1"><a class="header-anchor" href="#_3-2-2-åŸºäº-bean-å£°æ˜-lazy-queue" aria-hidden="true">#</a> 3.2.2.åŸºäº@Bean å£°æ˜ lazy-queue</h3><p><img src="/MyBlog/assets/image-20210718194522223-8673ddc8.png" alt="image-20210718194522223"></p><h3 id="_3-2-3-åŸºäº-rabbitlistener-å£°æ˜-lazyqueue" tabindex="-1"><a class="header-anchor" href="#_3-2-3-åŸºäº-rabbitlistener-å£°æ˜-lazyqueue" aria-hidden="true">#</a> 3.2.3.åŸºäº@RabbitListener å£°æ˜ LazyQueue</h3><p><img src="/MyBlog/assets/image-20210718194539054-b8352f3b.png" alt="image-20210718194539054"></p><h3 id="_3-3-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_3-3-æ€»ç»“" aria-hidden="true">#</a> 3.3.æ€»ç»“</h3><p>æ¶ˆæ¯å †ç§¯é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</p><ul><li>é˜Ÿåˆ—ä¸Šç»‘å®šå¤šä¸ªæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</li><li>ä½¿ç”¨æƒ°æ€§é˜Ÿåˆ—ï¼Œå¯ä»¥å† mq ä¸­ä¿å­˜æ›´å¤šæ¶ˆæ¯</li></ul><p>æƒ°æ€§é˜Ÿåˆ—çš„ä¼˜ç‚¹æœ‰å“ªäº›ï¼Ÿ</p><ul><li>åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸Šé™é«˜</li><li>æ²¡æœ‰é—´æ­‡æ€§çš„ page-outï¼Œæ€§èƒ½æ¯”è¾ƒç¨³å®š</li></ul><p>æƒ°æ€§é˜Ÿåˆ—çš„ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ</p><ul><li>åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯æ—¶æ•ˆæ€§ä¼šé™ä½</li><li>æ€§èƒ½å—é™äºç£ç›˜çš„ IO</li></ul><h1 id="_4-mq-é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-mq-é›†ç¾¤" aria-hidden="true">#</a> 4.MQ é›†ç¾¤</h1><h2 id="_4-1-é›†ç¾¤åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#_4-1-é›†ç¾¤åˆ†ç±»" aria-hidden="true">#</a> 4.1.é›†ç¾¤åˆ†ç±»</h2><p>RabbitMQ çš„æ˜¯åŸºäº Erlang è¯­è¨€ç¼–å†™ï¼Œè€Œ Erlang åˆæ˜¯ä¸€ä¸ªé¢å‘å¹¶å‘çš„è¯­è¨€ï¼Œå¤©ç„¶æ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚RabbitMQ çš„é›†ç¾¤æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><p>â€¢<strong>æ™®é€šé›†ç¾¤</strong>ï¼šæ˜¯ä¸€ç§åˆ†å¸ƒå¼é›†ç¾¤ï¼Œå°†é˜Ÿåˆ—åˆ†æ•£åˆ°é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œæé«˜æ•´ä¸ªé›†ç¾¤çš„å¹¶å‘èƒ½åŠ›ã€‚</p><p>â€¢<strong>é•œåƒé›†ç¾¤</strong>ï¼šæ˜¯ä¸€ç§ä¸»ä»é›†ç¾¤ï¼Œæ™®é€šé›†ç¾¤çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ä¸»ä»å¤‡ä»½åŠŸèƒ½ï¼Œæé«˜é›†ç¾¤çš„æ•°æ®å¯ç”¨æ€§ã€‚</p><p>é•œåƒé›†ç¾¤è™½ç„¶æ”¯æŒä¸»ä»ï¼Œä½†ä¸»ä»åŒæ­¥å¹¶ä¸æ˜¯å¼ºä¸€è‡´çš„ï¼ŒæŸäº›æƒ…å†µä¸‹å¯èƒ½æœ‰æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚å› æ­¤åœ¨ RabbitMQ çš„ 3.8 ç‰ˆæœ¬ä»¥åï¼Œæ¨å‡ºäº†æ–°çš„åŠŸèƒ½ï¼š<strong>ä»²è£é˜Ÿåˆ—</strong>æ¥ä»£æ›¿é•œåƒé›†ç¾¤ï¼Œåº•å±‚é‡‡ç”¨ Raft åè®®ç¡®ä¿ä¸»ä»çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><h2 id="_4-2-æ™®é€šé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-2-æ™®é€šé›†ç¾¤" aria-hidden="true">#</a> 4.2.æ™®é€šé›†ç¾¤</h2><h3 id="_4-2-1-é›†ç¾¤ç»“æ„å’Œç‰¹å¾" tabindex="-1"><a class="header-anchor" href="#_4-2-1-é›†ç¾¤ç»“æ„å’Œç‰¹å¾" aria-hidden="true">#</a> 4.2.1.é›†ç¾¤ç»“æ„å’Œç‰¹å¾</h3><p>æ™®é€šé›†ç¾¤ï¼Œæˆ–è€…å«æ ‡å‡†é›†ç¾¤ï¼ˆclassic clusterï¼‰ï¼Œå…·å¤‡ä¸‹åˆ—ç‰¹å¾ï¼š</p><ul><li>ä¼šåœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹é—´å…±äº«éƒ¨åˆ†æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šäº¤æ¢æœºã€é˜Ÿåˆ—å…ƒä¿¡æ¯ã€‚ä¸åŒ…å«é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li><li>å½“è®¿é—®é›†ç¾¤æŸèŠ‚ç‚¹æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸åœ¨è¯¥èŠ‚ç‚¹ï¼Œä¼šä»æ•°æ®æ‰€åœ¨èŠ‚ç‚¹ä¼ é€’åˆ°å½“å‰èŠ‚ç‚¹å¹¶è¿”å›</li><li>é˜Ÿåˆ—æ‰€åœ¨èŠ‚ç‚¹å®•æœºï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±</li></ul><p>ç»“æ„å¦‚å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20210718220843323-4beadc93.png" alt="image-20210718220843323"></p><h3 id="_4-2-2-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_4-2-2-éƒ¨ç½²" aria-hidden="true">#</a> 4.2.2.éƒ¨ç½²</h3><p>å‚è€ƒè¯¾å‰èµ„æ–™ï¼šã€ŠRabbitMQ éƒ¨ç½²æŒ‡å—.mdã€‹</p><h2 id="_4-3-é•œåƒé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-3-é•œåƒé›†ç¾¤" aria-hidden="true">#</a> 4.3.é•œåƒé›†ç¾¤</h2><h3 id="_4-3-1-é›†ç¾¤ç»“æ„å’Œç‰¹å¾" tabindex="-1"><a class="header-anchor" href="#_4-3-1-é›†ç¾¤ç»“æ„å’Œç‰¹å¾" aria-hidden="true">#</a> 4.3.1.é›†ç¾¤ç»“æ„å’Œç‰¹å¾</h3><p>é•œåƒé›†ç¾¤ï¼šæœ¬è´¨æ˜¯ä¸»ä»æ¨¡å¼ï¼Œå…·å¤‡ä¸‹é¢çš„ç‰¹å¾ï¼š</p><ul><li>äº¤æ¢æœºã€é˜Ÿåˆ—ã€é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥å¤‡ä»½ã€‚</li><li>åˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„<strong>ä¸»èŠ‚ç‚¹ï¼Œ<strong>å¤‡ä»½åˆ°çš„å…¶å®ƒèŠ‚ç‚¹å«åšè¯¥é˜Ÿåˆ—çš„</strong>é•œåƒ</strong>èŠ‚ç‚¹ã€‚</li><li>ä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹</li><li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹</li><li>ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»</li></ul><p>ç»“æ„å¦‚å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20210718221039542-34311eab.png" alt="image-20210718221039542"></p><h3 id="_4-3-2-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_4-3-2-éƒ¨ç½²" aria-hidden="true">#</a> 4.3.2.éƒ¨ç½²</h3><p>å‚è€ƒè¯¾å‰èµ„æ–™ï¼šã€ŠRabbitMQ éƒ¨ç½²æŒ‡å—.mdã€‹</p><h2 id="_4-4-ä»²è£é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_4-4-ä»²è£é˜Ÿåˆ—" aria-hidden="true">#</a> 4.4.ä»²è£é˜Ÿåˆ—</h2><h3 id="_4-4-1-é›†ç¾¤ç‰¹å¾" tabindex="-1"><a class="header-anchor" href="#_4-4-1-é›†ç¾¤ç‰¹å¾" aria-hidden="true">#</a> 4.4.1.é›†ç¾¤ç‰¹å¾</h3><p>ä»²è£é˜Ÿåˆ—ï¼šä»²è£é˜Ÿåˆ—æ˜¯ 3.8 ç‰ˆæœ¬ä»¥åæ‰æœ‰çš„æ–°åŠŸèƒ½ï¼Œç”¨æ¥æ›¿ä»£é•œåƒé˜Ÿåˆ—ï¼Œå…·å¤‡ä¸‹åˆ—ç‰¹å¾ï¼š</p><ul><li>ä¸é•œåƒé˜Ÿåˆ—ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸»ä»æ¨¡å¼ï¼Œæ”¯æŒä¸»ä»æ•°æ®åŒæ­¥</li><li>ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ²¡æœ‰å¤æ‚çš„é…ç½®</li><li>ä¸»ä»åŒæ­¥åŸºäº Raft åè®®ï¼Œå¼ºä¸€è‡´</li></ul><h3 id="_4-4-2-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_4-4-2-éƒ¨ç½²" aria-hidden="true">#</a> 4.4.2.éƒ¨ç½²</h3><p>å‚è€ƒè¯¾å‰èµ„æ–™ï¼šã€ŠRabbitMQ éƒ¨ç½²æŒ‡å—.mdã€‹</p><h3 id="_4-4-3-java-ä»£ç åˆ›å»ºä»²è£é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_4-4-3-java-ä»£ç åˆ›å»ºä»²è£é˜Ÿåˆ—" aria-hidden="true">#</a> 4.4.3.Java ä»£ç åˆ›å»ºä»²è£é˜Ÿåˆ—</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">quorumQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span>
        <span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;quorum.queue&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒä¹…åŒ–</span>
        <span class="token punctuation">.</span><span class="token function">quorum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ä»²è£é˜Ÿåˆ—</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-4-springamqp-è¿æ¥-mq-é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-4-4-springamqp-è¿æ¥-mq-é›†ç¾¤" aria-hidden="true">#</a> 4.4.4.SpringAMQP è¿æ¥ MQ é›†ç¾¤</h3><p>æ³¨æ„ï¼Œè¿™é‡Œç”¨ address æ¥ä»£æ›¿ hostã€port æ–¹å¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>spring<span class="token operator">:</span>
  rabbitmq<span class="token operator">:</span>
    addresses<span class="token operator">:</span> <span class="token number">192.168</span><span class="token number">.150</span><span class="token number">.105</span><span class="token operator">:</span><span class="token number">8071</span><span class="token punctuation">,</span> <span class="token number">192.168</span><span class="token number">.150</span><span class="token number">.105</span><span class="token operator">:</span><span class="token number">8072</span><span class="token punctuation">,</span> <span class="token number">192.168</span><span class="token number">.150</span><span class="token number">.105</span><span class="token operator">:</span><span class="token number">8073</span>
    username<span class="token operator">:</span> itcast
    password<span class="token operator">:</span> <span class="token number">123321</span>
    virtual<span class="token operator">-</span>host<span class="token operator">:</span> <span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ZyKunn/edit/main/notes/microservices/02/day05-MQé«˜çº§/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">è´¡çŒ®è€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 814342838@qq.com">ZyKun</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/MyBlog/notes/microservices/02/Redis%E9%9B%86%E7%BE%A4/" class="" aria-label="Redis é›†ç¾¤ ğŸ§™"><!--[--><!--]--> Redis é›†ç¾¤ ğŸ§™ <!--[--><!--]--></a></span><span class="next"><a href="/MyBlog/notes/microservices/02/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" class="" aria-label="RabbitMQ éƒ¨ç½²æŒ‡å— ğŸ§™"><!--[--><!--]--> RabbitMQ éƒ¨ç½²æŒ‡å— ğŸ§™ <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/MyBlog/assets/app-a153c100.js" defer></script>
  </body>
</html>
