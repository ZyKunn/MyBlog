<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.63">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="./img/logo.png"><title>ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1 | ZyKunã®Blog</title><meta name="description" content="">
    <link rel="preload" href="/MyBlog/assets/style-57272a59.css" as="style"><link rel="stylesheet" href="/MyBlog/assets/style-57272a59.css">
    <link rel="modulepreload" href="/MyBlog/assets/app-a153c100.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-a235e4bb.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-64f564d2.js"><link rel="prefetch" href="/MyBlog/assets/index.html-ab0151fa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1249ab5a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d02565e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1c68c797.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93acf26d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2bc953d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c526d7c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-636c9f52.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4177c6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7624decc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d0b4a798.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa378d7b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ddd44d65.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbb7f41.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-34576599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1079a374.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-88d4ebe7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5e927142.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a6f13b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c85da23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-69e813d7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545062a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd7a4fcb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-910949e0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-459b0c71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a036060.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f62ffe74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-841a86c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b31c8bb6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85bae056.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73555735.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d5456cd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d2dfbeec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-746091c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9cc627ff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d411448a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4454f425.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57aa84f4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2ce52087.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76657200.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90d9409e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d6ba5e7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-41bc7856.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6140daf4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ea30461d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00114784.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3fa86cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-386f0bd2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b46ac77e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-256a258e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4ebf55b3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7268161e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a8852c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19373782.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4e33bb6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-de5ff178.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd5da14a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dbee5a73.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64025c89.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9bd15ac7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4812edff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1f3f5c2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3f85e131.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1d66d048.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-67b1b38e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-17f10f72.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ad1b5dc8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b14e7669.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa35810b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-acb9b7bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2ba9a88.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-abdb28e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b3cc33e9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ef13eee8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73fa0dcc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6f7449c7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3857ef8d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e5af1d8f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5d14c1f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-94a8b9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3931e4d3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0978879b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-617bd5bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fe008c8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0e33aa95.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00725025.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8e05ec6e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-72ca6b4c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-427c5181.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b3baf42.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-40a790c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9709e7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8eb00d02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c849262.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eda16f63.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81242655.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9f6820.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79188b74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5775eee0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eff0510c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-305de307.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e83a5de7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-761a9548.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c12ae66e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-87a73e5c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d720473a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b960b5b6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bbd98f93.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76195dca.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3bd0cfa7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8c87d147.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bac2e853.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ee6bc34.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ab7381d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5b97f6b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd33ca6f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-684189de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-63731ad7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-895bfca1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d1ff4c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b71bf26f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ce6f983b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c185f9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-29c62d64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-52c91de2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-55aa1c06.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c87ef63a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff1d9f51.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a12aedeb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-298f19f2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f881f599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c32406a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4217479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7edb7ce1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8671126f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da565d04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9deb3ec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee7cf1b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-270d6327.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ec786b75.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e98adf02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7233a0e2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79c193cf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9714081e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5dea51d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e3209a23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cdce2101.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-389e66df.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-652ee4f6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-025e6f4e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-60711e70.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6edc93de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11bd39b1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53015219.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74dcd8ae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dd727db.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11b329fb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b6f3614.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-70ce719f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f6ca4d92.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a6833de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bf03220c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2edab58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f1e5cf7a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-21d4e18d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5235fca9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dc704c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57630906.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff165209.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6ec253a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9e4f0c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-664b232d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adf015a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4667c0e6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cc407710.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1752d212.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9b5d99c4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-43c48ae2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e8a616b7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93e7405b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-22a72a56.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-42ce3023.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f8eeab22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dd50991a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-af520db8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5ab2bfac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-965bc04f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81ebef01.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79d19f4d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9600bdfb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-560df48d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fb22a4f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd4caa82.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-370323f9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f673ebfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78d88460.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8b54347c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d30f0340.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e26bc4de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7d37b036.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3aa565ce.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c69f238.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76d60030.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7116a5e4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8f649cc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbbb7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90bb86fd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e23936a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19ad952b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-07245162.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-038b3afd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-084fe5c1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-098421fe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7baefce4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fffdfb9c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8c9612c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-05c42fda.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e1615934.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da824146.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa2d32f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545dbea7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3ca58cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b9e2188a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fc5f1f7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ec5c70d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cbf2aa55.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8beb0c08.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee54da9f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd28b91d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-98aa51a1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-03f9381a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9009c5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-71b7cfbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1759170e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa84186f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53160af7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51b685b4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ecb8e229.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9c507901.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6362722.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-faf67dd8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d7f20950.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a088985c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93b7982c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b76e6179.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d976d39c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b16efd78.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1301757e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c3240cbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2ddd21c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74fb5e20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-128f5026.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8fd9f38a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-82e84e23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-007ef014.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3dd860c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-382a2bae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b6beaec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2eb17cfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6f50213.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c8aef39.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-133f4d38.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cffd2be1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a798219d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b5fde77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-13275b71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4b6a02c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f179a12.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f45bc33f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0574e5e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0921816f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-631fbc02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8586017d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c4dbf09b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-967486c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aad17dde.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff644d77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78a4df64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d2180e8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53fbcd20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a3387e5e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-979f5ac4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0938c506.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51707e22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b1e917a0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b56a071.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d15eb498.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b0a97c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fda196b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bcc5faac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-490c208f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dce28479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62825d3c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b5a4af15.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eb40da96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d6d1c61.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-618cf3f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2a35430.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bca2187b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85181f96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f689b28.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62aa623a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b0c39cc5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73b8fff0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5466ae58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fbd0bcfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-5f041a2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/MyBlog/" class=""><!----><span class="site-name can-hide">ZyKunã®Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="router-link-active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="router-link-active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/MyBlog/notes/project/02/" class="router-link-active sidebar-item sidebar-heading active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/MyBlog/notes/project/02/%E7%AC%AC1%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAv3.1/" class="sidebar-item" aria-label="ç¬¬ 1 ç«  é¡¹ç›®ä»‹ç»&amp;ç¯å¢ƒæ­å»º v3.1"><!--[--><!--]--> ç¬¬ 1 ç«  é¡¹ç›®ä»‹ç»&amp;ç¯å¢ƒæ­å»º v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC2%E7%AB%A0-%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="sidebar-item" aria-label="ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-æ¨¡å—éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1 æ¨¡å—éœ€æ±‚åˆ†æ"><!--[--><!--]--> 1 æ¨¡å—éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-1-æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 æ¨¡å—ä»‹ç»"><!--[--><!--]--> 1.1 æ¨¡å—ä»‹ç» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 1.2 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-2-1-ä¸Šä¼ å›¾ç‰‡" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.1 ä¸Šä¼ å›¾ç‰‡"><!--[--><!--]--> 1.2.1 ä¸Šä¼ å›¾ç‰‡ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-2-2-ä¸Šä¼ è§†é¢‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.2 ä¸Šä¼ è§†é¢‘"><!--[--><!--]--> 1.2.2 ä¸Šä¼ è§†é¢‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-2-3-å¤„ç†è§†é¢‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.3 å¤„ç†è§†é¢‘"><!--[--><!--]--> 1.2.3 å¤„ç†è§†é¢‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-2-4-å®¡æ ¸åª’èµ„" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.4 å®¡æ ¸åª’èµ„"><!--[--><!--]--> 1.2.4 å®¡æ ¸åª’èµ„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-2-5-ç»‘å®šåª’èµ„" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.5 ç»‘å®šåª’èµ„"><!--[--><!--]--> 1.2.5 ç»‘å®šåª’èµ„ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-3-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3 æ•°æ®æ¨¡å‹"><!--[--><!--]--> 1.3 æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-æ­å»ºæ¨¡å—ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2 æ­å»ºæ¨¡å—ç¯å¢ƒ"><!--[--><!--]--> 2 æ­å»ºæ¨¡å—ç¯å¢ƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-1-æ¶æ„çš„é—®é¢˜åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 æ¶æ„çš„é—®é¢˜åˆ†æ"><!--[--><!--]--> 2.1 æ¶æ„çš„é—®é¢˜åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-æ­å»º-nacos" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 æ­å»º Nacos"><!--[--><!--]--> 2.2 æ­å»º Nacos <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-1-æœåŠ¡å‘ç°ä¸­å¿ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.1 æœåŠ¡å‘ç°ä¸­å¿ƒ"><!--[--><!--]--> 2.2.1 æœåŠ¡å‘ç°ä¸­å¿ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-2-é…ç½®ä¸­å¿ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2 é…ç½®ä¸­å¿ƒ"><!--[--><!--]--> 2.2.2 é…ç½®ä¸­å¿ƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-2-1-é…ç½®ä¸‰è¦ç´ " class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2.1 é…ç½®ä¸‰è¦ç´ "><!--[--><!--]--> 2.2.2.1 é…ç½®ä¸‰è¦ç´  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-2-2-é…ç½®-content-service" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2.2 é…ç½® content-service"><!--[--><!--]--> 2.2.2.2 é…ç½® content-service <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-2-3-é…ç½®-content-api" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2.3 é…ç½® content-api"><!--[--><!--]--> 2.2.2.3 é…ç½® content-api <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-3-å…¬ç”¨é…ç½®" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.3 å…¬ç”¨é…ç½®"><!--[--><!--]--> 2.2.3 å…¬ç”¨é…ç½® <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-4-é…ç½®ä¼˜å…ˆçº§" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.4 é…ç½®ä¼˜å…ˆçº§"><!--[--><!--]--> 2.2.4 é…ç½®ä¼˜å…ˆçº§ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-5-å¯¼å…¥é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5 å¯¼å…¥é…ç½®æ–‡ä»¶"><!--[--><!--]--> 2.2.5 å¯¼å…¥é…ç½®æ–‡ä»¶ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-6-ä½œä¸š" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.6 ä½œä¸š"><!--[--><!--]--> 2.2.6 ä½œä¸š <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-3-æ­å»º-gateway" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 æ­å»º Gateway"><!--[--><!--]--> 2.3 æ­å»º Gateway <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-4-æ­å»ºåª’èµ„å·¥ç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 æ­å»ºåª’èµ„å·¥ç¨‹"><!--[--><!--]--> 2.4 æ­å»ºåª’èµ„å·¥ç¨‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3 åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ"><!--[--><!--]--> 3 åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ"><!--[--><!--]--> 3.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-minio" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 MinIO"><!--[--><!--]--> 3.2 MinIO <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-1-ä»‹ç»" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.1 ä»‹ç»"><!--[--><!--]--> 3.2.1 ä»‹ç» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-2-æ•°æ®æ¢å¤æ¼”ç¤º" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.2 æ•°æ®æ¢å¤æ¼”ç¤º"><!--[--><!--]--> 3.2.2 æ•°æ®æ¢å¤æ¼”ç¤º <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-3-æµ‹è¯•-docker-ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.3 æµ‹è¯• Docker ç¯å¢ƒ"><!--[--><!--]--> 3.2.3 æµ‹è¯• Docker ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-4-sdk" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.4 SDK"><!--[--><!--]--> 3.2.4 SDK <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-4-1-ä¸Šä¼ æ–‡ä»¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.4.1 ä¸Šä¼ æ–‡ä»¶"><!--[--><!--]--> 3.2.4.1 ä¸Šä¼ æ–‡ä»¶ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-4-2-åˆ é™¤æ–‡ä»¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.4.2 åˆ é™¤æ–‡ä»¶"><!--[--><!--]--> 3.2.4.2 åˆ é™¤æ–‡ä»¶ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-4-3-æŸ¥è¯¢æ–‡ä»¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.4.3 æŸ¥è¯¢æ–‡ä»¶"><!--[--><!--]--> 3.2.4.3 æŸ¥è¯¢æ–‡ä»¶ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-ä¸Šä¼ å›¾ç‰‡" class="router-link-active router-link-exact-active sidebar-item" aria-label="4 ä¸Šä¼ å›¾ç‰‡"><!--[--><!--]--> 4 ä¸Šä¼ å›¾ç‰‡ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 4.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-1-1-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.1 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 4.1.1 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-1-2-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.2 æ•°æ®æ¨¡å‹"><!--[--><!--]--> 4.1.2 æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-2-å‡†å¤‡ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 å‡†å¤‡ç¯å¢ƒ"><!--[--><!--]--> 4.2 å‡†å¤‡ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-3-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 æ¥å£å®šä¹‰"><!--[--><!--]--> 4.3 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-4-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 æ¥å£å¼€å‘"><!--[--><!--]--> 4.4 æ¥å£å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-4-1-dao-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.1 DAO å¼€å‘"><!--[--><!--]--> 4.4.1 DAO å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-4-2-service-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.2 Service å¼€å‘"><!--[--><!--]--> 4.4.2 Service å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-4-3-å®Œå–„æ¥å£å±‚" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3 å®Œå–„æ¥å£å±‚"><!--[--><!--]--> 4.4.3 å®Œå–„æ¥å£å±‚ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-4-4-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.4 æ¥å£æµ‹è¯•"><!--[--><!--]--> 4.4.4 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-4-5-service-äº‹åŠ¡ä¼˜åŒ–" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.5 Service äº‹åŠ¡ä¼˜åŒ–"><!--[--><!--]--> 4.4.5 Service äº‹åŠ¡ä¼˜åŒ– <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-ä¸Šä¼ è§†é¢‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="5 ä¸Šä¼ è§†é¢‘"><!--[--><!--]--> 5 ä¸Šä¼ è§†é¢‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 5.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-2-æ–­ç‚¹ç»­ä¼ æŠ€æœ¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 æ–­ç‚¹ç»­ä¼ æŠ€æœ¯"><!--[--><!--]--> 5.2 æ–­ç‚¹ç»­ä¼ æŠ€æœ¯ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-2-1-ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ " class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2.1 ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ "><!--[--><!--]--> 5.2.1 ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-2-2-åˆ†å—ä¸åˆå¹¶æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2.2 åˆ†å—ä¸åˆå¹¶æµ‹è¯•"><!--[--><!--]--> 5.2.2 åˆ†å—ä¸åˆå¹¶æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-2-3-è§†é¢‘ä¸Šä¼ æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2.3 è§†é¢‘ä¸Šä¼ æµç¨‹"><!--[--><!--]--> 5.2.3 è§†é¢‘ä¸Šä¼ æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-2-4-minio-åˆå¹¶æ–‡ä»¶æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2.4 minio åˆå¹¶æ–‡ä»¶æµ‹è¯•"><!--[--><!--]--> 5.2.4 minio åˆå¹¶æ–‡ä»¶æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-3-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 æ¥å£å®šä¹‰"><!--[--><!--]--> 5.3 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-4-ä¸Šä¼ åˆ†å—å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4 ä¸Šä¼ åˆ†å—å¼€å‘"><!--[--><!--]--> 5.4 ä¸Šä¼ åˆ†å—å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-4-1-dao-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.1 DAO å¼€å‘"><!--[--><!--]--> 5.4.1 DAO å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-4-2-service-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.2 Service å¼€å‘"><!--[--><!--]--> 5.4.2 Service å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-4-2-1-æ£€æŸ¥æ–‡ä»¶å’Œåˆ†å—" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.2.1 æ£€æŸ¥æ–‡ä»¶å’Œåˆ†å—"><!--[--><!--]--> 5.4.2.1 æ£€æŸ¥æ–‡ä»¶å’Œåˆ†å— <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-4-2-2-ä¸Šä¼ åˆ†å—" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.2.2 ä¸Šä¼ åˆ†å—"><!--[--><!--]--> 5.4.2.2 ä¸Šä¼ åˆ†å— <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-4-2-3-ä¸Šä¼ åˆ†å—æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.2.3 ä¸Šä¼ åˆ†å—æµ‹è¯•"><!--[--><!--]--> 5.4.2.3 ä¸Šä¼ åˆ†å—æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-5-åˆå¹¶åˆ†å—å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.5 åˆå¹¶åˆ†å—å¼€å‘"><!--[--><!--]--> 5.5 åˆå¹¶åˆ†å—å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-5-1-service-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.5.1 service å¼€å‘"><!--[--><!--]--> 5.5.1 service å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-5-2-åˆå¹¶åˆ†å—æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.5.2 åˆå¹¶åˆ†å—æµ‹è¯•"><!--[--><!--]--> 5.5.2 åˆå¹¶åˆ†å—æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-6-å…¶å®ƒé—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.6 å…¶å®ƒé—®é¢˜"><!--[--><!--]--> 5.6 å…¶å®ƒé—®é¢˜ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-6-1-åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.6.1 åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜"><!--[--><!--]--> 5.6.1 åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-è§†é¢‘å¤„ç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="7 è§†é¢‘å¤„ç†"><!--[--><!--]--> 7 è§†é¢‘å¤„ç† <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-1-éœ€æ±‚" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.1 éœ€æ±‚"><!--[--><!--]--> 7.1 éœ€æ±‚ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-1-1-æ€»ä½“éœ€æ±‚" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.1.1 æ€»ä½“éœ€æ±‚"><!--[--><!--]--> 7.1.1 æ€»ä½“éœ€æ±‚ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-7-2-ä»€ä¹ˆæ˜¯è§†é¢‘ç¼–ç " class="router-link-active router-link-exact-active sidebar-item" aria-label="7.7.2 ä»€ä¹ˆæ˜¯è§†é¢‘ç¼–ç "><!--[--><!--]--> 7.7.2 ä»€ä¹ˆæ˜¯è§†é¢‘ç¼–ç  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-7-3-ffmpeg-çš„åŸºæœ¬ä½¿ç”¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.7.3 FFmpeg çš„åŸºæœ¬ä½¿ç”¨"><!--[--><!--]--> 7.7.3 FFmpeg çš„åŸºæœ¬ä½¿ç”¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-7-4-è§†é¢‘å¤„ç†å·¥å…·ç±»" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.7.4 è§†é¢‘å¤„ç†å·¥å…·ç±»"><!--[--><!--]--> 7.7.4 è§†é¢‘å¤„ç†å·¥å…·ç±» <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2 åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†"><!--[--><!--]--> 7.2 åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç† <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦"><!--[--><!--]--> 7.2.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-2-xxl-job-ä»‹ç»" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2.2 XXL-JOB ä»‹ç»"><!--[--><!--]--> 7.2.2 XXL-JOB ä»‹ç» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-3-æ­å»º-xxl-job" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2.3 æ­å»º XXL-JOB"><!--[--><!--]--> 7.2.3 æ­å»º XXL-JOB <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-3-1-è°ƒåº¦ä¸­å¿ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2.3.1 è°ƒåº¦ä¸­å¿ƒ"><!--[--><!--]--> 7.2.3.1 è°ƒåº¦ä¸­å¿ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-3-2-æ‰§è¡Œå™¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2.3.2 æ‰§è¡Œå™¨"><!--[--><!--]--> 7.2.3.2 æ‰§è¡Œå™¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-3-3-æ‰§è¡Œä»»åŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2.3.3 æ‰§è¡Œä»»åŠ¡"><!--[--><!--]--> 7.2.3.3 æ‰§è¡Œä»»åŠ¡ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-4-åˆ†ç‰‡å¹¿æ’­" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2.4 åˆ†ç‰‡å¹¿æ’­"><!--[--><!--]--> 7.2.4 åˆ†ç‰‡å¹¿æ’­ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-3-æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3 æŠ€æœ¯æ–¹æ¡ˆ"><!--[--><!--]--> 7.3 æŠ€æœ¯æ–¹æ¡ˆ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-3-1-ä½œä¸šåˆ†ç‰‡æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3.1 ä½œä¸šåˆ†ç‰‡æ–¹æ¡ˆ"><!--[--><!--]--> 7.3.1 ä½œä¸šåˆ†ç‰‡æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-3-2-ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3.2 ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ"><!--[--><!--]--> 7.3.2 ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-3-3-è§†é¢‘å¤„ç†æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3.3 è§†é¢‘å¤„ç†æ–¹æ¡ˆ"><!--[--><!--]--> 7.3.3 è§†é¢‘å¤„ç†æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-4-æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.4 æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡"><!--[--><!--]--> 7.4 æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.4.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 7.4.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-4-2-æ·»åŠ å¾…å¤„ç†ä»»åŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.4.2 æ·»åŠ å¾…å¤„ç†ä»»åŠ¡"><!--[--><!--]--> 7.4.2 æ·»åŠ å¾…å¤„ç†ä»»åŠ¡ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-4-3-æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.4.3 æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡"><!--[--><!--]--> 7.4.3 æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-5-å¼€å§‹æ‰§è¡Œä»»åŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.5 å¼€å§‹æ‰§è¡Œä»»åŠ¡"><!--[--><!--]--> 7.5 å¼€å§‹æ‰§è¡Œä»»åŠ¡ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-5-1-åˆ†å¸ƒå¼é”" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.5.1 åˆ†å¸ƒå¼é”"><!--[--><!--]--> 7.5.1 åˆ†å¸ƒå¼é” <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-5-2-å¼€å¯ä»»åŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.5.2 å¼€å¯ä»»åŠ¡"><!--[--><!--]--> 7.5.2 å¼€å¯ä»»åŠ¡ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-6-æ›´æ–°ä»»åŠ¡çŠ¶æ€" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.6 æ›´æ–°ä»»åŠ¡çŠ¶æ€"><!--[--><!--]--> 7.6 æ›´æ–°ä»»åŠ¡çŠ¶æ€ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-7-è§†é¢‘å¤„ç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.7 è§†é¢‘å¤„ç†"><!--[--><!--]--> 7.7 è§†é¢‘å¤„ç† <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-8-æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.8 æµ‹è¯•"><!--[--><!--]--> 7.8 æµ‹è¯• <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-8-1-åŸºæœ¬æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.8.1 åŸºæœ¬æµ‹è¯•"><!--[--><!--]--> 7.8.1 åŸºæœ¬æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-8-2-å¤±è´¥æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.8.2 å¤±è´¥æµ‹è¯•"><!--[--><!--]--> 7.8.2 å¤±è´¥æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-8-3-æŠ¢å ä»»åŠ¡æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.8.3 æŠ¢å ä»»åŠ¡æµ‹è¯•"><!--[--><!--]--> 7.8.3 æŠ¢å ä»»åŠ¡æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-9-å…¶å®ƒé—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.9 å…¶å®ƒé—®é¢˜"><!--[--><!--]--> 7.9 å…¶å®ƒé—®é¢˜ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-9-1-ä»»åŠ¡è¡¥å¿æœºåˆ¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.9.1 ä»»åŠ¡è¡¥å¿æœºåˆ¶"><!--[--><!--]--> 7.9.1 ä»»åŠ¡è¡¥å¿æœºåˆ¶ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-9-2-è¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•°" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.9.2 è¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•°"><!--[--><!--]--> 7.9.2 è¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•° <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-ç»‘å®šåª’èµ„" class="router-link-active router-link-exact-active sidebar-item" aria-label="8 ç»‘å®šåª’èµ„"><!--[--><!--]--> 8 ç»‘å®šåª’èµ„ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 8.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-1-1-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.1.1 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 8.1.1 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-1-2-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.1.2 æ•°æ®æ¨¡å‹"><!--[--><!--]--> 8.1.2 æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.2 æ¥å£å®šä¹‰"><!--[--><!--]--> 8.2 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-3-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.3 æ¥å£å¼€å‘"><!--[--><!--]--> 8.3 æ¥å£å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-3-1-dao-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.3.1 DAO å¼€å‘"><!--[--><!--]--> 8.3.1 DAO å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-3-2-service-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.3.2 Service å¼€å‘"><!--[--><!--]--> 8.3.2 Service å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-3-3-æ¥å£å±‚å®Œå–„" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.3.3 æ¥å£å±‚å®Œå–„"><!--[--><!--]--> 8.3.3 æ¥å£å±‚å®Œå–„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-3-4-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.3.4 æ¥å£æµ‹è¯•"><!--[--><!--]--> 8.3.4 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-4-å®æˆ˜-å‰ç«¯ä»£ç æœ‰é—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.4 å®æˆ˜ï¼ˆå‰ç«¯ä»£ç æœ‰é—®é¢˜ï¼‰"><!--[--><!--]--> 8.4 å®æˆ˜ï¼ˆå‰ç«¯ä»£ç æœ‰é—®é¢˜ï¼‰ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/" class="sidebar-item" aria-label="ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1"><!--[--><!--]--> ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/" class="sidebar-item" aria-label="ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1"><!--[--><!--]--> ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/" class="sidebar-item" aria-label="ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1"><!--[--><!--]--> ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC7%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2v3.1/" class="sidebar-item" aria-label="ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1"><!--[--><!--]--> ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC8%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%963.1/" class="sidebar-item" aria-label="ç¬¬ 8 ç«  é¡¹ç›®ä¼˜åŒ– 3.1"><!--[--><!--]--> ç¬¬ 8 ç«  é¡¹ç›®ä¼˜åŒ– 3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83-%E9%83%A8%E7%BD%B2%E9%97%A8%E6%88%B7%E6%96%87%E6%A1%A3/" class="sidebar-item" aria-label="è¯¾ç¨‹å‘å¸ƒ-éƒ¨ç½²é—¨æˆ·æ–‡æ¡£ v3.1"><!--[--><!--]--> è¯¾ç¨‹å‘å¸ƒ-éƒ¨ç½²é—¨æˆ·æ–‡æ¡£ v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE/" class="sidebar-item" aria-label="å¾®ä¿¡æ‰«ç ç™»å½•é…ç½®"><!--[--><!--]--> å¾®ä¿¡æ‰«ç ç™»å½•é…ç½® <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AEv3.1/" class="sidebar-item" aria-label="å­¦æˆåœ¨çº¿é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½® v3.1"><!--[--><!--]--> å­¦æˆåœ¨çº¿é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½® v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="sidebar-item" aria-label="æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ"><!--[--><!--]--> æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" class="sidebar-item" aria-label="é¡¹ç›®æ€»ç»“"><!--[--><!--]--> é¡¹ç›®æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="ç¬¬-3-ç« åª’èµ„ç®¡ç†æ¨¡å—-v3-1" tabindex="-1"><a class="header-anchor" href="#ç¬¬-3-ç« åª’èµ„ç®¡ç†æ¨¡å—-v3-1" aria-hidden="true">#</a> <strong>ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1</strong></h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-æ¨¡å—éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">1 æ¨¡å—éœ€æ±‚åˆ†æ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-1-æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active">1.1 æ¨¡å—ä»‹ç»</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active">1.2 ä¸šåŠ¡æµç¨‹</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_1-3-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active">1.3 æ•°æ®æ¨¡å‹</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-æ­å»ºæ¨¡å—ç¯å¢ƒ" class="router-link-active router-link-exact-active">2 æ­å»ºæ¨¡å—ç¯å¢ƒ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-1-æ¶æ„çš„é—®é¢˜åˆ†æ" class="router-link-active router-link-exact-active">2.1 æ¶æ„çš„é—®é¢˜åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-2-æ­å»º-nacos" class="router-link-active router-link-exact-active">2.2 æ­å»º Nacos</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-3-æ­å»º-gateway" class="router-link-active router-link-exact-active">2.3 æ­å»º Gateway</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_2-4-æ­å»ºåª’èµ„å·¥ç¨‹" class="router-link-active router-link-exact-active">2.4 æ­å»ºåª’èµ„å·¥ç¨‹</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" class="router-link-active router-link-exact-active">3 åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" class="router-link-active router-link-exact-active">3.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_3-2-minio" class="router-link-active router-link-exact-active">3.2 MinIO</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-ä¸Šä¼ å›¾ç‰‡" class="router-link-active router-link-exact-active">4 ä¸Šä¼ å›¾ç‰‡</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">4.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-2-å‡†å¤‡ç¯å¢ƒ" class="router-link-active router-link-exact-active">4.2 å‡†å¤‡ç¯å¢ƒ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-3-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active">4.3 æ¥å£å®šä¹‰</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_4-4-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active">4.4 æ¥å£å¼€å‘</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-ä¸Šä¼ è§†é¢‘" class="router-link-active router-link-exact-active">5 ä¸Šä¼ è§†é¢‘</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">5.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-2-æ–­ç‚¹ç»­ä¼ æŠ€æœ¯" class="router-link-active router-link-exact-active">5.2 æ–­ç‚¹ç»­ä¼ æŠ€æœ¯</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-3-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active">5.3 æ¥å£å®šä¹‰</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-4-ä¸Šä¼ åˆ†å—å¼€å‘" class="router-link-active router-link-exact-active">5.4 ä¸Šä¼ åˆ†å—å¼€å‘</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-5-åˆå¹¶åˆ†å—å¼€å‘" class="router-link-active router-link-exact-active">5.5 åˆå¹¶åˆ†å—å¼€å‘</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_5-6-å…¶å®ƒé—®é¢˜" class="router-link-active router-link-exact-active">5.6 å…¶å®ƒé—®é¢˜</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-è§†é¢‘å¤„ç†" class="router-link-active router-link-exact-active">7 è§†é¢‘å¤„ç†</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-1-éœ€æ±‚" class="router-link-active router-link-exact-active">7.1 éœ€æ±‚</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-2-åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†" class="router-link-active router-link-exact-active">7.2 åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-3-æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active">7.3 æŠ€æœ¯æ–¹æ¡ˆ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-4-æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡" class="router-link-active router-link-exact-active">7.4 æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-5-å¼€å§‹æ‰§è¡Œä»»åŠ¡" class="router-link-active router-link-exact-active">7.5 å¼€å§‹æ‰§è¡Œä»»åŠ¡</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-6-æ›´æ–°ä»»åŠ¡çŠ¶æ€" class="router-link-active router-link-exact-active">7.6 æ›´æ–°ä»»åŠ¡çŠ¶æ€</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-7-è§†é¢‘å¤„ç†" class="router-link-active router-link-exact-active">7.7 è§†é¢‘å¤„ç†</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-8-æµ‹è¯•" class="router-link-active router-link-exact-active">7.8 æµ‹è¯•</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_7-9-å…¶å®ƒé—®é¢˜" class="router-link-active router-link-exact-active">7.9 å…¶å®ƒé—®é¢˜</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-ç»‘å®šåª’èµ„" class="router-link-active router-link-exact-active">8 ç»‘å®šåª’èµ„</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">8.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active">8.2 æ¥å£å®šä¹‰</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-3-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active">8.3 æ¥å£å¼€å‘</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/#_8-4-å®æˆ˜-å‰ç«¯ä»£ç æœ‰é—®é¢˜" class="router-link-active router-link-exact-active">8.4 å®æˆ˜ï¼ˆå‰ç«¯ä»£ç æœ‰é—®é¢˜ï¼‰</a></li></ul></li></ul></nav><h2 id="_1-æ¨¡å—éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_1-æ¨¡å—éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>1 æ¨¡å—éœ€æ±‚åˆ†æ</strong></h2><h3 id="_1-1-æ¨¡å—ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-1-æ¨¡å—ä»‹ç»" aria-hidden="true">#</a> <strong>1.1 æ¨¡å—ä»‹ç»</strong></h3><p>åª’èµ„ç®¡ç†ç³»ç»Ÿæ˜¯æ¯ä¸ªåœ¨çº¿æ•™è‚²å¹³å°æ‰€å¿…é¡»å…·å¤‡çš„ï¼ŒæŸ¥é˜…ç™¾åº¦ç™¾ç§‘å¯¹å®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><p>åª’ä½“èµ„æºç®¡ç†(Media Asset Managementï¼ŒMAM)ç³»ç»Ÿæ˜¯å»ºç«‹åœ¨å¤šåª’ä½“ã€ç½‘ç»œã€æ•°æ®åº“å’Œæ•°å­—å­˜å‚¨ç­‰å…ˆè¿›æŠ€æœ¯åŸºç¡€ä¸Šçš„ä¸€ä¸ªå¯¹å„ç§åª’ä½“åŠå†…å®¹(å¦‚è§†/éŸ³é¢‘èµ„æ–™ã€æ–‡æœ¬æ–‡ä»¶ã€å›¾è¡¨ç­‰)è¿›è¡Œæ•°å­—åŒ–å­˜å‚¨ã€ç®¡ç†ä»¥åŠåº”ç”¨çš„æ€»ä½“è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ•°å­—åª’ä½“çš„é‡‡é›†ã€ç¼–ç›®ã€ç®¡ç†ã€ä¼ è¾“å’Œç¼–ç è½¬æ¢ç­‰æ‰€æœ‰ç¯èŠ‚ã€‚å…¶ä¸»è¦æ˜¯æ»¡è¶³<a href="https://baike.baidu.com/item/%E5%AA%92%E4%BD%93?fromModule=lemma_inlink" target="_blank" rel="noopener noreferrer">åª’ä½“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>èµ„æºæ‹¥æœ‰è€…æ”¶é›†ã€ä¿å­˜ã€æŸ¥æ‰¾ã€ç¼–è¾‘ã€å‘å¸ƒå„ç§ä¿¡æ¯çš„è¦æ±‚ï¼Œä¸ºåª’ä½“èµ„æºçš„ä½¿ç”¨è€…æä¾›è®¿é—®å†…å®¹çš„ä¾¿æ·æ–¹æ³•ï¼Œå®ç°å¯¹åª’ä½“èµ„æºçš„é«˜æ•ˆç®¡ç†ï¼Œå¤§å¹…åº¦æé«˜åª’ä½“èµ„æºçš„ä»·å€¼ã€‚</p><p>æ¯ä¸ªæ•™å­¦æœºæ„éƒ½å¯ä»¥åœ¨åª’èµ„ç³»ç»Ÿç®¡ç†è‡ªå·±çš„æ•™å­¦èµ„æºï¼ŒåŒ…æ‹¬ï¼šè§†é¢‘ã€æ•™æ¡ˆç­‰æ–‡ä»¶ã€‚</p><p>ç›®å‰åª’èµ„ç®¡ç†çš„ä¸»è¦ç®¡ç†å¯¹è±¡æ˜¯è§†é¢‘ã€å›¾ç‰‡ã€æ–‡æ¡£ç­‰ï¼ŒåŒ…æ‹¬ï¼šåª’èµ„æ–‡ä»¶çš„æŸ¥è¯¢ã€æ–‡ä»¶ä¸Šä¼ ã€è§†é¢‘å¤„ç†ç­‰ã€‚</p><p>åª’èµ„æŸ¥è¯¢ï¼šæ•™å­¦æœºæ„æŸ¥è¯¢è‡ªå·±æ‰€æ‹¥æœ‰çš„åª’èµ„ä¿¡æ¯ã€‚</p><p>æ–‡ä»¶ä¸Šä¼ ï¼šåŒ…æ‹¬ä¸Šä¼ å›¾ç‰‡ã€ä¸Šä¼ æ–‡æ¡£ã€ä¸Šä¼ è§†é¢‘ã€‚</p><p>è§†é¢‘å¤„ç†ï¼šè§†é¢‘ä¸Šä¼ æˆåŠŸï¼Œç³»ç»Ÿè‡ªåŠ¨å¯¹è§†é¢‘è¿›è¡Œç¼–ç å¤„ç†ã€‚</p><p>æ–‡ä»¶åˆ é™¤ï¼šæ•™å­¦æœºæ„åˆ é™¤è‡ªå·±ä¸Šä¼ çš„åª’èµ„æ–‡ä»¶ã€‚</p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹ç¼–è¾‘ä¸å‘å¸ƒçš„æ•´ä½“æµç¨‹ï¼Œé€šè¿‡ä¸‹å›¾å¯ä»¥çœ‹åˆ°åª’èµ„ç®¡ç†åœ¨æ•´ä½“æµç¨‹çš„ä½ç½®ï¼š</p><p><img src="/MyBlog/assets/image-20230516200809855-0c0f2854.png" alt="image-20230521172723493"></p><h3 id="_1-2-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-2-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>1.2 ä¸šåŠ¡æµç¨‹</strong></h3><h4 id="_1-2-1-ä¸Šä¼ å›¾ç‰‡" tabindex="-1"><a class="header-anchor" href="#_1-2-1-ä¸Šä¼ å›¾ç‰‡" aria-hidden="true">#</a> <strong>1.2.1 ä¸Šä¼ å›¾ç‰‡</strong></h4><p>æ•™å­¦æœºæ„äººå‘˜åœ¨è¯¾ç¨‹ä¿¡æ¯ç¼–è¾‘é¡µé¢ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡ï¼Œè¯¾ç¨‹å›¾ç‰‡ç»Ÿä¸€è®°å½•åœ¨åª’èµ„ç®¡ç†ç³»ç»Ÿã€‚</p><p>ä¸‹å›¾æ˜¯ä¸Šä¼ å›¾ç‰‡çš„ç•Œé¢ï¼š</p><p><img src="/MyBlog/assets/image-20230521172736026-dcdff67f.png" alt="image-20230521172736026"></p><h4 id="_1-2-2-ä¸Šä¼ è§†é¢‘" tabindex="-1"><a class="header-anchor" href="#_1-2-2-ä¸Šä¼ è§†é¢‘" aria-hidden="true">#</a> <strong>1.2.2 ä¸Šä¼ è§†é¢‘</strong></h4><p>1ã€æ•™å­¦æœºæ„äººå‘˜è¿›å…¥åª’èµ„ç®¡ç†åˆ—è¡¨æŸ¥è¯¢è‡ªå·±ä¸Šä¼ çš„åª’èµ„æ–‡ä»¶ã€‚</p><p>ç‚¹å‡»â€œåª’èµ„ç®¡ç†â€</p><p><img src="/MyBlog/assets/image-20230521172741680-7b3acbdf.png" alt="image-20230521172741680"></p><p>è¿›å…¥åª’èµ„ç®¡ç†åˆ—è¡¨é¡µé¢æŸ¥è¯¢æœ¬æœºæ„ä¸Šä¼ çš„åª’èµ„æ–‡ä»¶ã€‚</p><p><img src="/MyBlog/assets/image-20230521172746056-a676d7de.png" alt="image-20230521172746056"></p><p>2ã€æ•™è‚²æœºæ„ç”¨æˆ·åœ¨&quot;åª’èµ„ç®¡ç†&quot;é¡µé¢ä¸­ç‚¹å‡» &quot;ä¸Šä¼ è§†é¢‘&quot; æŒ‰é’®ã€‚</p><p><img src="/MyBlog/assets/image-20230521172754168-1b28ee58.png" alt="image-20230521172754168"></p><p>ç‚¹å‡»â€œä¸Šä¼ è§†é¢‘â€æ‰“å¼€ä¸Šä¼ é¡µé¢</p><p><img src="/MyBlog/assets/image-20230521172759310-c7af05fe.png" alt="image-20230521172759310"></p><p>3ã€é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè‡ªåŠ¨æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œè§†é¢‘ä¸Šä¼ æˆåŠŸä¼šè‡ªåŠ¨å¤„ç†ã€‚</p><p><img src="/MyBlog/assets/image-20230521172807448-1b4d28cf.png" alt="image-20230521172807448"></p><h4 id="_1-2-3-å¤„ç†è§†é¢‘" tabindex="-1"><a class="header-anchor" href="#_1-2-3-å¤„ç†è§†é¢‘" aria-hidden="true">#</a> <strong>1.2.3 å¤„ç†è§†é¢‘</strong></h4><p>å¯¹éœ€è¦è½¬ç å¤„ç†çš„è§†é¢‘ç³»ç»Ÿä¼šè‡ªåŠ¨å¯¹å…¶å¤„ç†ï¼Œå¤„ç†åç”Ÿæˆè§†é¢‘çš„ URLã€‚</p><p>å¤„ç†è§†é¢‘æ²¡æœ‰ç”¨æˆ·ç•Œé¢ï¼Œå®Œå…¨æ˜¯åå°è‡ªåŠ¨æ‰§è¡Œã€‚</p><h4 id="_1-2-4-å®¡æ ¸åª’èµ„" tabindex="-1"><a class="header-anchor" href="#_1-2-4-å®¡æ ¸åª’èµ„" aria-hidden="true">#</a> <strong>1.2.4 å®¡æ ¸åª’èµ„</strong></h4><p>å®¡æ ¸åª’èµ„åŒ…æ‹¬ç¨‹åºè‡ªåŠ¨å®¡æ ¸å’Œäººå·¥å®¡æ ¸ï¼Œç¨‹åºå¯ä»¥é€šè¿‡é‰´é»„æ¥å£(https://www.aliyun.com/product/lvwang?spm=5176.19720258.J_3207526240.51.e93976f4rSq796)å®¡æ ¸è§†é¢‘ï¼Œå¯¹æœ‰å¼‚è®®çš„è§†é¢‘ç”±äººå·¥è¿›è¡Œå®¡æ ¸ã€‚</p><p>1.è¿è¥ç”¨æˆ·ç™»å…¥è¿è¥å¹³å°å¹¶è¿›å…¥åª’èµ„ç®¡ç†é¡µé¢ï¼ŒæŸ¥æ‰¾å¾…å®¡æ ¸åª’èµ„</p><p><img src="/MyBlog/assets/image-20230521172839945-ace69397.png" alt="image-20230521172839945"></p><p>2.ç‚¹å‡»åˆ—è¡¨ä¸­åª’èµ„åç§°é“¾æ¥ï¼Œå¯é¢„è§ˆè¯¥åª’èµ„ï¼Œè‹¥æ˜¯è§†é¢‘ï¼Œåˆ™æ’­æ”¾è§†é¢‘ã€‚</p><p><img src="/MyBlog/assets/image-20230521172852283-2ed79aae.png" alt="image-20230521172852283"></p><p>3.ç‚¹å‡»åˆ—è¡¨ä¸­æŸåª’èµ„åçš„&quot;å®¡æ ¸&quot; æŒ‰é’®ï¼Œæ—¢å®Œæˆåª’èµ„çš„å®¡æ‰¹è¿‡ç¨‹ã€‚</p><p><img src="/MyBlog/assets/image-20230521172906517-f9961011.png" alt="image-20230521172906517"></p><p>ç‚¹å‡»â€œå®¡æ ¸â€ï¼Œé€‰æ‹©å®¡æ ¸ç»“æœï¼Œè¾“å…¥å®¡æ ¸æ„è§ã€‚</p><p><img src="/MyBlog/assets/image-20230521172913161-aa580986.png" alt="image-20230521172913161"></p><h4 id="_1-2-5-ç»‘å®šåª’èµ„" tabindex="-1"><a class="header-anchor" href="#_1-2-5-ç»‘å®šåª’èµ„" aria-hidden="true">#</a> <strong>1.2.5 ç»‘å®šåª’èµ„</strong></h4><p>è¯¾ç¨‹è®¡åˆ’åˆ›å»ºå¥½åéœ€è¦ç»‘å®šåª’èµ„æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šå¦‚æœè¯¾ç¨‹è®¡åˆ’ç»‘å®šäº†è§†é¢‘æ–‡ä»¶ï¼Œè¿›å…¥è¯¾ç¨‹åœ¨çº¿å­¦ä¹ ç•Œé¢åç‚¹è¯¾ç¨‹è®¡åˆ’åç§°åˆ™åœ¨çº¿æ’­æ”¾è§†é¢‘ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521172926268-1194aad7.png" alt="image-20230521172926268"></p><p>å¦‚ä½•å°†è¯¾ç¨‹è®¡åˆ’ç»‘å®šåª’èµ„å‘¢ï¼Ÿ</p><p>1.æ•™è‚²æœºæ„ç”¨æˆ·è¿›å…¥è¯¾ç¨‹ç®¡ç†é¡µé¢å¹¶ç¼–è¾‘æŸä¸€ä¸ªè¯¾ç¨‹ï¼Œåœ¨&quot;è¯¾ç¨‹å¤§çº²&quot;æ ‡ç­¾é¡µçš„æŸä¸€å°èŠ‚åå¯ç‚¹å‡»â€æ·»åŠ è§†é¢‘â€œã€‚</p><p><img src="/MyBlog/assets/image-20230521172936979-a0af02f0.png" alt="image-20230521172936979"></p><p>2.å¼¹å‡ºæ·»åŠ è§†é¢‘å¯¹è¯æ¡†ï¼Œå¯é€šè¿‡è§†é¢‘å…³é”®å­—æœç´¢å·²å®¡æ ¸é€šè¿‡çš„è§†é¢‘åª’èµ„ã€‚</p><p><img src="/MyBlog/assets/image-20230521172943466-f5fa9803.png" alt="image-20230521172943466"></p><p>3.é€‰æ‹©è§†é¢‘åª’èµ„ï¼Œç‚¹å‡»æäº¤æŒ‰é’®ï¼Œå®Œæˆè¯¾ç¨‹è®¡åˆ’ç»‘å®šåª’èµ„æµç¨‹ã€‚</p><p><img src="/MyBlog/assets/image-20230521172953841-176a63dd.png" alt="image-20230521172953841"></p><p>è¯¾ç¨‹è®¡åˆ’å…³è”è§†é¢‘åå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521172959743-85b2922d.png" alt="image-20230521172959743"></p><h3 id="_1-3-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_1-3-æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>1.3 æ•°æ®æ¨¡å‹</strong></h3><p>æœ¬æ¨¡å—åª’èµ„æ–‡ä»¶ç›¸å…³çš„æ•°æ®è¡¨å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521173006160-bd1dee18.png" alt="image-20230521173006160"></p><p>åª’èµ„æ–‡ä»¶è¡¨ï¼šå­˜å‚¨æ–‡ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ç­‰ã€‚</p><p>media_process: å¾…å¤„ç†è§†é¢‘è¡¨ã€‚</p><p>media_process_history: è§†é¢‘å¤„ç†å†å²è¡¨ï¼Œè®°å½•å·²ç»å¤„ç†æˆåŠŸçš„è§†é¢‘ä¿¡æ¯ã€‚</p><p>åª’èµ„æ–‡ä»¶ä¸è¯¾ç¨‹è®¡åˆ’ç»‘å®šå…³ç³»è¡¨å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521173014279-ffe1a0ca.png" alt="image-20230521173014279"></p><h2 id="_2-æ­å»ºæ¨¡å—ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_2-æ­å»ºæ¨¡å—ç¯å¢ƒ" aria-hidden="true">#</a> <strong>2 æ­å»ºæ¨¡å—ç¯å¢ƒ</strong></h2><h3 id="_2-1-æ¶æ„çš„é—®é¢˜åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_2-1-æ¶æ„çš„é—®é¢˜åˆ†æ" aria-hidden="true">#</a> <strong>2.1 æ¶æ„çš„é—®é¢˜åˆ†æ</strong></h3><p>å½“å‰è¦å¼€å‘çš„æ˜¯åª’èµ„ç®¡ç†æœåŠ¡ï¼Œç›®å‰ä¸ºæ­¢å…±ä¸‰ä¸ªå¾®æœåŠ¡ï¼šå†…å®¹ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ã€åª’èµ„ç®¡ç†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521173023640-0cdd3615.png" alt="image-20230521173023640"></p><p>åæœŸè¿˜ä¼šæ·»åŠ æ›´å¤šçš„å¾®æœåŠ¡ï¼Œå½“å‰è¿™ç§ç”±å‰ç«¯ç›´æ¥è¯·æ±‚å¾®æœåŠ¡çš„æ–¹å¼å­˜åœ¨å¼Šç«¯ï¼š</p><p>å¦‚æœåœ¨å‰ç«¯å¯¹æ¯ä¸ªè¯·æ±‚åœ°å€éƒ½é…ç½®ç»å¯¹è·¯å¾„ï¼Œéå¸¸ä¸åˆ©äºç³»ç»Ÿç»´æŠ¤ï¼Œæ¯”å¦‚ä¸‹è¾¹ä»£ç ä¸­è¯·æ±‚ç³»ç»Ÿç®¡ç†æœåŠ¡çš„åœ°å€ä½¿ç”¨çš„æ˜¯ localhost</p><p><img src="/MyBlog/assets/image-20230521173032950-94f2b353.png" alt="image-20230521173032950"></p><p>å½“ç³»ç»Ÿä¸Šçº¿åè¿™é‡Œéœ€è¦æ”¹æˆå…¬ç½‘çš„åŸŸåï¼Œå¦‚æœè¿™ç§åœ°å€éå¸¸å¤šåˆ™éå¸¸éº»çƒ¦ã€‚</p><p>åŸºäºè¿™ä¸ªé—®é¢˜å¯ä»¥é‡‡ç”¨ç½‘å…³æ¥è§£å†³ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521173044369-beeae50f.png" alt="image-20230521173044369"></p><p>è¿™æ ·åœ¨å‰ç«¯çš„ä»£ç ä¸­åªéœ€è¦æŒ‡å®šæ¯ä¸ªæ¥å£çš„ç›¸å¯¹è·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/MyBlog/assets/image-20230521173050724-c9baec01.png" alt="image-20230521173050724"></p><p>åœ¨å‰ç«¯ä»£ç çš„ä¸€ä¸ªå›ºå®šçš„åœ°æ–¹åœ¨æ¥å£åœ°å€å‰ç»Ÿä¸€åŠ ç½‘å…³çš„åœ°å€ï¼Œæ¯ä¸ªè¯·æ±‚ç»Ÿä¸€åˆ°ç½‘å…³ï¼Œç”±ç½‘å…³å°†è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„å¾®æœåŠ¡ã€‚</p><p>ä¸ºä»€ä¹ˆæ‰€æœ‰çš„è¯·æ±‚å…ˆåˆ°ç½‘å…³å‘¢ï¼Ÿ</p><p>æœ‰äº†ç½‘å…³å°±å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œè·¯ç”±ï¼Œè·¯ç”±åˆ°å…·ä½“çš„å¾®æœåŠ¡ï¼Œå‡å°‘å¤–ç•Œå¯¹æ¥å¾®æœåŠ¡çš„æˆæœ¬ï¼Œæ¯”å¦‚ï¼š400 ç”µè¯ï¼Œè·¯ç”±çš„è¯•å¯ä»¥æ ¹æ®è¯·æ±‚è·¯å¾„è¿›è¡Œè·¯ç”±ã€æ ¹æ® host åœ°å€è¿›è¡Œè·¯ç”±ç­‰ï¼Œ å½“å¾®æœåŠ¡æœ‰å¤šä¸ªå®ä¾‹æ—¶å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•è¿›è¡Œè·¯ç”±ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521173104225-cd295f61.png" alt="image-20230521173104225"></p><p>å¦å¤–ï¼Œç½‘å…³è¿˜å¯ä»¥å®ç°æƒé™æ§åˆ¶ã€é™æµç­‰åŠŸèƒ½ã€‚</p><p>é¡¹ç›®é‡‡ç”¨ Spring Cloud Gateway ä½œä¸ºç½‘å…³ï¼Œç½‘å…³åœ¨è¯·æ±‚è·¯ç”±æ—¶éœ€è¦çŸ¥é“æ¯ä¸ªå¾®æœåŠ¡å®ä¾‹çš„åœ°å€ï¼Œé¡¹ç›®ä½¿ç”¨ Nacos ä½œç”¨æœåŠ¡å‘ç°ä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼Œæ•´ä½“çš„æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521173111174-07cf65ac.png" alt="image-20230521173111174"></p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€å¾®æœåŠ¡å¯åŠ¨ï¼Œå°†è‡ªå·±æ³¨å†Œåˆ° Nacosï¼ŒNacos è®°å½•äº†å„å¾®æœåŠ¡å®ä¾‹çš„åœ°å€ã€‚</p><p>2ã€ç½‘å…³ä» Nacos è¯»å–æœåŠ¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬æœåŠ¡åç§°ã€æœåŠ¡åœ°å€ç­‰ã€‚</p><p>3ã€è¯·æ±‚åˆ°è¾¾ç½‘å…³ï¼Œç½‘å…³å°†è¯·æ±‚è·¯ç”±åˆ°å…·ä½“çš„å¾®æœåŠ¡ã€‚</p><p>è¦ä½¿ç”¨ç½‘å…³é¦–å…ˆæ­å»º Nacosï¼ŒNacos æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><p>1ã€æœåŠ¡å‘ç°ä¸­å¿ƒã€‚</p><p>å¾®æœåŠ¡å°†è‡ªèº«æ³¨å†Œè‡³ Nacosï¼Œç½‘å…³ä» Nacos è·å–å¾®æœåŠ¡åˆ—è¡¨ã€‚</p><p>2ã€é…ç½®ä¸­å¿ƒã€‚</p><p>å¾®æœåŠ¡ä¼—å¤šï¼Œå®ƒä»¬çš„é…ç½®ä¿¡æ¯ä¹Ÿéå¸¸å¤æ‚ï¼Œä¸ºäº†æä¾›ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ï¼Œå¾®æœåŠ¡çš„é…ç½®ä¿¡æ¯ç»Ÿä¸€åœ¨ Nacos é…ç½®ã€‚</p><h3 id="_2-2-æ­å»º-nacos" tabindex="-1"><a class="header-anchor" href="#_2-2-æ­å»º-nacos" aria-hidden="true">#</a> <strong>2.2 æ­å»º Nacos</strong></h3><h4 id="_2-2-1-æœåŠ¡å‘ç°ä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#_2-2-1-æœåŠ¡å‘ç°ä¸­å¿ƒ" aria-hidden="true">#</a> <strong>2.2.1 æœåŠ¡å‘ç°ä¸­å¿ƒ</strong></h4><p>Spring Cloud ï¼šä¸€å¥—è§„èŒƒ</p><p>Spring Cloud alibabaï¼ˆç±»ä¼¼ä¸æ¥å£ä¸å®ç°ç±»çš„å…³ç³»ï¼‰: nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œé…ç½®ä¸­å¿ƒ****</p><p>æ ¹æ®ä¸ŠèŠ‚è®²è§£çš„ç½‘å…³çš„æ¶æ„å›¾ï¼Œè¦ä½¿ç”¨ç½‘å…³é¦–å…ˆæ­å»º Nacosã€‚</p><p>é¦–å…ˆæ­å»º Nacos æœåŠ¡å‘ç°ä¸­å¿ƒã€‚</p><p>åœ¨æ­å»º Nacos æœåŠ¡å‘ç°ä¸­å¿ƒä¹‹å‰éœ€è¦ææ¸…æ¥šä¸¤ä¸ªæ¦‚å¿µï¼šnamespace å’Œ group</p><p>namespaceï¼šç”¨äºåŒºåˆ†ç¯å¢ƒã€æ¯”å¦‚ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒã€‚</p><p>groupï¼šç”¨äºåŒºåˆ†é¡¹ç›®ï¼Œæ¯”å¦‚ï¼šxuecheng-plus é¡¹ç›®ã€xuecheng2.0 é¡¹ç›®</p><p>é¦–å…ˆåœ¨ nacos é…ç½® namespace:</p><p>ç™»å½• Centosï¼Œå¯åŠ¨ Naocsï¼Œä½¿ç”¨ sh /data/soft/restart.sh å°†è‡ªåŠ¨å¯åŠ¨ Nacosã€‚</p><p>è®¿é—®ï¼šhttp://192.168.101.65:8848/nacos/</p><p>è´¦å·å¯†ç ï¼šnacos/nacos</p><p>ç™»å½•æˆåŠŸï¼Œç‚¹å‡»å·¦ä¾§èœå•â€œå‘½åç©ºé—´â€è¿›å…¥å‘½åç©ºé—´ç®¡ç†ç•Œé¢ï¼Œ</p><p><img src="/MyBlog/assets/image-20230521173125710-97f224ec.png" alt="image-20230521173125710"></p><p>ç‚¹å‡»â€œæ–°å»ºå‘½åç©ºé—´â€ï¼Œå¡«å†™å‘½åç©ºé—´çš„ç›¸å…³ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521173132455-80f80f7d.png" alt="image-20230521173132455"></p><p>ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•å†åˆ›å»ºâ€œæµ‹è¯•ç¯å¢ƒâ€ã€&quot;ç”Ÿäº§ç¯å¢ƒ&quot;çš„å‘½åç©ºé—´ã€‚</p><p><img src="/MyBlog/assets/image-20230521173137803-223e339c.png" alt="image-20230521173137803"></p><p><img src="/MyBlog/assets/image-20230521173144339-39d2e089.png" alt="image-20230521173144339"></p><p>åˆ›å»ºæˆåŠŸï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521173156276-bad15a1d.png" alt="image-20230521173156276"></p><p>åœ¨æ•™å­¦ä¸­å¯ä»¥åˆ›å»ºå…·ä½“ç­çº§çš„å‘½åç©ºé—´ï¼Œå‡å¦‚åˆ›å»º 1010 ç­çº§çš„å‘½åç©ºé—´ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521173201037-9d7510c3.png" alt="image-20230521173201037"></p><p><code>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨dev1010å‘½åç©ºé—´ï¼Œåœ¨ä¸‹è¾¹çš„é…ç½®ä¸­å¯¹namespaceé…ç½®ä¸ºdev1010ã€‚</code></p><p>é¦–å…ˆå®Œæˆå„æœåŠ¡æ³¨å†Œåˆ° Naocsï¼Œä¸‹è¾¹å°†å†…å®¹ç®¡ç†æœåŠ¡æ³¨å†Œåˆ° nacos ä¸­ã€‚</p><p>1) åœ¨ xuecheng-plus-parent ä¸­æ·»åŠ ä¾èµ–ç®¡ç†</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud-alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰åœ¨å†…å®¹ç®¡ç†æ¨¡å—çš„æ¥å£å·¥ç¨‹ã€ç³»ç»Ÿç®¡ç†æ¨¡å—çš„æ¥å£å·¥ç¨‹ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰é…ç½® nacos çš„åœ°å€</p><p>åœ¨ç³»ç»Ÿç®¡ç†çš„æ¥å£å·¥ç¨‹çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">##å¾®æœåŠ¡é…ç½®</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å†…å®¹ç®¡ç†çš„æ¥å£å·¥ç¨‹çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ï¼‰é‡å¯å†…å®¹ç®¡ç†æœåŠ¡ã€ç³»ç»Ÿç®¡ç†æœåŠ¡ã€‚</p><p>å¾…å¾®æœåŠ¡å¯åŠ¨æˆåŠŸï¼Œè¿›å…¥ Nacos æœåŠ¡æŸ¥çœ‹æœåŠ¡åˆ—è¡¨</p><p><img src="/MyBlog/assets/image-20230521173400176-4ad78901.png" alt="image-20230521173400176"></p><p>åœ¨ â€œå¼€å‘ç¯å¢ƒâ€ å‘½åç©ºé—´ä¸‹æœ‰ä¸¤ä¸ªæœåŠ¡è¿™è¯´æ˜å†…å®¹ç®¡ç†å¾®æœåŠ¡å’Œç³»ç»Ÿç®¡ç†å¾®æœåŠ¡åœ¨ Nacos æ³¨å†ŒæˆåŠŸã€‚</p><p>ç‚¹å‡»å…¶å®ƒä¸€ä¸ªå¾®æœåŠ¡çš„â€œè¯¦æƒ…â€</p><p><img src="/MyBlog/assets/image-20230521173404990-73544b58.png" alt="image-20230521173404990"></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥æŸ¥çœ‹å¾®æœåŠ¡å®ä¾‹çš„åœ°å€ã€‚</p><h4 id="_2-2-2-é…ç½®ä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#_2-2-2-é…ç½®ä¸­å¿ƒ" aria-hidden="true">#</a> <strong>2.2.2 é…ç½®ä¸­å¿ƒ</strong></h4><h5 id="_2-2-2-1-é…ç½®ä¸‰è¦ç´ " tabindex="-1"><a class="header-anchor" href="#_2-2-2-1-é…ç½®ä¸‰è¦ç´ " aria-hidden="true">#</a> <strong>2.2.2.1 é…ç½®ä¸‰è¦ç´ </strong></h5><p>æ­å»ºå®Œæˆ Nacos æœåŠ¡å‘ç°ä¸­å¿ƒï¼Œä¸‹è¾¹æ­å»º Nacos ä¸ºé…ç½®ä¸­å¿ƒï¼Œå…¶ç›®çš„å°±æ˜¯é€šè¿‡ Nacos å»ç®¡ç†é¡¹ç›®çš„æ‰€æœ‰é…ç½®ã€‚</p><p>å…ˆå°†é¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶åˆ†åˆ†ç±»ï¼š</p><p><strong>1ã€æ¯ä¸ªé¡¹ç›®ç‰¹æœ‰çš„é…ç½®</strong></p><p>æ˜¯æŒ‡è¯¥é…ç½®åªåœ¨æœ‰äº›é¡¹ç›®ä¸­éœ€è¦é…ç½®ï¼Œæˆ–è€…è¯¥é…ç½®åœ¨æ¯ä¸ªé¡¹ç›®ä¸­é…ç½®çš„å€¼ä¸åŒã€‚</p><p>æ¯”å¦‚ï¼šspring.application.name æ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦é…ç½®ä½†å€¼ä¸ä¸€æ ·ï¼Œä»¥åŠæœ‰äº›é¡¹ç›®éœ€è¦è¿æ¥æ•°æ®åº“è€Œæœ‰äº›é¡¹ç›®ä¸éœ€è¦ï¼Œæœ‰äº›é¡¹ç›®éœ€è¦é…ç½®æ¶ˆæ¯é˜Ÿåˆ—è€Œæœ‰äº›é¡¹ç›®ä¸éœ€è¦ã€‚</p><p><strong>2ã€é¡¹ç›®æ‰€å…¬ç”¨çš„é…ç½®</strong></p><p>æ˜¯æŒ‡åœ¨è‹¥å¹²é¡¹ç›®ä¸­é…ç½®å†…å®¹ç›¸åŒçš„é…ç½®ã€‚æ¯”å¦‚ï¼šredis çš„é…ç½®ï¼Œå¾ˆå¤šé¡¹ç›®ç”¨çš„åŒä¸€å¥— redis æœåŠ¡æ‰€ä»¥é…ç½®ä¹Ÿä¸€æ ·ã€‚</p><p>å¦å¤–è¿˜éœ€è¦çŸ¥é“ nacos å¦‚ä½•å»å®šä½ä¸€ä¸ªå…·ä½“çš„é…ç½®æ–‡ä»¶ï¼Œå³ï¼šnamespaceã€groupã€dataid.</p><p>1ã€é€šè¿‡ namespaceã€group æ‰¾åˆ°å…·ä½“çš„ç¯å¢ƒå’Œå…·ä½“çš„é¡¹ç›®ã€‚</p><p>2ã€é€šè¿‡ dataid æ‰¾åˆ°å…·ä½“çš„é…ç½®æ–‡ä»¶ï¼Œdataid æœ‰ä¸‰éƒ¨åˆ†ç»„æˆ</p><p><code>æ¯”å¦‚ï¼šcontent-service-dev.yamlé…ç½®æ–‡ä»¶ ç”±ï¼ˆcontent-serviceï¼‰-ï¼ˆdevï¼‰. (yaml)ä¸‰éƒ¨åˆ†ç»„æˆ</code></p><p>content-serviceï¼šç¬¬ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯åœ¨ application.yaml ä¸­é…ç½®çš„åº”ç”¨åï¼Œå³ spring.application.name çš„å€¼ã€‚</p><p>devï¼šç¬¬äºŒéƒ¨åˆ†ï¼Œå®ƒæ˜¯ç¯å¢ƒåï¼Œé€šè¿‡ spring.profiles.active æŒ‡å®šï¼Œ</p><p>Yaml: ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå®ƒæ˜¯é…ç½®æ–‡ä»¶ çš„åç¼€ï¼Œç›®å‰ nacos æ”¯æŒ propertiesã€yaml ç­‰æ ¼å¼ç±»å‹ï¼Œæœ¬é¡¹ç›®é€‰æ‹© yaml æ ¼å¼ç±»å‹ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦é…ç½® content-service å·¥ç¨‹çš„é…ç½®æ–‡ä»¶:</p><p>åœ¨å¼€å‘ç¯å¢ƒä¸­é…ç½® content-service-dev.yaml</p><p>åœ¨æµ‹è¯•ç¯å¢ƒä¸­é…ç½® content-service-test.yaml</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½® content-service-prod.yaml</p><p>æˆ‘ä»¬å¯åŠ¨é¡¹ç›®ä¸­ä¼ å…¥ spring.profiles.active çš„å‚æ•°å†³å®šå¼•ç”¨å“ªä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šä¼ å…¥ spring.profiles.active=dev è¡¨ç¤ºä½¿ç”¨ dev ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å³ content-service-dev.yamlã€‚</p><h5 id="_2-2-2-2-é…ç½®-content-service" tabindex="-1"><a class="header-anchor" href="#_2-2-2-2-é…ç½®-content-service" aria-hidden="true">#</a> <strong>2.2.2.2 é…ç½® content-service</strong></h5><p>ä¸‹è¾¹ä»¥å¼€å‘ç¯å¢ƒä¸ºä¾‹å¯¹ content-service å·¥ç¨‹çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œè¿›å…¥ nacosï¼Œè¿›å…¥å¼€å‘ç¯å¢ƒã€‚</p><p><img src="/MyBlog/assets/image-20230521173419195-24b80f51.png" alt="image-20230521173419195"></p><p>ç‚¹å‡»åŠ å·ï¼Œæ·»åŠ ä¸€ä¸ªé…ç½®</p><p><img src="/MyBlog/assets/image-20230521173425795-3ffbe389.png" alt="image-20230521173425795"></p><p>è¾“å…¥ data idã€group ä»¥åŠé…ç½®æ–‡ä»¶å†…å®¹ã€‚</p><p>ä¸ºä»€ä¹ˆæ²¡åœ¨ nacos ä¸­é…ç½®ä¸‹è¾¹çš„å†…å®¹ ï¼Ÿ</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºåˆšæ‰è¯´äº† dataid ç¬¬ä¸€éƒ¨åˆ†å°±æ˜¯ spring.application.nameï¼Œnacos å®¢æˆ·ç«¯è¦æ ¹æ®æ­¤å€¼ç¡®å®šé…ç½®æ–‡ä»¶ åç§°ï¼Œæ‰€ä»¥ spring.application.name ä¸åœ¨ nacos ä¸­é…ç½®ï¼Œè€Œæ˜¯è¦åœ¨å·¥ç¨‹çš„æœ¬åœ°è¿›è¡Œé…ç½®ã€‚</p><p>åœ¨ content-service å·¥ç¨‹çš„ test/resources ä¸­æ·»åŠ  bootstrap.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token comment">#profilesé»˜è®¤ä¸ºdev</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å†…å®¹ç®¡ç†æ¨¡å—çš„æ¥å£å·¥ç¨‹å’Œ service å·¥ç¨‹é…ç½®ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®å®Œæˆï¼Œè¿è¡Œ content-service å·¥ç¨‹ çš„å•å…ƒæµ‹è¯•æ–‡ä»¶ï¼Œèƒ½å¦æ­£å¸¸æµ‹è¯•ï¼Œè·Ÿè¸ªå•å…ƒæµ‹è¯•æ–¹æ³•å¯ä»¥æ­£å¸¸è¯»å–æ•°æ®åº“çš„æ•°æ®ï¼Œè¯´æ˜ä» nacos è¯»å–é…ç½®ä¿¡æ¯æ­£å¸¸ã€‚</p><p>é€šè¿‡è¿è¡Œè§‚å¯Ÿæ§åˆ¶å°æ‰“å°å‡ºä¸‹è¾¹çš„ä¿¡æ¯ï¼ŒNacosRestTemplate.java é€šè¿‡ Post æ–¹å¼ä¸ nacos æœåŠ¡ç«¯äº¤äº’è¯»å–é…ç½®ä¿¡æ¯ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>NacosRestTemplate.java:476<span class="token punctuation">]</span> - HTTP method: POST, url: http://192.168.101.65:8848/nacos/v1/cs/configs/listener, body: <span class="token punctuation">{</span>Listening-Configs<span class="token operator">=</span>content-service.yaml?xuecheng-plus-project??dev?content-service-dev.yaml?xuecheng-plus-project?88459b1483b8381eccc2ef462bd59182?dev?content-service?xuecheng-plus-project??dev?, <span class="token assign-left variable">tenant</span><span class="token operator">=</span>dev<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2-2-3-é…ç½®-content-api" tabindex="-1"><a class="header-anchor" href="#_2-2-2-3-é…ç½®-content-api" aria-hidden="true">#</a> <strong>2.2.2.3 é…ç½® content-api</strong></h5><p>ä»¥ç›¸åŒçš„æ–¹æ³•é…ç½® content-api å·¥ç¨‹çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ nacos ä¸­çš„å¼€å‘ç¯å¢ƒä¸­é…ç½® content-api-dev.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /content
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">63040</span>

<span class="token comment">## æ—¥å¿—æ–‡ä»¶é…ç½®è·¯å¾„</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>log4j2<span class="token punctuation">-</span>dev.xml

<span class="token comment">## swagger æ–‡æ¡£é…ç½®</span>
<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">&#39;å­¦æˆåœ¨çº¿å†…å®¹ç®¡ç†ç³»ç»Ÿ&#39;</span>
  <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">&#39;å†…å®¹ç³»ç»Ÿç®¡ç†ç³»ç»Ÿå¯¹è¯¾ç¨‹ç›¸å…³ä¿¡æ¯è¿›è¡Œä¸šåŠ¡ç®¡ç†æ•°æ®&#39;</span>
  <span class="token key atrule">base-package</span><span class="token punctuation">:</span> com.xuecheng.content
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> 1.0.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ content-api å·¥ç¨‹ çš„æœ¬åœ°é…ç½® bootstrap.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">##å¾®æœåŠ¡é…ç½®</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">extension-configs</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå› ä¸º api æ¥å£å·¥ç¨‹ä¾èµ–äº† service å·¥ç¨‹ çš„ jarï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨ extension-configs æ‰©å±•é…ç½®æ–‡ä»¶ çš„æ–¹å¼å¼•ç”¨ service å·¥ç¨‹æ‰€ç”¨åˆ°çš„é…ç½®æ–‡ä»¶ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">extension-configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
    <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ·»åŠ å¤šä¸ªæ‰©å±•æ–‡ä»¶ï¼Œç»§ç»­åœ¨ä¸‹æ·»åŠ å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">extension-configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
    <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> å¡«å†™æ–‡ä»¶ dataid
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
    <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨ content-api å·¥ç¨‹ï¼ŒæŸ¥è¯¢æ§åˆ¶å°æ˜¯å¦æ‰“å°å‡ºäº†è¯·æ±‚ nacos çš„æ—¥å¿—ï¼Œå¦‚ä¸‹:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>NacosRestTemplate.java:476<span class="token punctuation">]</span> - HTTP method: POST, url: http://192.168.101.65:8848/nacos/v1/cs/configs/listener

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶ä½¿ç”¨ Httpclient æµ‹è¯•è¯¾ç¨‹æŸ¥è¯¢æ¥å£æ˜¯å¦å¯ä»¥æ­£å¸¸æŸ¥è¯¢ã€‚</p><h4 id="_2-2-3-å…¬ç”¨é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-2-3-å…¬ç”¨é…ç½®" aria-hidden="true">#</a> <strong>2.2.3 å…¬ç”¨é…ç½®</strong></h4><p>è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–çš„ç‚¹æ˜¯å¦‚ä½•åœ¨ nacos ä¸­é…ç½®é¡¹ç›®çš„å…¬ç”¨é…ç½®å‘¢ï¼Ÿ</p><p>nacos æä¾›äº† shared-configs å¯ä»¥å¼•å…¥å…¬ç”¨é…ç½®ã€‚</p><p>åœ¨ content-api ä¸­é…ç½®äº† swaggerï¼Œæ‰€æœ‰çš„æ¥å£å·¥ç¨‹ éƒ½éœ€è¦é…ç½® swaggerï¼Œè¿™é‡Œå°±å¯ä»¥å°† swagger çš„é…ç½®å®šä¹‰ä¸ºä¸€ä¸ªå…¬ç”¨é…ç½®ï¼Œå“ªä¸ªé¡¹ç›®ç”¨å¼•å…¥å³å¯ã€‚</p><p>å•ç‹¬åœ¨ xuecheng-plus-common åˆ†ç»„ä¸‹åˆ›å»º xuecheng-plus çš„å…¬ç”¨é…ç½®ï¼Œè¿›å…¥ nacos çš„å¼€å‘ç¯å¢ƒï¼Œæ·»åŠ  swagger-dev.yaml å…¬ç”¨é…ç½®</p><p><img src="/MyBlog/assets/image-20230521173736347-7724532e.png" alt="image-20230521173736347"></p><p>åˆ é™¤æ¥å£å·¥ç¨‹ä¸­å¯¹ swagger çš„é…ç½®ã€‚</p><p>é¡¹ç›®ä½¿ç”¨ shared-configs å¯ä»¥å¼•å…¥å…¬ç”¨é…ç½®ã€‚åœ¨æ¥å£å·¥ç¨‹çš„æœ¬åœ°é…ç½®æ–‡ä»¶ ä¸­å¼•å…¥å…¬ç”¨é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">extension-configs</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">shared-configs</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> swagger<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> logging<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†ä»¥ç›¸åŒ çš„æ–¹æ³•é…ç½®æ—¥å¿—çš„å…¬ç”¨é…ç½®ã€‚</p><p><img src="/MyBlog/assets/image-20230521173754467-13df68aa.png" alt="image-20230521173754467"></p><p>åœ¨æ¥å£å·¥ç¨‹å’Œä¸šåŠ¡å·¥ç¨‹ï¼Œå¼•å…¥ loggin-dev.yaml å…¬ç”¨é…ç½®æ–‡ä»¶</p><p><img src="/MyBlog/assets/image-20230521173758499-477c5882.png" alt="image-20230521173758499"></p><p>é…ç½®å®Œæˆï¼Œé‡å¯ content-api æ¥å£å·¥ç¨‹ï¼Œè®¿é—® http://localhost:63040/content/swagger-ui.html æŸ¥çœ‹ swagger æ¥å£æ–‡æ¡£æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®ï¼ŒæŸ¥çœ‹æ§åˆ¶å° log4j2 æ—¥å¿—è¾“å‡ºæ˜¯å¦æ­£å¸¸ã€‚</p><h4 id="_2-2-4-é…ç½®ä¼˜å…ˆçº§" tabindex="-1"><a class="header-anchor" href="#_2-2-4-é…ç½®ä¼˜å…ˆçº§" aria-hidden="true">#</a> <strong>2.2.4 é…ç½®ä¼˜å…ˆçº§</strong></h4><p>åˆ°ç›®å‰ä¸ºæ­¢å·²å°†æ‰€æœ‰å¾®æœåŠ¡çš„é…ç½®ç»Ÿä¸€åœ¨ nacos è¿›è¡Œé…ç½®ï¼Œç”¨åˆ°çš„é…ç½®æ–‡ä»¶æœ‰æœ¬åœ°çš„é…ç½®æ–‡ä»¶ bootstrap.yaml å’Œ nacos ä¸Šçš„é…ç½®æ–‡ä»¶ï¼ŒSpringBoot è¯»å–é…ç½®æ–‡ä»¶ çš„é¡ºåºå¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521173813332-06d85572.png" alt="image-20230521173813332"></p><p>å¼•å…¥é…ç½®æ–‡ä»¶çš„å½¢å¼æœ‰ï¼š</p><p>1ã€ä»¥é¡¹ç›®åº”ç”¨åæ–¹å¼å¼•å…¥</p><p>2ã€ä»¥æ‰©å±•é…ç½®æ–‡ä»¶æ–¹å¼å¼•å…¥</p><p>3ã€ä»¥å…±äº«é…ç½®æ–‡ä»¶ æ–¹å¼å¼•å…¥</p><p>4ã€æœ¬åœ°é…ç½®æ–‡ä»¶</p><blockquote><p>å„é…ç½®æ–‡ä»¶ çš„ä¼˜å…ˆçº§ï¼šé¡¹ç›®åº”ç”¨åé…ç½®æ–‡ä»¶ &gt; æ‰©å±•é…ç½®æ–‡ä»¶ &gt; å…±äº«é…ç½®æ–‡ä»¶ &gt; æœ¬åœ°é…ç½®æ–‡ä»¶ã€‚</p></blockquote><p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨æµ‹è¯•ç¨‹åºæ—¶ç›´æ¥åœ¨æœ¬åœ°åŠ ä¸€ä¸ªé…ç½®è¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚ä¸‹è¾¹çš„ä¾‹å­ï¼š</p><p>æˆ‘ä»¬æƒ³å¯åŠ¨ä¸¤ä¸ªå†…å®¹ç®¡ç†å¾®æœåŠ¡ï¼Œæ­¤æ—¶éœ€è¦åœ¨æœ¬åœ°æŒ‡å®šä¸åŒçš„ç«¯å£ï¼Œé€šè¿‡ VM Options å‚æ•°ï¼Œåœ¨ IDEA é…ç½®å¯åŠ¨å‚æ•°</p><p><img src="/MyBlog/assets/image-20230521173822900-3f61ab4c.png" alt="image-20230521173822900"></p><p>é€šè¿‡-D æŒ‡å®šå‚æ•°åå’Œå‚æ•°å€¼ï¼Œå‚æ•°åå³åœ¨ bootstrap.yml ä¸­é…ç½®çš„ server.portã€‚</p><p><img src="/MyBlog/assets/image-20230521173839490-36a95960.png" alt="image-20230521173839490"></p><p>å¯åŠ¨ ContentApplication2ï¼Œå‘ç°ç«¯å£ä»ç„¶æ˜¯ 63040ï¼Œè¿™è¯´æ˜æœ¬åœ°çš„é…ç½®æ²¡æœ‰ç”Ÿæ•ˆã€‚</p><p>è¿™æ—¶æˆ‘ä»¬æƒ³è®©æœ¬åœ°æœ€ä¼˜å…ˆï¼Œå¯ä»¥åœ¨ nacos é…ç½®æ–‡ä»¶ ä¸­é…ç½®å¦‚ä¸‹å³å¯å®ç°ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">##é…ç½®æœ¬åœ°ä¼˜å…ˆ</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">override-none</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æ¬¡å¯åŠ¨ ContentApplication2ï¼Œç«¯å£ä¸º 63041ã€‚</p><h4 id="_2-2-5-å¯¼å…¥é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-2-5-å¯¼å…¥é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> <strong>2.2.5 å¯¼å…¥é…ç½®æ–‡ä»¶</strong></h4><p>è¯¾ç¨‹èµ„æ–™ä¸­æä¾›äº†ç³»ç»Ÿç”¨çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ nacos_config_export.zipï¼Œä¸‹è¾¹å°† nacos_config_export.zip å¯¼å…¥ nacosã€‚</p><p>è¿›å…¥å…·ä½“çš„å‘½åç©ºé—´ï¼Œç‚¹å‡»â€œå¯¼å…¥é…ç½®â€</p><p><img src="/MyBlog/assets/image-20230521173859544-f712d2b8.png" alt="image-20230521173859544"></p><p>æ‰“å¼€å¯¼å…¥çª—å£</p><p><img src="/MyBlog/assets/image-20230521173905236-16eb8eaf.png" alt="image-20230521173905236"></p><p>ç›¸åŒçš„é…ç½®é€‰æ‹©è¦†ç›–é…ç½®ã€‚</p><p>ç‚¹å‡»â€œä¸Šä¼ æ–‡ä»¶â€é€‰æ‹©èµ„æ–™ä¸­çš„ nacos_config_export.zip å¼€å§‹å¯¼å…¥ã€‚</p><h4 id="_2-2-6-ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#_2-2-6-ä½œä¸š" aria-hidden="true">#</a> <strong>2.2.6 ä½œä¸š</strong></h4><p>æŒ‰ç…§ä¸Šè¾¹çš„æ–¹æ³• è‡ªè¡Œå°†ç³»ç»Ÿç®¡ç†æœåŠ¡çš„é…ç½®ä¿¡æ¯åœ¨ nacos ä¸Šè¿›è¡Œé…ç½®ã€‚</p><h3 id="_2-3-æ­å»º-gateway" tabindex="-1"><a class="header-anchor" href="#_2-3-æ­å»º-gateway" aria-hidden="true">#</a> <strong>2.3 æ­å»º Gateway</strong></h3><p>æœ¬é¡¹ç›®ä½¿ç”¨ Spring Cloud Gateway ä½œä¸ºç½‘å…³ï¼Œä¸‹è¾¹åˆ›å»ºç½‘å…³å·¥ç¨‹ã€‚</p><p>æ–°å»ºä¸€ä¸ªç½‘å…³å·¥ç¨‹ã€‚</p><p><img src="/MyBlog/assets/image-20230521173930442-ac478c45.png" alt="image-20230521173930442"></p><p>å·¥ç¨‹ç»“æ„</p><p><img src="/MyBlog/assets/image-20230521173937510-22e2aaed.png" alt="image-20230521173937510"></p><p>æ·»åŠ ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.xuecheng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xuecheng-plus-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">&gt;</span></span>../xuecheng-plus-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>relativePath</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xuecheng-plus-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--ç½‘å…³--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--æœåŠ¡å‘ç°ä¸­å¿ƒ--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- æ’é™¤ Spring Boot ä¾èµ–çš„æ—¥å¿—åŒ…å†²çª --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Spring Boot é›†æˆ log4j2 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-log4j2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®ç½‘å…³çš„ bootstrap.yaml é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">##å¾®æœåŠ¡é…ç½®</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">shared-configs</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> logging<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ nacos ä¸Šé…ç½®ç½‘å…³è·¯ç”±ç­–ç•¥ï¼š</p><p><img src="/MyBlog/assets/image-20230521174013064-17e56827.png" alt="image-20230521174013064"></p><p>è¯¦ç»†é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">63010</span> <span class="token comment"># ç½‘å…³ç«¯å£</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment">#      filter:</span>
      <span class="token comment">#        strip-prefix:</span>
      <span class="token comment">#          enabled: true</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment"># ç½‘å…³è·¯ç”±é…ç½®</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api <span class="token comment"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span>
          <span class="token comment"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//content<span class="token punctuation">-</span>api <span class="token comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span>
            <span class="token punctuation">-</span> Path=/content/<span class="token important">**</span> <span class="token comment"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/content/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span>
        <span class="token comment">#          filters:</span>
        <span class="token comment">#            - StripPrefix=1</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>api
          <span class="token comment"># uri: http://127.0.0.1:8081</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//system<span class="token punctuation">-</span>api
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/system/<span class="token important">**</span>
        <span class="token comment">#          filters:</span>
        <span class="token comment">#            - StripPrefix=1</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> media<span class="token punctuation">-</span>api
          <span class="token comment"># uri: http://127.0.0.1:8081</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//media<span class="token punctuation">-</span>api
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/media/<span class="token important">**</span>
<span class="token comment">##          filters:</span>
<span class="token comment">##            - StripPrefix=1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨ç½‘å…³å·¥ç¨‹ï¼Œé€šè¿‡ç½‘å…³å·¥ç¨‹è®¿é—®å¾®æœåŠ¡è¿›è¡Œæµ‹è¯•ã€‚</p><p>åœ¨ http-client-env.json ä¸­é…ç½®ç½‘å…³çš„åœ°å€</p><p><img src="/MyBlog/assets/image-20230521174035750-b6350df8.png" alt="image-20230521174035750"></p><p>ä½¿ç”¨ httpclient æµ‹è¯•è¯¾ç¨‹æŸ¥è¯¢ æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>#### è¯¾ç¨‹æŸ¥è¯¢åˆ—è¡¨
POST <span class="token punctuation">{</span><span class="token punctuation">{</span>gateway_host<span class="token punctuation">}</span><span class="token punctuation">}</span>/content/course/list?pageNo=<span class="token number">2</span>&amp;pageSize=<span class="token number">1</span>
Content-Type<span class="token operator">:</span> application/json

<span class="token punctuation">{</span>
  <span class="token property">&quot;auditStatus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;202002&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;courseName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œï¼Œè§‚å¯Ÿæ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®æ¥å£ ï¼Œå¦‚ä¸‹æ‰€ç¤ºå¯ä»¥æ­£å¸¸è¯·æ±‚æ¥å£ã€‚</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>http<span class="token operator">:</span><span class="token comment">//localhost:63010/content/course/list?pageNo=2&amp;pageSize=1</span>

HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OK
transfer-encoding<span class="token operator">:</span> chunked
Content-Type<span class="token operator">:</span> application/json
Date<span class="token operator">:</span> Sun<span class="token punctuation">,</span> <span class="token number">11</span> Sep <span class="token number">2022</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">32</span> GMT

<span class="token punctuation">{</span>
  <span class="token property">&quot;items&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
      <span class="token property">&quot;companyId&quot;</span><span class="token operator">:</span> <span class="token number">1232141425</span><span class="token punctuation">,</span>
      <span class="token property">&quot;companyName&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring cloudå®æˆ˜&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token string">&quot;æ‰€æœ‰äºº&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;mt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1-3&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;mtName&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;st&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1-3-2&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;stName&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token string">&quot;200003&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;teachmode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;201001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;æœ¬è¯¾ç¨‹ä¸»è¦ä»å››ä¸ªç« èŠ‚è¿›è¡Œè®²è§£ï¼š 1.å¾®æœåŠ¡æ¶æ„å…¥é—¨ 2.spring cloud åŸºç¡€å…¥é—¨ 3.å®æˆ˜Spring Boot 4.æ³¨å†Œä¸­å¿ƒeurekaã€‚&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://cdn.educba.com/academy/wp-content/uploads/2018/08/Spring-BOOT-Interview-questions.jpg&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;createDate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2019-09-04 09:56:19&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;changeDate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-12-26 22:10:38&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;createPeople&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;changePeople&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;auditStatus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;202002&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;203001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;coursePubId&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;coursePubDate&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;counts&quot;</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span>
  <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pageSize&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç½‘å…³å·¥ç¨‹æ­å»ºå®Œæˆå³å¯å°†å‰ç«¯å·¥ç¨‹ä¸­çš„æ¥å£åœ°å€æ”¹ä¸ºç½‘å…³çš„åœ°å€</p><p><img src="/MyBlog/assets/image-20230521174225795-40667565.png" alt="image-20230521174225795"></p><p>å¯åŠ¨å‰ç«¯å·¥ç¨‹ï¼Œæµ‹è¯•ä¹‹å‰å¼€å‘å†…å®¹ç®¡ç†æ¨¡å—çš„åŠŸèƒ½ã€‚</p><p>è§‚å¯Ÿç½‘å…³æ§åˆ¶å°ï¼Œé€šè¿‡ç½‘å…³è½¬å‘è¯¾ç¨‹æŸ¥è¯¢çš„æ—¥å¿—å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Handler is being applied: <span class="token punctuation">{</span>uri<span class="token operator">=</span>http://192.168.101.1:63040/content/course/list?pageNo<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span><span class="token assign-left variable">pageSize</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">method</span><span class="token operator">=</span>POST<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-æ­å»ºåª’èµ„å·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-4-æ­å»ºåª’èµ„å·¥ç¨‹" aria-hidden="true">#</a> <strong>2.4 æ­å»ºåª’èµ„å·¥ç¨‹</strong></h3><p>è‡³æ­¤ç½‘å…³ã€Nacos å·²ç»æ­å»ºå®Œæˆï¼Œä¸‹è¾¹å°†åª’èµ„å·¥ç¨‹å¯¼å…¥é¡¹ç›®ã€‚</p><p>ä»è¯¾ç¨‹èµ„æ–™ä¸­è·å–åª’èµ„å·¥ç¨‹ xuecheng-plus-mediaï¼Œæ‹·è´åˆ°é¡¹ç›®å·¥ç¨‹æ ¹ç›®å½•ã€‚</p><p>å³é”® pom.xml è½¬ä¸º maven å·¥ç¨‹ã€‚</p><p><img src="/MyBlog/assets/image-20230521174246366-eba74aa0.png" alt="image-20230521174246366"></p><p>ä¸‹è¾¹åšå¦‚ä¸‹é…ç½®ï¼š</p><p>1ã€åˆ›å»ºåª’èµ„æ•°æ®åº“ xc_mediaï¼Œå¹¶å¯¼å…¥èµ„æ–™ç›®å½•ä¸­çš„ xcplus_media.sql</p><p>2ã€ä¿®æ”¹ nacos ä¸Šçš„ media-service-dev.yaml é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“é“¾æ¥ä¿¡æ¯</p><p>é‡å¯ media-api å·¥ç¨‹åªè¦èƒ½æ­£å¸¸å¯åŠ¨æˆåŠŸå³å¯ï¼Œç¨åæ ¹æ®éœ€æ±‚å†™æ¥å£ã€‚</p><h2 id="_3-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#_3-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" aria-hidden="true">#</a> <strong>3 åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</strong></h2><h3 id="_3-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#_3-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" aria-hidden="true">#</a> <strong>3.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</strong></h3><p>è¦ç†è§£åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿé¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿã€‚</p><p>æŸ¥é˜…ç™¾åº¦ç™¾ç§‘ï¼š</p><p><img src="/MyBlog/assets/image-20230521174256887-a4403dc1.png" alt="image-20230521174256887"></p><p>æ–‡ä»¶ç³»ç»Ÿæ˜¯è´Ÿè´£ç®¡ç†å’Œå­˜å‚¨æ–‡ä»¶çš„ç³»ç»Ÿè½¯ä»¶ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡æ–‡ä»¶ç³»ç»Ÿæä¾›çš„æ¥å£å»å­˜å–æ–‡ä»¶ï¼Œç”¨æˆ·é€šè¿‡æ“ä½œç³»ç»Ÿè®¿é—®ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚</p><p>ä¸‹å›¾æŒ‡ç¤ºäº†æ–‡ä»¶ç³»ç»Ÿæ‰€å¤„çš„ä½ç½®ï¼š</p><p><img src="/MyBlog/assets/image-20230521174301218-24e58423.png" alt="image-20230521174301218"></p><p>å¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿï¼šFAT16/FAT32ã€NTFSã€HFSã€UFSã€APFSã€XFSã€Ext4 ç­‰ ã€‚</p><p>ç°åœ¨æœ‰ä¸ªé—®é¢˜ï¼Œä¸€æ­¤çŸ­è§†é¢‘å¹³å°æ‹¥æœ‰å¤§é‡çš„è§†é¢‘ã€å›¾ç‰‡ï¼Œè¿™äº›è§†é¢‘æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶è¯¥å¦‚ä½•å­˜å‚¨å‘¢ï¼Ÿå¦‚ä½•å­˜å‚¨å¯ä»¥æ»¡è¶³äº’è”ç½‘ä¸Šæµ·é‡ç”¨æˆ·çš„æµè§ˆã€‚</p><p>ä»Šå¤©è®²çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå°±æ˜¯æµ·é‡ç”¨æˆ·æŸ¥é˜…æµ·é‡æ–‡ä»¶çš„æ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬é˜…è¯»ç™¾åº¦ç™¾ç§‘å»ç†è§£åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„å®šä¹‰ï¼š</p><p><img src="/MyBlog/assets/image-20230521174316618-8bdb5559.png" alt="image-20230521174316618"></p><p>é€šè¿‡æ¦‚å¿µå¯ä»¥ç®€å•ç†è§£ä¸ºï¼šä¸€ä¸ªè®¡ç®—æœºæ— æ³•å­˜å‚¨æµ·é‡çš„æ–‡ä»¶ï¼Œé€šè¿‡ç½‘ç»œå°†è‹¥å¹²è®¡ç®—æœºç»„ç»‡èµ·æ¥å…±åŒå»å­˜å‚¨æµ·é‡çš„æ–‡ä»¶ï¼Œå»æ¥æ”¶æµ·é‡ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¿™äº›ç»„ç»‡èµ·æ¥çš„è®¡ç®—æœºé€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521174324104-4a9a4f65.png" alt="image-20230521174324104"></p><p>å¥½å¤„ï¼š</p><p>1ã€ä¸€å°è®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿå¤„ç†èƒ½åŠ›æ‰©å……åˆ°å¤šå°è®¡ç®—æœºåŒæ—¶å¤„ç†ã€‚</p><p>2ã€ä¸€å°è®¡ç®—æœºæŒ‚äº†è¿˜æœ‰å¦å¤–å‰¯æœ¬è®¡ç®—æœºæä¾›æ•°æ®ã€‚</p><p>3ã€æ¯å°è®¡ç®—æœºå¯ä»¥æ”¾åœ¨ä¸åŒçš„åœ°åŸŸï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å°±è¿‘è®¿é—®ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚</p><p>å¸‚é¢ä¸Šæœ‰å“ªäº›åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„äº§å“å‘¢ï¼Ÿ</p><p>1ã€NFS</p><p>é˜…è¯»ç™¾åº¦ç™¾ç§‘ï¼š</p><p><img src="/MyBlog/assets/image-20230521174332940-58c85c5a.png" alt="image-20230521174332940"></p><p><img src="/MyBlog/assets/image-20230521174339285-07848f14.png" alt="image-20230521174339285"></p><p>ç‰¹ç‚¹ï¼š</p><p>1ï¼‰åœ¨å®¢æˆ·ç«¯ä¸Šæ˜ å°„ NFS æœåŠ¡å™¨çš„é©±åŠ¨å™¨ã€‚</p><p>2ï¼‰å®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œè®¿é—® NFS æœåŠ¡å™¨çš„ç¡¬ç›˜å®Œå…¨é€æ˜ã€‚</p><p>2ã€GFS</p><p><img src="/MyBlog/assets/image-20230521174350504-af4004b2.png" alt="image-20230521174350504"></p><p><img src="/MyBlog/assets/image-20230521174356095-a3e6d6a2.png" alt="image-20230521174356095"></p><p>1ï¼‰GFS é‡‡ç”¨ä¸»ä»ç»“æ„ï¼Œä¸€ä¸ª GFS é›†ç¾¤ç”±ä¸€ä¸ª master å’Œå¤§é‡çš„ chunkserver ç»„æˆã€‚</p><p>2ï¼‰master å­˜å‚¨äº†æ•°æ®æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œä¸€ä¸ªæ–‡ä»¶è¢«åˆ†æˆäº†è‹¥å¹²å—å­˜å‚¨åœ¨å¤šä¸ª chunkserver ä¸­ã€‚</p><p>3ï¼‰ç”¨æˆ·ä» master ä¸­è·å–æ•°æ®å…ƒä¿¡æ¯ï¼Œå‘ chunkserver å­˜å‚¨æ•°æ®ã€‚</p><p>3) HDFS</p><p>HDFSï¼Œæ˜¯ Hadoop Distributed File System çš„ç®€ç§°ï¼Œæ˜¯ Hadoop æŠ½è±¡æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ç§å®ç°ã€‚HDFS æ˜¯ä¸€ä¸ªé«˜åº¦å®¹é”™æ€§çš„ç³»ç»Ÿï¼Œé€‚åˆéƒ¨ç½²åœ¨å»‰ä»·çš„æœºå™¨ä¸Šã€‚HDFS èƒ½æä¾›é«˜ååé‡çš„æ•°æ®è®¿é—®ï¼Œéå¸¸é€‚åˆå¤§è§„æ¨¡æ•°æ®é›†ä¸Šçš„åº”ç”¨ã€‚ HDFS çš„æ–‡ä»¶åˆ†å¸ƒåœ¨é›†ç¾¤æœºå™¨ä¸Šï¼ŒåŒæ—¶æä¾›å‰¯æœ¬è¿›è¡Œå®¹é”™åŠå¯é æ€§ä¿è¯ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯å†™å…¥è¯»å–æ–‡ä»¶çš„ç›´æ¥æ“ä½œéƒ½æ˜¯åˆ†å¸ƒåœ¨é›†ç¾¤å„ä¸ªæœºå™¨ä¸Šçš„ï¼Œæ²¡æœ‰å•ç‚¹æ€§èƒ½å‹åŠ›ã€‚</p><p>ä¸‹å›¾æ˜¯ HDFS çš„æ¶æ„å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521174405599-0ae10664.png" alt="image-20230521174405599"></p><p>1ï¼‰HDFS é‡‡ç”¨ä¸»ä»ç»“æ„ï¼Œä¸€ä¸ª HDFS é›†ç¾¤ç”±ä¸€ä¸ªåç§°ç»“ç‚¹å’Œè‹¥å¹²æ•°æ®ç»“ç‚¹ç»„æˆã€‚</p><p>2) åç§°ç»“ç‚¹å­˜å‚¨æ•°æ®çš„å…ƒä¿¡æ¯ï¼Œä¸€ä¸ªå®Œæ•´çš„æ•°æ®æ–‡ä»¶åˆ†æˆè‹¥å¹²å—å­˜å‚¨åœ¨æ•°æ®ç»“ç‚¹ã€‚</p><p>3ï¼‰å®¢æˆ·ç«¯ä»åç§°ç»“ç‚¹è·å–æ•°æ®çš„å…ƒä¿¡æ¯åŠæ•°æ®åˆ†å—çš„ä¿¡æ¯ï¼Œå¾—åˆ°ä¿¡æ¯å®¢æˆ·ç«¯å³å¯ä»æ•°æ®å—æ¥å­˜å–æ•°æ®ã€‚</p><p><strong>4ã€äº‘è®¡ç®—å‚å®¶</strong></p><p>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆObject Storage Serviceï¼Œç®€ç§° OSSï¼‰ï¼Œæ˜¯é˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚å…¶æ•°æ®è®¾è®¡æŒä¹…æ€§ä¸ä½äº 99.9999999999%ï¼ˆ12 ä¸ª 9ï¼‰ï¼ŒæœåŠ¡è®¾è®¡å¯ç”¨æ€§ï¼ˆæˆ–ä¸šåŠ¡è¿ç»­æ€§ï¼‰ä¸ä½äº 99.995%ã€‚</p><p><em>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://www.aliyun.com/product/oss" target="_blank" rel="noopener noreferrer">https://www.aliyun.com/product/oss<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></em></p><p>ç™¾åº¦å¯¹è±¡å­˜å‚¨ BOS æä¾›ç¨³å®šã€å®‰å…¨ã€é«˜æ•ˆã€é«˜å¯æ‰©å±•çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ‚¨å¯ä»¥å°†ä»»æ„æ•°é‡å’Œå½¢å¼çš„éç»“æ„åŒ–æ•°æ®å­˜å…¥ BOSï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œç®¡ç†å’Œå¤„ç†ã€‚BOS æ”¯æŒæ ‡å‡†ã€ä½é¢‘ã€å†·å’Œå½’æ¡£å­˜å‚¨ç­‰å¤šç§å­˜å‚¨ç±»å‹ï¼Œæ»¡è¶³å¤šåœºæ™¯çš„å­˜å‚¨éœ€æ±‚ã€‚</p><p><em>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://cloud.baidu.com/product/bos.html" target="_blank" rel="noopener noreferrer">https://cloud.baidu.com/product/bos.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></em></p><h3 id="_3-2-minio" tabindex="-1"><a class="header-anchor" href="#_3-2-minio" aria-hidden="true">#</a> <strong>3.2 MinIO</strong></h3><h4 id="_3-2-1-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_3-2-1-ä»‹ç»" aria-hidden="true">#</a> <strong>3.2.1 ä»‹ç»</strong></h4><p>æœ¬é¡¹ç›®é‡‡ç”¨ MinIO æ„å»ºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ŒMinIO æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çš„æœåŠ¡,å¯ä»¥å¾ˆç®€å•çš„å’Œå…¶ä»–åº”ç”¨çš„ç»“åˆä½¿ç”¨ï¼Œå®ƒå…¼å®¹äºšé©¬é€Š S3 äº‘å­˜å‚¨æœåŠ¡æ¥å£ï¼Œéå¸¸é€‚åˆäºå­˜å‚¨å¤§å®¹é‡éç»“æ„åŒ–çš„æ•°æ®ï¼Œä¾‹å¦‚å›¾ç‰‡ã€è§†é¢‘ã€æ—¥å¿—æ–‡ä»¶ã€å¤‡ä»½æ•°æ®å’Œå®¹å™¨/è™šæ‹Ÿæœºé•œåƒç­‰ã€‚</p><p>å®ƒä¸€å¤§ç‰¹ç‚¹å°±æ˜¯è½»é‡ï¼Œä½¿ç”¨ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå„ç§å¹³å°ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§ 5TBï¼Œå…¼å®¹ Amazon S3 æ¥å£ï¼Œæä¾›äº† Javaã€Pythonã€GO ç­‰å¤šç‰ˆæœ¬ SDK æ”¯æŒã€‚</p><p>å®˜ç½‘ï¼šhttps://min.io</p><p>ä¸­æ–‡ï¼šhttps://www.minio.org.cn/ï¼Œhttp://docs.minio.org.cn/docs/</p><p>MinIO é›†ç¾¤é‡‡ç”¨å»ä¸­å¿ƒåŒ–å…±äº«æ¶æ„ï¼Œæ¯ä¸ªç»“ç‚¹æ˜¯å¯¹ç­‰å…³ç³»ï¼Œé€šè¿‡ Nginx å¯å¯¹ MinIO è¿›è¡Œè´Ÿè½½å‡è¡¡è®¿é—®ã€‚</p><p>å»ä¸­å¿ƒåŒ–æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</p><p>åœ¨å¤§æ•°æ®é¢†åŸŸï¼Œé€šå¸¸çš„è®¾è®¡ç†å¿µéƒ½æ˜¯æ— ä¸­å¿ƒå’Œåˆ†å¸ƒå¼ã€‚Minio åˆ†å¸ƒå¼æ¨¡å¼å¯ä»¥å¸®åŠ©ä½ æ­å»ºä¸€ä¸ªé«˜å¯ç”¨çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™äº›å­˜å‚¨è®¾å¤‡ï¼Œè€Œä¸ç”¨è€ƒè™‘å…¶çœŸå®ç‰©ç†ä½ç½®ã€‚</p><p>å®ƒå°†åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„å¤šå—ç¡¬ç›˜ç»„æˆä¸€ä¸ªå¯¹è±¡å­˜å‚¨æœåŠ¡ã€‚ç”±äºç¡¬ç›˜åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œåˆ†å¸ƒå¼ Minio é¿å…äº†å•ç‚¹æ•…éšœã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521174422689-0b701b9b.png" alt="image-20230521174422689"></p><p>Minio ä½¿ç”¨<strong>çº åˆ ç </strong>æŠ€æœ¯æ¥ä¿æŠ¤æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ç§æ¢å¤ä¸¢å¤±å’ŒæŸåæ•°æ®çš„æ•°å­¦ç®—æ³•ï¼Œå®ƒå°†æ•°æ®åˆ†å—å†—ä½™çš„åˆ†æ•£å­˜å‚¨åœ¨å„å„èŠ‚ç‚¹çš„ç£ç›˜ä¸Šï¼Œæ‰€æœ‰çš„å¯ç”¨ç£ç›˜ç»„æˆä¸€ä¸ªé›†åˆï¼Œä¸Šå›¾ç”± 8 å—ç¡¬ç›˜ç»„æˆä¸€ä¸ªé›†åˆï¼Œå½“ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ä¼šé€šè¿‡çº åˆ ç ç®—æ³•è®¡ç®—å¯¹æ–‡ä»¶è¿›è¡Œåˆ†å—å­˜å‚¨ï¼Œé™¤äº†å°†æ–‡ä»¶æœ¬èº«åˆ†æˆ 4 ä¸ªæ•°æ®å—ï¼Œè¿˜ä¼šç”Ÿæˆ 4 ä¸ªæ ¡éªŒå—ï¼Œæ•°æ®å—å’Œæ ¡éªŒå—ä¼šåˆ†æ•£çš„å­˜å‚¨åœ¨è¿™ 8 å—ç¡¬ç›˜ä¸Šã€‚</p><p>ä½¿ç”¨çº åˆ ç çš„å¥½å¤„æ˜¯å³ä¾¿ä¸¢å¤±ä¸€åŠæ•°é‡ï¼ˆN/2ï¼‰çš„ç¡¬ç›˜ï¼Œä»ç„¶å¯ä»¥æ¢å¤æ•°æ®ã€‚ æ¯”å¦‚ä¸Šè¾¹é›†åˆä¸­æœ‰ 4 ä¸ªä»¥å†…çš„ç¡¬ç›˜æŸå®³ä»å¯ä¿è¯æ•°æ®æ¢å¤ï¼Œä¸å½±å“ä¸Šä¼ å’Œä¸‹è½½ï¼Œå¦‚æœå¤šäºä¸€åŠçš„ç¡¬ç›˜åäº†åˆ™æ— æ³•æ¢å¤ã€‚</p><h4 id="_3-2-2-æ•°æ®æ¢å¤æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_3-2-2-æ•°æ®æ¢å¤æ¼”ç¤º" aria-hidden="true">#</a> <strong>3.2.2 æ•°æ®æ¢å¤æ¼”ç¤º</strong></h4><p>ä¸‹è¾¹åœ¨æœ¬æœºæ¼”ç¤º MinIO æ¢å¤æ•°æ®çš„è¿‡ç¨‹ï¼Œåœ¨æœ¬åœ°åˆ›å»º 4 ä¸ªç›®å½•è¡¨ç¤º 4 ä¸ªç¡¬ç›˜ã€‚</p><p><img src="/MyBlog/assets/image-20230521174429441-fe8bf6db.png" alt="image-20230521174429441"></p><p>ä¸‹è½½ minioï¼Œä¸‹è½½åœ°å€åœ¨https://dl.min.io/server/minio/release/ï¼Œå¯ä»è¯¾ç¨‹èµ„æ–™æ‰¾åˆ°MinIOçš„å®‰è£…æ–‡ä»¶minio.zipè§£å‹å³å¯ä½¿ç”¨ï¼ŒCMDè¿›å…¥æœ‰minio.exeçš„ç›®å½•ï¼Œè¿è¡Œä¸‹è¾¹çš„å‘½ä»¤ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>minio.exe server D:<span class="token function selector">\develop</span><span class="token function selector">\minio</span>_data<span class="token function selector">\data</span>1  D:<span class="token function selector">\develop</span><span class="token function selector">\minio</span>_data<span class="token function selector">\data</span>2  D:<span class="token function selector">\develop</span><span class="token function selector">\minio</span>_data<span class="token function selector">\data</span>3  D:<span class="token function selector">\develop</span><span class="token function selector">\minio</span>_data<span class="token function selector">\data</span>4

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521174516437-f9b09631.png" alt="image-20230521174516437"></p><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>WARNING: MINIO_ACCESS_KEY <span class="token operator">and</span> MINIO_SECRET_KEY are deprecated<span class="token punctuation">.</span>
         Please <span class="token keyword">use</span> MINIO_ROOT_USER <span class="token operator">and</span> MINIO_ROOT_PASSWORD
Formatting <span class="token number">1</span>st pool<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">set</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span> drives per <span class="token keyword">set</span><span class="token punctuation">.</span>
WARNING: Host <span class="token keyword">local</span> has more than <span class="token number">2</span> drives <span class="token keyword">of</span> <span class="token keyword">set</span><span class="token punctuation">.</span> A host failure will result <span class="token operator">in</span> <span class="token keyword">data</span> becoming unavailable<span class="token punctuation">.</span>
WARNING: Detected <span class="token keyword">default</span> credentials <span class="token string">&#39;minioadmin:minioadmin&#39;</span><span class="token punctuation">,</span> we recommend that you change these <span class="token keyword">values</span> <span class="token keyword">with</span> <span class="token string">&#39;MINIO_ROOT_USER&#39;</span> <span class="token operator">and</span> <span class="token string">&#39;MINIO_ROOT_PASSWORD&#39;</span> environment variables

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1ï¼‰è€ç‰ˆæœ¬ä½¿ç”¨çš„ MINIO_ACCESS_KEY å’Œ MINIO_SECRET_KEY ä¸æ¨èä½¿ç”¨ï¼Œæ¨èä½¿ç”¨ MINIO_ROOT_USER å’Œ MINIO_ROOT_PASSWORD è®¾ç½®è´¦å·å’Œå¯†ç ã€‚</p><p>2ï¼‰pool å³ minio èŠ‚ç‚¹ç»„æˆçš„æ± å­ï¼Œå½“å‰æœ‰ä¸€ä¸ª pool å’Œ 4 ä¸ªç¡¬ç›˜ç»„æˆçš„ set é›†åˆ</p><p>3ï¼‰å› ä¸ºé›†åˆæ˜¯ 4 ä¸ªç¡¬ç›˜ï¼Œå¤§äº 2 çš„ç¡¬ç›˜æŸåæ•°æ®å°†æ— æ³•æ¢å¤ã€‚</p><p>4ï¼‰è´¦å·å’Œå¯†ç é»˜è®¤ä¸º minioadminã€minioadminï¼Œå¯ä»¥åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®é€šè¿‡&#39;MINIO_ROOT_USER&#39; and &#39;MINIO_ROOT_PASSWORD&#39; è¿›è¡Œè®¾ç½®ã€‚</p><p>ä¸‹è¾¹è¾“å…¥ http://localhost:9000 è¿›è¡Œç™»å½•ï¼Œè´¦å·å’Œå¯†ç ä¸ºï¼šminioadmin/minioadmin</p><p><img src="/MyBlog/assets/image-20230521174542920-04fae96a.png" alt="image-20230521174542920"></p><p>ç™»å½•æˆåŠŸï¼š</p><p><img src="/MyBlog/assets/image-20230521174550651-0329b8d4.png" alt="image-20230521174550651">ä¸‹ä¸€æ­¥åˆ›å»º bucketï¼Œæ¡¶ï¼Œå®ƒç›¸å½“äºå­˜å‚¨æ–‡ä»¶çš„ç›®å½•ï¼Œå¯ä»¥åˆ›å»ºè‹¥å¹²çš„æ¡¶ã€‚</p><p><img src="/MyBlog/assets/image-20230521174556135-4a8110f2.png" alt="image-20230521174556135"></p><p>è¾“å…¥ bucket çš„åç§°ï¼Œç‚¹å‡»â€œCreateBucketâ€ï¼Œåˆ›å»ºæˆåŠŸ</p><p><img src="/MyBlog/assets/image-20230521174601980-808b15b7.png" alt="image-20230521174601980"></p><p>ç‚¹å‡»â€œuploadâ€ä¸Šä¼ æ–‡ä»¶ã€‚</p><p>ä¸‹è¾¹ä¸Šä¼ å‡ ä¸ªæ–‡ä»¶</p><p><img src="/MyBlog/assets/image-20230521174611447-14fded21.png" alt="image-20230521174611447"></p><p>ä¸‹è¾¹å»å››ä¸ªç›®å½•è§‚å¯Ÿæ–‡ä»¶çš„å­˜å‚¨æƒ…å†µ</p><p><img src="/MyBlog/assets/image-20230521174618445-2a4d6358.png" alt="image-20230521174618445"></p><p>æˆ‘ä»¬å‘ç°ä¸Šä¼ çš„ 1.mp4 æ–‡ä»¶å­˜å‚¨åœ¨äº†å››ä¸ªç›®å½•ï¼Œå³å››ä¸ªç¡¬ç›˜ä¸Šã€‚</p><p>ä¸‹è¾¹æµ‹è¯• minio çš„æ•°æ®æ¢å¤è¿‡ç¨‹ï¼š</p><p>1ã€é¦–å…ˆåˆ é™¤ä¸€ä¸ªç›®å½•ã€‚</p><p>åˆ é™¤ç›®å½•åä»ç„¶å¯ä»¥åœ¨ web æ§åˆ¶å°ä¸Šä¼ æ–‡ä»¶å’Œä¸‹è½½æ–‡ä»¶ã€‚</p><p>ç¨ç­‰ç‰‡åˆ»åˆ é™¤çš„ç›®å½•è‡ªåŠ¨æ¢å¤ã€‚</p><p>2ã€åˆ é™¤ä¸¤ä¸ªç›®å½•ã€‚</p><p>åˆ é™¤ä¸¤ä¸ªç›®å½•ä¹Ÿä¼šè‡ªåŠ¨æ¢å¤ã€‚</p><p>3ã€åˆ é™¤ä¸‰ä¸ªç›®å½• ã€‚</p><p>ç”±äº é›†åˆä¸­å…±æœ‰ 4 å—ç¡¬ç›˜ï¼Œæœ‰å¤§äºä¸€åŠçš„ç¡¬ç›˜æŸåæ•°æ®æ— æ³•æ¢å¤ã€‚</p><p>æ­¤æ—¶æŠ¥é”™ï¼šWe encountered an internal error, please try again. (Read failed. Insufficient number of drives online)åœ¨çº¿é©±åŠ¨å™¨æ•°é‡ä¸è¶³ã€‚</p><h4 id="_3-2-3-æµ‹è¯•-docker-ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_3-2-3-æµ‹è¯•-docker-ç¯å¢ƒ" aria-hidden="true">#</a> <strong>3.2.3 æµ‹è¯• Docker ç¯å¢ƒ</strong></h4><p>å¼€å‘é˜¶æ®µå’Œç”Ÿäº§é˜¶æ®µç»Ÿä¸€ä½¿ç”¨ Docker ä¸‹çš„ MINIOã€‚</p><p>åœ¨ä¸‹å‘çš„è™šæ‹Ÿæœºä¸­å·²å®‰è£…äº† MinIO çš„é•œåƒå’Œå®¹å™¨ï¼Œæ‰§è¡Œ sh /data/soft /restart.sh å¯åŠ¨ Docker ä¸‹çš„ MinIO</p><p>å¯åŠ¨å®Œæˆç™»å½• MinIO æŸ¥çœ‹æ˜¯å¦æ­£å¸¸ã€‚</p><p>è®¿é—®http://192.168.101.65:9000</p><p><img src="/MyBlog/assets/image-20230521174632760-d2754acf.png" alt="image-20230521174632760">æœ¬é¡¹ç›®åˆ›å»ºä¸¤ä¸ª bucketsï¼š</p><p>mediafilesï¼š æ™®é€šæ–‡ä»¶</p><p>videoï¼šè§†é¢‘æ–‡ä»¶</p><h4 id="_3-2-4-sdk" tabindex="-1"><a class="header-anchor" href="#_3-2-4-sdk" aria-hidden="true">#</a> <strong>3.2.4 SDK</strong></h4><h5 id="_3-2-4-1-ä¸Šä¼ æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-2-4-1-ä¸Šä¼ æ–‡ä»¶" aria-hidden="true">#</a> <strong>3.2.4.1 ä¸Šä¼ æ–‡ä»¶</strong></h5><p>MinIO æä¾›å¤šä¸ªè¯­è¨€ç‰ˆæœ¬ SDK çš„æ”¯æŒï¼Œä¸‹è¾¹æ‰¾åˆ° java ç‰ˆæœ¬çš„æ–‡æ¡£ï¼š</p><p>åœ°å€ï¼šhttps://docs.min.io/docs/java-client-quickstart-guide.html</p><p>æœ€ä½éœ€æ±‚ Java 1.8 æˆ–æ›´é«˜ç‰ˆæœ¬:</p><p>maven ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.minio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>minio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.squareup.okhttp3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>okhttp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ media-service å·¥ç¨‹æ·»åŠ æ­¤ä¾èµ–ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><p>éœ€è¦ä¸‰ä¸ªå‚æ•°æ‰èƒ½è¿æ¥åˆ° minio æœåŠ¡ã€‚</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>å‚æ•°</td><td>è¯´æ˜</td></tr><tr><td>Endpoint</td><td>å¯¹è±¡å­˜å‚¨æœåŠ¡çš„ URL</td></tr><tr><td>Access Key</td><td>Access key å°±åƒç”¨æˆ· IDï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä½ çš„è´¦æˆ·ã€‚</td></tr><tr><td>Secret Key</td><td>Secret key æ˜¯ä½ è´¦æˆ·çš„å¯†ç ã€‚</td></tr></tbody></table><p>å®˜æ–¹çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">BucketExistsArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MakeBucketArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MinioClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">UploadObjectArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span>errors<span class="token punctuation">.</span></span><span class="token class-name">MinioException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">InvalidKeyException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploader</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// Create a minioClient with the MinIO server playground, its access key and secret key.</span>
      <span class="token class-name">MinioClient</span> minioClient <span class="token operator">=</span>
          <span class="token class-name">MinioClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;https://play.min.io&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">credentials</span><span class="token punctuation">(</span><span class="token string">&quot;Q3AM3UQ867SPQQA43P2F&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Make &#39;asiatrip&#39; bucket if not exist.</span>
      <span class="token keyword">boolean</span> found <span class="token operator">=</span>
          minioClient<span class="token punctuation">.</span><span class="token function">bucketExists</span><span class="token punctuation">(</span><span class="token class-name">BucketExistsArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;asiatrip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>found<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Make a new bucket called &#39;asiatrip&#39;.</span>
        minioClient<span class="token punctuation">.</span><span class="token function">makeBucket</span><span class="token punctuation">(</span><span class="token class-name">MakeBucketArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;asiatrip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Bucket &#39;asiatrip&#39; already exists.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Upload &#39;/home/user/Photos/asiaphotos.zip&#39; as object name &#39;asiaphotos-2015.zip&#39; to bucket</span>
      <span class="token comment">// &#39;asiatrip&#39;.</span>
      minioClient<span class="token punctuation">.</span><span class="token function">uploadObject</span><span class="token punctuation">(</span>
          <span class="token class-name">UploadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;asiatrip&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;asiaphotos-2015.zip&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token string">&quot;/home/user/Photos/asiaphotos.zip&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
          <span class="token string">&quot;&#39;/home/user/Photos/asiaphotos.zip&#39; is successfully uploaded as &quot;</span>
              <span class="token operator">+</span> <span class="token string">&quot;object &#39;asiaphotos-2015.zip&#39; to bucket &#39;asiatrip&#39;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MinioException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Error occurred: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP trace: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">httpTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‚è€ƒç¤ºä¾‹åœ¨ media-service å·¥ç¨‹ä¸­ æµ‹è¯•ä¸Šä¼ æ–‡ä»¶åŠŸèƒ½ï¼Œ</p><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç”¨äºæµ‹è¯•çš„ bucket</p><p><img src="/MyBlog/assets/image-20230521174732420-4e9bfebd.png" alt="image-20230521174732420"></p><p>ç‚¹å‡»â€œManageâ€ä¿®æ”¹ bucket çš„è®¿é—®æƒé™</p><p><img src="/MyBlog/assets/image-20230521174737096-bf9a48fc.png" alt="image-20230521174737096"></p><p>é€‰æ‹© public æƒé™</p><p><img src="/MyBlog/assets/image-20230521174743840-00f5681a.png" alt="image-20230521174743840"></p><p>åœ¨ xuecheng-plus-media-service å·¥ç¨‹ çš„ test ä¸‹ç¼–å†™æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">BucketExistsArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MakeBucketArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MinioClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">UploadObjectArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span>errors<span class="token punctuation">.</span></span><span class="token class-name">MinioException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">InvalidKeyException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æµ‹è¯•MinIO
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/11 21:24
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MinioTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token class-name">MinioClient</span> minioClient <span class="token operator">=</span>
            <span class="token class-name">MinioClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;http://192.168.101.65:9000&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">credentials</span><span class="token punctuation">(</span><span class="token string">&quot;minioadmin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;minioadmin&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//ä¸Šä¼ æ–‡ä»¶</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">UploadObjectArgs</span> testbucket <span class="token operator">=</span> <span class="token class-name">UploadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;testbucket&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                    .object(&quot;test001.mp4&quot;)</span>
                    <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;001/test001.mp4&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ·»åŠ å­ç›®å½•</span>
                    <span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\develop\\upload\\1mp4.temp&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token string">&quot;video/mp4&quot;</span><span class="token punctuation">)</span><span class="token comment">//é»˜è®¤æ ¹æ®æ‰©å±•åç¡®å®šæ–‡ä»¶å†…å®¹ç±»å‹ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            minioClient<span class="token punctuation">.</span><span class="token function">uploadObject</span><span class="token punctuation">(</span>testbucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ upload æ–¹æ³•ï¼Œåˆ†åˆ«æµ‹è¯•å‘æ¡¶çš„æ ¹ç›®å½•ä¸Šä¼ æ–‡ä»¶ä»¥åŠå­ç›®å½•ä¸Šä¼ æ–‡ä»¶ã€‚</p><p>ä¸Šä¼ æˆåŠŸï¼Œé€šè¿‡ web æ§åˆ¶å°æŸ¥çœ‹æ–‡ä»¶ï¼Œå¹¶é¢„è§ˆæ–‡ä»¶ã€‚</p><p>è¯´æ˜ï¼š</p><p>è®¾ç½® contentType å¯ä»¥é€šè¿‡ com.j256.simplemagic.ContentType æšä¸¾ç±»æŸ¥çœ‹å¸¸ç”¨çš„ mimeTypeï¼ˆåª’ä½“ç±»å‹ï¼‰</p><p>é€šè¿‡æ‰©å±•åå¾—åˆ° mimeTypeï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">//æ ¹æ®æ‰©å±•åå–å‡ºmimeType</span>
    <span class="token class-name">ContentInfo</span> extensionMatch <span class="token operator">=</span> <span class="token class-name">ContentInfoUtil</span><span class="token punctuation">.</span><span class="token function">findExtensionMatch</span><span class="token punctuation">(</span><span class="token string">&quot;.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> mimeType <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_OCTET_STREAM_VALUE</span><span class="token punctuation">;</span><span class="token comment">//é€šç”¨mimeTypeï¼Œå­—èŠ‚æµ</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œå–„ä¸Šè¾¹çš„ä»£ç  å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ ¹æ®æ‰©å±•åå–å‡ºmimeType (å·¥å…·ç±» åœ¨baseå·¥ç¨‹ä¸­ Pom simplemagic)</span>
        <span class="token class-name">ContentInfo</span> extensionMatch <span class="token operator">=</span> <span class="token class-name">ContentInfoUtil</span><span class="token punctuation">.</span><span class="token function">findExtensionMatch</span><span class="token punctuation">(</span><span class="token string">&quot;.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> mimeType <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_OCTET_STREAM_VALUE</span><span class="token punctuation">;</span><span class="token comment">//é€šç”¨mimeTypeï¼Œå­—èŠ‚æµ</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>extensionMatch<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            mimeType <span class="token operator">=</span> extensionMatch<span class="token punctuation">.</span><span class="token function">getMimeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">UploadObjectArgs</span> testbucket <span class="token operator">=</span> <span class="token class-name">UploadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;testbucket&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                    .object(&quot;test001.mp4&quot;)</span>
                    <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;001/test001.mp4&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ·»åŠ å­ç›®å½•</span>
                    <span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\develop\\upload\\1mp4.temp&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span>mimeType<span class="token punctuation">)</span><span class="token comment">//é»˜è®¤æ ¹æ®æ‰©å±•åç¡®å®šæ–‡ä»¶å†…å®¹ç±»å‹ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            minioClient<span class="token punctuation">.</span><span class="token function">uploadObject</span><span class="token punctuation">(</span>testbucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-2-4-2-åˆ é™¤æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-2-4-2-åˆ é™¤æ–‡ä»¶" aria-hidden="true">#</a> <strong>3.2.4.2 åˆ é™¤æ–‡ä»¶</strong></h5><p>ä¸‹è¾¹æµ‹è¯•åˆ é™¤æ–‡ä»¶</p><p>å‚è€ƒï¼šhttps://docs.min.io/docs/java-client-api-reference#removeObject</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        minioClient<span class="token punctuation">.</span><span class="token function">removeObject</span><span class="token punctuation">(</span>
               <span class="token class-name">RemoveObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;testbucket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;001/test001.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ é™¤æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ é™¤å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-2-4-3-æŸ¥è¯¢æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-2-4-3-æŸ¥è¯¢æ–‡ä»¶" aria-hidden="true">#</a> <strong>3.2.4.3 æŸ¥è¯¢æ–‡ä»¶</strong></h5><p>é€šè¿‡æŸ¥è¯¢æ–‡ä»¶æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ minio ä¸­ã€‚</p><p>å‚è€ƒï¼šhttps://docs.min.io/docs/java-client-api-reference#getObject</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//æŸ¥è¯¢æ–‡ä»¶</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">GetObjectArgs</span> getObjectArgs <span class="token operator">=</span> <span class="token class-name">GetObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;testbucket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;test001.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span>
        <span class="token class-name">FilterInputStream</span> inputStream <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>getObjectArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\develop\\upload\\1_2.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¡éªŒæ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œå¯¹æ–‡ä»¶è®¡ç®—å‡º md5 å€¼ï¼Œæ¯”è¾ƒåŸå§‹æ–‡ä»¶çš„ md5 å’Œç›®æ ‡æ–‡ä»¶çš„ md5ï¼Œä¸€è‡´åˆ™è¯´æ˜å®Œæ•´</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//æ ¡éªŒæ–‡ä»¶çš„å®Œæ•´æ€§å¯¹æ–‡ä»¶çš„å†…å®¹è¿›è¡Œmd5</span>
<span class="token class-name">FileInputStream</span> fileInputStream1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\develop\\upload\\1.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> source_md5 <span class="token operator">=</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>fileInputStream1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\develop\\upload\\1a.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> local_md5 <span class="token operator">=</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>source_md5<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>local_md5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸‹è½½æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä¸ªäººè®¤ä¸ºè¿™ç§ åšæ³•æœ‰é—®é¢˜ æ²¡æœ‰å®é™…æ„ä¹‰</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-ä¸Šä¼ å›¾ç‰‡" tabindex="-1"><a class="header-anchor" href="#_4-ä¸Šä¼ å›¾ç‰‡" aria-hidden="true">#</a> <strong>4 ä¸Šä¼ å›¾ç‰‡</strong></h2><h3 id="_4-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>4.1 éœ€æ±‚åˆ†æ</strong></h3><h4 id="_4-1-1-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-1-1-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>4.1.1 ä¸šåŠ¡æµç¨‹</strong></h4><p>è¯¾ç¨‹å›¾ç‰‡æ˜¯å®£ä¼ è¯¾ç¨‹éå¸¸é‡è¦çš„ä¿¡æ¯ï¼Œåœ¨æ–°å¢è¯¾ç¨‹ç•Œé¢ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹è¯¾ç¨‹å›¾ç‰‡ã€‚</p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521174916606-55b71828.png" alt="image-20230521174916606"></p><p>ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡æ€»ä½“ä¸ŠåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š</p><p>1ã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡å‰ç«¯è¯·æ±‚åª’èµ„ç®¡ç†æœåŠ¡å°†æ–‡ä»¶ä¸Šä¼ è‡³åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”åœ¨åª’èµ„ç®¡ç†æ•°æ®åº“ä¿å­˜æ–‡ä»¶ä¿¡æ¯ã€‚</p><p>2ã€ä¸Šä¼ å›¾ç‰‡æˆåŠŸä¿å­˜å›¾ç‰‡åœ°å€åˆ°è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯è¡¨ä¸­ã€‚</p><p>è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521174923069-80a452d5.png" alt="image-20230521174923069"></p><p>1ã€å‰ç«¯è¿›å…¥ä¸Šä¼ å›¾ç‰‡ç•Œé¢</p><p>2ã€ä¸Šä¼ å›¾ç‰‡ï¼Œè¯·æ±‚åª’èµ„ç®¡ç†æœåŠ¡ã€‚</p><p>3ã€åª’èµ„ç®¡ç†æœåŠ¡å°†å›¾ç‰‡æ–‡ä»¶å­˜å‚¨åœ¨ MinIOã€‚</p><p>4ã€åª’èµ„ç®¡ç†è®°å½•æ–‡ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“ã€‚</p><p>5ã€å‰ç«¯è¯·æ±‚å†…å®¹ç®¡ç†æœåŠ¡ä¿å­˜è¯¾ç¨‹ä¿¡æ¯ï¼Œåœ¨å†…å®¹ç®¡ç†æ•°æ®åº“ä¿å­˜å›¾ç‰‡åœ°å€ã€‚</p><h4 id="_4-1-2-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_4-1-2-æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>4.1.2 æ•°æ®æ¨¡å‹</strong></h4><p>æ¶‰åŠåˆ°çš„æ•°æ®è¡¨æœ‰ï¼šè¯¾ç¨‹ä¿¡æ¯è¡¨ä¸­çš„å›¾ç‰‡å­—æ®µã€åª’èµ„æ•°æ®åº“çš„æ–‡ä»¶è¡¨ï¼Œä¸‹è¾¹ä¸»è¦çœ‹åª’èµ„æ•°æ®åº“çš„æ–‡ä»¶è¡¨ã€‚</p><p><img src="/MyBlog/assets/image-20230521174930515-77797c2f.png" alt="image-20230521174930515"></p><p>å„å­—æ®µæè¿°å¦‚ä¸‹ï¼š</p><h3 id="_4-2-å‡†å¤‡ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_4-2-å‡†å¤‡ç¯å¢ƒ" aria-hidden="true">#</a> <img src="/MyBlog/assets/image-20230521174935560-5bb4a506.png" alt="image-20230521174935560"><strong>4.2 å‡†å¤‡ç¯å¢ƒ</strong></h3><p>é¦–å…ˆåœ¨ minio é…ç½® bucketï¼Œbucket åç§°ä¸ºï¼šmediafilesï¼Œå¹¶è®¾ç½® bucket çš„æƒé™ä¸ºå…¬å¼€ã€‚</p><p><img src="/MyBlog/assets/image-20230521174942568-e44b793b.png" alt="image-20230521174942568"></p><p>åœ¨ nacos é…ç½®ä¸­ minio çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿›å…¥ media-service-dev.yaml:</p><p><img src="/MyBlog/assets/image-20230521174948380-8e67c1e0.png" alt="image-20230521174948380"></p><p>é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">minio</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//192.168.101.65<span class="token punctuation">:</span><span class="token number">9000</span>
  <span class="token key atrule">accessKey</span><span class="token punctuation">:</span> minioadmin
  <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> minioadmin
  <span class="token key atrule">bucket</span><span class="token punctuation">:</span>
    <span class="token key atrule">files</span><span class="token punctuation">:</span> mediafiles
    <span class="token key atrule">videofiles</span><span class="token punctuation">:</span> video
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ media-service å·¥ç¨‹ç¼–å†™ minio çš„é…ç½®ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MinioClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> minioé…ç½®
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/12 19:32
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MinioConfig</span> <span class="token punctuation">{</span>


 <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${minio.endpoint}&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">private</span> <span class="token class-name">String</span> endpoint<span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${minio.accessKey}&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">private</span> <span class="token class-name">String</span> accessKey<span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${minio.secretKey}&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">private</span> <span class="token class-name">String</span> secretKey<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Bean</span>
 <span class="token keyword">public</span> <span class="token class-name">MinioClient</span> <span class="token function">minioClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token class-name">MinioClient</span> minioClient <span class="token operator">=</span>
          <span class="token class-name">MinioClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">credentials</span><span class="token punctuation">(</span>accessKey<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> minioClient<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_4-3-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>4.3 æ¥å£å®šä¹‰</strong></h3><p>æ ¹æ®éœ€æ±‚åˆ†æï¼Œä¸‹è¾¹è¿›è¡Œæ¥å£å®šä¹‰ï¼Œæ­¤æ¥å£å®šä¹‰ä¸ºä¸€ä¸ªé€šç”¨çš„ä¸Šä¼ æ–‡ä»¶æ¥å£ï¼Œå¯ä»¥ä¸Šä¼ å›¾ç‰‡æˆ–å…¶å®ƒæ–‡ä»¶ã€‚</p><p>é¦–å…ˆåˆ†ææ¥å£ï¼š</p><p>è¯·æ±‚åœ°å€ï¼š/media/upload/coursefile</p><p>è¯·æ±‚å†…å®¹ï¼š<strong>Content-Type:</strong> multipart/form-data;</p><p>form-data; name=&quot;filedata&quot;; filename=&quot;å…·ä½“çš„æ–‡ä»¶åç§°&quot;</p><p>å“åº”å‚æ•°ï¼šæ–‡ä»¶ä¿¡æ¯ï¼Œå¦‚ä¸‹</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a16da7a132559daf9e1193166b3e7f52&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;companyId&quot;</span><span class="token operator">:</span> <span class="token number">1232141425</span><span class="token punctuation">,</span>
  <span class="token property">&quot;companyName&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;filename&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.jpg&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;001001&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bucket&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fileId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a16da7a132559daf9e1193166b3e7f52&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;timelength&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;createDate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-09-12T21:57:18&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;changeDate&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;remark&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;auditStatus&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;auditMind&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fileSize&quot;</span><span class="token operator">:</span> <span class="token number">248329</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ä¸Šä¼ å“åº”æ¨¡å‹ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaFiles</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> ä¸Šä¼ æ™®é€šæ–‡ä»¶æˆåŠŸå“åº”ç»“æœ
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/12 18:49
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadFileResultDto</span> <span class="token keyword">extends</span> <span class="token class-name">MediaFiles</span> <span class="token punctuation">{</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/upload/coursefile&quot;</span><span class="token punctuation">,</span> consumes <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">MULTIPART_FORM_DATA_VALUE</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UploadFileResultDto</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">&quot;filedata&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> upload<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥å£å®šä¹‰å¥½åå¯ä»¥ç”¨ httpclient å·¥å…·æµ‹è¯•ä¸€ä¸‹</p><p>ä½¿ç”¨ httpclient æµ‹è¯•</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>#### ä¸Šä¼ æ–‡ä»¶
POST <span class="token punctuation">{</span><span class="token punctuation">{</span>media_host<span class="token punctuation">}</span><span class="token punctuation">}</span>/media/upload/coursefile
Content-Type<span class="token operator">:</span> multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition<span class="token operator">:</span> form-data; name=<span class="token string">&quot;filedata&quot;</span>; filename=<span class="token string">&quot;1.jpg&quot;</span>
Content-Type<span class="token operator">:</span> application/octet-stream

&lt; d<span class="token operator">:</span>/develop/upload/<span class="token number">1</span>.jpg

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-æ¥å£å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_4-4-æ¥å£å¼€å‘" aria-hidden="true">#</a> <strong>4.4 æ¥å£å¼€å‘</strong></h3><h4 id="_4-4-1-dao-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_4-4-1-dao-å¼€å‘" aria-hidden="true">#</a> <strong>4.4.1 DAO å¼€å‘</strong></h4><p>æ ¹æ®éœ€æ±‚åˆ†æ DAO å±‚å®ç°å‘ media_files è¡¨æ’å…¥ä¸€æ¡è®°å½•ï¼Œä½¿ç”¨ media_files è¡¨ç”Ÿæˆçš„ mapper å³å¯ã€‚</p><h4 id="_4-4-2-service-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_4-4-2-service-å¼€å‘" aria-hidden="true">#</a> <strong>4.4.2 Service å¼€å‘</strong></h4><p>Service æ–¹æ³•éœ€è¦æä¾›ä¸€ä¸ªæ›´åŠ é€šç”¨çš„ä¿å­˜æ–‡ä»¶çš„æ–¹æ³•ã€‚</p><p>å®šä¹‰è¯·æ±‚å‚æ•°ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaFiles</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> ä¸Šä¼ æ™®é€šæ–‡ä»¶è¯·æ±‚å‚æ•°
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/12 18:49
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadFileParamsDto</span> <span class="token punctuation">{</span>

 <span class="token doc-comment comment">/**
  * æ–‡ä»¶åç§°
  */</span>
 <span class="token keyword">private</span> <span class="token class-name">String</span> filename<span class="token punctuation">;</span>


 <span class="token doc-comment comment">/**
  * æ–‡ä»¶ç±»å‹ï¼ˆæ–‡æ¡£ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ï¼‰
  */</span>
 <span class="token keyword">private</span> <span class="token class-name">String</span> fileType<span class="token punctuation">;</span>
 <span class="token doc-comment comment">/**
  * æ–‡ä»¶å¤§å°
  */</span>
 <span class="token keyword">private</span> <span class="token class-name">Long</span> fileSize<span class="token punctuation">;</span>

 <span class="token doc-comment comment">/**
  * æ ‡ç­¾
  */</span>
 <span class="token keyword">private</span> <span class="token class-name">String</span> tags<span class="token punctuation">;</span>

 <span class="token doc-comment comment">/**
  * ä¸Šä¼ äºº
  */</span>
 <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

 <span class="token doc-comment comment">/**
  * å¤‡æ³¨
  */</span>
 <span class="token keyword">private</span> <span class="token class-name">String</span> remark<span class="token punctuation">;</span>



<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ service æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä¸Šä¼ æ–‡ä»¶
 * <span class="token keyword">@param</span> <span class="token parameter">companyId</span> æœºæ„id
 * <span class="token keyword">@param</span> <span class="token parameter">uploadFileParamsDto</span> ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯
 * <span class="token keyword">@param</span> <span class="token parameter">localFilePath</span> æ–‡ä»¶ç£ç›˜è·¯å¾„
 * <span class="token keyword">@return</span> æ–‡ä»¶ä¿¡æ¯
 */</span>
<span class="token keyword">public</span> <span class="token class-name">UploadFileResultDto</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span> <span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">,</span> <span class="token class-name">String</span> localFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">MinioClient</span> minioClient<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">MediaFilesMapper</span> mediaFilesMapper<span class="token punctuation">;</span>

<span class="token comment">//æ™®é€šæ–‡ä»¶æ¡¶</span>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${minio.bucket.files}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> bucket_Files<span class="token punctuation">;</span>


<span class="token comment">//è·å–æ–‡ä»¶é»˜è®¤å­˜å‚¨ç›®å½•è·¯å¾„ å¹´/æœˆ/æ—¥</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getDefaultFolderPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> folder <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> folder<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//è·å–æ–‡ä»¶çš„md5</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getFileMd5</span><span class="token punctuation">(</span><span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> fileMd5 <span class="token operator">=</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileMd5<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getMimeType</span><span class="token punctuation">(</span><span class="token class-name">String</span> extension<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>extension<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span>
        extension <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ ¹æ®æ‰©å±•åå–å‡ºmimeType</span>
    <span class="token class-name">ContentInfo</span> extensionMatch <span class="token operator">=</span> <span class="token class-name">ContentInfoUtil</span><span class="token punctuation">.</span><span class="token function">findExtensionMatch</span><span class="token punctuation">(</span>extension<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//é€šç”¨mimeTypeï¼Œå­—èŠ‚æµ</span>
    <span class="token class-name">String</span> mimeType <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_OCTET_STREAM_VALUE</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>extensionMatch<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        mimeType <span class="token operator">=</span> extensionMatch<span class="token punctuation">.</span><span class="token function">getMimeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> mimeType<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> å°†æ–‡ä»¶å†™å…¥minIO
 * <span class="token keyword">@param</span> <span class="token parameter">localFilePath</span>  æ–‡ä»¶åœ°å€
 * <span class="token keyword">@param</span> <span class="token parameter">bucket</span>  æ¡¶
 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> å¯¹è±¡åç§°
 * <span class="token keyword">@return</span> void
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/12 21:22
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addMediaFilesToMinIO</span><span class="token punctuation">(</span><span class="token class-name">String</span> localFilePath<span class="token punctuation">,</span><span class="token class-name">String</span> mimeType<span class="token punctuation">,</span><span class="token class-name">String</span> bucket<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">UploadObjectArgs</span> testbucket <span class="token operator">=</span> <span class="token class-name">UploadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span>localFilePath<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span>mimeType<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        minioClient<span class="token punctuation">.</span><span class="token function">uploadObject</span><span class="token punctuation">(</span>testbucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æ–‡ä»¶åˆ°minioæˆåŠŸ,bucket:{},objectName:{}&quot;</span><span class="token punctuation">,</span>bucket<span class="token punctuation">,</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æ–‡ä»¶åˆ°minioå‡ºé”™,bucket:{},objectName:{},é”™è¯¯åŸå› :{}&quot;</span><span class="token punctuation">,</span>bucket<span class="token punctuation">,</span>objectName<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æ–‡ä»¶åˆ°æ–‡ä»¶ç³»ç»Ÿå¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> å°†æ–‡ä»¶ä¿¡æ¯æ·»åŠ åˆ°æ–‡ä»¶è¡¨
 * <span class="token keyword">@param</span> <span class="token parameter">companyId</span>  æœºæ„id
 * <span class="token keyword">@param</span> <span class="token parameter">fileMd5</span>  æ–‡ä»¶md5å€¼
 * <span class="token keyword">@param</span> <span class="token parameter">uploadFileParamsDto</span>  ä¸Šä¼ æ–‡ä»¶çš„ä¿¡æ¯
 * <span class="token keyword">@param</span> <span class="token parameter">bucket</span>  æ¡¶
 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> å¯¹è±¡åç§°
 * <span class="token keyword">@return</span> com.xuecheng.media.model.po.MediaFiles
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/12 21:22
 */</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">MediaFiles</span> <span class="token function">addMediaFilesToDb</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span><span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">,</span><span class="token class-name">String</span> bucket<span class="token punctuation">,</span><span class="token class-name">String</span> objectName<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//ä»æ•°æ®åº“æŸ¥è¯¢æ–‡ä»¶</span>
    <span class="token class-name">MediaFiles</span> mediaFiles <span class="token operator">=</span> mediaFilesMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mediaFiles <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mediaFiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ‹·è´åŸºæœ¬ä¿¡æ¯</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>uploadFileParamsDto<span class="token punctuation">,</span> mediaFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setFileId</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setCompanyId</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> bucket <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setBucket</span><span class="token punctuation">(</span>bucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setFilePath</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setAuditStatus</span><span class="token punctuation">(</span><span class="token string">&quot;002003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ–‡ä»¶è¡¨</span>
        <span class="token keyword">int</span> insert <span class="token operator">=</span> mediaFilesMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>insert <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“å¤±è´¥,{}&quot;</span><span class="token punctuation">,</span>mediaFiles<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“æˆåŠŸ,{}&quot;</span><span class="token punctuation">,</span>mediaFiles<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> mediaFiles<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">UploadFileResultDto</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span> <span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">,</span> <span class="token class-name">String</span> localFilePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>localFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ–‡ä»¶åç§°</span>
    <span class="token class-name">String</span> filename <span class="token operator">=</span> uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶æ‰©å±•å</span>
    <span class="token class-name">String</span> extension <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶mimeType</span>
    <span class="token class-name">String</span> mimeType <span class="token operator">=</span> <span class="token function">getMimeType</span><span class="token punctuation">(</span>extension<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶çš„md5å€¼</span>
    <span class="token class-name">String</span> fileMd5 <span class="token operator">=</span> <span class="token function">getFileMd5</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶çš„é»˜è®¤ç›®å½•</span>
    <span class="token class-name">String</span> defaultFolderPath <span class="token operator">=</span> <span class="token function">getDefaultFolderPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å­˜å‚¨åˆ°minioä¸­çš„å¯¹è±¡å(å¸¦ç›®å½•)</span>
    <span class="token class-name">String</span>  objectName <span class="token operator">=</span> defaultFolderPath <span class="token operator">+</span> fileMd5 <span class="token operator">+</span> exension<span class="token punctuation">;</span>
    <span class="token comment">//å°†æ–‡ä»¶ä¸Šä¼ åˆ°minio</span>
    <span class="token keyword">boolean</span> b <span class="token operator">=</span> <span class="token function">addMediaFilesToMinIO</span><span class="token punctuation">(</span>localFilePath<span class="token punctuation">,</span> mimeType<span class="token punctuation">,</span> bucket_files<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶å¤§å°</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setFileSize</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å°†æ–‡ä»¶ä¿¡æ¯å­˜å‚¨åˆ°æ•°æ®åº“</span>
    <span class="token class-name">MediaFiles</span> mediaFiles <span class="token operator">=</span> <span class="token function">addMediaFilesToDb</span><span class="token punctuation">(</span>companyId<span class="token punctuation">,</span> fileMd5<span class="token punctuation">,</span> uploadFileParamsDto<span class="token punctuation">,</span> bucket_files<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å‡†å¤‡è¿”å›æ•°æ®</span>
    <span class="token class-name">UploadFileResultDto</span> uploadFileResultDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadFileResultDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">,</span> uploadFileResultDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> uploadFileResultDto<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-3-å®Œå–„æ¥å£å±‚" tabindex="-1"><a class="header-anchor" href="#_4-4-3-å®Œå–„æ¥å£å±‚" aria-hidden="true">#</a> <strong>4.4.3 å®Œå–„æ¥å£å±‚</strong></h4><p>å®Œå–„æ¥å£å±‚ä»£ç  ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/upload/coursefile&quot;</span><span class="token punctuation">,</span>consumes <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">MULTIPART_FORM_DATA_VALUE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">UploadFileResultDto</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">&quot;filedata&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> upload<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;folder&quot;</span><span class="token punctuation">,</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> folder<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;objectName&quot;</span><span class="token punctuation">,</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Long</span> companyId <span class="token operator">=</span> <span class="token number">1232141425L</span><span class="token punctuation">;</span>
    <span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadFileParamsDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶å¤§å°</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setFileSize</span><span class="token punctuation">(</span>filedata<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å›¾ç‰‡</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setFileType</span><span class="token punctuation">(</span><span class="token string">&quot;001001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶åç§°</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setFilename</span><span class="token punctuation">(</span>filedata<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ–‡ä»¶åç§°</span>
    <span class="token comment">//æ–‡ä»¶å¤§å°</span>
    <span class="token keyword">long</span> fileSize <span class="token operator">=</span> filedata<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setFileSize</span><span class="token punctuation">(</span>fileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆ›å»ºä¸´æ—¶æ–‡ä»¶</span>
    <span class="token class-name">File</span> tempFile <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span><span class="token string">&quot;minio&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¸Šä¼ çš„æ–‡ä»¶æ‹·è´åˆ°ä¸´æ—¶æ–‡ä»¶</span>
    filedata<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>tempFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶è·¯å¾„</span>
    <span class="token class-name">String</span> absolutePath <span class="token operator">=</span> tempFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¸Šä¼ æ–‡ä»¶</span>
    <span class="token class-name">UploadFileResultDto</span> uploadFileResultDto <span class="token operator">=</span> mediaFileService<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>companyId<span class="token punctuation">,</span> uploadFileParamsDto<span class="token punctuation">,</span> absolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> uploadFileResultDto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-4-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-4-4-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>4.4.4 æ¥å£æµ‹è¯•</strong></h4><p>1ã€é¦–å…ˆä½¿ç”¨ httpclient æµ‹è¯•</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>#### ä¸Šä¼ æ–‡ä»¶
POST <span class="token punctuation">{</span><span class="token punctuation">{</span>media_host<span class="token punctuation">}</span><span class="token punctuation">}</span>/media/upload/coursefile
Content-Type<span class="token operator">:</span> multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition<span class="token operator">:</span> form-data; name=<span class="token string">&quot;filedata&quot;</span>; filename=<span class="token string">&quot;1.jpg&quot;</span>
Content-Type<span class="token operator">:</span> application/octet-stream

&lt; d<span class="token operator">:</span>/develop/upload/<span class="token number">1</span>.jpg

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å†è¿›è¡Œå‰åç«¯è”è°ƒæµ‹è¯•</p><p>åœ¨æ–°å¢è¯¾ç¨‹ã€ç¼–è¾‘è¯¾ç¨‹ç•Œé¢ä¸Šä¼ å›¾ï¼Œä¿å­˜è¯¾ç¨‹ä¿¡æ¯åå†æ¬¡è¿›å…¥ç¼–è¾‘è¯¾ç¨‹ç•Œé¢ï¼ŒæŸ¥çœ‹æ˜¯å¦å¯ä»¥æ­£å¸¸ä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ã€‚</p><p><img src="/MyBlog/assets/image-20230521172736026-dcdff67f.png" alt="image-20230521175306531"></p><p>ä¸Šå›¾å›¾ç‰‡å®Œæˆåï¼Œè¿›å…¥åª’èµ„ç®¡ç†ï¼ŒæŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨ä¸­æ˜¯å¦æœ‰åˆšåˆšä¸Šä¼ çš„å›¾ç‰‡ä¿¡æ¯ã€‚</p><p><img src="/MyBlog/assets/image-20230521172746056-a676d7de.png" alt="image-20230521175312589"></p><h4 id="_4-4-5-service-äº‹åŠ¡ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-4-5-service-äº‹åŠ¡ä¼˜åŒ–" aria-hidden="true">#</a> <strong>4.4.5 Service äº‹åŠ¡ä¼˜åŒ–</strong></h4><p>ä¸Šè¾¹çš„ service æ–¹æ³•ä¼˜åŒ–åå¹¶æµ‹è¯•é€šè¿‡ï¼Œç°åœ¨æ€è€ƒå…³äº uploadFile æ–¹æ³•çš„æ˜¯å¦åº”è¯¥å¼€å¯äº‹åŠ¡ã€‚</p><p>ç›®å‰æ˜¯åœ¨ uploadFile æ–¹æ³•ä¸Šæ·»åŠ @Transactionalï¼Œå½“è°ƒç”¨ uploadFile æ–¹æ³•å‰ä¼šå¼€å¯æ•°æ®åº“äº‹åŠ¡ï¼Œå¦‚æœä¸Šä¼ æ–‡ä»¶è¿‡ç¨‹æ—¶é—´è¾ƒé•¿é‚£ä¹ˆæ•°æ®åº“çš„äº‹åŠ¡æŒç»­æ—¶é—´å°±ä¼šå˜é•¿ï¼Œè¿™æ ·æ•°æ®åº“é“¾æ¥é‡Šæ”¾å°±æ…¢ï¼Œæœ€ç»ˆå¯¼è‡´æ•°æ®åº“é“¾æ¥ä¸å¤Ÿç”¨ã€‚</p><p>æˆ‘ä»¬åªå°† addMediaFilesToDb æ–¹æ³•æ·»åŠ äº‹åŠ¡æ§åˆ¶å³å¯,uploadFile æ–¹æ³•ä¸Šçš„@Transactional æ³¨è§£å»æ‰ã€‚</p><p>ä¼˜åŒ–åå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">MediaFiles</span> <span class="token function">addMediaFilesToDb</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span><span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">,</span><span class="token class-name">String</span> bucket<span class="token punctuation">,</span><span class="token class-name">String</span> objectName<span class="token punctuation">)</span><span class="token punctuation">{</span>

   <span class="token comment">//ä»æ•°æ®åº“æŸ¥è¯¢æ–‡ä»¶</span>
<span class="token class-name">MediaFiles</span> mediaFiles <span class="token operator">=</span> mediaFilesMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>mediaFiles <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mediaFiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ‹·è´åŸºæœ¬ä¿¡æ¯</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>uploadFileParamsDto<span class="token punctuation">,</span> mediaFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setFileId</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setCompanyId</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> bucket <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setBucket</span><span class="token punctuation">(</span>bucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setFilePath</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setAuditStatus</span><span class="token punctuation">(</span><span class="token string">&quot;002003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaFiles<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ–‡ä»¶è¡¨</span>
    <span class="token keyword">int</span> insert <span class="token operator">=</span> mediaFilesMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>insert <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“å¤±è´¥,{}&quot;</span><span class="token punctuation">,</span>mediaFiles<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“æˆåŠŸ,{}&quot;</span><span class="token punctuation">,</span>mediaFiles<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">return</span> mediaFiles<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬äººä¸ºåœ¨ int insert = mediaFilesMapper.insert(mediaFiles);ä¸‹è¾¹æ·»åŠ ä¸€ä¸ªå¼‚å¸¸ä»£ç  int a=1/0;</p><p>æµ‹è¯•æ˜¯å¦äº‹åŠ¡æ§åˆ¶ã€‚<code>å¾ˆé—æ†¾ï¼Œäº‹åŠ¡æ§åˆ¶å¤±è´¥</code>ã€‚</p><p>æ–¹æ³•ä¸Šå·²ç»æ·»åŠ äº†@Transactional æ³¨è§£ä¸ºä»€ä¹ˆè¯¥æ–¹æ³•ä¸èƒ½è¢«äº‹åŠ¡æ§åˆ¶å‘¢ï¼Ÿ</p><p>å¦‚æœæ˜¯åœ¨ uploadFile æ–¹æ³•ä¸Šæ·»åŠ @Transactional æ³¨è§£å°±å¯ä»¥æ§åˆ¶äº‹åŠ¡ï¼Œå»æ‰åˆ™ä¸è¡Œã€‚</p><blockquote><p>ç°åœ¨çš„é—®é¢˜å…¶å®æ˜¯ä¸€ä¸ªéäº‹åŠ¡æ–¹æ³•è°ƒåŒç±»ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œäº‹åŠ¡æ— æ³•æ§åˆ¶ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p></blockquote><p>ä¸‹è¾¹åˆ†æåŸå› ï¼š</p><p>å¦‚æœåœ¨ uploadFile æ–¹æ³•ä¸Šæ·»åŠ @Transactional æ³¨è§£ï¼Œä»£ç†å¯¹è±¡æ‰§è¡Œæ­¤æ–¹æ³•å‰ä¼šå¼€å¯äº‹åŠ¡ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521175414648-70d575d5.png" alt="image-20230521175414648"></p><p>å¦‚æœåœ¨ uploadFile æ–¹æ³•ä¸Šæ²¡æœ‰@Transactional æ³¨è§£ï¼Œä»£ç†å¯¹è±¡æ‰§è¡Œæ­¤æ–¹æ³•å‰ä¸è¿›è¡Œäº‹åŠ¡æ§åˆ¶ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521175420395-2598ad20.png" alt="image-20230521175420395"></p><blockquote><p>æ‰€ä»¥åˆ¤æ–­è¯¥æ–¹æ³•æ˜¯å¦å¯ä»¥äº‹åŠ¡æ§åˆ¶å¿…é¡»ä¿è¯æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ­¤æ–¹æ³•ï¼Œä¸”æ­¤æ–¹æ³•ä¸Šæ·»åŠ äº†@Transactional æ³¨è§£ã€‚</p></blockquote><p>ç°åœ¨åœ¨ addMediaFilesToDb æ–¹æ³•ä¸Šæ·»åŠ @Transactional æ³¨è§£ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œäº‹åŠ¡æ§åˆ¶æ˜¯å› ä¸ºå¹¶ä¸æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡æ‰§è¡Œçš„ addMediaFilesToDb æ–¹æ³•ã€‚ä¸ºäº†åˆ¤æ–­åœ¨ uploadFile æ–¹æ³•ä¸­å»è°ƒç”¨ addMediaFilesToDb æ–¹æ³•æ˜¯å¦æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡å»è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“æ–­ç‚¹è·Ÿè¸ªã€‚</p><p><img src="/MyBlog/assets/image-20230521175426352-a8d24717.png" alt="image-20230521175426352"></p><p>æˆ‘ä»¬å‘ç°åœ¨ uploadFile æ–¹æ³•ä¸­å»è°ƒç”¨ addMediaFilesToDb æ–¹æ³•ä¸æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡å»è°ƒç”¨ã€‚</p><p>å¦‚ä½•è§£å†³å‘¢ï¼Ÿé€šè¿‡ä»£ç†å¯¹è±¡å»è°ƒç”¨ addMediaFilesToDb æ–¹æ³•å³å¯è§£å†³ã€‚</p><p>åœ¨ MediaFileService çš„å®ç°ç±»ä¸­æ³¨å…¥ MediaFileService çš„ä»£ç†å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">MediaFileService</span> currentProxy<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°† addMediaFilesToDb æ–¹æ³•ææˆæ¥å£ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> å°†æ–‡ä»¶ä¿¡æ¯æ·»åŠ åˆ°æ–‡ä»¶è¡¨
 * <span class="token keyword">@param</span> <span class="token parameter">companyId</span>  æœºæ„id
 * <span class="token keyword">@param</span> <span class="token parameter">fileMd5</span>  æ–‡ä»¶md5å€¼
 * <span class="token keyword">@param</span> <span class="token parameter">uploadFileParamsDto</span>  ä¸Šä¼ æ–‡ä»¶çš„ä¿¡æ¯
 * <span class="token keyword">@param</span> <span class="token parameter">bucket</span>  æ¡¶
 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> å¯¹è±¡åç§°
 * <span class="token keyword">@return</span> com.xuecheng.media.model.po.MediaFiles
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/12 21:22
 */</span>

<span class="token keyword">public</span> <span class="token class-name">MediaFiles</span> <span class="token function">addMediaFilesToDb</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span><span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">,</span><span class="token class-name">String</span> bucket<span class="token punctuation">,</span><span class="token class-name">String</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ addMediaFilesToDb æ–¹æ³•çš„ä»£ç å¤„æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//å†™å…¥æ–‡ä»¶è¡¨</span>
<span class="token class-name">MediaFiles</span> mediaFiles <span class="token operator">=</span> currentProxy<span class="token punctuation">.</span><span class="token function">addMediaFilesToDb</span><span class="token punctuation">(</span>companyId<span class="token punctuation">,</span> fileMd5<span class="token punctuation">,</span> uploadFileParamsDto<span class="token punctuation">,</span> bucket_files<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æ¬¡æµ‹è¯•äº‹åŠ¡æ˜¯å¦å¯ä»¥æ­£å¸¸æ§åˆ¶ã€‚</p><h2 id="_5-ä¸Šä¼ è§†é¢‘" tabindex="-1"><a class="header-anchor" href="#_5-ä¸Šä¼ è§†é¢‘" aria-hidden="true">#</a> <strong>5 ä¸Šä¼ è§†é¢‘</strong></h2><h3 id="_5-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_5-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>5.1 éœ€æ±‚åˆ†æ</strong></h3><p>1ã€æ•™å­¦æœºæ„äººå‘˜è¿›å…¥åª’èµ„ç®¡ç†åˆ—è¡¨æŸ¥è¯¢è‡ªå·±ä¸Šä¼ çš„åª’èµ„æ–‡ä»¶ã€‚</p><p>ç‚¹å‡»â€œåª’èµ„ç®¡ç†â€</p><p><img src="/MyBlog/assets/image-20230521172741680-7b3acbdf.png" alt="image-20230521175523775"></p><p>è¿›å…¥åª’èµ„ç®¡ç†åˆ—è¡¨é¡µé¢æŸ¥è¯¢æœ¬æœºæ„ä¸Šä¼ çš„åª’èµ„æ–‡ä»¶ã€‚</p><p><img src="/MyBlog/assets/image-20230521172746056-a676d7de.png" alt="image-20230521175528444"></p><p>2ã€æ•™è‚²æœºæ„ç”¨æˆ·åœ¨&quot;åª’èµ„ç®¡ç†&quot;é¡µé¢ä¸­ç‚¹å‡» &quot;ä¸Šä¼ è§†é¢‘&quot; æŒ‰é’®ã€‚</p><p><img src="/MyBlog/assets/image-20230521172754168-1b28ee58.png" alt="image-20230521175534003"></p><p>ç‚¹å‡»â€œä¸Šä¼ è§†é¢‘â€æ‰“å¼€ä¸Šä¼ é¡µé¢</p><p><img src="/MyBlog/assets/image-20230521172759310-c7af05fe.png" alt="image-20230521175539244"></p><p>3ã€é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè‡ªåŠ¨æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ ã€‚</p><p><img src="/MyBlog/assets/image-20230521172807448-1b4d28cf.png" alt="image-20230521175544353"></p><p>4ã€è§†é¢‘ä¸Šä¼ æˆåŠŸä¼šè‡ªåŠ¨å¤„ç†ï¼Œå¤„ç†å®Œæˆå¯ä»¥é¢„è§ˆè§†é¢‘ã€‚</p><p><img src="/MyBlog/assets/image-20230521175550024-a4fbd7fe.png" alt="image-20230521175550024"></p><h3 id="_5-2-æ–­ç‚¹ç»­ä¼ æŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#_5-2-æ–­ç‚¹ç»­ä¼ æŠ€æœ¯" aria-hidden="true">#</a> <strong>5.2 æ–­ç‚¹ç»­ä¼ æŠ€æœ¯</strong></h3><h4 id="_5-2-1-ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ " tabindex="-1"><a class="header-anchor" href="#_5-2-1-ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ " aria-hidden="true">#</a> <strong>5.2.1 ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ </strong></h4><p>é€šå¸¸è§†é¢‘æ–‡ä»¶éƒ½æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å¯¹äºåª’èµ„ç³»ç»Ÿä¸Šä¼ æ–‡ä»¶çš„éœ€æ±‚è¦æ»¡è¶³å¤§æ–‡ä»¶çš„ä¸Šä¼ è¦æ±‚ã€‚http åè®®æœ¬èº«å¯¹ä¸Šä¼ æ–‡ä»¶å¤§å°æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯å®¢æˆ·çš„ç½‘ç»œç¯å¢ƒè´¨é‡ã€ç”µè„‘ç¡¬ä»¶ç¯å¢ƒç­‰å‚å·®ä¸é½ï¼Œå¦‚æœä¸€ä¸ªå¤§æ–‡ä»¶å¿«ä¸Šä¼ å®Œäº†ç½‘æ–­äº†æ²¡æœ‰ä¸Šä¼ å®Œæˆï¼Œéœ€è¦å®¢æˆ·é‡æ–°ä¸Šä¼ ï¼Œç”¨æˆ·ä½“éªŒéå¸¸å·®ï¼Œæ‰€ä»¥å¯¹äºå¤§æ–‡ä»¶ä¸Šä¼ çš„è¦æ±‚æœ€åŸºæœ¬çš„æ˜¯æ–­ç‚¹ç»­ä¼ ã€‚</p><p>ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ ï¼š</p><p>å¼•ç”¨ç™¾åº¦ç™¾ç§‘ï¼šæ–­ç‚¹ç»­ä¼ æŒ‡çš„æ˜¯åœ¨ä¸‹è½½æˆ–ä¸Šä¼ æ—¶ï¼Œå°†ä¸‹è½½æˆ–ä¸Šä¼ ä»»åŠ¡ï¼ˆä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªå‹ç¼©åŒ…ï¼‰äººä¸ºçš„åˆ’åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†é‡‡ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œä¸Šä¼ æˆ–ä¸‹è½½ï¼Œå¦‚æœç¢°åˆ°ç½‘ç»œæ•…éšœï¼Œå¯ä»¥ä»å·²ç»ä¸Šä¼ æˆ–ä¸‹è½½çš„éƒ¨åˆ†å¼€å§‹ç»§ç»­ä¸Šä¼ ä¸‹è½½æœªå®Œæˆçš„éƒ¨åˆ†ï¼Œè€Œæ²¡æœ‰å¿…è¦ä»å¤´å¼€å§‹ä¸Šä¼ ä¸‹è½½ï¼Œæ–­ç‚¹ç»­ä¼ å¯ä»¥æé«˜èŠ‚çœæ“ä½œæ—¶é—´ï¼Œæé«˜ç”¨æˆ·ä½“éªŒæ€§ã€‚</p><p>æ–­ç‚¹ç»­ä¼ æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521175557288-d81e1e20.png" alt="image-20230521175557288"></p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€å‰ç«¯ä¸Šä¼ å‰å…ˆæŠŠæ–‡ä»¶åˆ†æˆå—</p><p>2ã€ä¸€å—ä¸€å—çš„ä¸Šä¼ ï¼Œä¸Šä¼ ä¸­æ–­åé‡æ–°ä¸Šä¼ ï¼Œå·²ä¸Šä¼ çš„åˆ†å—åˆ™ä¸ç”¨å†ä¸Šä¼ </p><p>3ã€å„åˆ†å—ä¸Šä¼ å®Œæˆæœ€ååœ¨æœåŠ¡ç«¯åˆå¹¶æ–‡ä»¶</p><h4 id="_5-2-2-åˆ†å—ä¸åˆå¹¶æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-2-2-åˆ†å—ä¸åˆå¹¶æµ‹è¯•" aria-hidden="true">#</a> <strong>5.2.2 åˆ†å—ä¸åˆå¹¶æµ‹è¯•</strong></h4><p>ä¸ºäº†æ›´å¥½çš„ç†è§£æ–‡ä»¶åˆ†å—ä¸Šä¼ çš„åŸç†ï¼Œä¸‹è¾¹ç”¨ java ä»£ç æµ‹è¯•æ–‡ä»¶çš„åˆ†å—ä¸åˆå¹¶ã€‚</p><p>æ–‡ä»¶åˆ†å—çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€è·å–æºæ–‡ä»¶é•¿åº¦</p><p>2ã€æ ¹æ®è®¾å®šçš„åˆ†å—æ–‡ä»¶çš„å¤§å°è®¡ç®—å‡ºå—æ•°</p><p>3ã€ä»æºæ–‡ä»¶è¯»æ•°æ®ä¾æ¬¡å‘æ¯ä¸€ä¸ªå—æ–‡ä»¶å†™æ•°æ®ã€‚</p><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>digest<span class="token punctuation">.</span></span><span class="token class-name">DigestUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">RandomAccessFile</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> å¤§æ–‡ä»¶å¤„ç†æµ‹è¯•
 * <span class="token keyword">@date</span> 2022/9/13 9:21
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BigFileTest</span> <span class="token punctuation">{</span>


    <span class="token comment">//æµ‹è¯•æ–‡ä»¶åˆ†å—æ–¹æ³•</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testChunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> sourceFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/develop/bigfile_test/nacos.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> chunkPath <span class="token operator">=</span> <span class="token string">&quot;d:/develop/bigfile_test/chunk/&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> chunkFolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>chunkPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>chunkFolder<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            chunkFolder<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//åˆ†å—å¤§å°</span>
        <span class="token keyword">long</span> chunkSize <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ†å—æ•°é‡</span>
        <span class="token keyword">long</span> chunkNum <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>sourceFile<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> chunkSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ†å—æ€»æ•°ï¼š&quot;</span><span class="token operator">+</span>chunkNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç¼“å†²åŒºå¤§å°</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//ä½¿ç”¨RandomAccessFileè®¿é—®æ–‡ä»¶</span>
        <span class="token class-name">RandomAccessFile</span> raf_read <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>sourceFile<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ†å—</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chunkNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//åˆ›å»ºåˆ†å—æ–‡ä»¶</span>
            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>chunkPath <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                file<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">boolean</span> newFile <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//å‘åˆ†å—æ–‡ä»¶ä¸­å†™æ•°æ®</span>
                <span class="token class-name">RandomAccessFile</span> raf_write <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> raf_read<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    raf_write<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> chunkSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                raf_write<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å®Œæˆåˆ†å—&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        raf_read<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–‡ä»¶åˆå¹¶æµç¨‹ï¼š</p><p>1ã€æ‰¾åˆ°è¦åˆå¹¶çš„æ–‡ä»¶å¹¶æŒ‰æ–‡ä»¶åˆå¹¶çš„å…ˆåè¿›è¡Œæ’åºã€‚</p><p>2ã€åˆ›å»ºåˆå¹¶æ–‡ä»¶</p><p>3ã€ä¾æ¬¡ä»åˆå¹¶çš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®å‘åˆå¹¶æ–‡ä»¶å†™å…¥æ•°</p><p>æ–‡ä»¶åˆå¹¶çš„æµ‹è¯•ä»£ç  ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//æµ‹è¯•æ–‡ä»¶åˆå¹¶æ–¹æ³•</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMerge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//å—æ–‡ä»¶ç›®å½•</span>
        <span class="token class-name">File</span> chunkFolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/develop/bigfile_test/chunk/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åŸå§‹æ–‡ä»¶</span>
        <span class="token class-name">File</span> originalFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/develop/bigfile_test/nacos.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆå¹¶æ–‡ä»¶</span>
        <span class="token class-name">File</span> mergeFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/develop/bigfile_test/nacos01.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mergeFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mergeFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//åˆ›å»ºæ–°çš„åˆå¹¶æ–‡ä»¶</span>
        mergeFile<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç”¨äºå†™æ–‡ä»¶</span>
        <span class="token class-name">RandomAccessFile</span> raf_write <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>mergeFile<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æŒ‡é’ˆæŒ‡å‘æ–‡ä»¶é¡¶ç«¯</span>
        raf_write<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç¼“å†²åŒº</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ†å—åˆ—è¡¨</span>
        <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fileArray <span class="token operator">=</span> chunkFolder<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è½¬æˆé›†åˆï¼Œä¾¿äºæ’åº</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>fileArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä»å°åˆ°å¤§æ’åº</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>fileList<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">File</span> o1<span class="token punctuation">,</span> <span class="token class-name">File</span> o2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>o1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆå¹¶æ–‡ä»¶</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> chunkFile <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">RandomAccessFile</span> raf_read <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>chunkFile<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> raf_read<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                raf_write<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
            raf_read<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        raf_write<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ ¡éªŒæ–‡ä»¶</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span>

                <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>originalFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">FileInputStream</span> mergeFileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>mergeFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//å–å‡ºåŸå§‹æ–‡ä»¶çš„md5</span>
            <span class="token class-name">String</span> originalMd5 <span class="token operator">=</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å–å‡ºåˆå¹¶æ–‡ä»¶çš„md5è¿›è¡Œæ¯”è¾ƒ</span>
            <span class="token class-name">String</span> mergeFileMd5 <span class="token operator">=</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>mergeFileStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>originalMd5<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mergeFileMd5<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆå¹¶æ–‡ä»¶æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆå¹¶æ–‡ä»¶å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-3-è§†é¢‘ä¸Šä¼ æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_5-2-3-è§†é¢‘ä¸Šä¼ æµç¨‹" aria-hidden="true">#</a> <strong>5.2.3 è§†é¢‘ä¸Šä¼ æµç¨‹</strong></h4><p>ä¸‹å›¾æ˜¯ä¸Šä¼ è§†é¢‘çš„æ•´ä½“æµç¨‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521175658020-01a4dd98.png" alt="image-20230521175658020"></p><p>1ã€å‰ç«¯å¯¹æ–‡ä»¶è¿›è¡Œåˆ†å—ã€‚</p><p>2ã€å‰ç«¯ä¸Šä¼ åˆ†å—æ–‡ä»¶å‰è¯·æ±‚åª’èµ„æœåŠ¡æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™ä¸å†ä¸Šä¼ ã€‚</p><p>3ã€å¦‚æœåˆ†å—æ–‡ä»¶ä¸å­˜åœ¨åˆ™å‰ç«¯å¼€å§‹ä¸Šä¼ </p><p>4ã€å‰ç«¯è¯·æ±‚åª’èµ„æœåŠ¡ä¸Šä¼ åˆ†å—ã€‚</p><p>5ã€åª’èµ„æœåŠ¡å°†åˆ†å—ä¸Šä¼ è‡³ MinIOã€‚</p><p>6ã€å‰ç«¯å°†åˆ†å—ä¸Šä¼ å®Œæ¯•è¯·æ±‚åª’èµ„æœåŠ¡åˆå¹¶åˆ†å—ã€‚</p><p>7ã€åª’èµ„æœåŠ¡åˆ¤æ–­åˆ†å—ä¸Šä¼ å®Œæˆåˆ™è¯·æ±‚ MinIO åˆå¹¶æ–‡ä»¶ã€‚</p><p>8ã€åˆå¹¶å®Œæˆæ ¡éªŒåˆå¹¶åçš„æ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼Œå¦‚æœä¸å®Œæ•´åˆ™åˆ é™¤æ–‡ä»¶ã€‚</p><h4 id="_5-2-4-minio-åˆå¹¶æ–‡ä»¶æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-2-4-minio-åˆå¹¶æ–‡ä»¶æµ‹è¯•" aria-hidden="true">#</a> <strong>5.2.4 minio åˆå¹¶æ–‡ä»¶æµ‹è¯•</strong></h4><p>1ã€å°†åˆ†å—æ–‡ä»¶ä¸Šä¼ è‡³ minio</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//å°†åˆ†å—æ–‡ä»¶ä¸Šä¼ è‡³minio</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uploadChunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> chunkFolderPath <span class="token operator">=</span> <span class="token string">&quot;D:\\develop\\upload\\chunk\\&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> chunkFolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>chunkFolderPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆ†å—æ–‡ä»¶</span>
    <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> files <span class="token operator">=</span> chunkFolder<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å°†åˆ†å—æ–‡ä»¶ä¸Šä¼ è‡³minio</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">UploadObjectArgs</span> uploadObjectArgs <span class="token operator">=</span> <span class="token class-name">UploadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;testbucket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;chunk/&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            minioClient<span class="token punctuation">.</span><span class="token function">uploadObject</span><span class="token punctuation">(</span>uploadObjectArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ åˆ†å—æˆåŠŸ&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€é€šè¿‡ minio çš„åˆå¹¶æ–‡ä»¶</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//åˆå¹¶æ–‡ä»¶ï¼Œè¦æ±‚åˆ†å—æ–‡ä»¶æœ€å°5M</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_merge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComposeSource</span><span class="token punctuation">&gt;</span></span> sources <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token class-name">ComposeSource</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;testbucket&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;chunk/&quot;</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ComposeObjectArgs</span> composeObjectArgs <span class="token operator">=</span> <span class="token class-name">ComposeObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;testbucket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;merge01.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    minioClient<span class="token punctuation">.</span><span class="token function">composeObject</span><span class="token punctuation">(</span>composeObjectArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">//æ¸…é™¤åˆ†å—æ–‡ä»¶</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_removeObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//åˆå¹¶åˆ†å—å®Œæˆå°†åˆ†å—æ–‡ä»¶æ¸…é™¤</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DeleteObject</span><span class="token punctuation">&gt;</span></span> deleteObjects <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">DeleteObject</span><span class="token punctuation">(</span><span class="token string">&quot;chunk/&quot;</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">RemoveObjectsArgs</span> removeObjectsArgs <span class="token operator">=</span> <span class="token class-name">RemoveObjectsArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;testbucket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objects</span><span class="token punctuation">(</span>deleteObjects<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&lt;</span><span class="token class-name">DeleteError</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">removeObjects</span><span class="token punctuation">(</span>removeObjectsArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>r<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">DeleteError</span> deleteError <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            deleteError <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ minio åˆå¹¶æ–‡ä»¶æŠ¥é”™ï¼šjava.lang.IllegalArgumentException: source testbucket/chunk/0: size 1048576 must be greater than 5242880</p><p>minio åˆå¹¶æ–‡ä»¶é»˜è®¤åˆ†å—æœ€å° 5Mï¼Œæˆ‘ä»¬å°†åˆ†å—æ”¹ä¸º 5M å†æ¬¡æµ‹è¯•ã€‚</p><h3 id="_5-3-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_5-3-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>5.3 æ¥å£å®šä¹‰</strong></h3><p>æ ¹æ®ä¸Šä¼ è§†é¢‘æµç¨‹ï¼Œå®šä¹‰æ¥å£ï¼Œä¸å‰ç«¯çš„çº¦å®šæ˜¯æ“ä½œæˆåŠŸè¿”å›{code:0}å¦åˆ™è¿”å›{code:-1}</p><p>ä»è¯¾ç¨‹èµ„æ–™ä¸­æ‹·è´ RestResponse.java ç±»åˆ° base å·¥ç¨‹ä¸‹çš„ model åŒ…ä¸‹ã€‚</p><p>å®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>j256<span class="token punctuation">.</span>simplemagic<span class="token punctuation">.</span></span><span class="token class-name">ContentInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>j256<span class="token punctuation">.</span>simplemagic<span class="token punctuation">.</span></span><span class="token class-name">ContentInfoUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">RestResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">UploadFileParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MediaFileService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> å¤§æ–‡ä»¶ä¸Šä¼ æ¥å£
 * <span class="token keyword">@date</span> 2022/9/6 11:29
 */</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;å¤§æ–‡ä»¶ä¸Šä¼ æ¥å£&quot;</span><span class="token punctuation">,</span> tags <span class="token operator">=</span> <span class="token string">&quot;å¤§æ–‡ä»¶ä¸Šä¼ æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BigFilesController</span> <span class="token punctuation">{</span>



    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;æ–‡ä»¶ä¸Šä¼ å‰æ£€æŸ¥æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/checkfile&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkfile</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5
    <span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;åˆ†å—æ–‡ä»¶ä¸Šä¼ å‰çš„æ£€æµ‹&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/checkchunk&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkchunk</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span>
                                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;chunk&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;ä¸Šä¼ åˆ†å—æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/uploadchunk&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">uploadchunk</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span>
                                    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span>
                                    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;chunk&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;åˆå¹¶æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/mergechunks&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">mergechunks</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span>
                                    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileName&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span>
                                    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;chunkTotal&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> chunkTotal<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-ä¸Šä¼ åˆ†å—å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_5-4-ä¸Šä¼ åˆ†å—å¼€å‘" aria-hidden="true">#</a> <strong>5.4 ä¸Šä¼ åˆ†å—å¼€å‘</strong></h3><h4 id="_5-4-1-dao-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_5-4-1-dao-å¼€å‘" aria-hidden="true">#</a> <strong>5.4.1 DAO å¼€å‘</strong></h4><p>å‘åª’èµ„æ•°æ®åº“çš„æ–‡ä»¶è¡¨æ’å…¥è®°å½•ï¼Œä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ Mapper æ¥å£å³å¯æ»¡è¶³è¦æ±‚ã€‚</p><h4 id="_5-4-2-service-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_5-4-2-service-å¼€å‘" aria-hidden="true">#</a> <strong>5.4.2 Service å¼€å‘</strong></h4><h5 id="_5-4-2-1-æ£€æŸ¥æ–‡ä»¶å’Œåˆ†å—" tabindex="-1"><a class="header-anchor" href="#_5-4-2-1-æ£€æŸ¥æ–‡ä»¶å’Œåˆ†å—" aria-hidden="true">#</a> <strong>5.4.2.1 æ£€æŸ¥æ–‡ä»¶å’Œåˆ†å—</strong></h5><p>æ¥å£å®Œæˆè¿›è¡Œæ¥å£å®ç°ï¼Œé¦–å…ˆå®ç°æ£€æŸ¥æ–‡ä»¶æ–¹æ³•å’Œæ£€æŸ¥åˆ†å—æ–¹æ³•ã€‚</p><p>åœ¨ MediaFileService ä¸­å®šä¹‰ service æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
 * <span class="token keyword">@param</span> <span class="token parameter">fileMd5</span> æ–‡ä»¶çš„md5
 * <span class="token keyword">@return</span> com.xuecheng.base.model.RestResponse<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.lang.Boolean</span><span class="token punctuation">&gt;</span></span> falseä¸å­˜åœ¨ï¼Œtrueå­˜åœ¨
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/13 15:38
*/</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æ£€æŸ¥åˆ†å—æ˜¯å¦å­˜åœ¨
 * <span class="token keyword">@param</span> <span class="token parameter">fileMd5</span>  æ–‡ä»¶çš„md5
 * <span class="token keyword">@param</span> <span class="token parameter">chunkIndex</span>  åˆ†å—åºå·
 * <span class="token keyword">@return</span> com.xuecheng.base.model.RestResponse<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.lang.Boolean</span><span class="token punctuation">&gt;</span></span> falseä¸å­˜åœ¨ï¼Œtrueå­˜åœ¨
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/13 15:39
*/</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkChunk</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span> <span class="token keyword">int</span> chunkIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>service æ¥å£å®ç°æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æŸ¥è¯¢æ–‡ä»¶ä¿¡æ¯</span>
    <span class="token class-name">MediaFiles</span> mediaFiles <span class="token operator">=</span> mediaFilesMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mediaFiles <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ¡¶</span>
        <span class="token class-name">String</span> bucket <span class="token operator">=</span> mediaFiles<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å­˜å‚¨ç›®å½•</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span> mediaFiles<span class="token punctuation">.</span><span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ–‡ä»¶æµ</span>
        <span class="token class-name">InputStream</span> stream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            stream <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>
                    <span class="token class-name">GetObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>stream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ–‡ä»¶å·²å­˜åœ¨</span>
                <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ–‡ä»¶ä¸å­˜åœ¨</span>
    <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkChunk</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span> <span class="token keyword">int</span> chunkIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//å¾—åˆ°åˆ†å—æ–‡ä»¶ç›®å½•</span>
    <span class="token class-name">String</span> chunkFileFolderPath <span class="token operator">=</span> <span class="token function">getChunkFileFolderPath</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¾—åˆ°åˆ†å—æ–‡ä»¶çš„è·¯å¾„</span>
    <span class="token class-name">String</span> chunkFilePath <span class="token operator">=</span> chunkFileFolderPath <span class="token operator">+</span> chunkIndex<span class="token punctuation">;</span>

    <span class="token comment">//æ–‡ä»¶æµ</span>
    <span class="token class-name">InputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        fileInputStream <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>
                <span class="token class-name">GetObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span>bucket_videoFiles<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>chunkFilePath<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileInputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//åˆ†å—å·²å­˜åœ¨</span>
            <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token comment">//åˆ†å—æœªå­˜åœ¨</span>
    <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//å¾—åˆ°åˆ†å—æ–‡ä»¶çš„ç›®å½•</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getChunkFileFolderPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fileMd5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileMd5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileMd5 <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;chunk&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-4-2-2-ä¸Šä¼ åˆ†å—" tabindex="-1"><a class="header-anchor" href="#_5-4-2-2-ä¸Šä¼ åˆ†å—" aria-hidden="true">#</a> <strong>5.4.2.2 ä¸Šä¼ åˆ†å—</strong></h5><p>å®šä¹‰ service æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> ä¸Šä¼ åˆ†å—
 * <span class="token keyword">@param</span> <span class="token parameter">fileMd5</span>  æ–‡ä»¶md5
 * <span class="token keyword">@param</span> <span class="token parameter">chunk</span>  åˆ†å—åºå·
 * <span class="token keyword">@param</span> <span class="token parameter">bytes</span>  æ–‡ä»¶å­—èŠ‚
 * <span class="token keyword">@return</span> com.xuecheng.base.model.RestResponse
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/13 15:50
*/</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">uploadChunk</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span><span class="token keyword">int</span> chunk<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥å£å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">uploadChunk</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span> <span class="token keyword">int</span> chunk<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token comment">//å¾—åˆ°åˆ†å—æ–‡ä»¶çš„ç›®å½•è·¯å¾„</span>
    <span class="token class-name">String</span> chunkFileFolderPath <span class="token operator">=</span> <span class="token function">getChunkFileFolderPath</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¾—åˆ°åˆ†å—æ–‡ä»¶çš„è·¯å¾„</span>
    <span class="token class-name">String</span> chunkFilePath <span class="token operator">=</span> chunkFileFolderPath <span class="token operator">+</span> chunk<span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//å°†æ–‡ä»¶å­˜å‚¨è‡³minIO</span>
    <span class="token function">addMediaFilesToMinIO</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> bucket_videoFiles<span class="token punctuation">,</span>chunkFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ åˆ†å—æ–‡ä»¶:{},å¤±è´¥:{}&quot;</span><span class="token punctuation">,</span>chunkFilePath<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;ä¸Šä¼ åˆ†å—å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-4-2-3-ä¸Šä¼ åˆ†å—æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-4-2-3-ä¸Šä¼ åˆ†å—æµ‹è¯•" aria-hidden="true">#</a> <strong>5.4.2.3 ä¸Šä¼ åˆ†å—æµ‹è¯•</strong></h5><p>å®Œå–„æ¥å£å±‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;æ–‡ä»¶ä¸Šä¼ å‰æ£€æŸ¥æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/checkfile&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkfile</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5
<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mediaFileService<span class="token punctuation">.</span><span class="token function">checkFile</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;åˆ†å—æ–‡ä»¶ä¸Šä¼ å‰çš„æ£€æµ‹&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/checkchunk&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkchunk</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span>
                                        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;chunk&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mediaFileService<span class="token punctuation">.</span><span class="token function">checkChunk</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">,</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;ä¸Šä¼ åˆ†å—æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/uploadchunk&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">uploadchunk</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span>
                                <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span>
                                <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;chunk&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token comment">//åˆ›å»ºä¸´æ—¶æ–‡ä»¶</span>
    <span class="token class-name">File</span> tempFile <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span><span class="token string">&quot;minio&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¸Šä¼ çš„æ–‡ä»¶æ‹·è´åˆ°ä¸´æ—¶æ–‡ä»¶</span>
    file<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>tempFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶è·¯å¾„</span>
    <span class="token class-name">String</span> absolutePath <span class="token operator">=</span> tempFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> mediaFileService<span class="token punctuation">.</span><span class="token function">uploadChunk</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">,</span>chunk<span class="token punctuation">,</span>absolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨å‰ç«¯å·¥ç¨‹ï¼Œè¿›å…¥ä¸Šä¼ è§†é¢‘ç•Œé¢è¿›è¡Œå‰åç«¯è”è°ƒæµ‹è¯•ã€‚</p><p>å‰ç«¯å¯¹æ–‡ä»¶åˆ†å—çš„å¤§å°ä¸º 5MBï¼ŒSpringBoot web é»˜è®¤ä¸Šä¼ æ–‡ä»¶çš„å¤§å°é™åˆ¶ä¸º 1MBï¼Œè¿™é‡Œéœ€è¦åœ¨ media-api å·¥ç¨‹ä¿®æ”¹é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">multipart</span><span class="token punctuation">:</span>
      <span class="token key atrule">max-file-size</span><span class="token punctuation">:</span> 50MB
      <span class="token key atrule">max-request-size</span><span class="token punctuation">:</span> 50MB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>max-file-sizeï¼šå•ä¸ªæ–‡ä»¶çš„å¤§å°é™åˆ¶</p><p>Max-request-size: å•æ¬¡è¯·æ±‚çš„å¤§å°é™åˆ¶</p><h3 id="_5-5-åˆå¹¶åˆ†å—å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_5-5-åˆå¹¶åˆ†å—å¼€å‘" aria-hidden="true">#</a> <strong>5.5 åˆå¹¶åˆ†å—å¼€å‘</strong></h3><h4 id="_5-5-1-service-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_5-5-1-service-å¼€å‘" aria-hidden="true">#</a> <strong>5.5.1 service å¼€å‘</strong></h4><p>å®šä¹‰ service æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> åˆå¹¶åˆ†å—
 * <span class="token keyword">@param</span> <span class="token parameter">companyId</span>  æœºæ„id
 * <span class="token keyword">@param</span> <span class="token parameter">fileMd5</span>  æ–‡ä»¶md5
 * <span class="token keyword">@param</span> <span class="token parameter">chunkTotal</span> åˆ†å—æ€»å’Œ
 * <span class="token keyword">@param</span> <span class="token parameter">uploadFileParamsDto</span> æ–‡ä»¶ä¿¡æ¯
 * <span class="token keyword">@return</span> com.xuecheng.base.model.RestResponse
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/13 15:56
 */</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">mergechunks</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span><span class="token keyword">int</span> chunkTotal<span class="token punctuation">,</span><span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>service å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">mergechunks</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span> <span class="token keyword">int</span> chunkTotal<span class="token punctuation">,</span> <span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//=====è·å–åˆ†å—æ–‡ä»¶è·¯å¾„=====</span>
    <span class="token class-name">String</span> chunkFileFolderPath <span class="token operator">=</span> <span class="token function">getChunkFileFolderPath</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ç»„æˆå°†åˆ†å—æ–‡ä»¶è·¯å¾„ç»„æˆ List&lt;ComposeSource&gt;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComposeSource</span><span class="token punctuation">&gt;</span></span> sourceObjectList <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>chunkTotal<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token class-name">ComposeSource</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span>bucket_videoFiles<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>chunkFileFolderPath<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//=====åˆå¹¶=====</span>
    <span class="token comment">//æ–‡ä»¶åç§°</span>
    <span class="token class-name">String</span> fileName <span class="token operator">=</span> uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶æ‰©å±•å</span>
    <span class="token class-name">String</span> extName <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆå¹¶æ–‡ä»¶è·¯å¾„</span>
    <span class="token class-name">String</span> mergeFilePath <span class="token operator">=</span> <span class="token function">getFilePathByMd5</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">,</span> extName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//åˆå¹¶æ–‡ä»¶</span>
        <span class="token class-name">ObjectWriteResponse</span> response <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">composeObject</span><span class="token punctuation">(</span>
                <span class="token class-name">ComposeObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span>bucket_videoFiles<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>mergeFilePath<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span>sourceObjectList<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;åˆå¹¶æ–‡ä»¶æˆåŠŸ:{}&quot;</span><span class="token punctuation">,</span>mergeFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;åˆå¹¶æ–‡ä»¶å¤±è´¥,fileMd5:{},å¼‚å¸¸:{}&quot;</span><span class="token punctuation">,</span>fileMd5<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;åˆå¹¶æ–‡ä»¶å¤±è´¥ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ====éªŒè¯md5====</span>
    <span class="token class-name">File</span> minioFile <span class="token operator">=</span> <span class="token function">downloadFileFromMinIO</span><span class="token punctuation">(</span>bucket_videoFiles<span class="token punctuation">,</span>mergeFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>minioFile <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸‹è½½åˆå¹¶åæ–‡ä»¶å¤±è´¥,mergeFilePath:{}&quot;</span><span class="token punctuation">,</span>mergeFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¸‹è½½åˆå¹¶åæ–‡ä»¶å¤±è´¥ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> newFileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>minioFile<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//minioä¸Šæ–‡ä»¶çš„md5å€¼</span>
        <span class="token class-name">String</span> md5Hex <span class="token operator">=</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>newFileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ¯”è¾ƒmd5å€¼ï¼Œä¸ä¸€è‡´åˆ™è¯´æ˜æ–‡ä»¶ä¸å®Œæ•´</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fileMd5<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>md5Hex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;æ–‡ä»¶åˆå¹¶æ ¡éªŒå¤±è´¥ï¼Œæœ€ç»ˆä¸Šä¼ å¤±è´¥ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//æ–‡ä»¶å¤§å°</span>
        uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setFileSize</span><span class="token punctuation">(</span>minioFile<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ ¡éªŒæ–‡ä»¶å¤±è´¥,fileMd5:{},å¼‚å¸¸:{}&quot;</span><span class="token punctuation">,</span>fileMd5<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;æ–‡ä»¶åˆå¹¶æ ¡éªŒå¤±è´¥ï¼Œæœ€ç»ˆä¸Šä¼ å¤±è´¥ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>minioFile<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           minioFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//æ–‡ä»¶å…¥åº“</span>
    currentProxy<span class="token punctuation">.</span><span class="token function">addMediaFilesToDb</span><span class="token punctuation">(</span>companyId<span class="token punctuation">,</span>fileMd5<span class="token punctuation">,</span>uploadFileParamsDto<span class="token punctuation">,</span>bucket_videoFiles<span class="token punctuation">,</span>mergeFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//=====æ¸…é™¤åˆ†å—æ–‡ä»¶=====</span>
    <span class="token function">clearChunkFiles</span><span class="token punctuation">(</span>chunkFileFolderPath<span class="token punctuation">,</span>chunkTotal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * ä»minioä¸‹è½½æ–‡ä»¶
 * <span class="token keyword">@param</span> <span class="token parameter">bucket</span> æ¡¶
 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> å¯¹è±¡åç§°
 * <span class="token keyword">@return</span> ä¸‹è½½åçš„æ–‡ä»¶
 */</span>
<span class="token keyword">public</span> <span class="token class-name">File</span> <span class="token function">downloadFileFromMinIO</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucket<span class="token punctuation">,</span><span class="token class-name">String</span> objectName<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//ä¸´æ—¶æ–‡ä»¶</span>
    <span class="token class-name">File</span> minioFile <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">FileOutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token class-name">InputStream</span> stream <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">GetObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ›å»ºä¸´æ—¶æ–‡ä»¶</span>
        minioFile<span class="token operator">=</span><span class="token class-name">File</span><span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span><span class="token string">&quot;minio&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>minioFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> minioFile<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>outputStream<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
 * å¾—åˆ°åˆå¹¶åçš„æ–‡ä»¶çš„åœ°å€
 * <span class="token keyword">@param</span> <span class="token parameter">fileMd5</span> æ–‡ä»¶idå³md5å€¼
 * <span class="token keyword">@param</span> <span class="token parameter">fileExt</span> æ–‡ä»¶æ‰©å±•å
 * <span class="token keyword">@return</span>
 */</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getFilePathByMd5</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span><span class="token class-name">String</span> fileExt<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span>   fileMd5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileMd5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileMd5 <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span>fileMd5 <span class="token operator">+</span>fileExt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * æ¸…é™¤åˆ†å—æ–‡ä»¶
 * <span class="token keyword">@param</span> <span class="token parameter">chunkFileFolderPath</span> åˆ†å—æ–‡ä»¶è·¯å¾„
 * <span class="token keyword">@param</span> <span class="token parameter">chunkTotal</span> åˆ†å—æ–‡ä»¶æ€»æ•°
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">clearChunkFiles</span><span class="token punctuation">(</span><span class="token class-name">String</span> chunkFileFolderPath<span class="token punctuation">,</span><span class="token keyword">int</span> chunkTotal<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DeleteObject</span><span class="token punctuation">&gt;</span></span> deleteObjects <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>chunkTotal<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">DeleteObject</span><span class="token punctuation">(</span>chunkFileFolderPath<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">RemoveObjectsArgs</span> removeObjectsArgs <span class="token operator">=</span> <span class="token class-name">RemoveObjectsArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objects</span><span class="token punctuation">(</span>deleteObjects<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&lt;</span><span class="token class-name">DeleteError</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">removeObjects</span><span class="token punctuation">(</span>removeObjectsArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>r<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">DeleteError</span> deleteError <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                deleteError <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ¸…æ¥šåˆ†å—æ–‡ä»¶å¤±è´¥,objectname:{}&quot;</span><span class="token punctuation">,</span>deleteError<span class="token punctuation">.</span><span class="token function">objectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ¸…æ¥šåˆ†å—æ–‡ä»¶å¤±è´¥,chunkFileFolderPath:{}&quot;</span><span class="token punctuation">,</span>chunkFileFolderPath<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5.4.3 æ¥å£å±‚å®Œå–„</p><p>ä¸‹è¾¹å®Œå–„æ¥å£å±‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;æ–‡ä»¶ä¸Šä¼ å‰æ£€æŸ¥æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/checkfile&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkfile</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5
<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mediaFileService<span class="token punctuation">.</span><span class="token function">checkFile</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;åˆ†å—æ–‡ä»¶ä¸Šä¼ å‰çš„æ£€æµ‹&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/checkchunk&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">checkchunk</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span>
                                        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;chunk&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mediaFileService<span class="token punctuation">.</span><span class="token function">checkChunk</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">,</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;ä¸Šä¼ åˆ†å—æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/uploadchunk&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">uploadchunk</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span>
                                <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span>
                                <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;chunk&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> mediaFileService<span class="token punctuation">.</span><span class="token function">uploadChunk</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">,</span>chunk<span class="token punctuation">,</span>file<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;åˆå¹¶æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload/mergechunks&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span> <span class="token function">mergechunks</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileMd5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span>
                                <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileName&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span>
                                <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;chunkTotal&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> chunkTotal<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">Long</span> companyId <span class="token operator">=</span> <span class="token number">1232141425L</span><span class="token punctuation">;</span>

    <span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadFileParamsDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setFileType</span><span class="token punctuation">(</span><span class="token string">&quot;001002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setTags</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹è§†é¢‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadFileParamsDto<span class="token punctuation">.</span><span class="token function">setFilename</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> mediaFileService<span class="token punctuation">.</span><span class="token function">mergechunks</span><span class="token punctuation">(</span>companyId<span class="token punctuation">,</span>fileMd5<span class="token punctuation">,</span>chunkTotal<span class="token punctuation">,</span>uploadFileParamsDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-5-2-åˆå¹¶åˆ†å—æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-5-2-åˆå¹¶åˆ†å—æµ‹è¯•" aria-hidden="true">#</a> <strong>5.5.2 åˆå¹¶åˆ†å—æµ‹è¯•</strong></h4><p>ä¸‹è¾¹è¿›è¡Œå‰åç«¯è”è°ƒï¼š</p><p>1ã€ä¸Šä¼ ä¸€ä¸ªè§†é¢‘æµ‹è¯•åˆå¹¶åˆ†å—çš„æ‰§è¡Œé€»è¾‘</p><p>è¿›å…¥ service æ–¹æ³•é€è¡Œè·Ÿè¸ªã€‚</p><p>2ã€æ–­ç‚¹ç»­ä¼ æµ‹è¯•</p><p>ä¸Šä¼ ä¸€éƒ¨åˆ†åï¼Œåœæ­¢åˆ·æ–°æµè§ˆå™¨å†é‡æ–°ä¸Šä¼ ï¼Œé€šè¿‡æµè§ˆå™¨æ—¥å¿—å‘ç°å·²ç»ä¸Šä¼ è¿‡çš„åˆ†å—ä¸å†é‡æ–°ä¸Šä¼ </p><p><img src="/MyBlog/assets/image-20230521180052105-4469312c.png" alt="image-20230521180052105"></p><h3 id="_5-6-å…¶å®ƒé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_5-6-å…¶å®ƒé—®é¢˜" aria-hidden="true">#</a> <strong>5.6 å…¶å®ƒé—®é¢˜</strong></h3><h4 id="_5-6-1-åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_5-6-1-åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜" aria-hidden="true">#</a> <strong>5.6.1 åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜</strong></h4><p>ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œåˆ†å—ä¸Šä¼ ï¼Œä¸Šä¼ ä¸€åŠä¸ä¼ äº†ï¼Œä¹‹å‰ä¸Šä¼ åˆ° minio çš„åˆ†å—æ–‡ä»¶è¦æ¸…ç†å—ï¼Ÿæ€ä¹ˆåšçš„ï¼Ÿ</p><p>1ã€åœ¨æ•°æ®åº“ä¸­æœ‰ä¸€å¼ æ–‡ä»¶è¡¨è®°å½• minio ä¸­å­˜å‚¨çš„æ–‡ä»¶ä¿¡æ¯ã€‚</p><p>2ã€æ–‡ä»¶å¼€å§‹ä¸Šä¼ æ—¶ä¼šå†™å…¥æ–‡ä»¶è¡¨ï¼ŒçŠ¶æ€ä¸ºä¸Šä¼ ä¸­ï¼Œä¸Šä¼ å®Œæˆä¼šæ›´æ–°çŠ¶æ€ä¸ºä¸Šä¼ å®Œæˆã€‚</p><p>3ã€å½“ä¸€ä¸ªæ–‡ä»¶ä¼ äº†ä¸€åŠä¸å†ä¸Šä¼ äº†è¯´æ˜è¯¥æ–‡ä»¶æ²¡æœ‰ä¸Šä¼ å®Œæˆï¼Œä¼šæœ‰å®šæ—¶ä»»åŠ¡å»æŸ¥è¯¢æ–‡ä»¶è¡¨ä¸­çš„è®°å½•ï¼Œå¦‚æœæ–‡ä»¶æœªä¸Šä¼ å®Œæˆåˆ™åˆ é™¤ minio ä¸­æ²¡æœ‰ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶ç›®å½•ã€‚</p><h2 id="_7-è§†é¢‘å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7-è§†é¢‘å¤„ç†" aria-hidden="true">#</a> <strong>7 è§†é¢‘å¤„ç†</strong></h2><h3 id="_7-1-éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#_7-1-éœ€æ±‚" aria-hidden="true">#</a> <strong>7.1 éœ€æ±‚</strong></h3><h4 id="_7-1-1-æ€»ä½“éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#_7-1-1-æ€»ä½“éœ€æ±‚" aria-hidden="true">#</a> <strong>7.1.1 æ€»ä½“éœ€æ±‚</strong></h4><p>è§†é¢‘ä¸Šä¼ æˆåŠŸéœ€è¦å¯¹è§†é¢‘çš„æ ¼å¼è¿›è¡Œè½¬ç å¤„ç†ï¼Œæ¯”å¦‚ï¼šavi è½¬æˆ mp4ã€‚å¦‚ä½•ç”¨ Java ç¨‹åºå¯¹è§†é¢‘è¿›è¡Œå¤„ç†å‘¢ï¼Ÿå½“è§†é¢‘æ¯”è¾ƒå¤šçš„æ—¶å€™æˆ‘ä»¬å¦‚ä½•å¯ä»¥é«˜æ•ˆå¤„ç†ã€‚</p><p>åœ¨ä¸€äº›äº‘å¹³å°ä¸Šå¯¹è±¡å­˜å‚¨äº§å“å°±å…·æœ‰æ–‡ä»¶å¤„ç†çš„åŠŸèƒ½ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521180100640-0632437c.png" alt="image-20230521180100640"></p><p><img src="/MyBlog/assets/image-20230521180105909-e9016b77.png" alt="image-20230521180105909"></p><p>æ‰€ä»¥ä¸€èˆ¬åšæ–‡ä»¶å­˜å‚¨çš„æœåŠ¡éƒ½éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚å¯¹è§†é¢‘è¿›è¡Œè½¬ç å¤„ç†ï¼Œå¯èƒ½ç”±äºæ–‡ä»¶é‡è¾ƒå¤§éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ç­‰æŠ€æœ¯è¿›è¡Œé«˜æ•ˆå¤„ç†ã€‚</p><h4 id="_7-7-2-ä»€ä¹ˆæ˜¯è§†é¢‘ç¼–ç " tabindex="-1"><a class="header-anchor" href="#_7-7-2-ä»€ä¹ˆæ˜¯è§†é¢‘ç¼–ç " aria-hidden="true">#</a> <strong>7.7.2 ä»€ä¹ˆæ˜¯è§†é¢‘ç¼–ç </strong></h4><p>è§†é¢‘ä¸Šä¼ æˆåŠŸåéœ€è¦å¯¹è§†é¢‘è¿›è¡Œè½¬ç å¤„ç†ã€‚</p><p>ä»€ä¹ˆæ˜¯è§†é¢‘ç¼–ç ï¼ŸæŸ¥é˜…ç™¾åº¦ç™¾ç§‘å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521180115190-70c7ca06.png" alt="image-20230521180115190"></p><p>è¯¦æƒ…å‚è€ƒ ï¼š<a href="https://baike.baidu.com/item/%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81/839038" target="_blank" rel="noopener noreferrer">https://baike.baidu.com/item/è§†é¢‘ç¼–ç /839038<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>é¦–å…ˆæˆ‘ä»¬è¦åˆ†æ¸…æ–‡ä»¶æ ¼å¼å’Œç¼–ç æ ¼å¼ï¼š</p><p>æ–‡ä»¶æ ¼å¼ï¼šæ˜¯æŒ‡.mp4ã€.aviã€.rmvb ç­‰ è¿™äº›ä¸åŒæ‰©å±•åçš„è§†é¢‘æ–‡ä»¶çš„æ–‡ä»¶æ ¼å¼ ï¼Œè§†é¢‘æ–‡ä»¶çš„å†…å®¹ä¸»è¦åŒ…æ‹¬è§†é¢‘å’ŒéŸ³é¢‘ï¼Œå…¶æ–‡ä»¶æ ¼å¼æ˜¯æŒ‰ç…§ä¸€ å®šçš„ç¼–ç æ ¼å¼å»ç¼–ç ï¼Œå¹¶ä¸”æŒ‰ç…§è¯¥æ–‡ä»¶æ‰€è§„å®šçš„å°è£…æ ¼å¼å°†è§†é¢‘ã€éŸ³é¢‘ã€å­—å¹•ç­‰ä¿¡æ¯å°è£…åœ¨ä¸€èµ·ï¼Œæ’­æ”¾å™¨ä¼šæ ¹æ®å®ƒä»¬çš„å°è£…æ ¼å¼å»æå–å‡ºç¼–ç ï¼Œç„¶åç”±æ’­æ”¾å™¨è§£ç ï¼Œæœ€ç»ˆæ’­æ”¾éŸ³è§†é¢‘ã€‚</p><p>éŸ³è§†é¢‘ç¼–ç æ ¼å¼ï¼šé€šè¿‡éŸ³è§†é¢‘çš„å‹ç¼©æŠ€æœ¯ï¼Œå°†è§†é¢‘æ ¼å¼è½¬æ¢æˆå¦ä¸€ç§è§†é¢‘æ ¼å¼ï¼Œé€šè¿‡è§†é¢‘ç¼–ç å®ç°æµåª’ä½“çš„ä¼ è¾“ã€‚æ¯”å¦‚ï¼šä¸€ä¸ª.avi çš„è§†é¢‘æ–‡ä»¶åŸæ¥çš„ç¼–ç æ˜¯ aï¼Œé€šè¿‡ç¼–ç åç¼–ç æ ¼å¼å˜ä¸º bï¼ŒéŸ³é¢‘åŸæ¥ä¸º cï¼Œé€šè¿‡ç¼–ç åå˜ä¸º dã€‚</p><p>éŸ³è§†é¢‘ç¼–ç æ ¼å¼å„ç±»ç¹å¤šï¼Œä¸»è¦æœ‰å‡ ä¸‹å‡ ç±»ï¼š</p><p>MPEG ç³»åˆ—</p><p>ï¼ˆç”± ISO[å›½é™…æ ‡å‡†ç»„ç»‡æœºæ„]ä¸‹å±çš„ MPEG[è¿åŠ¨å›¾è±¡ä¸“å®¶ç»„]å¼€å‘ ï¼‰è§†é¢‘ç¼–ç æ–¹é¢ä¸»è¦æ˜¯ Mpeg1ï¼ˆvcd ç”¨çš„å°±æ˜¯å®ƒï¼‰ã€Mpeg2ï¼ˆDVD ä½¿ç”¨ï¼‰ã€Mpeg4ï¼ˆçš„ DVDRIP ä½¿ç”¨çš„éƒ½æ˜¯å®ƒçš„å˜ç§ï¼Œå¦‚ï¼šdivxï¼Œxvid ç­‰ï¼‰ã€Mpeg4 AVCï¼ˆæ­£çƒ­é—¨ï¼‰ï¼›éŸ³é¢‘ç¼–ç æ–¹é¢ä¸»è¦æ˜¯ MPEG Audio Layer 1/2ã€MPEG Audio Layer 3ï¼ˆå¤§åé¼é¼çš„ mp3ï¼‰ã€MPEG-2 AAC ã€MPEG-4 AAC ç­‰ç­‰ã€‚æ³¨æ„ï¼šDVD éŸ³é¢‘æ²¡æœ‰é‡‡ç”¨ Mpeg çš„ã€‚</p><p>H.26X ç³»åˆ—</p><p>ï¼ˆç”± ITU[å›½é™…ç”µä¼ è§†è®¯è”ç›Ÿ]ä¸»å¯¼ï¼Œä¾§é‡ç½‘ç»œä¼ è¾“ï¼Œæ³¨æ„ï¼šåªæ˜¯è§†é¢‘ç¼–ç ï¼‰</p><p>åŒ…æ‹¬ H.261ã€H.262ã€H.263ã€H.263+ã€H.263++ã€H.264ï¼ˆå°±æ˜¯ MPEG4 AVC-åˆä½œçš„ç»“æ™¶ï¼‰</p><p>ç›®å‰æœ€å¸¸ç”¨çš„ç¼–ç æ ‡å‡†æ˜¯è§†é¢‘ H.264ï¼ŒéŸ³é¢‘ AACã€‚</p><p>æé—®ï¼š</p><p>H.264 æ˜¯ç¼–ç æ ¼å¼è¿˜æ˜¯æ–‡ä»¶æ ¼å¼ï¼Ÿ</p><p>mp4 æ˜¯ç¼–ç æ ¼å¼è¿˜æ˜¯æ–‡ä»¶æ ¼å¼ï¼Ÿ</p><h4 id="_7-7-3-ffmpeg-çš„åŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_7-7-3-ffmpeg-çš„åŸºæœ¬ä½¿ç”¨" aria-hidden="true">#</a> <strong>7.7.3 FFmpeg çš„åŸºæœ¬ä½¿ç”¨</strong></h4><p><strong>æµåª’ä½“ç¨‹åºå‘˜</strong></p><p>æˆ‘ä»¬å°†è§†é¢‘å½•åˆ¶å®Œæˆåï¼Œä½¿ç”¨è§†é¢‘ç¼–ç è½¯ä»¶å¯¹è§†é¢‘è¿›è¡Œç¼–ç ï¼Œæœ¬é¡¹ç›® ä½¿ç”¨ FFmpeg å¯¹è§†é¢‘è¿›è¡Œç¼–ç  ã€‚</p><p><img src="/MyBlog/assets/image-20230521180125862-2b50e3ec.png" alt="image-20230521180125862"></p><p>FFmpeg è¢«è®¸å¤šå¼€æºé¡¹ç›®é‡‡ç”¨ï¼ŒQQ å½±éŸ³ã€æš´é£å½±éŸ³ã€VLC ç­‰ã€‚</p><p>ä¸‹è½½ï¼šFFmpeg <a href="https://www.ffmpeg.org/download.html#build-windows" target="_blank" rel="noopener noreferrer">https://www.ffmpeg.org/download.html#build-windows<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>è¯·ä»è¯¾ç¨‹èµ„æ–™ç›®å½•è§£å‹ ffmpeg.zip,å¹¶å°†è§£å‹å¾—åˆ°çš„ exe æ–‡ä»¶åŠ å…¥ç¯å¢ƒå˜é‡ã€‚</p><p>æµ‹è¯•æ˜¯å¦æ­£å¸¸ï¼šcmd è¿è¡Œ ffmpeg -v</p><p><img src="/MyBlog/assets/image-20230521180131520-020c8b94.png" alt="image-20230521180131520"></p><p>å®‰è£…æˆåŠŸï¼Œä½œä¸‹ç®€å•æµ‹è¯•</p><p>å°†ä¸€ä¸ª.avi æ–‡ä»¶è½¬æˆ mp4ã€mp3ã€gif ç­‰ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å°† nacos.avi æ–‡ä»¶è½¬æˆ mp4ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><p>D:\soft\ffmpeg\ffmpeg.exe -i 1.avi 1.mp4</p><p>å¯ä»¥å°† ffmpeg.exe é…ç½®åˆ°ç¯å¢ƒå˜é‡ path ä¸­ï¼Œè¿›å…¥è§†é¢‘ç›®å½•ç›´æ¥è¿è¡Œï¼šffmpeg.exe -i 1.avi 1.mp4</p><p>è½¬æˆ mp3ï¼šffmpeg -i nacos.avi nacos.mp3</p><p>è½¬æˆ gifï¼šffmpeg -i nacos.avi nacos.gif</p><p>å®˜æ–¹æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰ï¼š<a href="http://ffmpeg.org/ffmpeg.html" target="_blank" rel="noopener noreferrer">http://ffmpeg.org/ffmpeg.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_7-7-4-è§†é¢‘å¤„ç†å·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#_7-7-4-è§†é¢‘å¤„ç†å·¥å…·ç±»" aria-hidden="true">#</a> <strong>7.7.4 è§†é¢‘å¤„ç†å·¥å…·ç±»</strong></h4><p>å°†è¯¾ç¨‹èµ„æ–™ç›®å½•ä¸­çš„ util.zip è§£å‹ï¼Œå°†è§£å‹å‡ºçš„å·¥å…·ç±»æ‹·è´è‡³ base å·¥ç¨‹ã€‚</p><p><img src="/MyBlog/assets/image-20230521180142400-4e12ad4c.png" alt="image-20230521180142400"></p><p>å…¶ä¸­ Mp4VideoUtil ç±»æ˜¯ç”¨äºå°†è§†é¢‘è½¬ä¸º mp4 æ ¼å¼ï¼Œæ˜¯æˆ‘ä»¬é¡¹ç›®è¦ä½¿ç”¨çš„å·¥å…·ç±»ã€‚</p><p>ä¸‹è¾¹çœ‹ä¸‹è¿™ä¸ªç±»çš„ä»£ç ï¼Œå¹¶è¿›è¡Œæµ‹è¯•ã€‚</p><p>æˆ‘ä»¬è¦é€šè¿‡ ffmpeg å¯¹è§†é¢‘è½¬ç ï¼ŒJava ç¨‹åºè°ƒç”¨ ffmpegï¼Œä½¿ç”¨ java.lang.ProcessBuilder å»å®Œæˆï¼Œå…·ä½“åœ¨ Mp4VideoUtil ç±»çš„ 63 è¡Œï¼Œä¸‹è¾¹è¿›è¡Œç®€å•çš„æµ‹è¯•ï¼Œä¸‹è¾¹çš„ä»£ç è¿è¡Œæœ¬æœºå®‰è£…çš„ QQ è½¯ä»¶ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ProcessBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\Program Files (x86)\\Tencent\\QQ\\Bin\\QQScLauncher.exe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//å°†æ ‡å‡†è¾“å…¥æµå’Œé”™è¯¯è¾“å…¥æµåˆå¹¶ï¼Œé€šè¿‡æ ‡å‡†è¾“å…¥æµç¨‹è¯»å–ä¿¡æ¯</span>
builder<span class="token punctuation">.</span><span class="token function">redirectErrorStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Process</span> p <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹ Mp4VideoUtil ç±»éœ€è¦å­¦ä¹ ä½¿ç”¨æ–¹æ³•ï¼Œä¸‹è¾¹ä»£ç å°†ä¸€ä¸ª avi è§†é¢‘è½¬ä¸º mp4 è§†é¢‘ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//ffmpegçš„è·¯å¾„</span>
    <span class="token class-name">String</span> ffmpeg_path <span class="token operator">=</span> <span class="token string">&quot;D:\\soft\\ffmpeg\\ffmpeg.exe&quot;</span><span class="token punctuation">;</span><span class="token comment">//ffmpegçš„å®‰è£…ä½ç½®</span>
    <span class="token comment">//æºaviè§†é¢‘çš„è·¯å¾„</span>
    <span class="token class-name">String</span> video_path <span class="token operator">=</span> <span class="token string">&quot;D:\\develop\\bigfile_test\\nacos01.avi&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//è½¬æ¢åmp4æ–‡ä»¶çš„åç§°</span>
    <span class="token class-name">String</span> mp4_name <span class="token operator">=</span> <span class="token string">&quot;nacos01.mp4&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//è½¬æ¢åmp4æ–‡ä»¶çš„è·¯å¾„</span>
    <span class="token class-name">String</span> mp4_path <span class="token operator">=</span> <span class="token string">&quot;D:\\develop\\bigfile_test\\nacos01.mp4&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆ›å»ºå·¥å…·ç±»å¯¹è±¡</span>
    <span class="token class-name">Mp4VideoUtil</span> videoUtil <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mp4VideoUtil</span><span class="token punctuation">(</span>ffmpeg_path<span class="token punctuation">,</span>video_path<span class="token punctuation">,</span>mp4_name<span class="token punctuation">,</span>mp4_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¼€å§‹è§†é¢‘è½¬æ¢ï¼ŒæˆåŠŸå°†è¿”å›success</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> videoUtil<span class="token punctuation">.</span><span class="token function">generateMp4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ main æ–¹æ³•ï¼Œæœ€ç»ˆåœ¨æ§åˆ¶å°è¾“å‡º success è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸã€‚</p><h3 id="_7-2-åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7-2-åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†" aria-hidden="true">#</a> <strong>7.2 åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†</strong></h3><h4 id="_7-2-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#_7-2-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦" aria-hidden="true">#</a> <strong>7.2.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</strong></h4><p>å¦‚ä½•å»é«˜æ•ˆå¤„ç†ä¸€æ‰¹ä»»åŠ¡å‘¢ï¼Ÿ</p><p>1ã€å¤šçº¿ç¨‹</p><p>å¤šçº¿ç¨‹æ˜¯å……åˆ†åˆ©ç”¨å•æœºçš„èµ„æºã€‚</p><p>2ã€åˆ†å¸ƒå¼åŠ å¤šçº¿ç¨‹</p><p>å……åˆ†åˆ©ç”¨å¤šå°è®¡ç®—æœºï¼Œæ¯å°è®¡ç®—æœºä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†ã€‚</p><p>æ–¹æ¡ˆ 2 å¯æ‰©å±•æ€§æ›´å¼ºã€‚</p><p>æ–¹æ¡ˆ 2 æ˜¯ä¸€ç§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦çš„å¤„ç†æ–¹æ¡ˆã€‚</p><p>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹ä¸‹é¢ä¸šåŠ¡åœºæ™¯çš„è§£å†³æ–¹æ¡ˆï¼š</p><p>æ¯éš” 24 å°æ—¶æ‰§è¡Œæ•°æ®å¤‡ä»½ä»»åŠ¡ã€‚</p><p>12306 ç½‘ç«™ä¼šæ ¹æ®è½¦æ¬¡ä¸åŒï¼Œè®¾ç½®å‡ ä¸ªæ—¶é—´ç‚¹åˆ†æ‰¹æ¬¡æ”¾ç¥¨ã€‚</p><p>æŸè´¢åŠ¡ç³»ç»Ÿéœ€è¦åœ¨æ¯å¤©ä¸Šåˆ 10 ç‚¹å‰ç»“ç®—å‰ä¸€å¤©çš„è´¦å•æ•°æ®ï¼Œç»Ÿè®¡æ±‡æ€»ã€‚</p><p>å•†å“æˆåŠŸå‘è´§åï¼Œéœ€è¦å‘å®¢æˆ·å‘é€çŸ­ä¿¡æé†’ã€‚</p><p>ç±»ä¼¼çš„åœºæ™¯è¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å®ç°ï¼Ÿ</p><p><strong>å¤šçº¿ç¨‹æ–¹å¼å®ç°ï¼š</strong></p><p>å­¦è¿‡å¤šçº¿ç¨‹çš„åŒå­¦ï¼Œå¯èƒ½ä¼šæƒ³åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯ sleep ä¸€æ®µæ—¶é—´ï¼Œå°±å»æ£€æŸ¥æ˜¯å¦å·²åˆ°é¢„æœŸæ‰§è¡Œæ—¶é—´ã€‚</p><p>ä»¥ä¸‹ä»£ç ç®€å•å®ç°äº†ä»»åŠ¡è°ƒåº¦çš„åŠŸèƒ½ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´</span>
    <span class="token keyword">final</span> <span class="token keyword">long</span> timeInterval <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//TODOï¼šsomething</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç å®ç°äº†æŒ‰ä¸€å®šçš„é—´éš”æ—¶é—´æ‰§è¡Œä»»åŠ¡è°ƒåº¦çš„åŠŸèƒ½ã€‚</p><p>Jdk ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†ç›¸å…³æ”¯æŒï¼Œå¦‚ Timerã€ScheduledExecutorï¼Œä¸‹è¾¹æˆ‘ä»¬äº†è§£ä¸‹ã€‚</p><p><strong>Timer æ–¹å¼å®ç°</strong>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    timer<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TimerTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//TODOï¼šsomething</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//1ç§’åå¼€å§‹è°ƒåº¦ï¼Œæ¯2ç§’æ‰§è¡Œä¸€æ¬¡</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Timer çš„ä¼˜ç‚¹åœ¨äºç®€å•æ˜“ç”¨ï¼Œæ¯ä¸ª Timer å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œå› æ­¤å¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ª Timer å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼ŒåŒä¸€ä¸ª Timer ä¸­çš„ä»»åŠ¡æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚</p><p><strong>ScheduledExecutor æ–¹å¼å®ç°</strong>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> agrs<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ScheduledExecutorService</span> service <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//TODOï¼šsomething</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;todo something&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Java 5 æ¨å‡ºäº†åŸºäºçº¿ç¨‹æ± è®¾è®¡çš„ ScheduledExecutorï¼Œå…¶è®¾è®¡æ€æƒ³æ˜¯ï¼Œæ¯ä¸€ä¸ªè¢«è°ƒåº¦çš„ä»»åŠ¡éƒ½ä¼šç”±çº¿ç¨‹æ± ä¸­ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œï¼Œå› æ­¤ä»»åŠ¡æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šå—åˆ°å¹²æ‰°ã€‚</p><p>Timer å’Œ ScheduledExecutor éƒ½ä»…èƒ½æä¾›åŸºäºå¼€å§‹æ—¶é—´ä¸é‡å¤é—´éš”çš„ä»»åŠ¡è°ƒåº¦ï¼Œä¸èƒ½èƒœä»»æ›´åŠ å¤æ‚çš„è°ƒåº¦éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œè®¾ç½®æ¯æœˆç¬¬ä¸€å¤©å‡Œæ™¨ 1 ç‚¹æ‰§è¡Œä»»åŠ¡ã€å¤æ‚è°ƒåº¦ä»»åŠ¡çš„ç®¡ç†ã€ä»»åŠ¡é—´ä¼ é€’æ•°æ®ç­‰ç­‰ã€‚</p><p><strong>ç¬¬ä¸‰æ–¹ Quartz æ–¹å¼å®ç°ï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/quartz-scheduler/quartz</strong></p><p>Quartz æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå®ƒå¯ä»¥æ»¡è¶³æ›´å¤šæ›´å¤æ‚çš„è°ƒåº¦éœ€æ±‚ï¼ŒQuartz è®¾è®¡çš„æ ¸å¿ƒç±»åŒ…æ‹¬ Scheduler, Job ä»¥åŠ Triggerã€‚å…¶ä¸­ï¼ŒJob è´Ÿè´£å®šä¹‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒTrigger è´Ÿè´£è®¾ç½®è°ƒåº¦ç­–ç•¥ï¼ŒScheduler å°†äºŒè€…ç»„è£…åœ¨ä¸€èµ·ï¼Œå¹¶è§¦å‘ä»»åŠ¡å¼€å§‹æ‰§è¡Œã€‚Quartz æ”¯æŒç®€å•çš„æŒ‰æ—¶é—´é—´éš”è°ƒåº¦ã€è¿˜æ”¯æŒæŒ‰æ—¥å†è°ƒåº¦æ–¹å¼ï¼Œé€šè¿‡è®¾ç½® CronTrigger è¡¨è¾¾å¼ï¼ˆåŒ…æ‹¬ï¼šç§’ã€åˆ†ã€æ—¶ã€æ—¥ã€æœˆã€å‘¨ã€å¹´ï¼‰è¿›è¡Œä»»åŠ¡è°ƒåº¦ã€‚</p><p>ä¸‹è¾¹æ˜¯ä¸€ä¸ªä¾‹å­ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> agrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">{</span>
    <span class="token comment">//åˆ›å»ºä¸€ä¸ªScheduler</span>
    <span class="token class-name">SchedulerFactory</span> schedulerFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> schedulerFactory<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆ›å»ºJobDetail</span>
    <span class="token class-name">JobBuilder</span> jobDetailBuilder <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">MyJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jobDetailBuilder<span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;jobName&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jobGroupName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> jobDetailBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆ›å»ºè§¦å‘çš„CronTrigger æ”¯æŒæŒ‰æ—¥å†è°ƒåº¦</span>
        <span class="token class-name">CronTrigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;triggerName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;triggerGroupName&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span><span class="token string">&quot;0/2 * * * * ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span>trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> jobExecutionContext<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;todo something&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä»¥ä¸Šå†…å®¹æˆ‘ä»¬å­¦ä¹ äº†ä»€ä¹ˆæ˜¯ä»»åŠ¡è°ƒåº¦ï¼Œä»»åŠ¡è°ƒåº¦æ‰€è§£å†³çš„é—®é¢˜ï¼Œä»¥åŠä»»åŠ¡è°ƒåº¦çš„å¤šç§å®ç°æ–¹å¼ã€‚</p><p><strong>ä»»åŠ¡è°ƒåº¦é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯¹ä»»åŠ¡çš„è°ƒåº¦ï¼Œå®ƒæ˜¯æŒ‡ç³»ç»Ÿä¸ºäº†å®Œæˆç‰¹å®šä¸šåŠ¡ï¼ŒåŸºäºç»™å®šæ—¶é—´ç‚¹ï¼Œç»™å®šæ—¶é—´é—´éš”æˆ–è€…ç»™å®šæ‰§è¡Œæ¬¡æ•°è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚</strong></p><p><strong>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼Ÿ</strong></p><p>é€šå¸¸ä»»åŠ¡è°ƒåº¦çš„ç¨‹åºæ˜¯é›†æˆåœ¨åº”ç”¨ä¸­çš„ï¼Œæ¯”å¦‚ï¼šä¼˜æƒ å·æœåŠ¡ä¸­åŒ…æ‹¬äº†å®šæ—¶å‘æ”¾ä¼˜æƒ å·çš„çš„è°ƒåº¦ç¨‹åºï¼Œç»“ç®—æœåŠ¡ä¸­åŒ…æ‹¬äº†å®šæœŸç”ŸæˆæŠ¥è¡¨çš„ä»»åŠ¡è°ƒåº¦ç¨‹åºï¼Œç”±äºé‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œä¸€ä¸ªæœåŠ¡å¾€å¾€ä¼šéƒ¨ç½²å¤šä¸ªå†—ä½™å®ä¾‹æ¥è¿è¡Œæˆ‘ä»¬çš„ä¸šåŠ¡ï¼Œåœ¨è¿™ç§åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹è¿è¡Œä»»åŠ¡è°ƒåº¦ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521180334738-fe4d68f3.png" alt="image-20230521180334738"></p><p><strong>åˆ†å¸ƒå¼è°ƒåº¦è¦å®ç°çš„ç›®æ ‡ï¼š</strong></p><p>ä¸ç®¡æ˜¯ä»»åŠ¡è°ƒåº¦ç¨‹åºé›†æˆåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œè¿˜æ˜¯å•ç‹¬æ„å»ºçš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œå¦‚æœé‡‡ç”¨åˆ†å¸ƒå¼è°ƒåº¦ä»»åŠ¡çš„æ–¹å¼å°±ç›¸å½“äºå°†ä»»åŠ¡è°ƒåº¦ç¨‹åºåˆ†å¸ƒå¼æ„å»ºï¼Œè¿™æ ·å°±å¯ä»¥å…·æœ‰åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç‰¹ç‚¹ï¼Œå¹¶ä¸”æé«˜ä»»åŠ¡çš„è°ƒåº¦å¤„ç†èƒ½åŠ›ï¼š</p><p>1ã€å¹¶è¡Œä»»åŠ¡è°ƒåº¦</p><p>å¹¶è¡Œä»»åŠ¡è°ƒåº¦å®ç°é å¤šçº¿ç¨‹ï¼Œå¦‚æœæœ‰å¤§é‡ä»»åŠ¡éœ€è¦è°ƒåº¦ï¼Œæ­¤æ—¶å…‰é å¤šçº¿ç¨‹å°±ä¼šæœ‰ç“¶é¢ˆäº†ï¼Œå› ä¸ºä¸€å°è®¡ç®—æœº CPU çš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚</p><p>å¦‚æœå°†ä»»åŠ¡è°ƒåº¦ç¨‹åºåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œæ¯ä¸ªç»“ç‚¹è¿˜å¯ä»¥éƒ¨ç½²ä¸ºé›†ç¾¤ï¼Œè¿™æ ·å°±å¯ä»¥è®©å¤šå°è®¡ç®—æœºå…±åŒå»å®Œæˆä»»åŠ¡è°ƒåº¦ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»åŠ¡åˆ†å‰²ä¸ºè‹¥å¹²ä¸ªåˆ†ç‰‡ï¼Œç”±ä¸åŒçš„å®ä¾‹å¹¶è¡Œæ‰§è¡Œï¼Œæ¥æé«˜ä»»åŠ¡è°ƒåº¦çš„å¤„ç†æ•ˆç‡ã€‚</p><p>2ã€é«˜å¯ç”¨</p><p>è‹¥æŸä¸€ä¸ªå®ä¾‹å®•æœºï¼Œä¸å½±å“å…¶ä»–å®ä¾‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p><p>3ã€å¼¹æ€§æ‰©å®¹</p><p>å½“é›†ç¾¤ä¸­å¢åŠ å®ä¾‹å°±å¯ä»¥æé«˜å¹¶æ‰§è¡Œä»»åŠ¡çš„å¤„ç†æ•ˆç‡ã€‚</p><p>4ã€ä»»åŠ¡ç®¡ç†ä¸ç›‘æµ‹</p><p>å¯¹ç³»ç»Ÿä¸­å­˜åœ¨çš„æ‰€æœ‰å®šæ—¶ä»»åŠ¡è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†åŠç›‘æµ‹ã€‚è®©å¼€å‘äººå‘˜åŠè¿ç»´äººå‘˜èƒ½å¤Ÿæ—¶åˆ»äº†è§£ä»»åŠ¡æ‰§è¡Œæƒ…å†µï¼Œä»è€Œåšå‡ºå¿«é€Ÿçš„åº”æ€¥å¤„ç†å“åº”ã€‚</p><p>5ã€é¿å…ä»»åŠ¡é‡å¤æ‰§è¡Œ</p><p>å½“ä»»åŠ¡è°ƒåº¦ä»¥é›†ç¾¤æ–¹å¼éƒ¨ç½²ï¼ŒåŒä¸€ä¸ªä»»åŠ¡è°ƒåº¦å¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œæ¯”å¦‚åœ¨ä¸Šé¢æåˆ°çš„ç”µå•†ç³»ç»Ÿä¸­åˆ°ç‚¹å‘ä¼˜æƒ åˆ¸çš„ä¾‹å­ï¼Œå°±ä¼šå‘æ”¾å¤šæ¬¡ä¼˜æƒ åˆ¸ï¼Œå¯¹å…¬å¸é€ æˆå¾ˆå¤šæŸå¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ§åˆ¶ç›¸åŒçš„ä»»åŠ¡åœ¨å¤šä¸ªè¿è¡Œå®ä¾‹ä¸Šåªæ‰§è¡Œä¸€æ¬¡ã€‚</p><h4 id="_7-2-2-xxl-job-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_7-2-2-xxl-job-ä»‹ç»" aria-hidden="true">#</a> <strong>7.2.2 XXL-JOB ä»‹ç»</strong></h4><p>XXL-JOB æ˜¯ä¸€ä¸ªè½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•ã€‚ç°å·²å¼€æ”¾æºä»£ç å¹¶æ¥å…¥å¤šå®¶å…¬å¸çº¿ä¸Šäº§å“çº¿ï¼Œå¼€ç®±å³ç”¨ã€‚</p><p>å®˜ç½‘ï¼šhttps://www.xuxueli.com/xxl-job/</p><p>æ–‡æ¡£ï¼šhttps://www.xuxueli.com/xxl-job/#%E3%80%8A%E5%88%86%E5%B8%83%E5%BC%8F%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%B9%B3%E5%8F%B0XXL-JOB%E3%80%8B</p><p>XXL-JOB ä¸»è¦æœ‰è°ƒåº¦ä¸­å¿ƒã€æ‰§è¡Œå™¨ã€ä»»åŠ¡ï¼š</p><p><img src="/MyBlog/assets/image-20230521180414046-6ef55d05.png" alt="image-20230521180414046"></p><p><strong>è°ƒåº¦ä¸­å¿ƒï¼š</strong></p><p>è´Ÿè´£ç®¡ç†è°ƒåº¦ä¿¡æ¯ï¼ŒæŒ‰ç…§è°ƒåº¦é…ç½®å‘å‡ºè°ƒåº¦è¯·æ±‚ï¼Œè‡ªèº«ä¸æ‰¿æ‹…ä¸šåŠ¡ä»£ç ï¼›</p><p>ä¸»è¦èŒè´£ä¸ºæ‰§è¡Œå™¨ç®¡ç†ã€ä»»åŠ¡ç®¡ç†ã€ç›‘æ§è¿ç»´ã€æ—¥å¿—ç®¡ç†ç­‰</p><p><strong>ä»»åŠ¡æ‰§è¡Œå™¨ï¼š</strong></p><p>è´Ÿè´£æ¥æ”¶è°ƒåº¦è¯·æ±‚å¹¶æ‰§è¡Œä»»åŠ¡é€»è¾‘ï¼›</p><p>åªè¦èŒè´£æ˜¯æ³¨å†ŒæœåŠ¡ã€ä»»åŠ¡æ‰§è¡ŒæœåŠ¡ï¼ˆæ¥æ”¶åˆ°ä»»åŠ¡åä¼šæ”¾å…¥çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€æ‰§è¡Œç»“æœä¸ŠæŠ¥ã€æ—¥å¿—æœåŠ¡ç­‰</p><p>**ä»»åŠ¡ï¼š**è´Ÿè´£æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡å¤„ç†ã€‚</p><p>è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨ä¹‹é—´çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521180423515-b74dc916.png" alt="image-20230521180423515"></p><p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p><p>1.ä»»åŠ¡æ‰§è¡Œå™¨æ ¹æ®é…ç½®çš„è°ƒåº¦ä¸­å¿ƒçš„åœ°å€ï¼Œè‡ªåŠ¨æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒ</p><p>2.è¾¾åˆ°ä»»åŠ¡è§¦å‘æ¡ä»¶ï¼Œè°ƒåº¦ä¸­å¿ƒä¸‹å‘ä»»åŠ¡</p><p>3.æ‰§è¡Œå™¨åŸºäºçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœæ”¾å…¥å†…å­˜é˜Ÿåˆ—ä¸­ã€æŠŠæ‰§è¡Œæ—¥å¿—å†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­</p><p>4.æ‰§è¡Œå™¨æ¶ˆè´¹å†…å­˜é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œç»“æœï¼Œä¸»åŠ¨ä¸ŠæŠ¥ç»™è°ƒåº¦ä¸­å¿ƒ</p><p>5.å½“ç”¨æˆ·åœ¨è°ƒåº¦ä¸­å¿ƒæŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ï¼Œè°ƒåº¦ä¸­å¿ƒè¯·æ±‚ä»»åŠ¡æ‰§è¡Œå™¨ï¼Œä»»åŠ¡æ‰§è¡Œå™¨è¯»å–ä»»åŠ¡æ—¥å¿—æ–‡ä»¶å¹¶è¿”å›æ—¥å¿—è¯¦æƒ…</p><h4 id="_7-2-3-æ­å»º-xxl-job" tabindex="-1"><a class="header-anchor" href="#_7-2-3-æ­å»º-xxl-job" aria-hidden="true">#</a> <strong>7.2.3 æ­å»º XXL-JOB</strong></h4><h5 id="_7-2-3-1-è°ƒåº¦ä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#_7-2-3-1-è°ƒåº¦ä¸­å¿ƒ" aria-hidden="true">#</a> <strong>7.2.3.1 è°ƒåº¦ä¸­å¿ƒ</strong></h5><p>é¦–å…ˆä¸‹è½½ XXL-JOB</p><p>GitHubï¼š<a href="https://github.com/xuxueli/xxl-job" target="_blank" rel="noopener noreferrer">https://github.com/xuxueli/xxl-job<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ç äº‘ï¼š<a href="https://gitee.com/xuxueli0323/xxl-job" target="_blank" rel="noopener noreferrer">https://gitee.com/xuxueli0323/xxl-job<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>é¡¹ç›®ä½¿ç”¨ 2.3.1 ç‰ˆæœ¬ï¼š https://github.com/xuxueli/xxl-job/releases/tag/2.3.1</p><p>ä¹Ÿå¯ä»è¯¾ç¨‹èµ„æ–™ç›®å½•è·å–ï¼Œè§£å‹ xxl-job-2.3.1.zip</p><p>ä½¿ç”¨ IDEA æ‰“å¼€è§£å‹åçš„ç›®å½•</p><p><img src="/MyBlog/assets/image-20230521180432547-fb29d6e3.png" alt="image-20230521180432547"></p><p>xxl-job-adminï¼šè°ƒåº¦ä¸­å¿ƒ</p><p>xxl-job-coreï¼šå…¬å…±ä¾èµ–</p><p>xxl-job-executor-samplesï¼šæ‰§è¡Œå™¨ Sample ç¤ºä¾‹ï¼ˆé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬æ‰§è¡Œå™¨ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼‰</p><p>ï¼šxxl-job-executor-sample-springbootï¼šSpringboot ç‰ˆæœ¬ï¼Œé€šè¿‡ Springboot ç®¡ç†æ‰§è¡Œå™¨ï¼Œæ¨èè¿™ç§æ–¹å¼ï¼›</p><p>ï¼šxxl-job-executor-sample-framelessï¼šæ— æ¡†æ¶ç‰ˆæœ¬ï¼›</p><p>doc :æ–‡æ¡£èµ„æ–™ï¼ŒåŒ…å«æ•°æ®åº“è„šæœ¬</p><p>åœ¨ä¸‹å‘çš„è™šæ‹Ÿæœºçš„ MySQL ä¸­å·²ç»åˆ›å»ºäº† xxl_job_2.3.1 æ•°æ®åº“</p><p><img src="/MyBlog/assets/image-20230521180442150-58eb8986.png" alt="image-20230521180442150"></p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521180447626-91858f05.png" alt="image-20230521180447626"></p><p>æ‰§è¡Œ sh /data/soft/restart.sh è‡ªåŠ¨å¯åŠ¨ xxl-job è°ƒåº¦ä¸­å¿ƒ</p><p>è®¿é—®ï¼šhttp://192.168.101.65:8088/xxl-job-admin/</p><p>è´¦å·å’Œå¯†ç ï¼šadmin/123456</p><p>å¦‚æœæ— æ³•ä½¿ç”¨è™šæ‹Ÿæœºè¿è¡Œ xxl-job å¯ä»¥åœ¨æœ¬æœº idea è¿è¡Œ xxl-job è°ƒåº¦ä¸­å¿ƒã€‚</p><h5 id="_7-2-3-2-æ‰§è¡Œå™¨" tabindex="-1"><a class="header-anchor" href="#_7-2-3-2-æ‰§è¡Œå™¨" aria-hidden="true">#</a> <strong>7.2.3.2 æ‰§è¡Œå™¨</strong></h5><p>ä¸‹è¾¹é…ç½®æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨è´Ÿè´£ä¸è°ƒåº¦ä¸­å¿ƒé€šä¿¡æ¥æ”¶è°ƒåº¦ä¸­å¿ƒå‘èµ·çš„ä»»åŠ¡è°ƒåº¦è¯·æ±‚ã€‚</p><p>1ã€ä¸‹è¾¹è¿›å…¥è°ƒåº¦ä¸­å¿ƒæ·»åŠ æ‰§è¡Œå™¨</p><p><img src="/MyBlog/assets/image-20230521180502712-fef8d0be.png" alt="image-20230521180502712"></p><p>ç‚¹å‡»æ–°å¢ï¼Œå¡«å†™æ‰§è¡Œå™¨ä¿¡æ¯ï¼Œappname æ˜¯å‰è¾¹åœ¨ nacos ä¸­é…ç½® xxl ä¿¡æ¯æ—¶æŒ‡å®šçš„æ‰§è¡Œå™¨çš„åº”ç”¨åã€‚</p><p><img src="/MyBlog/assets/image-20230521180513326-0c3ad23c.png" alt="image-20230521180513326"></p><p>æ·»åŠ æˆåŠŸï¼š</p><p><img src="/MyBlog/assets/image-20230521180518819-735c19a2.png" alt="image-20230521180518819"></p><p>2ã€é¦–å…ˆåœ¨åª’èµ„ç®¡ç†æ¨¡å—çš„ service å·¥ç¨‹æ·»åŠ ä¾èµ–ï¼Œåœ¨é¡¹ç›®çš„çˆ¶å·¥ç¨‹å·²çº¦å®šäº†ç‰ˆæœ¬ 2.3.1</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>xuxueli<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>xxl<span class="token operator">-</span>job<span class="token operator">-</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€åœ¨ nacos ä¸‹çš„ media-service-dev.yaml ä¸‹é…ç½® xxl-job</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">xxl</span><span class="token punctuation">:</span>
  <span class="token key atrule">job</span><span class="token punctuation">:</span>
    <span class="token key atrule">admin</span><span class="token punctuation">:</span>
      <span class="token key atrule">addresses</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//192.168.101.65<span class="token punctuation">:</span>8088/xxl<span class="token punctuation">-</span>job<span class="token punctuation">-</span>admin
    <span class="token key atrule">executor</span><span class="token punctuation">:</span>
      <span class="token key atrule">appname</span><span class="token punctuation">:</span> media<span class="token punctuation">-</span>process<span class="token punctuation">-</span>service
      <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token key atrule">ip</span><span class="token punctuation">:</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
      <span class="token key atrule">logpath</span><span class="token punctuation">:</span> /data/applogs/xxl<span class="token punctuation">-</span>job/jobhandler
      <span class="token key atrule">logretentiondays</span><span class="token punctuation">:</span> <span class="token number">30</span>
    <span class="token key atrule">accessToken</span><span class="token punctuation">:</span> default_token
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„é…ç½®ä¸­çš„ appname è¿™æ˜¯æ‰§è¡Œå™¨çš„åº”ç”¨åï¼Œport æ˜¯æ‰§è¡Œå™¨å¯åŠ¨çš„ç«¯å£ï¼Œå¦‚æœæœ¬åœ°å¯åŠ¨å¤šä¸ªæ‰§è¡Œå™¨æ³¨æ„ç«¯å£ä¸èƒ½é‡å¤ã€‚</p><p>4ã€é…ç½® xxl-job çš„æ‰§è¡Œå™¨</p><p>å°† xxl-job ç¤ºä¾‹å·¥ç¨‹ä¸‹é…ç½®ç±»æ‹·è´åˆ°åª’èµ„ç®¡ç†çš„ service å·¥ç¨‹ä¸‹</p><p><img src="/MyBlog/assets/image-20230521180556533-55b8c901.png" alt="image-20230521180556533"></p><p>æ‹·è´è‡³ï¼š</p><p><img src="/MyBlog/assets/image-20230521180603161-804afa21.png" alt="image-20230521180603161"></p><p>åˆ°æ­¤å®Œæˆåª’èµ„ç®¡ç†æ¨¡å— service å·¥ç¨‹é…ç½® xxl-job æ‰§è¡Œå™¨ï¼Œåœ¨ xxl-job è°ƒåº¦ä¸­å¿ƒæ·»åŠ æ‰§è¡Œå™¨ï¼Œä¸‹è¾¹å‡†å¤‡æµ‹è¯•æ‰§è¡Œå™¨ä¸è°ƒåº¦ä¸­å¿ƒæ˜¯å¦æ­£å¸¸é€šä¿¡ï¼Œå› ä¸ºæ¥å£å·¥ç¨‹ä¾èµ–äº† service å·¥ç¨‹ï¼Œæ‰€ä»¥å¯åŠ¨åª’èµ„ç®¡ç†æ¨¡å—çš„æ¥å£å·¥ç¨‹ã€‚</p><p>å¯åŠ¨åè§‚å¯Ÿæ—¥å¿—ï¼Œå‡ºç°ä¸‹è¾¹çš„æ—¥å¿—è¡¨ç¤ºæ‰§è¡Œå™¨åœ¨è°ƒåº¦ä¸­å¿ƒæ³¨å†ŒæˆåŠŸ</p><p><img src="/MyBlog/assets/image-20230521180613249-0b480a2a.png" alt="image-20230521180613249"></p><p>åŒæ—¶è§‚å¯Ÿè°ƒåº¦ä¸­å¿ƒä¸­çš„æ‰§è¡Œå™¨ç•Œé¢</p><p><img src="/MyBlog/assets/image-20230521180617606-6f9c1b6b.png" alt="image-20230521180617606"></p><p>åœ¨çº¿æœºå™¨åœ°å€å¤„å·²æ˜¾ç¤º 1 ä¸ªæ‰§è¡Œå™¨ã€‚</p><h5 id="_7-2-3-3-æ‰§è¡Œä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_7-2-3-3-æ‰§è¡Œä»»åŠ¡" aria-hidden="true">#</a> <strong>7.2.3.3 æ‰§è¡Œä»»åŠ¡</strong></h5><p>ä¸‹è¾¹ç¼–å†™ä»»åŠ¡ï¼Œå‚è€ƒç¤ºä¾‹å·¥ç¨‹ä¸­ä»»åŠ¡ç±»çš„ç¼–å†™æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521180640610-29370503.png" alt="image-20230521180640610"></p><p>åœ¨åª’èµ„æœåŠ¡ service åŒ…ä¸‹æ–°å»º jobhandler å­˜æ”¾ä»»åŠ¡ç±»ï¼Œä¸‹è¾¹å‚è€ƒç¤ºä¾‹å·¥ç¨‹ç¼–å†™ä¸€ä¸ªä»»åŠ¡ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span>jobhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">XxlJobHelper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">XxlJob</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æµ‹è¯•æ‰§è¡Œå™¨
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/13 20:32
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Component</span>
 <span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleJob</span> <span class="token punctuation">{</span>

 <span class="token doc-comment comment">/**
  * 1ã€ç®€å•ä»»åŠ¡ç¤ºä¾‹ï¼ˆBeanæ¨¡å¼ï¼‰
  */</span>
 <span class="token annotation punctuation">@XxlJob</span><span class="token punctuation">(</span><span class="token string">&quot;testJob&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œ.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è¾¹åœ¨è°ƒåº¦ä¸­å¿ƒæ·»åŠ ä»»åŠ¡ï¼Œè¿›å…¥ä»»åŠ¡ç®¡ç†</p><p><img src="/MyBlog/assets/image-20230521180658297-1cdfb7e1.png" alt="image-20230521180658297"></p><p>ç‚¹å‡»æ–°å¢ï¼Œå¡«å†™ä»»åŠ¡ä¿¡æ¯</p><p><img src="/MyBlog/assets/image-20230521180703948-cbd4ee8a.png" alt="image-20230521180703948"></p><p>æ³¨æ„çº¢è‰²æ ‡è®°å¤„ï¼š</p><p><strong>è°ƒåº¦ç±»å‹ï¼š</strong></p><p>å›ºå®šé€Ÿåº¦æŒ‡æŒ‰å›ºå®šçš„é—´éš”å®šæ—¶è°ƒåº¦ã€‚</p><p>Cronï¼Œé€šè¿‡ Cron è¡¨è¾¾å¼å®ç°æ›´ä¸°å¯Œçš„å®šæ—¶è°ƒåº¦ç­–ç•¥ã€‚</p><p>Cron è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡å®ƒå¯ä»¥å®šä¹‰è°ƒåº¦ç­–ç•¥ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p>{ç§’æ•°} {åˆ†é’Ÿ} {å°æ—¶} {æ—¥æœŸ} {æœˆä»½} {æ˜ŸæœŸ} {å¹´ä»½(å¯ä¸ºç©º)}</p><p>xxl-job æä¾›å›¾å½¢ç•Œé¢å»é…ç½®ï¼š</p><p><img src="/MyBlog/assets/image-20230521180714771-c05bfa36.png" alt="image-20230521180714771"></p><p>ä¸€äº›ä¾‹å­å¦‚ä¸‹ï¼š</p><p>30 10 1 * * ? æ¯å¤© 1 ç‚¹ 10 åˆ† 30 ç§’è§¦å‘</p><p>0/30 * * * * ? æ¯ 30 ç§’è§¦å‘ä¸€æ¬¡</p><p>* 0/10 * * * ? æ¯ 10 åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</p><p><strong>è¿è¡Œæ¨¡å¼</strong>æœ‰ BEAN å’Œ GLUEï¼Œbean æ¨¡å¼è¾ƒå¸¸ç”¨å°±æ˜¯åœ¨é¡¹ç›®å·¥ç¨‹ä¸­ç¼–å†™æ‰§è¡Œå™¨çš„ä»»åŠ¡ä»£ç ï¼ŒGLUE æ˜¯å°†ä»»åŠ¡ä»£ç ç¼–å†™åœ¨è°ƒåº¦ä¸­å¿ƒã€‚</p><p><strong>JobHandler</strong>å³ä»»åŠ¡æ–¹æ³•åï¼Œå¡«å†™ä»»åŠ¡æ–¹æ³•ä¸Šè¾¹@XxlJob æ³¨è§£ä¸­çš„åç§°ã€‚</p><p>**è·¯ç”±ç­–ç•¥ï¼š**å½“æ‰§è¡Œå™¨é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œè°ƒåº¦ä¸­å¿ƒå‘å“ªä¸ªæ‰§è¡Œå™¨ä¸‹å‘ä»»åŠ¡ï¼Œè¿™é‡Œé€‰æ‹©ç¬¬ä¸€ä¸ªè¡¨ç¤ºåªå‘ç¬¬ä¸€ä¸ªæ‰§è¡Œå™¨ä¸‹å‘ä»»åŠ¡ï¼Œè·¯ç”±ç­–ç•¥çš„å…¶å®ƒé€‰é¡¹ç¨ååœ¨åˆ†ç‰‡å¹¿æ’­ç« èŠ‚è¯¦ç»†è§£é‡Šã€‚</p><p>é«˜çº§é…ç½®çš„å…¶å®ƒé…ç½®é¡¹ç¨ååœ¨åˆ†ç‰‡å¹¿æ’­ç« èŠ‚è¯¦ç»†è§£é‡Šã€‚</p><p>æ·»åŠ æˆåŠŸï¼Œå¯åŠ¨ä»»åŠ¡</p><p><img src="/MyBlog/assets/image-20230521180724944-9c8aa830.png" alt="image-20230521180724944"></p><p>é€šè¿‡è°ƒåº¦æ—¥å¿—æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæƒ…å†µ</p><p><img src="/MyBlog/assets/image-20230521180729915-cf953a62.png" alt="image-20230521180729915"></p><p>ä¸‹è¾¹å¯åŠ¨åª’èµ„ç®¡ç†çš„ service å·¥ç¨‹ï¼Œå¯åŠ¨æ‰§è¡Œå™¨ã€‚</p><p>è§‚å¯Ÿæ‰§è¡Œå™¨æ–¹æ³•çš„æ‰§è¡Œã€‚</p><p><img src="/MyBlog/assets/image-20230521180735194-5eed5427.png" alt="image-20230521180735194"></p><p>å¦‚æœè¦åœæ­¢ä»»åŠ¡éœ€è¦åœ¨è°ƒåº¦ä¸­å¿ƒæ“ä½œ</p><p><img src="/MyBlog/assets/image-20230521180741294-fb016b36.png" alt="image-20230521180741294"></p><p>ä»»åŠ¡è·‘ä¸€æ®µæ—¶é—´æ³¨æ„æ¸…ç†æ—¥å¿—</p><p><img src="/MyBlog/assets/image-20230521180747339-525f2b58.png" alt="image-20230521180747339"></p><h4 id="_7-2-4-åˆ†ç‰‡å¹¿æ’­" tabindex="-1"><a class="header-anchor" href="#_7-2-4-åˆ†ç‰‡å¹¿æ’­" aria-hidden="true">#</a> <strong>7.2.4 åˆ†ç‰‡å¹¿æ’­</strong></h4><p>æŒæ¡äº† xxl-job çš„åŸºæœ¬ä½¿ç”¨ï¼Œä¸‹è¾¹æ€è€ƒå¦‚ä½•è¿›è¡Œåˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†å‘¢ï¼Ÿå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬ä¼šå¯åŠ¨å¤šä¸ªæ‰§è¡Œå™¨ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œå»æ‰§è¡Œä»»åŠ¡ã€‚</p><p><img src="/MyBlog/assets/image-20230521180752964-b6e2dee0.png" alt="image-20230521180752964"></p><blockquote><p>æ‰§è¡Œå™¨åœ¨é›†ç¾¤éƒ¨ç½²ä¸‹è°ƒåº¦ä¸­å¿ƒæœ‰å“ªäº›è°ƒåº¦ç­–ç•¥å‘¢ï¼Ÿ</p></blockquote><p>æŸ¥çœ‹ xxl-job å®˜æ–¹æ–‡æ¡£ï¼Œé˜…è¯»é«˜çº§é…ç½®ç›¸å…³çš„å†…å®¹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>é«˜çº§é…ç½®ï¼š
    <span class="token operator">-</span> è·¯ç”±ç­–ç•¥ï¼šå½“æ‰§è¡Œå™¨é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œæä¾›ä¸°å¯Œçš„è·¯ç”±ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼›
        <span class="token keyword">FIRST</span>ï¼ˆç¬¬ä¸€ä¸ªï¼‰ï¼šå›ºå®šé€‰æ‹©ç¬¬ä¸€ä¸ªæœºå™¨ï¼›
        <span class="token keyword">LAST</span>ï¼ˆæœ€åä¸€ä¸ªï¼‰ï¼šå›ºå®šé€‰æ‹©æœ€åä¸€ä¸ªæœºå™¨ï¼›
        ROUNDï¼ˆè½®è¯¢ï¼‰ï¼šï¼›
        RANDOMï¼ˆéšæœºï¼‰ï¼šéšæœºé€‰æ‹©åœ¨çº¿çš„æœºå™¨ï¼›
        CONSISTENT_HASHï¼ˆä¸€è‡´æ€§<span class="token keyword">HASH</span>ï¼‰ï¼šæ¯ä¸ªä»»åŠ¡æŒ‰ç…§<span class="token keyword">Hash</span>ç®—æ³•å›ºå®šé€‰æ‹©æŸä¸€å°æœºå™¨ï¼Œä¸”æ‰€æœ‰ä»»åŠ¡å‡åŒ€æ•£åˆ—åœ¨ä¸åŒæœºå™¨ä¸Šã€‚
        LEAST_FREQUENTLY_USEDï¼ˆæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼‰ï¼šä½¿ç”¨é¢‘ç‡æœ€ä½çš„æœºå™¨ä¼˜å…ˆè¢«é€‰ä¸¾ï¼›
        LEAST_RECENTLY_USEDï¼ˆæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼‰ï¼šæœ€ä¹…æœªä½¿ç”¨çš„æœºå™¨ä¼˜å…ˆè¢«é€‰ä¸¾ï¼›
        FAILOVERï¼ˆæ•…éšœè½¬ç§»ï¼‰ï¼šæŒ‰ç…§é¡ºåºä¾æ¬¡è¿›è¡Œå¿ƒè·³æ£€æµ‹ï¼Œç¬¬ä¸€ä¸ªå¿ƒè·³æ£€æµ‹æˆåŠŸçš„æœºå™¨é€‰å®šä¸ºç›®æ ‡æ‰§è¡Œå™¨å¹¶å‘èµ·è°ƒåº¦ï¼›
        BUSYOVERï¼ˆå¿™ç¢Œè½¬ç§»ï¼‰ï¼šæŒ‰ç…§é¡ºåºä¾æ¬¡è¿›è¡Œç©ºé—²æ£€æµ‹ï¼Œç¬¬ä¸€ä¸ªç©ºé—²æ£€æµ‹æˆåŠŸçš„æœºå™¨é€‰å®šä¸ºç›®æ ‡æ‰§è¡Œå™¨å¹¶å‘èµ·è°ƒåº¦ï¼›
        SHARDING_BROADCAST<span class="token punctuation">(</span>åˆ†ç‰‡å¹¿æ’­<span class="token punctuation">)</span>ï¼šå¹¿æ’­è§¦å‘å¯¹åº”é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼ŒåŒæ—¶ç³»ç»Ÿè‡ªåŠ¨ä¼ é€’åˆ†ç‰‡å‚æ•°ï¼›å¯æ ¹æ®åˆ†ç‰‡å‚æ•°å¼€å‘åˆ†ç‰‡ä»»åŠ¡ï¼›

    <span class="token operator">-</span> å­ä»»åŠ¡ï¼šæ¯ä¸ªä»»åŠ¡éƒ½æ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„ä»»åŠ¡ID<span class="token punctuation">(</span>ä»»åŠ¡IDå¯ä»¥ä»ä»»åŠ¡åˆ—è¡¨è·å–<span class="token punctuation">)</span>ï¼Œå½“æœ¬ä»»åŠ¡æ‰§è¡Œç»“æŸå¹¶ä¸”æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œå°†ä¼šè§¦å‘å­ä»»åŠ¡IDæ‰€å¯¹åº”çš„ä»»åŠ¡çš„ä¸€æ¬¡ä¸»åŠ¨è°ƒåº¦ï¼Œé€šè¿‡å­ä»»åŠ¡å¯ä»¥å®ç°ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆå»æ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡ã€‚
    <span class="token operator">-</span> è°ƒåº¦è¿‡æœŸç­–ç•¥ï¼š
        <span class="token operator">-</span> å¿½ç•¥ï¼šè°ƒåº¦è¿‡æœŸåï¼Œå¿½ç•¥è¿‡æœŸçš„ä»»åŠ¡ï¼Œä»å½“å‰æ—¶é—´å¼€å§‹é‡æ–°è®¡ç®—ä¸‹æ¬¡è§¦å‘æ—¶é—´ï¼›
        <span class="token operator">-</span> ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼šè°ƒåº¦è¿‡æœŸåï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä»å½“å‰æ—¶é—´å¼€å§‹é‡æ–°è®¡ç®—ä¸‹æ¬¡è§¦å‘æ—¶é—´ï¼›
    <span class="token operator">-</span> é˜»å¡å¤„ç†ç­–ç•¥ï¼šè°ƒåº¦è¿‡äºå¯†é›†æ‰§è¡Œå™¨æ¥ä¸åŠå¤„ç†æ—¶çš„å¤„ç†ç­–ç•¥ï¼›
        å•æœºä¸²è¡Œï¼ˆé»˜è®¤ï¼‰ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œè°ƒåº¦è¯·æ±‚è¿›å…¥FIFOé˜Ÿåˆ—å¹¶ä»¥ä¸²è¡Œæ–¹å¼è¿è¡Œï¼›
        ä¸¢å¼ƒåç»­è°ƒåº¦ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œå‘ç°æ‰§è¡Œå™¨å­˜åœ¨è¿è¡Œçš„è°ƒåº¦ä»»åŠ¡ï¼Œæœ¬æ¬¡è¯·æ±‚å°†ä¼šè¢«ä¸¢å¼ƒå¹¶æ ‡è®°ä¸ºå¤±è´¥ï¼›
        è¦†ç›–ä¹‹å‰è°ƒåº¦ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œå‘ç°æ‰§è¡Œå™¨å­˜åœ¨è¿è¡Œçš„è°ƒåº¦ä»»åŠ¡ï¼Œå°†ä¼šç»ˆæ­¢è¿è¡Œä¸­çš„è°ƒåº¦ä»»åŠ¡å¹¶æ¸…ç©ºé˜Ÿåˆ—ï¼Œç„¶åè¿è¡Œæœ¬åœ°è°ƒåº¦ä»»åŠ¡ï¼›
    <span class="token operator">-</span> ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼šæ”¯æŒè‡ªå®šä¹‰ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼Œä»»åŠ¡è¿è¡Œè¶…æ—¶å°†ä¼šä¸»åŠ¨ä¸­æ–­ä»»åŠ¡ï¼›
    <span class="token operator">-</span> å¤±è´¥é‡è¯•æ¬¡æ•°ï¼›æ”¯æŒè‡ªå®šä¹‰ä»»åŠ¡å¤±è´¥é‡è¯•æ¬¡æ•°ï¼Œå½“ä»»åŠ¡å¤±è´¥æ—¶å°†ä¼šæŒ‰ç…§é¢„è®¾çš„å¤±è´¥é‡è¯•æ¬¡æ•°ä¸»åŠ¨è¿›è¡Œé‡è¯•ï¼›

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è¾¹è¦é‡ç‚¹è¯´çš„æ˜¯åˆ†ç‰‡å¹¿æ’­ç­–ç•¥ï¼Œåˆ†ç‰‡æ˜¯æŒ‡æ˜¯è°ƒåº¦ä¸­å¿ƒä»¥æ‰§è¡Œå™¨ä¸ºç»´åº¦è¿›è¡Œåˆ†ç‰‡ï¼Œå°†é›†ç¾¤ä¸­çš„æ‰§è¡Œå™¨æ ‡ä¸Šåºå·ï¼š0ï¼Œ1ï¼Œ2ï¼Œ3...ï¼Œå¹¿æ’­æ˜¯æŒ‡æ¯æ¬¡è°ƒåº¦ä¼šå‘é›†ç¾¤ä¸­çš„æ‰€æœ‰æ‰§è¡Œå™¨å‘é€ä»»åŠ¡è°ƒåº¦ï¼Œè¯·æ±‚ä¸­æºå¸¦åˆ†ç‰‡å‚æ•°ã€‚</p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521180836425-a5bf9698.png" alt="image-20230521180836425"></p><p>æ¯ä¸ªæ‰§è¡Œå™¨æ”¶åˆ°è°ƒåº¦è¯·æ±‚åŒæ—¶æ¥æ”¶åˆ†ç‰‡å‚æ•°ã€‚</p><p>xxl-job æ”¯æŒåŠ¨æ€æ‰©å®¹æ‰§è¡Œå™¨é›†ç¾¤ä»è€ŒåŠ¨æ€å¢åŠ åˆ†ç‰‡æ•°é‡ï¼Œå½“æœ‰ä»»åŠ¡é‡å¢åŠ å¯ä»¥éƒ¨ç½²æ›´å¤šçš„æ‰§è¡Œå™¨åˆ°é›†ç¾¤ä¸­ï¼Œè°ƒåº¦ä¸­å¿ƒä¼šåŠ¨æ€ä¿®æ”¹åˆ†ç‰‡çš„æ•°é‡ã€‚</p><p><strong>ä½œä¸šåˆ†ç‰‡é€‚ç”¨å“ªäº›åœºæ™¯å‘¢ï¼Ÿ</strong></p><p>åˆ†ç‰‡ä»»åŠ¡åœºæ™¯ï¼š10 ä¸ªæ‰§è¡Œå™¨çš„é›†ç¾¤æ¥å¤„ç† 10w æ¡æ•°æ®ï¼Œæ¯å°æœºå™¨åªéœ€è¦å¤„ç† 1w æ¡æ•°æ®ï¼Œè€—æ—¶é™ä½ 10 å€ï¼›</p><p>å¹¿æ’­ä»»åŠ¡åœºæ™¯ï¼šå¹¿æ’­æ‰§è¡Œå™¨åŒæ—¶è¿è¡Œ shell è„šæœ¬ã€å¹¿æ’­é›†ç¾¤èŠ‚ç‚¹è¿›è¡Œç¼“å­˜æ›´æ–°ç­‰ã€‚</p><p>æ‰€ä»¥ï¼Œå¹¿æ’­åˆ†ç‰‡æ–¹å¼ä¸ä»…å¯ä»¥å……åˆ†å‘æŒ¥æ¯ä¸ªæ‰§è¡Œå™¨çš„èƒ½åŠ›ï¼Œå¹¶ä¸”æ ¹æ®åˆ†ç‰‡å‚æ•°å¯ä»¥æ§åˆ¶ä»»åŠ¡æ˜¯å¦æ‰§è¡Œï¼Œæœ€ç»ˆçµæ´»æ§åˆ¶äº†æ‰§è¡Œå™¨é›†ç¾¤åˆ†å¸ƒå¼å¤„ç†ä»»åŠ¡ã€‚</p><p><strong>ä½¿ç”¨è¯´æ˜ï¼š</strong></p><p>&quot;åˆ†ç‰‡å¹¿æ’­&quot; å’Œæ™®é€šä»»åŠ¡å¼€å‘æµç¨‹ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„åœ¨äºå¯ä»¥è·å–åˆ†ç‰‡å‚æ•°è¿›è¡Œåˆ†ç‰‡ä¸šåŠ¡å¤„ç†ã€‚</p><p>Java è¯­è¨€ä»»åŠ¡è·å–åˆ†ç‰‡å‚æ•°æ–¹å¼ï¼š</p><p>BEANã€GLUE æ¨¡å¼(Java)ï¼Œå¯å‚è€ƒ Sample ç¤ºä¾‹æ‰§è¡Œå™¨ä¸­çš„ç¤ºä¾‹ä»»åŠ¡&quot;ShardingJobHandler&quot;ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 2ã€åˆ†ç‰‡å¹¿æ’­ä»»åŠ¡
 */</span>
<span class="token annotation punctuation">@XxlJob</span><span class="token punctuation">(</span><span class="token string">&quot;shardingJobHandler&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shardingJobHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ†ç‰‡åºå·ï¼Œä»0å¼€å§‹</span>
    <span class="token keyword">int</span> shardIndex <span class="token operator">=</span> <span class="token class-name">XxlJobHelper</span><span class="token punctuation">.</span><span class="token function">getShardIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ†ç‰‡æ€»æ•°</span>
    <span class="token keyword">int</span> shardTotal <span class="token operator">=</span> <span class="token class-name">XxlJobHelper</span><span class="token punctuation">.</span><span class="token function">getShardTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è¾¹æµ‹è¯•ä½œä¸šåˆ†ç‰‡ï¼š</p><p>1ã€å®šä¹‰ä½œä¸šåˆ†ç‰‡çš„ä»»åŠ¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
  * 2ã€åˆ†ç‰‡å¹¿æ’­ä»»åŠ¡
  */</span>
 <span class="token annotation punctuation">@XxlJob</span><span class="token punctuation">(</span><span class="token string">&quot;shardingJobHandler&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shardingJobHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

  <span class="token comment">// åˆ†ç‰‡å‚æ•°</span>
  <span class="token keyword">int</span> shardIndex <span class="token operator">=</span> <span class="token class-name">XxlJobHelper</span><span class="token punctuation">.</span><span class="token function">getShardIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> shardTotal <span class="token operator">=</span> <span class="token class-name">XxlJobHelper</span><span class="token punctuation">.</span><span class="token function">getShardTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ†ç‰‡å‚æ•°ï¼šå½“å‰åˆ†ç‰‡åºå· = {}, æ€»åˆ†ç‰‡æ•° = {}&quot;</span><span class="token punctuation">,</span> shardIndex<span class="token punctuation">,</span> shardTotal<span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œç¬¬&quot;</span><span class="token operator">+</span>shardIndex<span class="token operator">+</span><span class="token string">&quot;æ‰¹ä»»åŠ¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€åœ¨è°ƒåº¦ä¸­å¿ƒæ·»åŠ ä»»åŠ¡</p><p><img src="/MyBlog/assets/image-20230521180911147-fc0848c4.png" alt="image-20230521180911147"></p><p>æ·»åŠ æˆåŠŸï¼š</p><p><img src="/MyBlog/assets/image-20230521180917665-d5c50d46.png" alt="image-20230521180917665"></p><p>å¯åŠ¨ä»»åŠ¡ï¼Œè§‚å¯Ÿæ—¥å¿—</p><p><img src="/MyBlog/assets/image-20230521180922827-14a20037.png" alt="image-20230521180922827"></p><p>ä¸‹è¾¹å¯åŠ¨ä¸¤ä¸ªæ‰§è¡Œå™¨å®ä¾‹ï¼Œè§‚å¯Ÿæ¯ä¸ªå®ä¾‹çš„æ‰§è¡Œæƒ…å†µ</p><p>é¦–å…ˆåœ¨ nacos ä¸­é…ç½® media-service çš„æœ¬åœ°ä¼˜å…ˆé…ç½®ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>##é…ç½®æœ¬åœ°ä¼˜å…ˆ
spring<span class="token operator">:</span>
 cloud<span class="token operator">:</span>
  config<span class="token operator">:</span>
    override<span class="token operator">-</span>none<span class="token operator">:</span> <span class="token boolean">true</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°† media-service å¯åŠ¨ä¸¤ä¸ªå®ä¾‹</p><p>ä¸¤ä¸ªå®ä¾‹çš„åœ¨å¯åŠ¨æ—¶æ³¨æ„ç«¯å£ä¸èƒ½å†²çªï¼š</p><p>å®ä¾‹ 1 åœ¨ VM options å¤„æ·»åŠ ï¼š-Dserver.port=63051 -Dxxl.job.executor.port=9998</p><p>å®ä¾‹ 2 åœ¨ VM options å¤„æ·»åŠ ï¼š-Dserver.port=63050 -Dxxl.job.executor.port=9999</p><p>ä¾‹å¦‚ï¼š</p><p><img src="/MyBlog/assets/image-20230521180941555-60c9539b.png" alt="image-20230521180941555"></p><p>å¯åŠ¨ä¸¤ä¸ªå®ä¾‹</p><p>è§‚å¯Ÿä»»åŠ¡è°ƒåº¦ä¸­å¿ƒï¼Œç¨ç­‰ç‰‡åˆ»æ‰§è¡Œå™¨æœ‰ä¸¤ä¸ª</p><p><img src="/MyBlog/assets/image-20230521180947517-0d06d6b8.png" alt="image-20230521180947517"></p><p>è§‚å¯Ÿä¸¤ä¸ªæ‰§è¡Œå®ä¾‹çš„æ—¥å¿—ï¼š</p><p><img src="/MyBlog/assets/image-20230521180953607-264038fe.png" alt="image-20230521180953607"></p><p>å¦ä¸€å®ä¾‹çš„æ—¥å¿—å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521180957825-5f900b41.png" alt="image-20230521180957825"></p><p>ä»æ—¥å¿—å¯ä»¥çœ‹æ¯ä¸ªå®ä¾‹çš„åˆ†ç‰‡åºå·ä¸åŒã€‚</p><p>å¦‚æœå…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå™¨æŒ‚æ‰ï¼Œåªå‰©ä¸‹ä¸€ä¸ªæ‰§è¡Œå™¨åœ¨å·¥ä½œï¼Œç¨ç­‰ç‰‡åˆ»è°ƒç”¨ä¸­å¿ƒå‘ç°å°‘äº†ä¸€ä¸ªæ‰§è¡Œå™¨å°†åŠ¨æ€è°ƒæ•´æ€»åˆ†ç‰‡æ•°ä¸º 1ã€‚</p><p>åˆ°æ­¤ä½œä¸šåˆ†ç‰‡ä»»åŠ¡è°ƒè¯•å®Œæˆï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ€è€ƒï¼š</p><blockquote><p>å½“ä¸€æ¬¡åˆ†ç‰‡å¹¿æ’­åˆ°æ¥ï¼Œå„æ‰§è¡Œå™¨å¦‚ä½•æ ¹æ®åˆ†ç‰‡å‚æ•°å»åˆ†å¸ƒå¼æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰§è¡Œå™¨ä¹‹é—´æ‰§è¡Œçš„ä»»åŠ¡ä¸é‡å¤å‘¢ï¼Ÿ</p></blockquote><h3 id="_7-3-æŠ€æœ¯æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_7-3-æŠ€æœ¯æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>7.3 æŠ€æœ¯æ–¹æ¡ˆ</strong></h3><h4 id="_7-3-1-ä½œä¸šåˆ†ç‰‡æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_7-3-1-ä½œä¸šåˆ†ç‰‡æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>7.3.1 ä½œä¸šåˆ†ç‰‡æ–¹æ¡ˆ</strong></h4><p>æŒæ¡äº† xxl-job çš„åˆ†ç‰‡å¹¿æ’­è°ƒåº¦æ–¹å¼ï¼Œä¸‹è¾¹æ€è€ƒå¦‚ä½•åˆ†å¸ƒå¼å»æ‰§è¡Œå­¦æˆåœ¨çº¿å¹³å°ä¸­çš„è§†é¢‘å¤„ç†ä»»åŠ¡ã€‚</p><p>ä»»åŠ¡æ·»åŠ æˆåŠŸåï¼Œå¯¹äºè¦å¤„ç†çš„ä»»åŠ¡ä¼šæ·»åŠ åˆ°å¾…å¤„ç†ä»»åŠ¡è¡¨ä¸­ï¼Œç°åœ¨å¯åŠ¨å¤šä¸ªæ‰§è¡Œå™¨å®ä¾‹å»æŸ¥è¯¢è¿™äº›å¾…å¤„ç†ä»»åŠ¡ï¼Œ<strong>æ­¤æ—¶å¦‚ä½•ä¿è¯å¤šä¸ªæ‰§è¡Œå™¨ä¸ä¼šæŸ¥è¯¢åˆ°é‡å¤çš„ä»»åŠ¡å‘¢ï¼Ÿ</strong></p><p>XXL-JOB å¹¶ä¸ç›´æ¥æä¾›æ•°æ®å¤„ç†çš„åŠŸèƒ½ï¼Œå®ƒåªä¼šç»™æ‰§è¡Œå™¨åˆ†é…å¥½åˆ†ç‰‡åºå·ï¼Œåœ¨å‘æ‰§è¡Œå™¨ä»»åŠ¡è°ƒåº¦çš„åŒæ—¶ä¸‹å‘åˆ†ç‰‡æ€»æ•°ä»¥åŠåˆ†ç‰‡åºå·ç­‰å‚æ•°ï¼Œæ‰§è¡Œå™¨æ”¶åˆ°è¿™äº›å‚æ•°æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚å»åˆ©ç”¨è¿™äº›å‚æ•°ã€‚</p><p>ä¸‹å›¾è¡¨ç¤ºäº†å¤šä¸ªæ‰§è¡Œå™¨è·å–è§†é¢‘å¤„ç†ä»»åŠ¡çš„ç»“æ„ï¼š</p><p><img src="/MyBlog/assets/image-20230521181030647-2759cf7e.png" alt="image-20230521181030647"></p><p>æ¯ä¸ªæ‰§è¡Œå™¨æ”¶åˆ°å¹¿æ’­ä»»åŠ¡æœ‰ä¸¤ä¸ªå‚æ•°ï¼šåˆ†ç‰‡æ€»æ•°ã€åˆ†ç‰‡åºå·ã€‚æ¯ä¸ªæ‰§è¡Œä»æ•°æ®è¡¨å–ä»»åŠ¡æ—¶å¯ä»¥è®©ä»»åŠ¡ id æ¨¡ä¸Š åˆ†ç‰‡æ€»æ•°ï¼Œå¦‚æœç­‰äºåˆ†ç‰‡åºå·åˆ™æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚</p><p>ä¸Šè¾¹ä¸¤ä¸ªæ‰§è¡Œå™¨å®ä¾‹é‚£ä¹ˆåˆ†ç‰‡æ€»æ•°ä¸º 2ï¼Œåºå·ä¸º 0ã€1ï¼Œä»ä»»åŠ¡ 1 å¼€å§‹ï¼Œå¦‚ä¸‹ï¼š</p><p>1 % 2 = 1 æ‰§è¡Œå™¨ 2 æ‰§è¡Œ</p><p>2 % 2 = 0 æ‰§è¡Œå™¨ 1 æ‰§è¡Œ</p><p>3 % 2 = 1 æ‰§è¡Œå™¨ 2 æ‰§è¡Œ</p><p>ä»¥æ­¤ç±»æ¨.</p><h4 id="_7-3-2-ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#_7-3-2-ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ" aria-hidden="true">#</a> <strong>7.3.2 ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ</strong></h4><blockquote><p>é€šè¿‡ä½œä¸šåˆ†ç‰‡æ–¹æ¡ˆä¿è¯äº†æ‰§è¡Œå™¨ä¹‹é—´æŸ¥è¯¢åˆ°ä¸é‡å¤çš„ä»»åŠ¡ï¼Œå¦‚æœä¸€ä¸ªæ‰§è¡Œå™¨åœ¨å¤„ç†ä¸€ä¸ªè§†é¢‘è¿˜æ²¡æœ‰å®Œæˆï¼Œæ­¤æ—¶è°ƒåº¦ä¸­å¿ƒåˆä¸€æ¬¡è¯·æ±‚è°ƒåº¦ï¼Œä¸ºäº†ä¸é‡å¤å¤„ç†åŒä¸€ä¸ªè§†é¢‘è¯¥æ€ä¹ˆåŠï¼Ÿ</p></blockquote><p>é¦–å…ˆé…ç½®è°ƒåº¦è¿‡æœŸç­–ç•¥ï¼š</p><p>æŸ¥çœ‹æ–‡æ¡£å¦‚ä¸‹ï¼š</p><p>- è°ƒåº¦è¿‡æœŸç­–ç•¥ï¼šè°ƒåº¦ä¸­å¿ƒé”™è¿‡è°ƒåº¦æ—¶é—´çš„è¡¥å¿å¤„ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼šå¿½ç•¥ã€ç«‹å³è¡¥å¿è§¦å‘ä¸€æ¬¡ç­‰ï¼›</p><ul><li>å¿½ç•¥ï¼šè°ƒåº¦è¿‡æœŸåï¼Œå¿½ç•¥è¿‡æœŸçš„ä»»åŠ¡ï¼Œä»å½“å‰æ—¶é—´å¼€å§‹é‡æ–°è®¡ç®—ä¸‹æ¬¡è§¦å‘æ—¶é—´ï¼›</li><li>ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼šè°ƒåº¦è¿‡æœŸåï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä»å½“å‰æ—¶é—´å¼€å§‹é‡æ–°è®¡ç®—ä¸‹æ¬¡è§¦å‘æ—¶é—´ï¼›</li><li>é˜»å¡å¤„ç†ç­–ç•¥ï¼šè°ƒåº¦è¿‡äºå¯†é›†æ‰§è¡Œå™¨æ¥ä¸åŠå¤„ç†æ—¶çš„å¤„ç†ç­–ç•¥ï¼›</li></ul><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¿½ç•¥ï¼Œå¦‚æœç«‹å³æ‰§è¡Œä¸€æ¬¡å°±å¯èƒ½é‡å¤æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ã€‚</p><p><img src="/MyBlog/assets/image-20230521181043641-46b1afcf.png" alt="image-20230521181043641"></p><p>å…¶æ¬¡ï¼Œå†çœ‹é˜»å¡å¤„ç†ç­–ç•¥ï¼Œé˜»å¡å¤„ç†ç­–ç•¥å°±æ˜¯å½“å‰æ‰§è¡Œå™¨æ­£åœ¨æ‰§è¡Œä»»åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶è°ƒåº¦ä¸­å¿ƒè¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œæ­¤æ—¶è¯¥å¦‚ä½•å¤„ç†ã€‚</p><p>æŸ¥çœ‹æ–‡æ¡£å¦‚ä¸‹ï¼š å•æœºä¸²è¡Œï¼ˆé»˜è®¤ï¼‰ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œè°ƒåº¦è¯·æ±‚è¿›å…¥ FIFO é˜Ÿåˆ—å¹¶ä»¥ä¸²è¡Œæ–¹å¼è¿è¡Œï¼› ä¸¢å¼ƒåç»­è°ƒåº¦ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œå‘ç°æ‰§è¡Œå™¨å­˜åœ¨è¿è¡Œçš„è°ƒåº¦ä»»åŠ¡ï¼Œæœ¬æ¬¡è¯·æ±‚å°†ä¼šè¢«ä¸¢å¼ƒå¹¶æ ‡è®°ä¸ºå¤±è´¥ï¼› è¦†ç›–ä¹‹å‰è°ƒåº¦ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œå‘ç°æ‰§è¡Œå™¨å­˜åœ¨è¿è¡Œçš„è°ƒåº¦ä»»åŠ¡ï¼Œå°†ä¼šç»ˆæ­¢è¿è¡Œä¸­çš„è°ƒåº¦ä»»åŠ¡å¹¶æ¸…ç©ºé˜Ÿåˆ—ï¼Œç„¶åè¿è¡Œæœ¬åœ°è°ƒåº¦ä»»åŠ¡ï¼›</p><p>è¿™é‡Œå¦‚æœé€‰æ‹©è¦†ç›–ä¹‹å‰è°ƒåº¦åˆ™å¯èƒ½é‡å¤æ‰§è¡Œä»»åŠ¡ï¼Œè¿™é‡Œé€‰æ‹© ä¸¢å¼ƒåç»­è°ƒåº¦æˆ–å•æœºä¸²è¡Œæ–¹å¼æ¥é¿å…ä»»åŠ¡é‡å¤æ‰§è¡Œã€‚</p><p>åªåšè¿™äº›é…ç½®å¯ä»¥ä¿è¯ä»»åŠ¡ä¸ä¼šé‡å¤æ‰§è¡Œå—ï¼Ÿ</p><p>åšä¸åˆ°ï¼Œè¿˜éœ€è¦ä¿è¯ä»»åŠ¡å¤„ç†çš„å¹‚ç­‰æ€§ï¼Œ**ä»€ä¹ˆæ˜¯ä»»åŠ¡çš„å¹‚ç­‰æ€§ï¼Ÿ**ä»»åŠ¡çš„å¹‚ç­‰æ€§æ˜¯æŒ‡ï¼šå¯¹äºæ•°æ®çš„æ“ä½œä¸è®ºå¤šå°‘æ¬¡ï¼Œæ“ä½œçš„ç»“æœå§‹ç»ˆæ˜¯ä¸€è‡´çš„ã€‚åœ¨æœ¬é¡¹ç›®ä¸­è¦å®ç°çš„æ˜¯ä¸è®ºå¤šå°‘æ¬¡ä»»åŠ¡è°ƒåº¦åŒä¸€ä¸ªè§†é¢‘åªæ‰§è¡Œä¸€æ¬¡æˆåŠŸçš„è½¬ç ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ï¼Ÿ</strong></p><p>å®ƒæè¿°äº†ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºå¯¹äºèµ„æºæœ¬èº«åº”è¯¥å…·æœ‰åŒæ ·çš„ç»“æœã€‚</p><p>å¹‚ç­‰æ€§æ˜¯ä¸ºäº†è§£å†³é‡å¤æäº¤é—®é¢˜ï¼Œæ¯”å¦‚ï¼šæ¶æ„åˆ·å•ï¼Œé‡å¤æ”¯ä»˜ç­‰ã€‚</p><p>è§£å†³å¹‚ç­‰æ€§å¸¸ç”¨çš„æ–¹æ¡ˆï¼š</p><p>1ï¼‰æ•°æ®åº“çº¦æŸï¼Œæ¯”å¦‚ï¼šå”¯ä¸€ç´¢å¼•ï¼Œä¸»é”®ã€‚</p><p>2ï¼‰ä¹è§‚é”ï¼Œå¸¸ç”¨äºæ•°æ®åº“ï¼Œæ›´æ–°æ•°æ®æ—¶æ ¹æ®ä¹è§‚é”çŠ¶æ€å»æ›´æ–°ã€‚</p><p>3ï¼‰å”¯ä¸€åºåˆ—å·ï¼Œæ“ä½œä¼ é€’ä¸€ä¸ªå”¯ä¸€åºåˆ—å·ï¼Œæ“ä½œæ—¶åˆ¤æ–­ä¸è¯¥åºåˆ—å·ç›¸ç­‰åˆ™æ‰§è¡Œã€‚</p><p>åŸºäºä»¥ä¸Šåˆ†æï¼Œåœ¨æ‰§è¡Œå™¨æ¥æ”¶è°ƒåº¦è¯·æ±‚å»æ‰§è¡Œè§†é¢‘å¤„ç†ä»»åŠ¡æ—¶è¦å®ç°è§†é¢‘å¤„ç†çš„å¹‚ç­‰æ€§ï¼Œè¦æœ‰åŠæ³•å»åˆ¤æ–­è¯¥è§†é¢‘æ˜¯å¦å¤„ç†å®Œæˆï¼Œå¦‚æœæ­£åœ¨å¤„ç†ä¸­æˆ–å¤„ç†å®Œåˆ™ä¸å†å¤„ç†ã€‚è¿™é‡Œæˆ‘ä»¬åœ¨æ•°æ®åº“è§†é¢‘å¤„ç†è¡¨ä¸­æ·»åŠ å¤„ç†çŠ¶æ€å­—æ®µï¼Œè§†é¢‘å¤„ç†å®Œæˆæ›´æ–°çŠ¶æ€ä¸ºå®Œæˆï¼Œæ‰§è¡Œè§†é¢‘å¤„ç†å‰åˆ¤æ–­çŠ¶æ€æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆåˆ™ä¸å†å¤„ç†ã€‚</p><h4 id="_7-3-3-è§†é¢‘å¤„ç†æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_7-3-3-è§†é¢‘å¤„ç†æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>7.3.3 è§†é¢‘å¤„ç†æ–¹æ¡ˆ</strong></h4><p>ç¡®å®šäº†åˆ†ç‰‡æ–¹æ¡ˆï¼Œä¸‹è¾¹æ¢³ç†æ•´ä¸ªè§†é¢‘ä¸Šä¼ åŠå¤„ç†çš„ä¸šåŠ¡æµç¨‹ã€‚</p><p><img src="/MyBlog/assets/image-20230521181122420-af5ad695.png" alt="image-20230521181122420"></p><p>ä¸Šä¼ è§†é¢‘æˆåŠŸå‘è§†é¢‘å¤„ç†å¾…å¤„ç†è¡¨æ·»åŠ è®°å½•ã€‚</p><p>è§†é¢‘å¤„ç†çš„è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230521181128453-03bf1276.png" alt="image-20230521181128453"></p><p>1ã€ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒå¹¿æ’­ä½œä¸šåˆ†ç‰‡ã€‚</p><p>2ã€æ‰§è¡Œå™¨æ”¶åˆ°å¹¿æ’­ä½œä¸šåˆ†ç‰‡ï¼Œä»æ•°æ®åº“è¯»å–å¾…å¤„ç†ä»»åŠ¡ï¼Œè¯»å–æœªå¤„ç†åŠå¤„ç†å¤±è´¥çš„ä»»åŠ¡ã€‚</p><p>3ã€æ‰§è¡Œå™¨æ›´æ–°ä»»åŠ¡ä¸ºå¤„ç†ä¸­ï¼Œæ ¹æ®ä»»åŠ¡å†…å®¹ä» MinIO ä¸‹è½½è¦å¤„ç†çš„æ–‡ä»¶ã€‚</p><p>4ã€æ‰§è¡Œå™¨å¯åŠ¨å¤šçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ã€‚</p><p>5ã€ä»»åŠ¡å¤„ç†å®Œæˆï¼Œä¸Šä¼ å¤„ç†åçš„è§†é¢‘åˆ° MinIOã€‚</p><p>6ã€å°†æ›´æ–°ä»»åŠ¡å¤„ç†ç»“æœï¼Œå¦‚æœè§†é¢‘å¤„ç†å®Œæˆé™¤äº†æ›´æ–°ä»»åŠ¡å¤„ç†ç»“æœä»¥å¤–è¿˜è¦å°†æ–‡ä»¶çš„è®¿é—®åœ°å€æ›´æ–°è‡³ä»»åŠ¡å¤„ç†è¡¨åŠæ–‡ä»¶è¡¨ä¸­ï¼Œæœ€åå°†ä»»åŠ¡å®Œæˆè®°å½•å†™å…¥å†å²è¡¨ã€‚</p><h3 id="_7-4-æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_7-4-æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡" aria-hidden="true">#</a> <strong>7.4 æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡</strong></h3><h4 id="_7-4-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_7-4-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>7.4.1 éœ€æ±‚åˆ†æ</strong></h4><p>æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡åªå¤„ç†æœªæäº¤åŠå¤„ç†å¤±è´¥çš„ä»»åŠ¡ï¼Œä»»åŠ¡å¤„ç†å¤±è´¥åè¿›è¡Œé‡è¯•ï¼Œæœ€å¤šé‡è¯• 3 æ¬¡ã€‚</p><p>ä»»åŠ¡å¤„ç†æˆåŠŸå°†å¾…å¤„ç†è®°å½•ç§»åŠ¨åˆ°å†å²ä»»åŠ¡è¡¨ã€‚</p><p>ä¸‹å›¾æ˜¯å¾…å¤„ç†ä»»åŠ¡è¡¨ï¼š</p><p><img src="/MyBlog/assets/image-20230521181136042-a8c5c24c.png" alt="image-20230521181136042"></p><p>å†å²ä»»åŠ¡è¡¨ä¸å¾…å¤„ç†ä»»åŠ¡è¡¨çš„ç»“æ„ç›¸åŒã€‚</p><h4 id="_7-4-2-æ·»åŠ å¾…å¤„ç†ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_7-4-2-æ·»åŠ å¾…å¤„ç†ä»»åŠ¡" aria-hidden="true">#</a> <strong>7.4.2 æ·»åŠ å¾…å¤„ç†ä»»åŠ¡</strong></h4><p>ä¸Šä¼ è§†é¢‘æˆåŠŸå‘è§†é¢‘å¤„ç†å¾…å¤„ç†è¡¨æ·»åŠ è®°å½•ï¼Œæš‚æ—¶åªæ·»åŠ å¯¹ avi è§†é¢‘çš„å¤„ç†è®°å½•ã€‚</p><p>æ ¹æ® MIME Type å»åˆ¤æ–­æ˜¯å¦æ˜¯ avi è§†é¢‘ï¼Œä¸‹è¾¹åˆ—å‡ºéƒ¨åˆ† MIME Type</p><p><img src="/MyBlog/assets/image-20230521181143845-c0c5766f.png" alt="image-20230521181143845"></p><p>avi è§†é¢‘çš„ MIME Type æ˜¯ video/x-msvideo</p><p>ä¿®æ”¹æ–‡ä»¶ä¿¡æ¯å…¥åº“æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">MediaFiles</span> <span class="token function">addMediaFilesToDb</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span> <span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span> <span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">,</span> <span class="token class-name">String</span> bucket<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä»æ•°æ®åº“æŸ¥è¯¢æ–‡ä»¶</span>
    <span class="token class-name">MediaFiles</span> mediaFiles <span class="token operator">=</span> mediaFilesMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mediaFiles <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mediaFiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ‹·è´åŸºæœ¬ä¿¡æ¯</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>uploadFileParamsDto<span class="token punctuation">,</span> mediaFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setFileId</span><span class="token punctuation">(</span>fileMd5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setCompanyId</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åª’ä½“ç±»å‹</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> bucket <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setBucket</span><span class="token punctuation">(</span>bucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setFilePath</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setAuditStatus</span><span class="token punctuation">(</span><span class="token string">&quot;002003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ–‡ä»¶è¡¨</span>
        <span class="token keyword">int</span> insert <span class="token operator">=</span> mediaFilesMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>insert <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“å¤±è´¥,{}&quot;</span><span class="token punctuation">,</span> mediaFiles<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//æ·»åŠ åˆ°å¾…å¤„ç†ä»»åŠ¡è¡¨</span>
        <span class="token function">addWaitingTask</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“æˆåŠŸ,{}&quot;</span><span class="token punctuation">,</span> mediaFiles<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> mediaFiles<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * æ·»åŠ å¾…å¤„ç†ä»»åŠ¡
 * <span class="token keyword">@param</span> <span class="token parameter">mediaFiles</span> åª’èµ„æ–‡ä»¶ä¿¡æ¯
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWaitingTask</span><span class="token punctuation">(</span><span class="token class-name">MediaFiles</span> mediaFiles<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//æ–‡ä»¶åç§°</span>
    <span class="token class-name">String</span> filename <span class="token operator">=</span> mediaFiles<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶æ‰©å±•å</span>
    <span class="token class-name">String</span> exension <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ–‡ä»¶mimeType</span>
    <span class="token class-name">String</span> mimeType <span class="token operator">=</span> <span class="token function">getMimeType</span><span class="token punctuation">(</span>exension<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¦‚æœæ˜¯aviè§†é¢‘æ·»åŠ åˆ°è§†é¢‘å¾…å¤„ç†è¡¨</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>mimeType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;video/x-msvideo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MediaProcess</span> mediaProcess <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">,</span>mediaProcess<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaProcess<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æœªå¤„ç†</span>
        mediaProcess<span class="token punctuation">.</span><span class="token function">setFailCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¤±è´¥æ¬¡æ•°é»˜è®¤ä¸º0</span>
        mediaProcessMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿›è¡Œå‰åç«¯æµ‹è¯•ï¼Œä¸Šä¼  4 ä¸ª avi è§†é¢‘ï¼Œè§‚å¯Ÿå¾…å¤„ç†ä»»åŠ¡è¡¨æ˜¯å¦å­˜åœ¨è®°å½•ï¼Œè®°å½•æ˜¯å¦å®Œæˆ</p><h4 id="_7-4-3-æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_7-4-3-æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡" aria-hidden="true">#</a> <strong>7.4.3 æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡</strong></h4><p><strong>å¦‚ä½•ä¿è¯æŸ¥è¯¢åˆ°çš„å¾…å¤„ç†è§†é¢‘è®°å½•ä¸é‡å¤ï¼Ÿ</strong></p><p>ç¼–å†™æ ¹æ®åˆ†ç‰‡å‚æ•°è·å–å¾…å¤„ç†ä»»åŠ¡çš„ DAO æ–¹æ³•ï¼Œå®šä¹‰ DAO æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MediaProcessMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æ ¹æ®åˆ†ç‰‡å‚æ•°è·å–å¾…å¤„ç†ä»»åŠ¡
     * <span class="token keyword">@param</span> <span class="token parameter">shardTotal</span>  åˆ†ç‰‡æ€»æ•°
     * <span class="token keyword">@param</span> <span class="token parameter">shardindex</span>  åˆ†ç‰‡åºå·
     * <span class="token keyword">@param</span> <span class="token parameter">count</span> ä»»åŠ¡æ•°
     * <span class="token keyword">@return</span> java.util.List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.xuecheng.media.model.po.MediaProcess</span><span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/14 8:54
    */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from media_process t where t.id % #{shardTotal} = #{shardIndex} and (t.status = &#39;1&#39; or t.status = &#39;3&#39;) and t.fail_count &lt; 3 limit #{count}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectListByShardIndex</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;shardTotal&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> shardTotal<span class="token punctuation">,</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;shardIndex&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> shardIndex<span class="token punctuation">,</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ Service æ¥å£ï¼ŒæŸ¥è¯¢å¾…å¤„ç†</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageParams</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">RestResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">QueryMediaParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">UploadFileParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">UploadFileResultDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaFiles</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaProcess</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> åª’èµ„æ–‡ä»¶å¤„ç†ä¸šåŠ¡æ–¹æ³•
 * <span class="token keyword">@date</span> 2022/9/10 8:55
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MediaFileProcessService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> è·å–å¾…å¤„ç†ä»»åŠ¡
     * <span class="token keyword">@param</span> <span class="token parameter">shardIndex</span> åˆ†ç‰‡åºå·
     * <span class="token keyword">@param</span> <span class="token parameter">shardTotal</span> åˆ†ç‰‡æ€»æ•°
     * <span class="token keyword">@param</span> <span class="token parameter">count</span> è·å–è®°å½•æ•°
     * <span class="token keyword">@return</span> java.util.List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.xuecheng.media.model.po.MediaProcess</span><span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/14 14:49
    */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMediaProcessList</span><span class="token punctuation">(</span><span class="token keyword">int</span> shardTotal<span class="token punctuation">,</span><span class="token keyword">int</span> shardIndex<span class="token punctuation">,</span><span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>service æ¥å£å®ç°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MediaFilesMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MediaProcessHistoryMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MediaProcessMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaFiles</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaProcess</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaProcessHistory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MediaFileProcessService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeanUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">AutoConfigureOrder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/14 14:41
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediaFileProcessServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MediaFileProcessService</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">MediaFilesMapper</span> mediaFilesMapper<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">MediaProcessMapper</span> mediaProcessMapper<span class="token punctuation">;</span>


 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMediaProcessList</span><span class="token punctuation">(</span><span class="token keyword">int</span> shardIndex<span class="token punctuation">,</span> <span class="token keyword">int</span> shardTotal<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> mediaProcesses <span class="token operator">=</span> mediaProcessMapper<span class="token punctuation">.</span><span class="token function">selectListByShardIndex</span><span class="token punctuation">(</span>shardTotal<span class="token punctuation">,</span> shardIndex<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> mediaProcesses<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-å¼€å§‹æ‰§è¡Œä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_7-5-å¼€å§‹æ‰§è¡Œä»»åŠ¡" aria-hidden="true">#</a> <strong>7.5 å¼€å§‹æ‰§è¡Œä»»åŠ¡</strong></h3><h4 id="_7-5-1-åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#_7-5-1-åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> <strong>7.5.1 åˆ†å¸ƒå¼é”</strong></h4><p>ä¸ºäº†é¿å…å¤šçº¿ç¨‹å»äº‰æŠ¢åŒä¸€ä¸ªä»»åŠ¡å¯ä»¥ä½¿ç”¨ synchronized åŒæ­¥é”å»è§£å†³ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>é”å¯¹è±¡<span class="token punctuation">)</span><span class="token punctuation">{</span>
   æ‰§è¡Œä»»åŠ¡<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>synchronized åªèƒ½ä¿è¯åŒä¸€ä¸ªè™šæ‹Ÿæœºä¸­å¤šä¸ªçº¿ç¨‹å»äº‰æŠ¢é”ã€‚</p><p><img src="/MyBlog/assets/image-20230521181420329-40a32fea.png" alt="image-20230521181420329"></p><p>å¦‚æœæ˜¯å¤šä¸ªæ‰§è¡Œå™¨åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¹¶ä¸èƒ½ä¿è¯åŒä¸€ä¸ªè§†é¢‘åªæœ‰ä¸€ä¸ªæ‰§è¡Œå™¨å»å¤„ç†ã€‚</p><p>ç°åœ¨è¦å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ‰€æœ‰è™šæ‹Ÿæœºä¸­çš„çº¿ç¨‹å»åŒæ­¥æ‰§è¡Œå°±éœ€è¦è®©å¤šä¸ªè™šæ‹Ÿæœºå»å…±ç”¨ä¸€ä¸ªé”ï¼Œè™šæ‹Ÿæœºå¯ä»¥åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œé”ä¹Ÿå¯ä»¥åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521181425785-ee889a1c.png" alt="image-20230521181425785"></p><p>è™šæ‹Ÿæœºéƒ½å»æŠ¢å åŒä¸€ä¸ªé”ï¼Œé”æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç¨‹åºæä¾›åŠ é”ã€è§£é”æœåŠ¡ã€‚</p><p>è¯¥é”å·²ä¸å±äºæŸä¸ªè™šæ‹Ÿæœºï¼Œè€Œæ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œç”±å¤šä¸ªè™šæ‹Ÿæœºæ‰€å…±äº«ï¼Œè¿™ç§é”å«<strong>åˆ†å¸ƒå¼é”</strong>ã€‚</p><p>å®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p><p>1ã€åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒé”</p><p>åˆ©ç”¨æ•°æ®åº“ä¸»é”®å”¯ä¸€æ€§çš„ç‰¹ç‚¹ï¼Œæˆ–åˆ©ç”¨æ•°æ®åº“å”¯ä¸€ç´¢å¼•ã€è¡Œçº§é”çš„ç‰¹ç‚¹ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å»æ›´æ–°ç›¸åŒçš„è®°å½•ï¼Œè°æ›´æ–°æˆåŠŸè°å°±æŠ¢åˆ°é”ã€‚</p><p>2ã€åŸºäº redis å®ç°é”</p><p>redis æä¾›äº†åˆ†å¸ƒå¼é”çš„å®ç°æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼šSETNXã€set nxã€redisson ç­‰ã€‚</p><p>æ‹¿ SETNX ä¸¾ä¾‹è¯´æ˜ï¼ŒSETNX å‘½ä»¤çš„å·¥ä½œè¿‡ç¨‹æ˜¯å» set ä¸€ä¸ªä¸å­˜åœ¨çš„ keyï¼Œå¤šä¸ªçº¿ç¨‹å»è®¾ç½®åŒä¸€ä¸ª key åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹è®¾ç½®æˆåŠŸï¼Œè®¾ç½®æˆåŠŸçš„çš„çº¿ç¨‹æ‹¿åˆ°é”ã€‚</p><p>3ã€ä½¿ç”¨ zookeeper å®ç°</p><p>zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œä¸»è¦è§£å†³åˆ†å¸ƒå¼ç¨‹åºä¹‹é—´çš„åŒæ­¥çš„é—®é¢˜ã€‚zookeeper çš„ç»“æ„ç±»ä¼¼çš„æ–‡ä»¶ç›®å½•ï¼Œå¤šçº¿ç¨‹å‘ zookeeper åˆ›å»ºä¸€ä¸ªå­ç›®å½•(èŠ‚ç‚¹)åªä¼šæœ‰ä¸€ä¸ªåˆ›å»ºæˆåŠŸï¼Œåˆ©ç”¨æ­¤ç‰¹ç‚¹å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼Œè°åˆ›å»ºè¯¥ç»“ç‚¹æˆåŠŸè°å°±è·å¾—é”ã€‚</p><h4 id="_7-5-2-å¼€å¯ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_7-5-2-å¼€å¯ä»»åŠ¡" aria-hidden="true">#</a> <strong>7.5.2 å¼€å¯ä»»åŠ¡</strong></h4><p>ä¸‹è¾¹åŸºäºæ•°æ®åº“æ–¹å¼å®ç°åˆ†å¸ƒé”ï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡å°†ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€æ›´æ–°ä¸º 4 è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œä¸­ã€‚</p><p>ä¸‹è¾¹çš„ sql è¯­å¥å¯ä»¥å®ç°æ›´æ–°æ“ä½œï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> media_process m <span class="token keyword">set</span> m<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token operator">=</span><span class="token string">&#39;4&#39;</span> <span class="token keyword">where</span>  m<span class="token punctuation">.</span>id<span class="token operator">=</span>?

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ˜¯å¤šä¸ªçº¿ç¨‹å»æ‰§è¡Œè¯¥ sql éƒ½å°†ä¼šæ‰§è¡ŒæˆåŠŸï¼Œä½†éœ€æ±‚æ˜¯åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°é”ï¼Œæ‰€ä»¥æ­¤ sql æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚</p><p>ä¸‹è¾¹ä½¿ç”¨ä¹è§‚é”çš„æ–¹å¼å®ç°æ›´æ–°æ“ä½œï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> media_process m <span class="token keyword">set</span> m<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token operator">=</span><span class="token string">&#39;4&#39;</span> <span class="token keyword">where</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token operator">=</span><span class="token string">&#39;1&#39;</span> <span class="token operator">or</span> m<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token operator">=</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span> <span class="token operator">and</span> m<span class="token punctuation">.</span>fail_count <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">and</span> m<span class="token punctuation">.</span>id<span class="token operator">=</span>?

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä¸Šè¾¹çš„ sql åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæˆåŠŸã€‚</p><p><strong>ä»€ä¹ˆæ˜¯ä¹è§‚é”ã€æ‚²è§‚é”ï¼Ÿ</strong></p><p>synchronized æ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œåœ¨æ‰§è¡Œè¢« synchronized åŒ…è£¹çš„ä»£ç æ—¶éœ€è¦é¦–å…ˆè·å–é”ï¼Œæ²¡æœ‰æ‹¿åˆ°é”åˆ™æ— æ³•æ‰§è¡Œï¼Œæ˜¯æ€»æ‚²è§‚çš„è®¤ä¸ºåˆ«çš„çº¿ç¨‹ä¼šå»æŠ¢ï¼Œæ‰€ä»¥å«æ‚²è§‚é”ã€‚</p><p>ä¹è§‚é”çš„æ€æƒ³æ˜¯å®ƒä¸è®¤ä¸ºä¼šæœ‰çº¿ç¨‹å»äº‰æŠ¢ï¼Œå°½ç®¡å»æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡ŒæˆåŠŸå°±å†å»é‡è¯•ã€‚</p><p>å®ç°å¦‚ä¸‹ï¼š</p><p>1ã€å®šä¹‰ mapper</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MediaProcessMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * å¼€å¯ä¸€ä¸ªä»»åŠ¡
     * <span class="token keyword">@param</span> <span class="token parameter">id</span> ä»»åŠ¡id
     * <span class="token keyword">@return</span> æ›´æ–°è®°å½•æ•°
     */</span>
    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;update media_process m set m.status=&#39;4&#39; where (m.status=&#39;1&#39; or m.status=&#39;3&#39;) and m.fail_count&lt;3 and m.id=#{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">startTask</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€service æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *  å¼€å¯ä¸€ä¸ªä»»åŠ¡
 * <span class="token keyword">@param</span> <span class="token parameter">id</span> ä»»åŠ¡id
 * <span class="token keyword">@return</span> trueå¼€å¯ä»»åŠ¡æˆåŠŸï¼Œfalseå¼€å¯ä»»åŠ¡å¤±è´¥
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">startTask</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//å®ç°å¦‚ä¸‹</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">startTask</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> mediaProcessMapper<span class="token punctuation">.</span><span class="token function">startTask</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token operator">?</span><span class="token boolean">false</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-6-æ›´æ–°ä»»åŠ¡çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#_7-6-æ›´æ–°ä»»åŠ¡çŠ¶æ€" aria-hidden="true">#</a> <strong>7.6 æ›´æ–°ä»»åŠ¡çŠ¶æ€</strong></h3><p>ä»»åŠ¡å¤„ç†å®Œæˆéœ€è¦æ›´æ–°ä»»åŠ¡å¤„ç†ç»“æœï¼Œä»»åŠ¡æ‰§è¡ŒæˆåŠŸæ›´æ–°è§†é¢‘çš„ URLã€åŠä»»åŠ¡å¤„ç†ç»“æœï¼Œå°†å¾…å¤„ç†ä»»åŠ¡è®°å½•åˆ é™¤ï¼ŒåŒæ—¶å‘å†å²ä»»åŠ¡è¡¨æ·»åŠ è®°å½•ã€‚</p><p>åœ¨ MediaFileProcessService æ¥å£æ·»åŠ æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> ä¿å­˜ä»»åŠ¡ç»“æœ
 * <span class="token keyword">@param</span> <span class="token parameter">taskId</span>  ä»»åŠ¡id
 * <span class="token keyword">@param</span> <span class="token parameter">status</span> ä»»åŠ¡çŠ¶æ€
 * <span class="token keyword">@param</span> <span class="token parameter">fileId</span>  æ–‡ä»¶id
 * <span class="token keyword">@param</span> <span class="token parameter">url</span> url
 * <span class="token keyword">@param</span> <span class="token parameter">errorMsg</span> é”™è¯¯ä¿¡æ¯
 * <span class="token keyword">@return</span> void
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/15 11:29
 */</span>
<span class="token keyword">void</span> <span class="token function">saveProcessFinishStatus</span><span class="token punctuation">(</span><span class="token class-name">Long</span> taskId<span class="token punctuation">,</span><span class="token class-name">String</span> status<span class="token punctuation">,</span><span class="token class-name">String</span> fileId<span class="token punctuation">,</span><span class="token class-name">String</span> url<span class="token punctuation">,</span><span class="token class-name">String</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>service æ¥å£æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MediaFilesMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MediaProcessHistoryMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MediaProcessMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaFiles</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaProcess</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaProcessHistory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MediaFileProcessService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeanUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">AutoConfigureOrder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/14 14:41
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediaFileProcessServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MediaFileProcessService</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">MediaFilesMapper</span> mediaFilesMapper<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">MediaProcessMapper</span> mediaProcessMapper<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">MediaProcessHistoryMapper</span> mediaProcessHistoryMapper<span class="token punctuation">;</span>



<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveProcessFinishStatus</span><span class="token punctuation">(</span><span class="token class-name">Long</span> taskId<span class="token punctuation">,</span> <span class="token class-name">String</span> status<span class="token punctuation">,</span> <span class="token class-name">String</span> fileId<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> errorMsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æŸ¥å‡ºä»»åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç›´æ¥è¿”å›</span>
    <span class="token class-name">MediaProcess</span> mediaProcess <span class="token operator">=</span> mediaProcessMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>mediaProcess <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¤„ç†å¤±è´¥ï¼Œæ›´æ–°ä»»åŠ¡å¤„ç†ç»“æœ</span>
    <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> queryWrapperById <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">MediaProcess</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¤„ç†å¤±è´¥</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MediaProcess</span> mediaProcess_u <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaProcess_u<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaProcess_u<span class="token punctuation">.</span><span class="token function">setErrormsg</span><span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaProcess_u<span class="token punctuation">.</span><span class="token function">setFailCount</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">.</span><span class="token function">getFailCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaProcessMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>mediaProcess_u<span class="token punctuation">,</span>queryWrapperById<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°ä»»åŠ¡å¤„ç†çŠ¶æ€ä¸ºå¤±è´¥ï¼Œä»»åŠ¡ä¿¡æ¯:{}&quot;</span><span class="token punctuation">,</span>mediaProcess_u<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ä»»åŠ¡å¤„ç†æˆåŠŸ</span>
    <span class="token class-name">MediaFiles</span> mediaFiles <span class="token operator">=</span> mediaFilesMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>mediaFiles<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//æ›´æ–°åª’èµ„æ–‡ä»¶ä¸­çš„è®¿é—®url</span>
        mediaFiles<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaFilesMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¤„ç†æˆåŠŸï¼Œæ›´æ–°urlå’ŒçŠ¶æ€</span>
    mediaProcess<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaProcess<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaProcess<span class="token punctuation">.</span><span class="token function">setFinishDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaProcessMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æ·»åŠ åˆ°å†å²è®°å½•</span>
    <span class="token class-name">MediaProcessHistory</span> mediaProcessHistory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaProcessHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">,</span> mediaProcessHistory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaProcessHistoryMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>mediaProcessHistory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆ é™¤mediaProcess</span>
    mediaProcessMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMediaProcessList</span><span class="token punctuation">(</span><span class="token keyword">int</span> shardIndex<span class="token punctuation">,</span> <span class="token keyword">int</span> shardTotal<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> mediaProcesses <span class="token operator">=</span> mediaProcessMapper<span class="token punctuation">.</span><span class="token function">selectListByShardIndex</span><span class="token punctuation">(</span>shardTotal<span class="token punctuation">,</span> shardIndex<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> mediaProcesses<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-7-è§†é¢‘å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7-7-è§†é¢‘å¤„ç†" aria-hidden="true">#</a> <strong>7.7 è§†é¢‘å¤„ç†</strong></h3><p>è§†é¢‘é‡‡ç”¨å¹¶å‘å¤„ç†ï¼Œæ¯ä¸ªè§†é¢‘ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ï¼Œæ¯æ¬¡å¤„ç†çš„è§†é¢‘æ•°é‡ä¸è¦è¶…è¿‡ cpu æ ¸å¿ƒæ•°ã€‚</p><p>æ‰€æœ‰è§†é¢‘å¤„ç†å®Œæˆç»“æŸæœ¬æ¬¡æ‰§è¡Œï¼Œä¸ºé˜²æ­¢ä»£ç å¼‚å¸¸å‡ºç°æ— é™æœŸç­‰å¾…åˆ™æ·»åŠ è¶…æ—¶è®¾ç½®ï¼Œåˆ°è¾¾è¶…æ—¶æ—¶é—´è¿˜æ²¡æœ‰å¤„ç†å®Œæˆä»ç»“æŸä»»åŠ¡ã€‚</p><p>å®šä¹‰ä»»åŠ¡ç±» VideoTask å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span>jobhander</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">Mp4VideoUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MediaProcess</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MediaFileProcessService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>media<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MediaFileService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">XxlJobHelper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">XxlJob</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/10/15 11:58
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoTask</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MediaFileService</span> mediaFileService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MediaFileProcessService</span> mediaFileProcessService<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${videoprocess.ffmpegpath}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> ffmpegpath<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@XxlJob</span><span class="token punctuation">(</span><span class="token string">&quot;videoJobHandler&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">videoJobHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">// åˆ†ç‰‡å‚æ•°</span>
    <span class="token keyword">int</span> shardIndex <span class="token operator">=</span> <span class="token class-name">XxlJobHelper</span><span class="token punctuation">.</span><span class="token function">getShardIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> shardTotal <span class="token operator">=</span> <span class="token class-name">XxlJobHelper</span><span class="token punctuation">.</span><span class="token function">getShardTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaProcess</span><span class="token punctuation">&gt;</span></span> mediaProcessList <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//å–å‡ºcpuæ ¸å¿ƒæ•°ä½œä¸ºä¸€æ¬¡å¤„ç†æ•°æ®çš„æ¡æ•°</span>
        <span class="token keyword">int</span> processors <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¸€æ¬¡å¤„ç†è§†é¢‘æ•°é‡ä¸è¦è¶…è¿‡cpuæ ¸å¿ƒæ•°</span>
        mediaProcessList <span class="token operator">=</span> mediaFileProcessService<span class="token punctuation">.</span><span class="token function">getMediaProcessList</span><span class="token punctuation">(</span>shardIndex<span class="token punctuation">,</span> shardTotal<span class="token punctuation">,</span> processors<span class="token punctuation">)</span><span class="token punctuation">;</span>
        size <span class="token operator">=</span> mediaProcessList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å–å‡ºå¾…å¤„ç†è§†é¢‘ä»»åŠ¡{}æ¡&quot;</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¯åŠ¨sizeä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </span>
    <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®¡æ•°å™¨</span>
    <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å°†å¤„ç†ä»»åŠ¡åŠ å…¥çº¿ç¨‹æ± </span>
    mediaProcessList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>mediaProcess <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//ä»»åŠ¡id</span>
                <span class="token class-name">Long</span> taskId <span class="token operator">=</span> mediaProcess<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//æŠ¢å ä»»åŠ¡</span>
                <span class="token keyword">boolean</span> b <span class="token operator">=</span> mediaFileProcessService<span class="token punctuation">.</span><span class="token function">startTask</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œä»»åŠ¡:{}&quot;</span><span class="token punctuation">,</span> mediaProcess<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ä¸‹è¾¹æ˜¯å¤„ç†é€»è¾‘</span>
                <span class="token comment">//æ¡¶</span>
                <span class="token class-name">String</span> bucket <span class="token operator">=</span> mediaProcess<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//å­˜å‚¨è·¯å¾„</span>
                <span class="token class-name">String</span> filePath <span class="token operator">=</span> mediaProcess<span class="token punctuation">.</span><span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//åŸå§‹è§†é¢‘çš„md5å€¼</span>
                <span class="token class-name">String</span> fileId <span class="token operator">=</span> mediaProcess<span class="token punctuation">.</span><span class="token function">getFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//åŸå§‹æ–‡ä»¶åç§°</span>
                <span class="token class-name">String</span> filename <span class="token operator">=</span> mediaProcess<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//å°†è¦å¤„ç†çš„æ–‡ä»¶ä¸‹è½½åˆ°æœåŠ¡å™¨ä¸Š</span>
                 <span class="token class-name">File</span> originalFile <span class="token operator">=</span> mediaFileService<span class="token punctuation">.</span><span class="token function">downloadFileFromMinIO</span><span class="token punctuation">(</span>bucket<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>originalFile <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸‹è½½å¾…å¤„ç†æ–‡ä»¶å¤±è´¥,originalFile:{}&quot;</span><span class="token punctuation">,</span> mediaProcess<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">.</span><span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mediaFileProcessService<span class="token punctuation">.</span><span class="token function">saveProcessFinishStatus</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> fileId<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¸‹è½½å¾…å¤„ç†æ–‡ä»¶å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//å¤„ç†ç»“æŸçš„è§†é¢‘æ–‡ä»¶</span>
                <span class="token class-name">File</span> mp4File <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    mp4File <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span><span class="token string">&quot;mp4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ›å»ºmp4ä¸´æ—¶æ–‡ä»¶å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mediaFileProcessService<span class="token punctuation">.</span><span class="token function">saveProcessFinishStatus</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> fileId<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;åˆ›å»ºmp4ä¸´æ—¶æ–‡ä»¶å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//è§†é¢‘å¤„ç†ç»“æœ</span>
                <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">//å¼€å§‹å¤„ç†è§†é¢‘</span>
                    <span class="token class-name">Mp4VideoUtil</span> videoUtil <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mp4VideoUtil</span><span class="token punctuation">(</span>ffmpegpath<span class="token punctuation">,</span> originalFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mp4File<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mp4File<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//å¼€å§‹è§†é¢‘è½¬æ¢ï¼ŒæˆåŠŸå°†è¿”å›success</span>
                    result <span class="token operator">=</span> videoUtil<span class="token punctuation">.</span><span class="token function">generateMp4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†è§†é¢‘æ–‡ä»¶:{},å‡ºé”™:{}&quot;</span><span class="token punctuation">,</span> mediaProcess<span class="token punctuation">.</span><span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//è®°å½•é”™è¯¯ä¿¡æ¯</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†è§†é¢‘å¤±è´¥,è§†é¢‘åœ°å€:{},é”™è¯¯ä¿¡æ¯:{}&quot;</span><span class="token punctuation">,</span> bucket <span class="token operator">+</span> filePath<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mediaFileProcessService<span class="token punctuation">.</span><span class="token function">saveProcessFinishStatus</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> fileId<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//å°†mp4ä¸Šä¼ è‡³minio</span>
                <span class="token comment">//mp4åœ¨minioçš„å­˜å‚¨è·¯å¾„</span>
                <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token function">getFilePath</span><span class="token punctuation">(</span>fileId<span class="token punctuation">,</span> <span class="token string">&quot;.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è®¿é—®url</span>
                <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> bucket <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> objectName<span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    mediaFileService<span class="token punctuation">.</span><span class="token function">addMediaFilesToMinIO</span><span class="token punctuation">(</span>mp4File<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;video/mp4&quot;</span><span class="token punctuation">,</span> bucket<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//å°†urlå­˜å‚¨è‡³æ•°æ®ï¼Œå¹¶æ›´æ–°çŠ¶æ€ä¸ºæˆåŠŸï¼Œå¹¶å°†å¾…å¤„ç†è§†é¢‘è®°å½•åˆ é™¤å­˜å…¥å†å²</span>
                    mediaFileProcessService<span class="token punctuation">.</span><span class="token function">saveProcessFinishStatus</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> fileId<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ è§†é¢‘å¤±è´¥æˆ–å…¥åº“å¤±è´¥,è§†é¢‘åœ°å€:{},é”™è¯¯ä¿¡æ¯:{}&quot;</span><span class="token punctuation">,</span> bucket <span class="token operator">+</span> objectName<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//æœ€ç»ˆè¿˜æ˜¯å¤±è´¥äº†</span>
                    mediaFileProcessService<span class="token punctuation">.</span><span class="token function">saveProcessFinishStatus</span><span class="token punctuation">(</span>mediaProcess<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> fileId<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;å¤„ç†åè§†é¢‘ä¸Šä¼ æˆ–å…¥åº“å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ç­‰å¾…,ç»™ä¸€ä¸ªå……è£•çš„è¶…æ—¶æ—¶é—´,é˜²æ­¢æ— é™ç­‰å¾…ï¼Œåˆ°è¾¾è¶…æ—¶æ—¶é—´è¿˜æ²¡æœ‰å¤„ç†å®Œæˆåˆ™ç»“æŸä»»åŠ¡</span>
    countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MINUTES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileMd5<span class="token punctuation">,</span><span class="token class-name">String</span> fileExt<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span>   fileMd5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileMd5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileMd5 <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span>fileMd5 <span class="token operator">+</span>fileExt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-8-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_7-8-æµ‹è¯•" aria-hidden="true">#</a> <strong>7.8 æµ‹è¯•</strong></h3><h4 id="_7-8-1-åŸºæœ¬æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_7-8-1-åŸºæœ¬æµ‹è¯•" aria-hidden="true">#</a> <strong>7.8.1 åŸºæœ¬æµ‹è¯•</strong></h4><p>è¿›å…¥ xxl-job è°ƒåº¦ä¸­å¿ƒæ·»åŠ æ‰§è¡Œå™¨å’Œè§†é¢‘å¤„ç†ä»»åŠ¡</p><p>åœ¨ xxl-job é…ç½®ä»»åŠ¡è°ƒåº¦ç­–ç•¥ï¼š</p><p>1ï¼‰é…ç½®é˜»å¡å¤„ç†ç­–ç•¥ä¸ºï¼šä¸¢å¼ƒåç»­è°ƒåº¦ã€‚</p><p>2ï¼‰é…ç½®è§†é¢‘å¤„ç†è°ƒåº¦æ—¶é—´é—´éš”ä¸ç”¨æ ¹æ®è§†é¢‘å¤„ç†æ—¶é—´å»ç¡®å®šï¼Œå¯ä»¥é…ç½®çš„å°ä¸€äº›ï¼Œå¦‚ï¼š5 åˆ†é’Ÿï¼Œå³ä½¿åˆ°è¾¾è°ƒåº¦æ—¶é—´å¦‚æœè§†é¢‘æ²¡æœ‰å¤„ç†å®Œä¼šä¸¢å¼ƒè°ƒåº¦è¯·æ±‚ã€‚</p><p>é…ç½®å®Œæˆå¼€å§‹æµ‹è¯•è§†é¢‘å¤„ç†ï¼š</p><p>1ã€é¦–å…ˆä¸Šä¼ è‡³å°‘ 4 ä¸ªè§†é¢‘ï¼Œé mp4 æ ¼å¼ã€‚</p><p>2ã€åœ¨ xxl-job å¯åŠ¨è§†é¢‘å¤„ç†ä»»åŠ¡</p><p>3ã€è§‚å¯Ÿåª’èµ„ç®¡ç†æœåŠ¡åå°æ—¥å¿—</p><h4 id="_7-8-2-å¤±è´¥æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_7-8-2-å¤±è´¥æµ‹è¯•" aria-hidden="true">#</a> <strong>7.8.2 å¤±è´¥æµ‹è¯•</strong></h4><p>1ã€å…ˆåœæ­¢è°ƒåº¦ä¸­å¿ƒçš„è§†é¢‘å¤„ç†ä»»åŠ¡ã€‚</p><p>2ã€ä¸Šä¼ è§†é¢‘ï¼Œæ‰‹åŠ¨ä¿®æ”¹å¾…å¤„ç†ä»»åŠ¡è¡¨ä¸­ file_path å­—æ®µä¸ºä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åœ°å€</p><p>3ã€å¯åŠ¨ä»»åŠ¡</p><p>è§‚å¯Ÿä»»åŠ¡å¤„ç†å¤±è´¥åæ˜¯å¦ä¼šé‡è¯•ï¼Œå¹¶è®°å½•å¤±è´¥æ¬¡æ•°ã€‚</p><h4 id="_7-8-3-æŠ¢å ä»»åŠ¡æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_7-8-3-æŠ¢å ä»»åŠ¡æµ‹è¯•" aria-hidden="true">#</a> <strong>7.8.3 æŠ¢å ä»»åŠ¡æµ‹è¯•</strong></h4><p>1ã€ä¿®æ”¹è°ƒåº¦ä¸­å¿ƒä¸­è§†é¢‘å¤„ç†ä»»åŠ¡çš„é˜»å¡å¤„ç†ç­–ç•¥ä¸ºâ€œè¦†ç›–ä¹‹é—´çš„è°ƒåº¦â€</p><p><img src="/MyBlog/assets/image-20230521181651102-595ab0a4.png" alt="image-20230521181651102"></p><p>2ã€åœ¨æŠ¢å ä»»åŠ¡ä»£ç å¤„æ‰“æ–­ç‚¹å¹¶é€‰æ‹©æ”¯æŒå¤šçº¿ç¨‹æ–¹å¼</p><p><img src="/MyBlog/assets/image-20230521181657594-ecf40b44.png" alt="image-20230521181657594"></p><p>3ã€åœ¨æŠ¢å ä»»åŠ¡ä»£ç å¤„çš„ä¸‹è¾¹ä¸¤è¡Œä»£ç åˆ†åˆ«æ‰“ä¸Šæ–­ç‚¹ï¼Œé¿å…è§‚å¯Ÿæ—¶ä»£ç ç»§ç»­æ‰§è¡Œã€‚</p><p>4ã€å¯åŠ¨ä»»åŠ¡</p><p>æ­¤æ—¶å¤šä¸ªçº¿ç¨‹æ‰§è¡Œéƒ½åœç•™åœ¨æ–­ç‚¹å¤„</p><p><img src="/MyBlog/assets/image-20230521181704394-9e47af61.png" alt="image-20230521181704394"></p><p>ä¾æ¬¡æ”¾è¡Œï¼Œè§‚å¯ŸåŒä¸€ä¸ªä»»åŠ¡åªä¼šè¢«ä¸€ä¸ªçº¿ç¨‹æŠ¢å æˆåŠŸã€‚</p><p><img src="/MyBlog/assets/image-20230521181709767-ae65f5ae.png" alt="image-20230521181709767"></p><p><img src="/MyBlog/assets/image-20230521181714516-606befb7.png" alt="image-20230521181714516"></p><h3 id="_7-9-å…¶å®ƒé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_7-9-å…¶å®ƒé—®é¢˜" aria-hidden="true">#</a> <strong>7.9 å…¶å®ƒé—®é¢˜</strong></h3><h4 id="_7-9-1-ä»»åŠ¡è¡¥å¿æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_7-9-1-ä»»åŠ¡è¡¥å¿æœºåˆ¶" aria-hidden="true">#</a> <strong>7.9.1 ä»»åŠ¡è¡¥å¿æœºåˆ¶</strong></h4><p>å¦‚æœæœ‰çº¿ç¨‹æŠ¢å äº†æŸä¸ªè§†é¢‘çš„å¤„ç†ä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹å¤„ç†è¿‡ç¨‹ä¸­æŒ‚æ‰äº†ï¼Œè¯¥è§†é¢‘çš„çŠ¶æ€å°†ä¼šä¸€ç›´æ˜¯å¤„ç†ä¸­ï¼Œå…¶å®ƒçº¿ç¨‹å°†æ— æ³•å¤„ç†ï¼Œè¿™ä¸ªé—®é¢˜éœ€è¦ç”¨è¡¥å¿æœºåˆ¶ã€‚</p><p>å•ç‹¬å¯åŠ¨ä¸€ä¸ªä»»åŠ¡æ‰¾åˆ°å¾…å¤„ç†ä»»åŠ¡è¡¨ä¸­è¶…è¿‡æ‰§è¡ŒæœŸé™ä½†ä»åœ¨å¤„ç†ä¸­çš„ä»»åŠ¡ï¼Œå°†ä»»åŠ¡çš„çŠ¶æ€æ”¹ä¸ºæ‰§è¡Œå¤±è´¥ã€‚</p><p>ä»»åŠ¡æ‰§è¡ŒæœŸé™æ˜¯å¤„ç†ä¸€ä¸ªè§†é¢‘çš„æœ€å¤§æ—¶é—´ï¼Œæ¯”å¦‚å®šä¸º 30 åˆ†é’Ÿï¼Œé€šè¿‡ä»»åŠ¡çš„å¯åŠ¨æ—¶é—´å»åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¶…è¿‡æ‰§è¡ŒæœŸé™ã€‚</p><p>å¤§å®¶æ€è€ƒè¿™ä¸ª sql è¯¥å¦‚ä½•å®ç°ï¼Ÿ</p><p>å¤§å®¶å°è¯•è‡ªå·±å®ç°æ­¤ä»»åŠ¡è¡¥å¿æœºåˆ¶ã€‚</p><h4 id="_7-9-2-è¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•°" tabindex="-1"><a class="header-anchor" href="#_7-9-2-è¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•°" aria-hidden="true">#</a> <strong>7.9.2 è¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•°</strong></h4><p>å½“ä»»åŠ¡è¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•°æ—¶ä¸€èˆ¬å°±è¯´æ˜ç¨‹åºå¤„ç†æ­¤è§†é¢‘å­˜åœ¨é—®é¢˜ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦äººå·¥å¤„ç†ï¼Œåœ¨é¡µé¢ä¸Šä¼šæç¤ºå¤±è´¥çš„ä¿¡æ¯ï¼Œäººå·¥å¯æ‰‹åŠ¨æ‰§è¡Œè¯¥è§†é¢‘è¿›è¡Œå¤„ç†ï¼Œæˆ–é€šè¿‡å…¶å®ƒè½¬ç å·¥å…·è¿›è¡Œè§†é¢‘è½¬ç ï¼Œè½¬ç åç›´æ¥ä¸Šä¼  mp4 è§†é¢‘ã€‚</p><h2 id="_8-ç»‘å®šåª’èµ„" tabindex="-1"><a class="header-anchor" href="#_8-ç»‘å®šåª’èµ„" aria-hidden="true">#</a> <strong>8 ç»‘å®šåª’èµ„</strong></h2><h3 id="_8-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_8-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>8.1 éœ€æ±‚åˆ†æ</strong></h3><h4 id="_8-1-1-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_8-1-1-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>8.1.1 ä¸šåŠ¡æµç¨‹</strong></h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåª’èµ„ç®¡ç†å·²å®Œæˆæ–‡ä»¶ä¸Šä¼ ã€è§†é¢‘å¤„ç†ã€æˆ‘çš„åª’èµ„åŠŸèƒ½ç­‰åŸºæœ¬åŠŸèƒ½ï¼Œå…¶å®ƒæ¨¡å—å¯ä»¥ä½¿ç”¨åª’èµ„æ–‡ä»¶ï¼Œæœ¬èŠ‚è¦è®²è§£è¯¾ç¨‹è®¡åˆ’ç»‘å®šåª’èµ„æ–‡ä»¶ã€‚</p><p>å¦‚ä½•å°†è¯¾ç¨‹è®¡åˆ’ç»‘å®šåª’èµ„å‘¢ï¼Ÿ</p><p>é¦–å…ˆè¿›å…¥è¯¾ç¨‹è®¡åˆ’ç•Œé¢ï¼Œç„¶åé€‰æ‹©è¦ç»‘å®šçš„è§†é¢‘è¿›è¡Œç»‘å®šå³å¯ã€‚</p><p>å…·ä½“çš„ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p><p>1.æ•™è‚²æœºæ„ç”¨æˆ·è¿›å…¥è¯¾ç¨‹ç®¡ç†é¡µé¢å¹¶ç¼–è¾‘æŸä¸€ä¸ªè¯¾ç¨‹ï¼Œåœ¨&quot;è¯¾ç¨‹å¤§çº²&quot;æ ‡ç­¾é¡µçš„æŸä¸€å°èŠ‚åå¯ç‚¹å‡»â€æ·»åŠ è§†é¢‘â€œã€‚</p><p><img src="/MyBlog/assets/image-20230521172936979-a0af02f0.png" alt="image-20230521181734951"></p><p>2.å¼¹å‡ºæ·»åŠ è§†é¢‘å¯¹è¯æ¡†ï¼Œå¯é€šè¿‡è§†é¢‘å…³é”®å­—æœç´¢å·²å®¡æ ¸é€šè¿‡çš„è§†é¢‘åª’èµ„ã€‚</p><p><img src="/MyBlog/assets/image-20230521172943466-f5fa9803.png" alt="image-20230521181740422"></p><p>3.é€‰æ‹©è§†é¢‘åª’èµ„ï¼Œç‚¹å‡»æäº¤æŒ‰é’®ï¼Œå®Œæˆè¯¾ç¨‹è®¡åˆ’ç»‘å®šåª’èµ„æµç¨‹ã€‚</p><p><img src="/MyBlog/assets/image-20230521172953841-176a63dd.png" alt="image-20230521181746130"></p><p>è¯¾ç¨‹è®¡åˆ’å…³è”è§†é¢‘åå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230521172959743-85b2922d.png" alt="image-20230521181753498"></p><p>ç‚¹å‡»å·²ç»ç»‘å®šçš„è§†é¢‘åç§°å³å¯è§£é™¤ç»‘å®šã€‚</p><p><img src="/MyBlog/assets/image-20230521181759166-42c56aa5.png" alt="image-20230521181759166"></p><h4 id="_8-1-2-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_8-1-2-æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>8.1.2 æ•°æ®æ¨¡å‹</strong></h4><p>è¯¾ç¨‹è®¡åˆ’ç»‘å®šåª’èµ„æ–‡ä»¶åå­˜å‚¨è‡³è¯¾ç¨‹è®¡åˆ’ç»‘å®šåª’èµ„è¡¨</p><p><img src="/MyBlog/assets/image-20230521181804767-6d4de7a1.png" alt="image-20230521181804767"></p><h3 id="_8-2-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_8-2-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>8.2 æ¥å£å®šä¹‰</strong></h3><p>æ ¹æ®ä¸šåŠ¡æµç¨‹ï¼Œç”¨æˆ·è¿›å…¥è¯¾ç¨‹è®¡åˆ’åˆ—è¡¨ï¼Œé¦–å…ˆç¡®å®šå‘å“ªä¸ªè¯¾ç¨‹è®¡åˆ’æ·»åŠ è§†é¢‘ï¼Œç‚¹å‡»â€æ·»åŠ è§†é¢‘â€œåç”¨æˆ·é€‰æ‹©è§†é¢‘ï¼Œé€‰æ‹©è§†é¢‘ï¼Œç‚¹å‡»æäº¤ï¼Œå‰ç«¯ä»¥ json æ ¼å¼è¯·æ±‚ä»¥ä¸‹å‚æ•°ï¼š</p><p>æäº¤åª’èµ„æ–‡ä»¶ idã€æ–‡ä»¶åç§°ã€æ•™å­¦è®¡åˆ’ id</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;mediaId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;70a98b4a2fffc89e50b101f959cc33ca&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;22-Hmilyå®ç°TCCäº‹åŠ¡-å¼€å‘bank2çš„confirmæ–¹æ³•.avi&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;teachplanId&quot;</span><span class="token operator">:</span> <span class="token number">257</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ¥å£åœ¨å†…å®¹ç®¡ç†æ¨¡å—æä¾›ã€‚</p><p>åœ¨å†…å®¹ç®¡ç†æ¨¡å—å®šä¹‰è¯·æ±‚å‚æ•°æ¨¡å‹ç±»å‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;BindTeachplanMediaDto&quot;</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">&quot;æ•™å­¦è®¡åˆ’-åª’èµ„ç»‘å®šæäº¤æ•°æ®&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BindTeachplanMediaDto</span> <span class="token punctuation">{</span>

<span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;åª’èµ„æ–‡ä»¶id&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> mediaId<span class="token punctuation">;</span>

<span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;åª’èµ„æ–‡ä»¶åç§°&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> fileName<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹è®¡åˆ’æ ‡è¯†&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
 <span class="token keyword">private</span> <span class="token class-name">Long</span> teachplanId<span class="token punctuation">;</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ TeachplanController ç±»ä¸­å®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹è®¡åˆ’å’Œåª’èµ„ä¿¡æ¯ç»‘å®š&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/teachplan/association/media&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">associationMedia</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BindTeachplanMediaDto</span> bindTeachplanMediaDto<span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-æ¥å£å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_8-3-æ¥å£å¼€å‘" aria-hidden="true">#</a> <strong>8.3 æ¥å£å¼€å‘</strong></h3><h4 id="_8-3-1-dao-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_8-3-1-dao-å¼€å‘" aria-hidden="true">#</a> <strong>8.3.1 DAO å¼€å‘</strong></h4><p>å¯¹ teachplanMedia è¡¨è‡ªåŠ¨ç”Ÿæˆ Mapperã€‚</p><h4 id="_8-3-2-service-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_8-3-2-service-å¼€å‘" aria-hidden="true">#</a> <strong>8.3.2 Service å¼€å‘</strong></h4><p>æ ¹æ®éœ€æ±‚å®šä¹‰ service æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æ•™å­¦è®¡åˆ’ç»‘å®šåª’èµ„
 * <span class="token keyword">@param</span> <span class="token parameter">bindTeachplanMediaDto</span>
 * <span class="token keyword">@return</span> com.xuecheng.content.model.po.TeachplanMedia
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/14 22:20
*/</span>
<span class="token keyword">public</span> <span class="token class-name">TeachplanMedia</span> <span class="token function">associationMedia</span><span class="token punctuation">(</span><span class="token class-name">BindTeachplanMediaDto</span> bindTeachplanMediaDto<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰æ¥å£å®ç°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@Transactional</span>
 <span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">TeachplanMedia</span> <span class="token function">associationMedia</span><span class="token punctuation">(</span><span class="token class-name">BindTeachplanMediaDto</span> bindTeachplanMediaDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//æ•™å­¦è®¡åˆ’id</span>
 <span class="token class-name">Long</span> teachplanId <span class="token operator">=</span> bindTeachplanMediaDto<span class="token punctuation">.</span><span class="token function">getTeachplanId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">Teachplan</span> teachplan <span class="token operator">=</span> teachplanMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>teachplanId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>teachplan<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ•™å­¦è®¡åˆ’ä¸å­˜åœ¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token class-name">Integer</span> grade <span class="token operator">=</span> teachplan<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>grade<span class="token operator">!=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;åªå…è®¸ç¬¬äºŒçº§æ•™å­¦è®¡åˆ’ç»‘å®šåª’èµ„æ–‡ä»¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//è¯¾ç¨‹id</span>
 <span class="token class-name">Long</span> courseId <span class="token operator">=</span> teachplan<span class="token punctuation">.</span><span class="token function">getCourseId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">//å…ˆåˆ é™¤åŸæ¥è¯¥æ•™å­¦è®¡åˆ’ç»‘å®šçš„åª’èµ„</span>
 teachplanMediaMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TeachplanMedia</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">TeachplanMedia</span><span class="token operator">::</span><span class="token function">getTeachplanId</span><span class="token punctuation">,</span>teachplanId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">//å†æ·»åŠ æ•™å­¦è®¡åˆ’ä¸åª’èµ„çš„ç»‘å®šå…³ç³»</span>
 <span class="token class-name">TeachplanMedia</span> teachplanMedia <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TeachplanMedia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 teachplanMedia<span class="token punctuation">.</span><span class="token function">setCourseId</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 teachplanMedia<span class="token punctuation">.</span><span class="token function">setTeachplanId</span><span class="token punctuation">(</span>teachplanId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 teachplanMedia<span class="token punctuation">.</span><span class="token function">setMediaFilename</span><span class="token punctuation">(</span>bindTeachplanMediaDto<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 teachplanMedia<span class="token punctuation">.</span><span class="token function">setMediaId</span><span class="token punctuation">(</span>bindTeachplanMediaDto<span class="token punctuation">.</span><span class="token function">getMediaId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 teachplanMedia<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 teachplanMediaMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>teachplanMedia<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> teachplanMedia<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-3-3-æ¥å£å±‚å®Œå–„" tabindex="-1"><a class="header-anchor" href="#_8-3-3-æ¥å£å±‚å®Œå–„" aria-hidden="true">#</a> <strong>8.3.3 æ¥å£å±‚å®Œå–„</strong></h4><p>å®Œå–„æ¥å£å±‚è°ƒç”¨ Service å±‚çš„ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹è®¡åˆ’å’Œåª’èµ„ä¿¡æ¯ç»‘å®š&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/teachplan/association/media&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">associationMedia</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BindTeachplanMediaDto</span> bindTeachplanMediaDto<span class="token punctuation">)</span><span class="token punctuation">{</span>
    teachplanService<span class="token punctuation">.</span><span class="token function">associationMedia</span><span class="token punctuation">(</span>bindTeachplanMediaDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-3-4-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_8-3-4-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>8.3.4 æ¥å£æµ‹è¯•</strong></h4><p>1ã€ä½¿ç”¨ httpclient æµ‹è¯•</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>#### è¯¾ç¨‹è®¡åˆ’ç»‘å®šè§†é¢‘
POST <span class="token punctuation">{</span><span class="token punctuation">{</span>media_host<span class="token punctuation">}</span><span class="token punctuation">}</span>/media/teachplan/association/media
Content-Type<span class="token operator">:</span> application/json

<span class="token punctuation">{</span>
  <span class="token property">&quot;mediaId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;teachplanId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å‰åç«¯è”è°ƒ</p><p>æ­¤åŠŸèƒ½è¾ƒä¸ºç®€å•æ¨èç›´æ¥å‰åç«¯è”è°ƒ</p><p>å‘æŒ‡å®šè¯¾ç¨‹è®¡åˆ’æ·»åŠ è§†é¢‘</p><h3 id="_8-4-å®æˆ˜-å‰ç«¯ä»£ç æœ‰é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_8-4-å®æˆ˜-å‰ç«¯ä»£ç æœ‰é—®é¢˜" aria-hidden="true">#</a> <strong>8.4 å®æˆ˜ï¼ˆå‰ç«¯ä»£ç æœ‰é—®é¢˜ï¼‰</strong></h3><p>æ ¹æ®æ¥å£å®šä¹‰å®ç°è§£é™¤ç»‘å®šåŠŸèƒ½ã€‚</p><p>ç‚¹å‡»å·²ç»ç»‘å®šçš„è§†é¢‘åç§°å³å¯è§£é™¤ç»‘å®šã€‚</p><p><img src="/MyBlog/assets/image-20230521181759166-42c56aa5.png" alt="image-20230521182028374"></p><p>æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>delete /teachplan/association/media/<span class="token punctuation">{</span>teachPlanId<span class="token punctuation">}</span>/<span class="token punctuation">{</span>mediaId<span class="token punctuation">}</span>

è¿”å›<span class="token number">200</span>çŠ¶æ€ç è¡¨ç¤ºæˆåŠŸã€‚


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼€å‘å®Œæˆä½¿ç”¨ httpclient æµ‹è¯•ã€å‰åç«¯è”è°ƒ</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>#### è¯¾ç¨‹è®¡åˆ’æ¥è§¦è§†é¢‘ç»‘å®š
DELETE <span class="token punctuation">{</span><span class="token punctuation">{</span>media_host<span class="token punctuation">}</span><span class="token punctuation">}</span>/media/teachplan/association/media/<span class="token punctuation">{</span>teachPlanId<span class="token punctuation">}</span>/<span class="token punctuation">{</span>mediaId<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ZyKunn/edit/main/notes/project/02/ç¬¬3ç« -åª’èµ„ç®¡ç†æ¨¡å—v3.1/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">è´¡çŒ®è€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 814342838@qq.com">ZyKun</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/MyBlog/notes/project/02/%E7%AC%AC2%E7%AB%A0-%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="" aria-label="ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a></span><span class="next"><a href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/" class="" aria-label="ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1"><!--[--><!--]--> ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/MyBlog/assets/app-a153c100.js" defer></script>
  </body>
</html>
