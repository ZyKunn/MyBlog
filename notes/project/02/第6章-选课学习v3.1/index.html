<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.63">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="./img/logo.png"><title>ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1 | ZyKunã®Blog</title><meta name="description" content="">
    <link rel="preload" href="/MyBlog/assets/style-57272a59.css" as="style"><link rel="stylesheet" href="/MyBlog/assets/style-57272a59.css">
    <link rel="modulepreload" href="/MyBlog/assets/app-a153c100.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-389e66df.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-7f689b28.js"><link rel="prefetch" href="/MyBlog/assets/index.html-ab0151fa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1249ab5a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d02565e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1c68c797.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93acf26d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2bc953d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c526d7c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-636c9f52.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4177c6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7624decc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d0b4a798.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa378d7b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ddd44d65.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbb7f41.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-34576599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1079a374.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-88d4ebe7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5e927142.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a6f13b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c85da23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-69e813d7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545062a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd7a4fcb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-910949e0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-459b0c71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a036060.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f62ffe74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-841a86c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b31c8bb6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85bae056.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73555735.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d5456cd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d2dfbeec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-746091c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9cc627ff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d411448a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4454f425.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57aa84f4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2ce52087.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76657200.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90d9409e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d6ba5e7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-41bc7856.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6140daf4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ea30461d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00114784.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3fa86cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-386f0bd2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b46ac77e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-256a258e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4ebf55b3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7268161e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a8852c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19373782.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4e33bb6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-de5ff178.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd5da14a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dbee5a73.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64025c89.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9bd15ac7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4812edff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1f3f5c2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3f85e131.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1d66d048.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-67b1b38e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-17f10f72.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ad1b5dc8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b14e7669.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa35810b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-acb9b7bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2ba9a88.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-abdb28e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b3cc33e9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ef13eee8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73fa0dcc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6f7449c7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3857ef8d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e5af1d8f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5d14c1f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-94a8b9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3931e4d3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0978879b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-617bd5bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fe008c8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0e33aa95.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00725025.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8e05ec6e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-72ca6b4c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-427c5181.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b3baf42.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-40a790c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9709e7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8eb00d02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c849262.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eda16f63.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81242655.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9f6820.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79188b74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5775eee0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eff0510c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-305de307.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e83a5de7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-761a9548.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c12ae66e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-87a73e5c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d720473a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b960b5b6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bbd98f93.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76195dca.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3bd0cfa7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8c87d147.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bac2e853.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ee6bc34.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ab7381d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5b97f6b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd33ca6f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-684189de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-63731ad7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-895bfca1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d1ff4c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b71bf26f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ce6f983b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c185f9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-29c62d64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-52c91de2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-55aa1c06.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c87ef63a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff1d9f51.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a12aedeb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-298f19f2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f881f599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c32406a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4217479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7edb7ce1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8671126f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da565d04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9deb3ec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee7cf1b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-270d6327.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ec786b75.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e98adf02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7233a0e2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79c193cf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9714081e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5dea51d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a235e4bb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e3209a23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cdce2101.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-652ee4f6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-025e6f4e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-60711e70.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6edc93de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11bd39b1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53015219.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74dcd8ae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dd727db.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11b329fb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b6f3614.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-70ce719f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f6ca4d92.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a6833de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bf03220c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2edab58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f1e5cf7a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-21d4e18d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5235fca9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dc704c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57630906.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff165209.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6ec253a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9e4f0c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-664b232d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adf015a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4667c0e6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cc407710.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1752d212.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9b5d99c4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-43c48ae2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e8a616b7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93e7405b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-22a72a56.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-42ce3023.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f8eeab22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dd50991a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-af520db8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5ab2bfac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-965bc04f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81ebef01.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79d19f4d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9600bdfb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-560df48d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fb22a4f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd4caa82.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-370323f9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f673ebfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78d88460.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8b54347c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d30f0340.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e26bc4de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7d37b036.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3aa565ce.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c69f238.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76d60030.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7116a5e4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8f649cc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbbb7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90bb86fd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e23936a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19ad952b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-07245162.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-038b3afd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-084fe5c1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-098421fe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7baefce4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fffdfb9c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8c9612c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-05c42fda.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e1615934.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da824146.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa2d32f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545dbea7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3ca58cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b9e2188a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fc5f1f7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ec5c70d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cbf2aa55.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8beb0c08.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee54da9f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd28b91d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-98aa51a1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-03f9381a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9009c5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-71b7cfbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1759170e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa84186f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53160af7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51b685b4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ecb8e229.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9c507901.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6362722.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-faf67dd8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d7f20950.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a088985c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93b7982c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b76e6179.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d976d39c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b16efd78.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1301757e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c3240cbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2ddd21c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74fb5e20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-128f5026.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8fd9f38a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-82e84e23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-007ef014.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3dd860c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-382a2bae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b6beaec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2eb17cfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6f50213.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c8aef39.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-133f4d38.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cffd2be1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a798219d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b5fde77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-13275b71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4b6a02c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f179a12.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f45bc33f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0574e5e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0921816f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-631fbc02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8586017d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c4dbf09b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-967486c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aad17dde.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff644d77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78a4df64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d2180e8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53fbcd20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a3387e5e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-979f5ac4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0938c506.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51707e22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b1e917a0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b56a071.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d15eb498.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b0a97c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fda196b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bcc5faac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-490c208f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dce28479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62825d3c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b5a4af15.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eb40da96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d6d1c61.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-618cf3f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2a35430.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64f564d2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bca2187b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85181f96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62aa623a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b0c39cc5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73b8fff0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5466ae58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fbd0bcfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-5f041a2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/MyBlog/" class=""><!----><span class="site-name can-hide">ZyKunã®Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="router-link-active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="router-link-active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/MyBlog/notes/project/02/" class="router-link-active sidebar-item sidebar-heading active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/MyBlog/notes/project/02/%E7%AC%AC1%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAv3.1/" class="sidebar-item" aria-label="ç¬¬ 1 ç«  é¡¹ç›®ä»‹ç»&amp;ç¯å¢ƒæ­å»º v3.1"><!--[--><!--]--> ç¬¬ 1 ç«  é¡¹ç›®ä»‹ç»&amp;ç¯å¢ƒæ­å»º v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC2%E7%AB%A0-%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="sidebar-item" aria-label="ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="sidebar-item" aria-label="ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/" class="sidebar-item" aria-label="ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1"><!--[--><!--]--> ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/" class="sidebar-item" aria-label="ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1"><!--[--><!--]--> ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1"><!--[--><!--]--> ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-æ¨¡å—éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1 æ¨¡å—éœ€æ±‚åˆ†æ"><!--[--><!--]--> 1 æ¨¡å—éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-1-æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 æ¨¡å—ä»‹ç»"><!--[--><!--]--> 1.1 æ¨¡å—ä»‹ç» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 1.2 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-2-1-å­¦ä¹ å¼•å¯¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.1 å­¦ä¹ å¼•å¯¼"><!--[--><!--]--> 1.2.1 å­¦ä¹ å¼•å¯¼ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-2-2-é€‰è¯¾æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.2 é€‰è¯¾æµç¨‹"><!--[--><!--]--> 1.2.2 é€‰è¯¾æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-2-3-æ”¯ä»˜æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.3 æ”¯ä»˜æµç¨‹"><!--[--><!--]--> 1.2.3 æ”¯ä»˜æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-2-4-åœ¨çº¿å­¦ä¹ " class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.4 åœ¨çº¿å­¦ä¹ "><!--[--><!--]--> 1.2.4 åœ¨çº¿å­¦ä¹  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-2-5-å…è´¹è¯¾ç¨‹ç»­æœŸ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.5 å…è´¹è¯¾ç¨‹ç»­æœŸ"><!--[--><!--]--> 1.2.5 å…è´¹è¯¾ç¨‹ç»­æœŸ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-æ·»åŠ é€‰è¯¾" class="router-link-active router-link-exact-active sidebar-item" aria-label="2 æ·»åŠ é€‰è¯¾"><!--[--><!--]--> 2 æ·»åŠ é€‰è¯¾ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 2.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-1-1-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.1 æ•°æ®æ¨¡å‹"><!--[--><!--]--> 2.1.1 æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-1-2-æ‰§è¡Œæµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1.2 æ‰§è¡Œæµç¨‹"><!--[--><!--]--> 2.1.2 æ‰§è¡Œæµç¨‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 æ¥å£å¼€å‘"><!--[--><!--]--> 2.2 æ¥å£å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-1-éƒ¨ç½²å­¦ä¹ ä¸­å¿ƒå·¥ç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.1 éƒ¨ç½²å­¦ä¹ ä¸­å¿ƒå·¥ç¨‹"><!--[--><!--]--> 2.2.1 éƒ¨ç½²å­¦ä¹ ä¸­å¿ƒå·¥ç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-2-æ·»åŠ æŸ¥è¯¢è¯¾ç¨‹æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2 æ·»åŠ æŸ¥è¯¢è¯¾ç¨‹æ¥å£"><!--[--><!--]--> 2.2.2 æ·»åŠ æŸ¥è¯¢è¯¾ç¨‹æ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-3-æµ‹è¯•æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.3 æµ‹è¯•æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£"><!--[--><!--]--> 2.2.3 æµ‹è¯•æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-æ·»åŠ é€‰è¯¾æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5 æ·»åŠ é€‰è¯¾æ¥å£"><!--[--><!--]--> 2.2.5 æ·»åŠ é€‰è¯¾æ¥å£ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-1-æ¥å£åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5.1 æ¥å£åˆ†æ"><!--[--><!--]--> 2.2.5.1 æ¥å£åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5.2 æ¥å£å®šä¹‰"><!--[--><!--]--> 2.2.5.2 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-3-æ·»åŠ å…è´¹è¯¾ç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5.3 æ·»åŠ å…è´¹è¯¾ç¨‹"><!--[--><!--]--> 2.2.5.3 æ·»åŠ å…è´¹è¯¾ç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-4-æ·»åŠ æˆ‘çš„è¯¾ç¨‹è¡¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5.4 æ·»åŠ æˆ‘çš„è¯¾ç¨‹è¡¨"><!--[--><!--]--> 2.2.5.4 æ·»åŠ æˆ‘çš„è¯¾ç¨‹è¡¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-5-æ·»åŠ æ”¶è´¹è¯¾ç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5.5 æ·»åŠ æ”¶è´¹è¯¾ç¨‹"><!--[--><!--]--> 2.2.5.5 æ·»åŠ æ”¶è´¹è¯¾ç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-6-è·å–å­¦ä¹ èµ„æ ¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5.6 è·å–å­¦ä¹ èµ„æ ¼"><!--[--><!--]--> 2.2.5.6 è·å–å­¦ä¹ èµ„æ ¼ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-7-service-æ¥å£å®Œå–„" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5.7 service æ¥å£å®Œå–„"><!--[--><!--]--> 2.2.5.7 service æ¥å£å®Œå–„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-5-8-å®Œå–„-controller" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.5.8 å®Œå–„ controller"><!--[--><!--]--> 2.2.5.8 å®Œå–„ controller <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-3-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 æ¥å£æµ‹è¯•"><!--[--><!--]--> 2.3 æ¥å£æµ‹è¯• <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-3-1-å•å…ƒæµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.1 å•å…ƒæµ‹è¯•"><!--[--><!--]--> 2.3.1 å•å…ƒæµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-3-2-å‰åç«¯è”è°ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.2 å‰åç«¯è”è°ƒ"><!--[--><!--]--> 2.3.2 å‰åç«¯è”è°ƒ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-æ”¯ä»˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="3 æ”¯ä»˜"><!--[--><!--]--> 3 æ”¯ä»˜ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 3.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-1-1-æ‰§è¡Œæµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.1 æ‰§è¡Œæµç¨‹"><!--[--><!--]--> 3.1.1 æ‰§è¡Œæµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-1-2-é€šç”¨è®¢å•æœåŠ¡è®¾è®¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.2 é€šç”¨è®¢å•æœåŠ¡è®¾è®¡"><!--[--><!--]--> 3.1.2 é€šç”¨è®¢å•æœåŠ¡è®¾è®¡ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-2-æ”¯ä»˜æ¥å£è°ƒç ”" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 æ”¯ä»˜æ¥å£è°ƒç ”"><!--[--><!--]--> 3.2 æ”¯ä»˜æ¥å£è°ƒç ” <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-2-1-å¾®ä¿¡æ”¯ä»˜æ¥å£è°ƒç ”" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.1 å¾®ä¿¡æ”¯ä»˜æ¥å£è°ƒç ”"><!--[--><!--]--> 3.2.1 å¾®ä¿¡æ”¯ä»˜æ¥å£è°ƒç ” <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-2-2-æ”¯ä»˜å®æ¥å£è°ƒç ”" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.2 æ”¯ä»˜å®æ¥å£è°ƒç ”"><!--[--><!--]--> 3.2.2 æ”¯ä»˜å®æ¥å£è°ƒç ” <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-3-å‡†å¤‡å¼€å‘ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 å‡†å¤‡å¼€å‘ç¯å¢ƒ"><!--[--><!--]--> 3.3 å‡†å¤‡å¼€å‘ç¯å¢ƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-3-1-æ”¯ä»˜å®å¼€å‘ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.1 æ”¯ä»˜å®å¼€å‘ç¯å¢ƒ"><!--[--><!--]--> 3.3.1 æ”¯ä»˜å®å¼€å‘ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-3-2-åˆ›å»ºè®¢å•æœåŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.2 åˆ›å»ºè®¢å•æœåŠ¡"><!--[--><!--]--> 3.3.2 åˆ›å»ºè®¢å•æœåŠ¡ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-æ”¯ä»˜æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4 æ”¯ä»˜æ¥å£æµ‹è¯•"><!--[--><!--]--> 3.4 æ”¯ä»˜æ¥å£æµ‹è¯• <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-1-é˜…è¯»æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.1 é˜…è¯»æ¥å£å®šä¹‰"><!--[--><!--]--> 3.4.1 é˜…è¯»æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-2-ä¸‹å•æ‰§è¡Œæµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.2 ä¸‹å•æ‰§è¡Œæµç¨‹"><!--[--><!--]--> 3.4.2 ä¸‹å•æ‰§è¡Œæµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-3-æ”¯ä»˜æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.3 æ”¯ä»˜æ¥å£æµ‹è¯•"><!--[--><!--]--> 3.4.3 æ”¯ä»˜æ¥å£æµ‹è¯• <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-3-1-ç¼–å†™ä¸‹å•ä»£ç " class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.3.1 ç¼–å†™ä¸‹å•ä»£ç "><!--[--><!--]--> 3.4.3.1 ç¼–å†™ä¸‹å•ä»£ç  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-3-2-ç”ŸæˆäºŒç»´ç " class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.3.2 ç”ŸæˆäºŒç»´ç "><!--[--><!--]--> 3.4.3.2 ç”ŸæˆäºŒç»´ç  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-3-3-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.3.3 æ¥å£æµ‹è¯•"><!--[--><!--]--> 3.4.3.3 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-4-æ”¯ä»˜ç»“æœæŸ¥è¯¢æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.4 æ”¯ä»˜ç»“æœæŸ¥è¯¢æ¥å£"><!--[--><!--]--> 3.4.4 æ”¯ä»˜ç»“æœæŸ¥è¯¢æ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-5-æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.5 æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£"><!--[--><!--]--> 3.4.5 æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-5-1-å‡†å¤‡ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.5.1 å‡†å¤‡ç¯å¢ƒ"><!--[--><!--]--> 3.4.5.1 å‡†å¤‡ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-5-2-ç¼–å†™æµ‹è¯•ä»£ç " class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.5.2 ç¼–å†™æµ‹è¯•ä»£ç "><!--[--><!--]--> 3.4.5.2 ç¼–å†™æµ‹è¯•ä»£ç  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-5-3-é€šçŸ¥æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.5.3 é€šçŸ¥æ¥å£æµ‹è¯•"><!--[--><!--]--> 3.4.5.3 é€šçŸ¥æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-ç”Ÿæˆæ”¯ä»˜äºŒç»´ç " class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5 ç”Ÿæˆæ”¯ä»˜äºŒç»´ç "><!--[--><!--]--> 3.5 ç”Ÿæˆæ”¯ä»˜äºŒç»´ç  <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 3.5.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-1-1-æ‰§è¡Œæµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.1.1 æ‰§è¡Œæµç¨‹"><!--[--><!--]--> 3.5.1.1 æ‰§è¡Œæµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-1-2-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.1.2 æ•°æ®æ¨¡å‹"><!--[--><!--]--> 3.5.1.2 æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.2 æ¥å£å®šä¹‰"><!--[--><!--]--> 3.5.2 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-3-æ¥å£å®ç°" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.3 æ¥å£å®ç°"><!--[--><!--]--> 3.5.3 æ¥å£å®ç° <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-3-1-ä¿å­˜å•†å“è®¢å•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.3.1 ä¿å­˜å•†å“è®¢å•"><!--[--><!--]--> 3.5.3.1 ä¿å­˜å•†å“è®¢å• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-3-2-åˆ›å»ºæ”¯ä»˜è®°å½•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.3.2 åˆ›å»ºæ”¯ä»˜è®°å½•"><!--[--><!--]--> 3.5.3.2 åˆ›å»ºæ”¯ä»˜è®°å½• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-3-3-ç”Ÿæˆæ”¯ä»˜äºŒç»´ç " class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.3.3 ç”Ÿæˆæ”¯ä»˜äºŒç»´ç "><!--[--><!--]--> 3.5.3.3 ç”Ÿæˆæ”¯ä»˜äºŒç»´ç  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-3-4-ç”ŸæˆäºŒç»´ç æ¥å£å®Œå–„" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.3.4 ç”ŸæˆäºŒç»´ç æ¥å£å®Œå–„"><!--[--><!--]--> 3.5.3.4 ç”ŸæˆäºŒç»´ç æ¥å£å®Œå–„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-3-5-æ‰«ç ä¸‹å•æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.3.5 æ‰«ç ä¸‹å•æ¥å£"><!--[--><!--]--> 3.5.3.5 æ‰«ç ä¸‹å•æ¥å£ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-3-æ”¯ä»˜æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.3 æ”¯ä»˜æµ‹è¯•"><!--[--><!--]--> 3.5.3 æ”¯ä»˜æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-4-é‡å¤æ”¯ä»˜é—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.4 é‡å¤æ”¯ä»˜é—®é¢˜"><!--[--><!--]--> 3.5.4 é‡å¤æ”¯ä»˜é—®é¢˜ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-6-æŸ¥è¯¢æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6 æŸ¥è¯¢æ”¯ä»˜ç»“æœ"><!--[--><!--]--> 3.6 æŸ¥è¯¢æ”¯ä»˜ç»“æœ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-6-1-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6.1 æ¥å£å®šä¹‰"><!--[--><!--]--> 3.6.1 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-6-2-æ¥å£å®ç°" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6.2 æ¥å£å®ç°"><!--[--><!--]--> 3.6.2 æ¥å£å®ç° <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-6-2-1-service-æ€»ä½“æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6.2.1 service æ€»ä½“æ¥å£"><!--[--><!--]--> 3.6.2.1 service æ€»ä½“æ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-6-2-2-æŸ¥è¯¢æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6.2.2 æŸ¥è¯¢æ”¯ä»˜ç»“æœ"><!--[--><!--]--> 3.6.2.2 æŸ¥è¯¢æ”¯ä»˜ç»“æœ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-6-2-3-ä¿å­˜æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6.2.3 ä¿å­˜æ”¯ä»˜ç»“æœ"><!--[--><!--]--> 3.6.2.3 ä¿å­˜æ”¯ä»˜ç»“æœ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-6-3-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6.3 æ¥å£æµ‹è¯•"><!--[--><!--]--> 3.6.3 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-7-æ¥æ”¶æ”¯ä»˜é€šçŸ¥" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.7 æ¥æ”¶æ”¯ä»˜é€šçŸ¥"><!--[--><!--]--> 3.7 æ¥æ”¶æ”¯ä»˜é€šçŸ¥ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-7-1-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.7.1 æ¥å£å®šä¹‰"><!--[--><!--]--> 3.7.1 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-7-2-æ¥å£å®ç°" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.7.2 æ¥å£å®ç°"><!--[--><!--]--> 3.7.2 æ¥å£å®ç° <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-7-4-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.7.4 æ¥å£æµ‹è¯•"><!--[--><!--]--> 3.7.4 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-æ”¯ä»˜é€šçŸ¥" class="router-link-active router-link-exact-active sidebar-item" aria-label="4 æ”¯ä»˜é€šçŸ¥"><!--[--><!--]--> 4 æ”¯ä»˜é€šçŸ¥ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 4.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-2-æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 æŠ€æœ¯æ–¹æ¡ˆ"><!--[--><!--]--> 4.2 æŠ€æœ¯æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-å‘é€æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 å‘é€æ”¯ä»˜ç»“æœ"><!--[--><!--]--> 4.3 å‘é€æ”¯ä»˜ç»“æœ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-1-è®¢å•æœåŠ¡é›†æˆ-mq" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.1 è®¢å•æœåŠ¡é›†æˆ MQ"><!--[--><!--]--> 4.3.1 è®¢å•æœåŠ¡é›†æˆ MQ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-2-å‘é€æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.2 å‘é€æ”¯ä»˜ç»“æœ"><!--[--><!--]--> 4.3.2 å‘é€æ”¯ä»˜ç»“æœ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-æ¥æ”¶æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 æ¥æ”¶æ”¯ä»˜ç»“æœ"><!--[--><!--]--> 4.4 æ¥æ”¶æ”¯ä»˜ç»“æœ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-1-å­¦ä¹ ä¸­å¿ƒæœåŠ¡é›†æˆ-mq" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.1 å­¦ä¹ ä¸­å¿ƒæœåŠ¡é›†æˆ MQ"><!--[--><!--]--> 4.4.1 å­¦ä¹ ä¸­å¿ƒæœåŠ¡é›†æˆ MQ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-2-æ¥æ”¶æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.2 æ¥æ”¶æ”¯ä»˜ç»“æœ"><!--[--><!--]--> 4.4.2 æ¥æ”¶æ”¯ä»˜ç»“æœ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-5-é€šçŸ¥æ”¯ä»˜ç»“æœæµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5 é€šçŸ¥æ”¯ä»˜ç»“æœæµ‹è¯•"><!--[--><!--]--> 4.5 é€šçŸ¥æ”¯ä»˜ç»“æœæµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-åœ¨çº¿å­¦ä¹ " class="router-link-active router-link-exact-active sidebar-item" aria-label="4 åœ¨çº¿å­¦ä¹ "><!--[--><!--]--> 4 åœ¨çº¿å­¦ä¹  <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-1-éœ€æ±‚åˆ†æ-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 4.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-2-æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯"><!--[--><!--]--> 4.2 æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-è·å–è§†é¢‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 è·å–è§†é¢‘"><!--[--><!--]--> 4.3 è·å–è§†é¢‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 4.3.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.2 æ¥å£å®šä¹‰"><!--[--><!--]--> 4.3.2 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-3-è·å–è§†é¢‘è¿œç¨‹æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.3 è·å–è§†é¢‘è¿œç¨‹æ¥å£"><!--[--><!--]--> 4.3.3 è·å–è§†é¢‘è¿œç¨‹æ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-5-å­¦ä¹ èµ„æ ¼æ ¡éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.5 å­¦ä¹ èµ„æ ¼æ ¡éªŒ"><!--[--><!--]--> 4.3.5 å­¦ä¹ èµ„æ ¼æ ¡éªŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-6-æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.6 æµ‹è¯•"><!--[--><!--]--> 4.3.6 æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-æˆ‘çš„è¯¾è¡¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 æˆ‘çš„è¯¾è¡¨"><!--[--><!--]--> 4.4 æˆ‘çš„è¯¾è¡¨ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 4.4.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-1-1-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.1.1 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 4.4.1.1 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-1-2-é…ç½®-nginx" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.1.2 é…ç½® nginx"><!--[--><!--]--> 4.4.1.2 é…ç½® nginx <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.2 æ¥å£å®šä¹‰"><!--[--><!--]--> 4.4.2 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-3-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3 æ¥å£å¼€å‘"><!--[--><!--]--> 4.4.3 æ¥å£å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-3-1dao" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3.1DAO"><!--[--><!--]--> 4.4.3.1DAO <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-3-2-service" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3.2 Service"><!--[--><!--]--> 4.4.3.2 Service <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-4-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.4 æ¥å£æµ‹è¯•"><!--[--><!--]--> 4.4.4 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC7%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2v3.1/" class="sidebar-item" aria-label="ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1"><!--[--><!--]--> ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC8%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%963.1/" class="sidebar-item" aria-label="ç¬¬ 8 ç«  é¡¹ç›®ä¼˜åŒ– 3.1"><!--[--><!--]--> ç¬¬ 8 ç«  é¡¹ç›®ä¼˜åŒ– 3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83-%E9%83%A8%E7%BD%B2%E9%97%A8%E6%88%B7%E6%96%87%E6%A1%A3/" class="sidebar-item" aria-label="è¯¾ç¨‹å‘å¸ƒ-éƒ¨ç½²é—¨æˆ·æ–‡æ¡£ v3.1"><!--[--><!--]--> è¯¾ç¨‹å‘å¸ƒ-éƒ¨ç½²é—¨æˆ·æ–‡æ¡£ v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE/" class="sidebar-item" aria-label="å¾®ä¿¡æ‰«ç ç™»å½•é…ç½®"><!--[--><!--]--> å¾®ä¿¡æ‰«ç ç™»å½•é…ç½® <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AEv3.1/" class="sidebar-item" aria-label="å­¦æˆåœ¨çº¿é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½® v3.1"><!--[--><!--]--> å­¦æˆåœ¨çº¿é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½® v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="sidebar-item" aria-label="æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ"><!--[--><!--]--> æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" class="sidebar-item" aria-label="é¡¹ç›®æ€»ç»“"><!--[--><!--]--> é¡¹ç›®æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="ç¬¬-6-ç« -é€‰è¯¾å­¦ä¹ -v3-1" tabindex="-1"><a class="header-anchor" href="#ç¬¬-6-ç« -é€‰è¯¾å­¦ä¹ -v3-1" aria-hidden="true">#</a> <strong>ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1</strong></h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-æ¨¡å—éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">1 æ¨¡å—éœ€æ±‚åˆ†æ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-1-æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active">1.1 æ¨¡å—ä»‹ç»</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active">1.2 ä¸šåŠ¡æµç¨‹</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-æ·»åŠ é€‰è¯¾" class="router-link-active router-link-exact-active">2 æ·»åŠ é€‰è¯¾</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">2.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-2-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active">2.2 æ¥å£å¼€å‘</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_2-3-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active">2.3 æ¥å£æµ‹è¯•</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-æ”¯ä»˜" class="router-link-active router-link-exact-active">3 æ”¯ä»˜</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">3.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-2-æ”¯ä»˜æ¥å£è°ƒç ”" class="router-link-active router-link-exact-active">3.2 æ”¯ä»˜æ¥å£è°ƒç ”</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-3-å‡†å¤‡å¼€å‘ç¯å¢ƒ" class="router-link-active router-link-exact-active">3.3 å‡†å¤‡å¼€å‘ç¯å¢ƒ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-4-æ”¯ä»˜æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active">3.4 æ”¯ä»˜æ¥å£æµ‹è¯•</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-5-ç”Ÿæˆæ”¯ä»˜äºŒç»´ç " class="router-link-active router-link-exact-active">3.5 ç”Ÿæˆæ”¯ä»˜äºŒç»´ç </a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-6-æŸ¥è¯¢æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active">3.6 æŸ¥è¯¢æ”¯ä»˜ç»“æœ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_3-7-æ¥æ”¶æ”¯ä»˜é€šçŸ¥" class="router-link-active router-link-exact-active">3.7 æ¥æ”¶æ”¯ä»˜é€šçŸ¥</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-æ”¯ä»˜é€šçŸ¥" class="router-link-active router-link-exact-active">4 æ”¯ä»˜é€šçŸ¥</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">4.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-2-æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active">4.2 æŠ€æœ¯æ–¹æ¡ˆ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-å‘é€æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active">4.3 å‘é€æ”¯ä»˜ç»“æœ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-æ¥æ”¶æ”¯ä»˜ç»“æœ" class="router-link-active router-link-exact-active">4.4 æ¥æ”¶æ”¯ä»˜ç»“æœ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-5-é€šçŸ¥æ”¯ä»˜ç»“æœæµ‹è¯•" class="router-link-active router-link-exact-active">4.5 é€šçŸ¥æ”¯ä»˜ç»“æœæµ‹è¯•</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-åœ¨çº¿å­¦ä¹ " class="router-link-active router-link-exact-active">4 åœ¨çº¿å­¦ä¹ </a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-1-éœ€æ±‚åˆ†æ-1" class="router-link-active router-link-exact-active">4.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-2-æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯" class="router-link-active router-link-exact-active">4.2 æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-3-è·å–è§†é¢‘" class="router-link-active router-link-exact-active">4.3 è·å–è§†é¢‘</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/#_4-4-æˆ‘çš„è¯¾è¡¨" class="router-link-active router-link-exact-active">4.4 æˆ‘çš„è¯¾è¡¨</a></li></ul></li></ul></nav><h2 id="_1-æ¨¡å—éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_1-æ¨¡å—éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>1 æ¨¡å—éœ€æ±‚åˆ†æ</strong></h2><h3 id="_1-1-æ¨¡å—ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-1-æ¨¡å—ä»‹ç»" aria-hidden="true">#</a> <strong>1.1 æ¨¡å—ä»‹ç»</strong></h3><p>æœ¬æ¨¡å—å®ç°äº†å­¦ç”Ÿé€‰è¯¾ã€ä¸‹å•æ”¯ä»˜ã€å­¦ä¹ çš„æ•´ä½“æµç¨‹ã€‚</p><p>ç½‘ç«™çš„è¯¾ç¨‹æœ‰å…è´¹å’Œæ”¶è´¹ä¸¤ç§ï¼Œå¯¹äºå…è´¹è¯¾ç¨‹å­¦ç”Ÿé€‰è¯¾åå¯ç›´æ¥å­¦ä¹ ï¼Œå¯¹äºæ”¶è´¹è¯¾ç¨‹å­¦ç”Ÿéœ€è¦ä¸‹å•ä¸”æ”¯ä»˜æˆåŠŸæ–¹å¯é€‰è¯¾ã€å­¦ä¹ ã€‚</p><p>é€‰è¯¾ï¼šæ˜¯å°†è¯¾ç¨‹åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨çš„è¿‡ç¨‹ã€‚</p><p>æˆ‘çš„è¯¾ç¨‹è¡¨ï¼šè®°å½•æˆ‘åœ¨ç½‘ç«™å­¦ä¹ çš„è¯¾ç¨‹ï¼Œæˆ‘çš„è¯¾ç¨‹è¡¨ä¸­æœ‰å…è´¹è¯¾ç¨‹å’Œæ”¶è´¹è¯¾ç¨‹ä¸¤ç§ï¼Œå¯¹äºå…è´¹è¯¾ç¨‹å¯ç›´æ¥æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹è¡¨ï¼Œå¯¹äºæ”¶è´¹è¯¾ç¨‹éœ€è¦ä¸‹å•ã€æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><p>æ¨¡å—æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611154802958-ccb8b1bd.png" alt="image-20230611154802958"></p><h3 id="_1-2-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-2-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>1.2 ä¸šåŠ¡æµç¨‹</strong></h3><h4 id="_1-2-1-å­¦ä¹ å¼•å¯¼" tabindex="-1"><a class="header-anchor" href="#_1-2-1-å­¦ä¹ å¼•å¯¼" aria-hidden="true">#</a> <strong>1.2.1 å­¦ä¹ å¼•å¯¼</strong></h4><p>ç”¨æˆ·é€šè¿‡æœç´¢è¯¾ç¨‹ã€è¯¾ç¨‹æ¨èç­‰ä¿¡æ¯è¿›å…¥è¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡»â€œé©¬ä¸Šå­¦ä¹ â€ å¼•å¯¼è¿›å…¥å­¦ä¹ ç•Œé¢å»å­¦ä¹ ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611154832783-f27c5efe.png" alt="image-20230611154832783">1ã€è¿›å…¥è¯¾ç¨‹è¯¦æƒ…ç‚¹å‡»é©¬ä¸Šå­¦ä¹ </p><p><img src="/MyBlog/assets/image-20230611154838147-4d93de17.png" alt="image-20230611154838147">2ã€è¯¾ç¨‹å…è´¹æ—¶å¼•å¯¼åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ã€æˆ–è¿›å…¥å­¦ä¹ ç•Œé¢ã€‚</p><p><img src="/MyBlog/assets/image-20230611154844659-4ef6b95e.png" alt="image-20230611154844659"></p><p>3ã€è¯¾ç¨‹æ”¶è´¹æ—¶å¼•å¯¼å»æ”¯ä»˜ã€æˆ–è¯•å­¦ã€‚</p><p><img src="/MyBlog/assets/image-20230611154849591-3d021039.png" alt="image-20230611154849591"></p><h4 id="_1-2-2-é€‰è¯¾æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-2-2-é€‰è¯¾æµç¨‹" aria-hidden="true">#</a> <strong>1.2.2 é€‰è¯¾æµç¨‹</strong></h4><p>é€‰è¯¾æ˜¯å°†è¯¾ç¨‹åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨çš„è¿‡ç¨‹ã€‚</p><p>å¯¹å…è´¹è¯¾ç¨‹é€‰è¯¾åå¯ç›´æ¥åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ï¼Œå¯¹æ”¶è´¹è¯¾ç¨‹é€‰è¯¾åéœ€è¦ä¸‹å•æ”¯ä»˜æˆåŠŸç³»ç»Ÿè‡ªåŠ¨åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611154901217-c4d357c6.png" alt="image-20230611154901217"></p><h4 id="_1-2-3-æ”¯ä»˜æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-2-3-æ”¯ä»˜æµç¨‹" aria-hidden="true">#</a> <strong>1.2.3 æ”¯ä»˜æµç¨‹</strong></h4><p>æœ¬é¡¹ç›®ä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°å¯¹æ¥å®Œæˆæ”¯ä»˜æ“ä½œã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611154906310-77f845f1.png" alt="image-20230611154906310"></p><h4 id="_1-2-4-åœ¨çº¿å­¦ä¹ " tabindex="-1"><a class="header-anchor" href="#_1-2-4-åœ¨çº¿å­¦ä¹ " aria-hidden="true">#</a> <strong>1.2.4 åœ¨çº¿å­¦ä¹ </strong></h4><p>é€‰è¯¾æˆåŠŸç”¨æˆ·å¯ä»¥åœ¨çº¿å­¦ä¹ ï¼Œå¯¹äºå…è´¹è¯¾ç¨‹æ— éœ€é€‰è¯¾å³å¯åœ¨çº¿å­¦ä¹ ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611154911811-aa2effc8.png" alt="image-20230611154911811"></p><h4 id="_1-2-5-å…è´¹è¯¾ç¨‹ç»­æœŸ" tabindex="-1"><a class="header-anchor" href="#_1-2-5-å…è´¹è¯¾ç¨‹ç»­æœŸ" aria-hidden="true">#</a> <strong>1.2.5 å…è´¹è¯¾ç¨‹ç»­æœŸ</strong></h4><p>å…è´¹è¯¾ç¨‹åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨é»˜è®¤ä¸º 1 å¹´æœ‰æ•ˆæœŸï¼Œåˆ°æœŸç”¨æˆ·å¯ç”³è¯·ç»­æœŸï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611154916637-518fe440.png" alt="image-20230611154916637"></p><h2 id="_2-æ·»åŠ é€‰è¯¾" tabindex="-1"><a class="header-anchor" href="#_2-æ·»åŠ é€‰è¯¾" aria-hidden="true">#</a> <strong>2 æ·»åŠ é€‰è¯¾</strong></h2><h3 id="_2-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_2-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>2.1 éœ€æ±‚åˆ†æ</strong></h3><h4 id="_2-1-1-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_2-1-1-æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>2.1.1 æ•°æ®æ¨¡å‹</strong></h4><p>é€‰è¯¾æ˜¯å°†è¯¾ç¨‹åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨çš„è¿‡ç¨‹ï¼Œæ ¹æ®é€‰è¯¾çš„ä¸šåŠ¡æµç¨‹è¿›è¡Œè¯¦ç»†åˆ†æï¼Œä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611154901217-c4d357c6.png" alt="image-20230611155104121"></p><p>é€‰è¯¾ä¿¡æ¯å­˜å…¥é€‰è¯¾è®°å½•è¡¨ï¼Œå…è´¹è¯¾ç¨‹è¢«é€‰è¯¾é™¤äº†è¿›å…¥é€‰è¯¾è®°å½•è¡¨åŒæ—¶è¿›å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ï¼Œæ”¶è´¹è¯¾ç¨‹è¿›å…¥é€‰è¯¾è®°å½•è¡¨åéœ€è¦ç»è¿‡ä¸‹å•ã€æ”¯ä»˜æˆåŠŸæ‰å¯ä»¥è¿›å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><p>æˆ‘çš„è¯¾ç¨‹è¡¨è®°å½•äº†ç”¨æˆ·å­¦ä¹ çš„è¯¾ç¨‹ï¼ŒåŒ…æ‹¬å…è´¹è¯¾ç¨‹ã€æ”¶è´¹è¯¾ç¨‹ï¼ˆå·²ç»æ”¯ä»˜ï¼‰ã€‚</p><p>1ã€é€‰è¯¾è®°å½•è¡¨</p><p>å½“ç”¨æˆ·å°†è¯¾ç¨‹æ·»åŠ åˆ°è¯¾ç¨‹è¡¨æ—¶éœ€è¦å…ˆåˆ›å»ºé€‰è¯¾è®°å½•ã€‚</p><p>ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611155108997-c87c54c8.png" alt="image-20230611155108997"></p><p>é€‰è¯¾ç±»å‹ï¼šå…è´¹è¯¾ç¨‹ã€æ”¶è´¹è¯¾ç¨‹ã€‚</p><p>é€‰è¯¾çŠ¶æ€ï¼šé€‰è¯¾æˆåŠŸã€å¾…æ”¯ä»˜ã€é€‰è¯¾åˆ é™¤ã€‚</p><p>å¯¹äºå…è´¹è¯¾ç¨‹ï¼šè¯¾ç¨‹ä»·æ ¼ä¸º 0ï¼Œæœ‰æ•ˆæœŸé»˜è®¤ 365ï¼Œå¼€å§‹æœåŠ¡æ—¶é—´ä¸ºé€‰è¯¾æ—¶é—´ï¼Œç»“æŸæœåŠ¡æ—¶é—´ä¸ºé€‰è¯¾æ—¶é—´åŠ  1 å¹´åçš„æ—¶é—´ï¼Œé€‰è¯¾çŠ¶æ€ä¸ºé€‰è¯¾æˆåŠŸã€‚</p><p>å¯¹äºæ”¶è´¹è¯¾ç¨‹ï¼šæŒ‰è¯¾ç¨‹çš„ç°ä»·ã€æœ‰æ•ˆæœŸç¡®å®šå¼€å§‹æœåŠ¡æ—¶é—´ã€ç»“æŸæœåŠ¡æ—¶é—´ï¼Œé€‰è¯¾çŠ¶æ€ä¸ºå¾…æ”¯ä»˜ã€‚</p><p>æ”¶è´¹è¯¾ç¨‹çš„é€‰è¯¾è®°å½•éœ€è¦æ”¯ä»˜æˆåŠŸåé€‰è¯¾çŠ¶æ€ä¸ºæˆåŠŸã€‚</p><p>2ã€æˆ‘çš„è¯¾ç¨‹è¡¨</p><p>æˆ‘çš„è¯¾ç¨‹è¡¨ä¸­è®°å½•äº†ç”¨æˆ·é€‰è¯¾æˆåŠŸçš„è¯¾ç¨‹ï¼Œæ‰€ä»¥æˆ‘çš„è¯¾ç¨‹è¡¨çš„æ•°æ®æ¥æºäºé€‰è¯¾è®°å½•è¡¨ã€‚</p><p>å¯¹äºå…è´¹è¯¾ç¨‹åˆ›å»ºé€‰è¯¾è®°å½•ååŒæ—¶å‘æˆ‘çš„è¯¾ç¨‹è¡¨æ·»åŠ è®°å½•ã€‚</p><p>å¯¹äºæ”¶è´¹è¯¾ç¨‹åˆ›å»ºé€‰è¯¾è®°å½•åéœ€è¦ä¸‹å•æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨å‘æˆ‘çš„è¯¾ç¨‹è¡¨æ·»åŠ è®°å½•ã€‚</p><p><img src="/MyBlog/assets/image-20230611155115475-0a1686cb.png" alt="image-20230611155115475"></p><h4 id="_2-1-2-æ‰§è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-1-2-æ‰§è¡Œæµç¨‹" aria-hidden="true">#</a> <strong>2.1.2 æ‰§è¡Œæµç¨‹</strong></h4><p>åœ¨å­¦ä¹ å¼•å¯¼å¤„ï¼Œå¯ä»¥ç›´æ¥å°†å…è´¹è¯¾ç¨‹åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230611154844659-4ef6b95e.png" alt="image-20230611155120825"></p><p>å¯¹äºæ”¶è´¹è¯¾ç¨‹å…ˆåˆ›å»ºé€‰è¯¾è®°å½•è¡¨ï¼Œæ”¯ä»˜æˆåŠŸåï¼Œæ”¶åˆ°æ”¯ä»˜ç»“æœç”±ç³»ç»Ÿè‡ªåŠ¨åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611155126023-57ae0de1.png" alt="image-20230611155126023"></p><h3 id="_2-2-æ¥å£å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_2-2-æ¥å£å¼€å‘" aria-hidden="true">#</a> <strong>2.2 æ¥å£å¼€å‘</strong></h3><h4 id="_2-2-1-éƒ¨ç½²å­¦ä¹ ä¸­å¿ƒå·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-2-1-éƒ¨ç½²å­¦ä¹ ä¸­å¿ƒå·¥ç¨‹" aria-hidden="true">#</a> <strong>2.2.1 éƒ¨ç½²å­¦ä¹ ä¸­å¿ƒå·¥ç¨‹</strong></h4><p>ä»è¯¾ç¨‹èµ„æ–™æ‹·è´å­¦ä¹ ä¸­å¿ƒæœåŠ¡å·¥ç¨‹åˆ°è‡ªå·±çš„å·¥ç¨‹ç›®å½•ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611155131637-af9766e4.png" alt="image-20230611155131637">æ³¨æ„å»ä¿®æ”¹ nacos çš„å‘½åç©ºé—´ã€‚</p><p>åˆ›å»ºæ•°æ®åº“ xc_learningï¼Œå¹¶å¯¼å…¥æ•°æ®</p><p>ä¿®æ”¹æ•°æ®åº“çš„è¿æ¥ï¼Œæ”¹æˆè‡ªå·±çš„æ•°æ®åº“ã€‚</p><p>nacos é…ç½®æ–‡ä»¶ï¼šlearning-api-dev.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /learning
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">63020</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>learning-service-dev.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.101.65<span class="token punctuation">:</span>3306/xc1010_learning<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;userUnicode=true&amp;useSSL=false&amp;</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-æ·»åŠ æŸ¥è¯¢è¯¾ç¨‹æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-2-2-æ·»åŠ æŸ¥è¯¢è¯¾ç¨‹æ¥å£" aria-hidden="true">#</a> <strong>2.2.2 æ·»åŠ æŸ¥è¯¢è¯¾ç¨‹æ¥å£</strong></h4><p>å†…å®¹ç®¡ç†æœåŠ¡æä¾›æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£ï¼Œæ­¤æ¥å£ä»è¯¾ç¨‹å‘å¸ƒè¡¨æŸ¥è¯¢ã€‚</p><p>æ­¤æ¥å£ä¸»è¦æä¾›å…¶å®ƒå¾®æœåŠ¡è¿œç¨‹è°ƒç”¨ï¼Œæ‰€ä»¥æ­¤æ¥å£ä¸ç”¨æˆæƒï¼Œæœ¬é¡¹ç›®æ ‡è®°æ­¤ç±»æ¥å£ç»Ÿä¸€ä»¥ /r å¼€å¤´ã€‚</p><p>åœ¨è¯¾ç¨‹å‘å¸ƒ controller ç±»ä¸­å®šä¹‰è¯¾ç¨‹å‘å¸ƒä¿¡æ¯æŸ¥è¯¢æ¥å£ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢è¯¾ç¨‹å‘å¸ƒä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/r/coursepublish/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CoursePublish</span> <span class="token function">getCoursepublish</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CoursePublish</span> coursePublish <span class="token operator">=</span> coursePublishService<span class="token punctuation">.</span><span class="token function">getCoursePublish</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> coursePublish<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service å¦‚ä¸‹ï¼š</p><p>å¦‚æœè¯¾ç¨‹å‘å¸ƒçŠ¶æ€æ­£å¸¸åˆ™æ­£å¸¸è¿”å›ï¼Œå¦åˆ™è¿”å›ç©ºã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token class-name">CoursePublish</span> <span class="token function">getCoursePublish</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">CoursePublish</span> coursePublish <span class="token operator">=</span> coursePublishMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> coursePublish <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ï¼š</p><p>å¯åŠ¨å†…å®¹ç®¡ç†æœåŠ¡ï¼Œä½¿ç”¨ httpclient æµ‹è¯•</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>
#### æŸ¥è¯¢è¯¾ç¨‹å‘å¸ƒä¿¡æ¯
GET {{content_host}}/content/r/coursepublish/2

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºæ˜¯åœ¨ç½‘å…³å¤„è¿›è¡Œä»¤ç‰Œæ ¡éªŒï¼Œæ‰€ä»¥åœ¨å¾®æœåŠ¡å¤„ä¸å†æ ¡éªŒä»¤ç‰Œçš„åˆæ³•æ€§ï¼Œä¿®æ”¹å†…å®¹ç®¡ç† content-api å·¥ç¨‹çš„ ResouceServerConfig ç±»ï¼Œå±è”½ authenticated()ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//          .antMatchers(&quot;/r/**&quot;,&quot;/course/**&quot;).authenticated()//æ‰€æœ‰/r/**çš„è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡</span>
          <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-3-æµ‹è¯•æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-2-3-æµ‹è¯•æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£" aria-hidden="true">#</a> <strong>2.2.3 æµ‹è¯•æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£</strong></h4><p>å­¦ç”Ÿä¸­å¿ƒæœåŠ¡è¿œç¨‹è°ƒç”¨å†…å®¹ç®¡ç†æœåŠ¡çš„æŸ¥è¯¢è¯¾ç¨‹å‘å¸ƒä¿¡æ¯æ¥å£ã€‚</p><p>å¯¼å…¥çš„å­¦ä¹ ä¸­å¿ƒå·¥ç¨‹å·²ç»å­˜åœ¨ ContentServiceClient æ¥å£ï¼Œé€šè¿‡æ­¤æ¥å£è¿œç¨‹è°ƒç”¨è¯¾ç¨‹æŸ¥è¯¢æ¥å£ã€‚</p><p>ç¼–å†™æµ‹è¯•æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CoursePublish</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>feignclient<span class="token punctuation">.</span></span><span class="token class-name">ContentServiceClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> Feignæ¥å£æµ‹è¯•ç±»
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/24 17:15
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignClientTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">ContentServiceClient</span> contentServiceClient<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testContentServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token class-name">CoursePublish</span> coursepublish <span class="token operator">=</span> contentServiceClient<span class="token punctuation">.</span><span class="token function">getCoursepublish</span><span class="token punctuation">(</span><span class="token number">18L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>åœ¨è¿›è¡Œ feign è¿œç¨‹è°ƒç”¨æ—¶ä¼šå°†å­—ç¬¦ä¸²è½¬æˆ LocalDateTimeï¼Œåœ¨ CoursePublish ç±»ä¸­ LocalDateTime çš„å±æ€§ä¸Šè¾¹æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>shape <span class="token operator">=</span> <span class="token class-name">JsonFormat<span class="token punctuation">.</span>Shape</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-5-æ·»åŠ é€‰è¯¾æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-2-5-æ·»åŠ é€‰è¯¾æ¥å£" aria-hidden="true">#</a> <strong>2.2.5 æ·»åŠ é€‰è¯¾æ¥å£</strong></h4><h5 id="_2-2-5-1-æ¥å£åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_2-2-5-1-æ¥å£åˆ†æ" aria-hidden="true">#</a> <strong>2.2.5.1 æ¥å£åˆ†æ</strong></h5><p>æœ¬æ¥å£æ”¯æŒå…è´¹è¯¾ç¨‹é€‰è¯¾ã€æ”¶è´¹è¯¾ç¨‹é€‰è¯¾ã€‚</p><p>å…è´¹è¯¾ç¨‹é€‰è¯¾ï¼šæ·»åŠ é€‰è¯¾è®°å½•ã€æ·»åŠ æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><p>æ”¶è´¹è¯¾ç¨‹é€‰è¯¾ï¼šæ·»åŠ é€‰è¯¾è®°å½•ã€‚</p><h5 id="_2-2-5-2-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_2-2-5-2-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>2.2.5.2 æ¥å£å®šä¹‰</strong></h5><p>1ã€è¯·æ±‚å‚æ•°ï¼šè¯¾ç¨‹ idã€å½“å‰ç”¨æˆ· id</p><p>2ã€å“åº”ç»“æœï¼šé€‰è¯¾è®°å½•ä¿¡æ¯ã€å­¦ä¹ èµ„æ ¼</p><p>å­¦ä¹ èµ„æ ¼ï¼š[{&quot;code&quot;:&quot;702001&quot;,&quot;desc&quot;:&quot;æ­£å¸¸å­¦ä¹ &quot;},{&quot;code&quot;:&quot;702002&quot;,&quot;desc&quot;:&quot;æ²¡æœ‰é€‰è¯¾æˆ–é€‰è¯¾åæ²¡æœ‰æ”¯ä»˜&quot;},{&quot;code&quot;:&quot;702003&quot;,&quot;desc&quot;:&quot;å·²è¿‡æœŸéœ€è¦ç”³è¯·ç»­æœŸæˆ–é‡æ–°æ”¯ä»˜&quot;}]</p><p>æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>execption<span class="token punctuation">.</span></span><span class="token class-name">XueChengPlusException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">RestResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">XcChooseCourseDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MyCourseTablesService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">SecurityUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> æˆ‘çš„è¯¾ç¨‹è¡¨æ¥å£
 * <span class="token keyword">@date</span> 2022/10/2 14:52
 */</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;æˆ‘çš„è¯¾ç¨‹è¡¨æ¥å£&quot;</span><span class="token punctuation">,</span> tags <span class="token operator">=</span> <span class="token string">&quot;æˆ‘çš„è¯¾ç¨‹è¡¨æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCourseTablesController</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ·»åŠ é€‰è¯¾&quot;</span><span class="token punctuation">)</span>
     <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/choosecourse/{courseId}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">XcChooseCourseDto</span> <span class="token function">addChooseCourse</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span>  <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service æ¥å£å®šä¹‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">XcChooseCourseDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcChooseCourse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcCourseTables</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æˆ‘çš„è¯¾ç¨‹è¡¨serviceæ¥å£
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/2 16:07
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyCourseTablesService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æ·»åŠ é€‰è¯¾
 * <span class="token keyword">@param</span> <span class="token parameter">userId</span> ç”¨æˆ·id
 * <span class="token keyword">@param</span> <span class="token parameter">courseId</span> è¯¾ç¨‹id
 * <span class="token keyword">@return</span> com.xuecheng.learning.model.dto.XcChooseCourseDto
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/24 17:33
*/</span>
 <span class="token keyword">public</span> <span class="token class-name">XcChooseCourseDto</span> <span class="token function">addChooseCourse</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service æ¥å£æ‰§è¡Œæµç¨‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>execption<span class="token punctuation">.</span></span><span class="token class-name">XueChengPlusException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CoursePublish</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>feignclient<span class="token punctuation">.</span></span><span class="token class-name">ContentServiceClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">XcChooseCourseMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">XcCourseTablesMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">XcChooseCourseDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcChooseCourse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcCourseTables</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MyCourseTablesService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>statement<span class="token punctuation">.</span></span><span class="token class-name">StatementUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeanUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/10/2 16:12
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCourseTablesServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MyCourseTablesService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcChooseCourseMapper</span> xcChooseCourseMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcCourseTablesMapper</span> xcCourseTablesMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ContentServiceClient</span> contentServiceClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MyCourseTablesService</span> myCourseTablesService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MyCourseTablesServiceImpl</span> currentProxy<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">XcChooseCourseDto</span> <span class="token function">addChooseCourse</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span>
        <span class="token class-name">CoursePublish</span> coursepublish <span class="token operator">=</span> contentServiceClient<span class="token punctuation">.</span><span class="token function">getCoursepublish</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¯¾ç¨‹æ”¶è´¹æ ‡å‡†</span>
        <span class="token class-name">String</span> charge <span class="token operator">=</span> coursepublish<span class="token punctuation">.</span><span class="token function">getCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é€‰è¯¾è®°å½•</span>
        <span class="token class-name">XcChooseCourse</span> chooseCourse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;201000&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>charge<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//è¯¾ç¨‹å…è´¹</span>
            <span class="token comment">//æ·»åŠ å…è´¹è¯¾ç¨‹</span>
            chooseCourse  <span class="token operator">=</span> <span class="token function">addFreeCoruse</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> coursepublish<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹è¡¨</span>
            <span class="token class-name">XcCourseTables</span> xcCourseTables <span class="token operator">=</span> <span class="token function">addCourseTabls</span><span class="token punctuation">(</span>chooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token comment">//æ·»åŠ æ”¶è´¹è¯¾ç¨‹</span>
            chooseCourse  <span class="token operator">=</span> <span class="token function">addChargeCoruse</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> coursepublish<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//è·å–å­¦ä¹ èµ„æ ¼</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>




<span class="token comment">//æ·»åŠ å…è´¹è¯¾ç¨‹,å…è´¹è¯¾ç¨‹åŠ å…¥é€‰è¯¾è®°å½•è¡¨ã€æˆ‘çš„è¯¾ç¨‹è¡¨</span>
<span class="token keyword">public</span> <span class="token class-name">XcChooseCourse</span> <span class="token function">addFreeCoruse</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">CoursePublish</span> coursepublish<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ·»åŠ æ”¶è´¹è¯¾ç¨‹</span>
<span class="token keyword">public</span> <span class="token class-name">XcChooseCourse</span> <span class="token function">addChargeCoruse</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span><span class="token class-name">CoursePublish</span> coursepublish<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹è¡¨</span>
<span class="token keyword">public</span> <span class="token class-name">XcCourseTables</span> <span class="token function">addCourseTabls</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span> xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2-5-3-æ·»åŠ å…è´¹è¯¾ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-2-5-3-æ·»åŠ å…è´¹è¯¾ç¨‹" aria-hidden="true">#</a> <strong>2.2.5.3 æ·»åŠ å…è´¹è¯¾ç¨‹</strong></h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>

<span class="token comment">//æ·»åŠ å…è´¹è¯¾ç¨‹,å…è´¹è¯¾ç¨‹åŠ å…¥é€‰è¯¾è®°å½•è¡¨ã€æˆ‘çš„è¯¾ç¨‹è¡¨</span>
<span class="token keyword">public</span> <span class="token class-name">XcChooseCourse</span> <span class="token function">addFreeCoruse</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">CoursePublish</span> coursepublish<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æŸ¥è¯¢é€‰è¯¾è®°å½•è¡¨æ˜¯å¦å­˜åœ¨å…è´¹çš„ä¸”é€‰è¯¾æˆåŠŸçš„è®¢å•</span>
    <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcChooseCourse</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    queryWrapper <span class="token operator">=</span> queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span><span class="token operator">::</span><span class="token function">getCourseId</span><span class="token punctuation">,</span> coursepublish<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span><span class="token operator">::</span><span class="token function">getOrderType</span><span class="token punctuation">,</span> <span class="token string">&quot;700001&quot;</span><span class="token punctuation">)</span><span class="token comment">//å…è´¹è¯¾ç¨‹</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">,</span> <span class="token string">&quot;701001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€‰è¯¾æˆåŠŸ</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcChooseCourse</span><span class="token punctuation">&gt;</span></span> xcChooseCourses <span class="token operator">=</span> xcChooseCourseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xcChooseCourses <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> xcChooseCourses<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> xcChooseCourses<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ·»åŠ é€‰è¯¾è®°å½•ä¿¡æ¯</span>
    <span class="token class-name">XcChooseCourse</span> xcChooseCourse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcChooseCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCourseId</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCourseName</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCoursePrice</span><span class="token punctuation">(</span><span class="token number">0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å…è´¹è¯¾ç¨‹ä»·æ ¼ä¸º0</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCompanyId</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setOrderType</span><span class="token punctuation">(</span><span class="token string">&quot;700001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å…è´¹è¯¾ç¨‹</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;701001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€‰è¯¾æˆåŠŸ</span>

    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setValidDays</span><span class="token punctuation">(</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å…è´¹è¯¾ç¨‹é»˜è®¤365</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setValidtimeStart</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setValidtimeEnd</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourseMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> xcChooseCourse<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2-5-4-æ·»åŠ æˆ‘çš„è¯¾ç¨‹è¡¨" tabindex="-1"><a class="header-anchor" href="#_2-2-5-4-æ·»åŠ æˆ‘çš„è¯¾ç¨‹è¡¨" aria-hidden="true">#</a> <strong>2.2.5.4 æ·»åŠ æˆ‘çš„è¯¾ç¨‹è¡¨</strong></h5><p>æˆ‘çš„è¯¾ç¨‹è¡¨çš„è®°å½•æ¥æºäºé€‰è¯¾è®°å½•ï¼Œé€‰è¯¾è®°å½•æˆåŠŸå°†è¯¾ç¨‹ä¿¡æ¯æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><p>å¦‚æœæˆ‘çš„è¯¾ç¨‹è¡¨å·²å­˜åœ¨è¯¾ç¨‹å¯èƒ½å·²ç»è¿‡æœŸï¼Œå¦‚æœæœ‰æ–°çš„é€‰è¯¾è®°å½•åˆ™éœ€è¦æ›´æ–°æˆ‘çš„è¯¾ç¨‹è¡¨ä¸­çš„ç°æœ‰ä¿¡æ¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹è¡¨
 * <span class="token keyword">@param</span> <span class="token parameter">xcChooseCourse</span> é€‰è¯¾è®°å½•
 * <span class="token keyword">@return</span> com.xuecheng.learning.model.po.XcCourseTables
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/3 11:24
*/</span>
<span class="token keyword">public</span> <span class="token class-name">XcCourseTables</span> <span class="token function">addCourseTabls</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span> xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//é€‰è¯¾è®°å½•å®Œæˆä¸”æœªè¿‡æœŸå¯ä»¥æ·»åŠ è¯¾ç¨‹åˆ°è¯¾ç¨‹è¡¨</span>
    <span class="token class-name">String</span> status <span class="token operator">=</span> xcChooseCourse<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;701001&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;é€‰è¯¾æœªæˆåŠŸï¼Œæ— æ³•æ·»åŠ åˆ°è¯¾ç¨‹è¡¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æŸ¥è¯¢æˆ‘çš„è¯¾ç¨‹è¡¨</span>
    <span class="token class-name">XcCourseTables</span> xcCourseTables <span class="token operator">=</span> <span class="token function">getXcCourseTables</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xcChooseCourse<span class="token punctuation">.</span><span class="token function">getCourseId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xcCourseTables<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">return</span> xcCourseTables<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">XcCourseTables</span> xcCourseTablesNew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcCourseTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setChooseCourseId</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setCourseId</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getCourseId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setCompanyId</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setCourseName</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getCourseName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setValidtimeStart</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getValidtimeStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setValidtimeEnd</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getValidtimeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesNew<span class="token punctuation">.</span><span class="token function">setCourseType</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">.</span><span class="token function">getOrderType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcCourseTablesMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>xcCourseTablesNew<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> xcCourseTablesNew<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æ ¹æ®è¯¾ç¨‹å’Œç”¨æˆ·æŸ¥è¯¢æˆ‘çš„è¯¾ç¨‹è¡¨ä¸­æŸä¸€é—¨è¯¾ç¨‹
 * <span class="token keyword">@param</span> <span class="token parameter">userId</span>
 * <span class="token keyword">@param</span> <span class="token parameter">courseId</span>
 * <span class="token keyword">@return</span> com.xuecheng.learning.model.po.XcCourseTables
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/2 17:07
*/</span>
<span class="token keyword">public</span> <span class="token class-name">XcCourseTables</span> <span class="token function">getXcCourseTables</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">XcCourseTables</span> xcCourseTables <span class="token operator">=</span> xcCourseTablesMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcCourseTables</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcCourseTables</span><span class="token operator">::</span><span class="token function">getCourseId</span><span class="token punctuation">,</span> courseId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xcCourseTables<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2-5-5-æ·»åŠ æ”¶è´¹è¯¾ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-2-5-5-æ·»åŠ æ”¶è´¹è¯¾ç¨‹" aria-hidden="true">#</a> <strong>2.2.5.5 æ·»åŠ æ”¶è´¹è¯¾ç¨‹</strong></h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token comment">//æ·»åŠ æ”¶è´¹è¯¾ç¨‹</span>
<span class="token keyword">public</span> <span class="token class-name">XcChooseCourse</span> <span class="token function">addChargeCoruse</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span><span class="token class-name">CoursePublish</span> coursepublish<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">//å¦‚æœå­˜åœ¨å¾…æ”¯ä»˜è®°å½•ç›´æ¥è¿”å›</span>
    <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcChooseCourse</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    queryWrapper <span class="token operator">=</span> queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span><span class="token operator">::</span><span class="token function">getCourseId</span><span class="token punctuation">,</span> coursepublish<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span><span class="token operator">::</span><span class="token function">getOrderType</span><span class="token punctuation">,</span> <span class="token string">&quot;700002&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ”¶è´¹è®¢å•</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcChooseCourse</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">,</span> <span class="token string">&quot;701002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¾…æ”¯ä»˜</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcChooseCourse</span><span class="token punctuation">&gt;</span></span> xcChooseCourses <span class="token operator">=</span> xcChooseCourseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xcChooseCourses <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> xcChooseCourses<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> xcChooseCourses<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">XcChooseCourse</span> xcChooseCourse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcChooseCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCourseId</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCourseName</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCoursePrice</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCompanyId</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setOrderType</span><span class="token punctuation">(</span><span class="token string">&quot;700002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ”¶è´¹è¯¾ç¨‹</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;701002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¾…æ”¯ä»˜</span>

    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setValidDays</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getValidDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setValidtimeStart</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourse<span class="token punctuation">.</span><span class="token function">setValidtimeEnd</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span>coursepublish<span class="token punctuation">.</span><span class="token function">getValidDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourseMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xcChooseCourse<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2-5-6-è·å–å­¦ä¹ èµ„æ ¼" tabindex="-1"><a class="header-anchor" href="#_2-2-5-6-è·å–å­¦ä¹ èµ„æ ¼" aria-hidden="true">#</a> <strong>2.2.5.6 è·å–å­¦ä¹ èµ„æ ¼</strong></h5><p>å®šä¹‰è·å–å­¦ä¹ èµ„æ ¼æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyCourseTablesService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">XcChooseCourseDto</span> <span class="token function">addChooseCourse</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> åˆ¤æ–­å­¦ä¹ èµ„æ ¼
     * <span class="token keyword">@param</span> <span class="token parameter">userId</span>
     * <span class="token keyword">@param</span> <span class="token parameter">courseId</span>
     * <span class="token keyword">@return</span> XcCourseTablesDto å­¦ä¹ èµ„æ ¼çŠ¶æ€ [<span class="token punctuation">{</span>&quot;code&quot;:&quot;702001&quot;,&quot;desc&quot;:&quot;æ­£å¸¸å­¦ä¹ &quot;<span class="token punctuation">}</span>,<span class="token punctuation">{</span>&quot;code&quot;:&quot;702002&quot;,&quot;desc&quot;:&quot;æ²¡æœ‰é€‰è¯¾æˆ–é€‰è¯¾åæ²¡æœ‰æ”¯ä»˜&quot;<span class="token punctuation">}</span>,<span class="token punctuation">{</span>&quot;code&quot;:&quot;702003&quot;,&quot;desc&quot;:&quot;å·²è¿‡æœŸéœ€è¦ç”³è¯·ç»­æœŸæˆ–é‡æ–°æ”¯ä»˜&quot;<span class="token punctuation">}</span>]
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/10/3 7:37
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">XcCourseTablesDto</span> <span class="token function">getLearningStatus</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥å£å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> åˆ¤æ–­å­¦ä¹ èµ„æ ¼
 * <span class="token keyword">@param</span> <span class="token parameter">userId</span>
 * <span class="token keyword">@param</span> <span class="token parameter">courseId</span>
 * <span class="token keyword">@return</span> XcCourseTablesDto å­¦ä¹ èµ„æ ¼çŠ¶æ€ [<span class="token punctuation">{</span>&quot;code&quot;:&quot;702001&quot;,&quot;desc&quot;:&quot;æ­£å¸¸å­¦ä¹ &quot;<span class="token punctuation">}</span>,<span class="token punctuation">{</span>&quot;code&quot;:&quot;702002&quot;,&quot;desc&quot;:&quot;æ²¡æœ‰é€‰è¯¾æˆ–é€‰è¯¾åæ²¡æœ‰æ”¯ä»˜&quot;<span class="token punctuation">}</span>,<span class="token punctuation">{</span>&quot;code&quot;:&quot;702003&quot;,&quot;desc&quot;:&quot;å·²è¿‡æœŸéœ€è¦ç”³è¯·ç»­æœŸæˆ–é‡æ–°æ”¯ä»˜&quot;<span class="token punctuation">}</span>]
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/3 7:37
*/</span>
<span class="token keyword">public</span> <span class="token class-name">XcCourseTablesDto</span> <span class="token function">getLearningStatus</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//æŸ¥è¯¢æˆ‘çš„è¯¾ç¨‹è¡¨</span>
    <span class="token class-name">XcCourseTables</span> xcCourseTables <span class="token operator">=</span> <span class="token function">getXcCourseTables</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xcCourseTables<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">XcCourseTablesDto</span> xcCourseTablesDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcCourseTablesDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ²¡æœ‰é€‰è¯¾æˆ–é€‰è¯¾åæ²¡æœ‰æ”¯ä»˜</span>
        xcCourseTablesDto<span class="token punctuation">.</span><span class="token function">setLearnStatus</span><span class="token punctuation">(</span><span class="token string">&quot;702002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> xcCourseTablesDto<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">XcCourseTablesDto</span> xcCourseTablesDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcCourseTablesDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>xcCourseTables<span class="token punctuation">,</span>xcCourseTablesDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ˜¯å¦è¿‡æœŸ,trueè¿‡æœŸï¼Œfalseæœªè¿‡æœŸ</span>
    <span class="token keyword">boolean</span> isExpires <span class="token operator">=</span> xcCourseTables<span class="token punctuation">.</span><span class="token function">getValidtimeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isExpires<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//æ­£å¸¸å­¦ä¹ </span>
        xcCourseTablesDto<span class="token punctuation">.</span><span class="token function">setLearnStatus</span><span class="token punctuation">(</span><span class="token string">&quot;702001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> xcCourseTablesDto<span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">//å·²è¿‡æœŸ</span>
        xcCourseTablesDto<span class="token punctuation">.</span><span class="token function">setLearnStatus</span><span class="token punctuation">(</span><span class="token string">&quot;702003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> xcCourseTablesDto<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2-5-7-service-æ¥å£å®Œå–„" tabindex="-1"><a class="header-anchor" href="#_2-2-5-7-service-æ¥å£å®Œå–„" aria-hidden="true">#</a> <strong>2.2.5.7 service æ¥å£å®Œå–„</strong></h5><p>å®Œå–„ Service æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">XcChooseCourseDto</span> <span class="token function">addChooseCourse</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span>
    <span class="token class-name">CoursePublish</span> coursepublish <span class="token operator">=</span> contentServiceClient<span class="token punctuation">.</span><span class="token function">getCoursepublish</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è¯¾ç¨‹æ”¶è´¹æ ‡å‡†</span>
    <span class="token class-name">String</span> charge <span class="token operator">=</span> coursepublish<span class="token punctuation">.</span><span class="token function">getCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//é€‰è¯¾è®°å½•</span>
    <span class="token class-name">XcChooseCourse</span> chooseCourse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;201000&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>charge<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//è¯¾ç¨‹å…è´¹</span>
        <span class="token comment">//æ·»åŠ å…è´¹è¯¾ç¨‹</span>
        chooseCourse <span class="token operator">=</span> <span class="token function">addFreeCoruse</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> coursepublish<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹è¡¨</span>
        <span class="token class-name">XcCourseTables</span> xcCourseTables <span class="token operator">=</span> <span class="token function">addCourseTabls</span><span class="token punctuation">(</span>chooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ·»åŠ æ”¶è´¹è¯¾ç¨‹</span>
        chooseCourse <span class="token operator">=</span> <span class="token function">addChargeCoruse</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> coursepublish<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">XcChooseCourseDto</span> xcChooseCourseDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcChooseCourseDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>chooseCourse<span class="token punctuation">,</span>xcChooseCourseDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è·å–å­¦ä¹ èµ„æ ¼</span>
    <span class="token class-name">XcCourseTablesDto</span> xcCourseTablesDto <span class="token operator">=</span> <span class="token function">getLearningStatus</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcChooseCourseDto<span class="token punctuation">.</span><span class="token function">setLearnStatus</span><span class="token punctuation">(</span>xcCourseTablesDto<span class="token punctuation">.</span><span class="token function">getLearnStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xcChooseCourseDto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2-5-8-å®Œå–„-controller" tabindex="-1"><a class="header-anchor" href="#_2-2-5-8-å®Œå–„-controller" aria-hidden="true">#</a> <strong>2.2.5.8 å®Œå–„ controller</strong></h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">MyCourseTablesService</span> courseTablesService<span class="token punctuation">;</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ·»åŠ é€‰è¯¾&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/choosecourse/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">XcChooseCourseDto</span> <span class="token function">addChooseCourse</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç™»å½•ç”¨æˆ·</span>
    <span class="token class-name">SecurityUtil<span class="token punctuation">.</span>XcUser</span> user <span class="token operator">=</span> <span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·ç™»å½•åç»§ç»­é€‰è¯¾&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> userId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>  courseTablesService<span class="token punctuation">.</span><span class="token function">addChooseCourse</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢å­¦ä¹ èµ„æ ¼&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/choosecourse/learnstatus/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">XcCourseTablesDto</span> <span class="token function">getLearnstatus</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç™»å½•ç”¨æˆ·</span>
    <span class="token class-name">SecurityUtil<span class="token punctuation">.</span>XcUser</span> user <span class="token operator">=</span> <span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·ç™»å½•åç»§ç»­é€‰è¯¾&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> userId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>  courseTablesService<span class="token punctuation">.</span><span class="token function">getLeanringStatus</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-3-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>2.3 æ¥å£æµ‹è¯•</strong></h3><h4 id="_2-3-1-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-3-1-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> <strong>2.3.1 å•å…ƒæµ‹è¯•</strong></h4><p>1ã€å‡†å¤‡æµ‹è¯•ç¯å¢ƒ</p><p>å‘å¸ƒä¸¤é—¨è¯¾ç¨‹ï¼Œä¸€é—¨ä¸ºå…è´¹ï¼Œä¸€é—¨ä¸ºæ”¶è´¹ã€‚</p><p>å°æŠ€å·§ï¼šå¯ä»¥æ›´æ”¹è¯¾ç¨‹å‘å¸ƒè¡¨å·²æœ‰è¯¾ç¨‹çš„æ”¶è´¹æ ‡å‡†è¿›è¡Œæµ‹è¯•ã€‚</p><p>2ã€æµ‹è¯•æ·»åŠ å…è´¹è¯¾ç¨‹</p><p>æˆåŠŸï¼šé€‰è¯¾è®°å½•è¡¨ä¸€æ¡è®°å½•ã€æˆ‘çš„è¯¾ç¨‹è¡¨ä¸€æ¡è®°å½•ã€‚</p><p>3ã€æµ‹è¯•æ·»åŠ æ”¶è´¹è¯¾ç¨‹</p><p>æˆåŠŸï¼šé€‰è¯¾è®°å½•è¡¨ä¸€æ¡è®°å½•</p><p>4ã€é‡å¤æ·»åŠ é€‰è¯¾</p><p>é‡å¤æ·»åŠ ç›¸åŒçš„è¯¾ç¨‹ï¼Œè§‚å¯Ÿæ˜¯å¦å­˜åœ¨å¼‚å¸¸ã€‚</p><p>5ã€ç”Ÿæˆä»¤ç‰Œï¼Œä¸ºæ–¹ä¾¿ç”Ÿæˆä»¤ç‰Œæš‚æ—¶å°† PasswordAuthServiceImpl ç±»ä¸­çš„éªŒè¯ç å±è”½</p><p>6ã€ä½¿ç”¨ httpclient æµ‹è¯•å¦‚ä¸‹ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### æ·»åŠ é€‰è¯¾
POST {{learning_host}}/learning/choosecourse/2
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsieHVlY2hlbmctcGx1cyJdLCJ1c2VyX25hbWUiOiJ7XCJiaXJ0aGRheVwiOlwiMjAyMi0wOS0yOFQxOToyODo0NlwiLFwiY3JlYXRlVGltZVwiOlwiMjAyMi0wOS0yOFQwODozMjowM1wiLFwiaWRcIjpcIjUwXCIsXCJuYW1lXCI6XCLlrabnlJ8xXCIsXCJuaWNrbmFtZVwiOlwi5aSn5rC054mbXCIsXCJwZXJtaXNzaW9uc1wiOltcInhjX3N5c21hbmFnZXJcIixcInhjX3N5c21hbmFnZXJfdXNlclwiLFwieGNfc3lzbWFuYWdlcl91c2VyX2FkZFwiLFwieGNfc3lzbWFuYWdlcl91c2VyX2VkaXRcIixcInhjX3N5c21hbmFnZXJfdXNlcl92aWV3XCIsXCJ4Y19zeXNtYW5hZ2VyX3VzZXJfZGVsZXRlXCIsXCJ4Y19zeXNtYW5hZ2VyX2RvY1wiLFwieGNfc3lzbWFuYWdlcl9sb2dcIixcInhjX3RlYWNobWFuYWdlcl9jb3Vyc2VcIixcInhjX3RlYWNobWFuYWdlcl9jb3Vyc2VfYWRkXCIsXCJ4Y190ZWFjaG1hbmFnZXJfY291cnNlX2Jhc2VcIixcInhjX3N5c21hbmFnZXJfY29tcGFueVwiLFwieGNfdGVhY2htYW5hZ2VyX2NvdXJzZV9saXN0XCJdLFwic2V4XCI6XCIxXCIsXCJzdGF0dXNcIjpcIjFcIixcInVzZXJuYW1lXCI6XCJzdHUxXCIsXCJ1c2VycGljXCI6XCJodHRwOi8vZmlsZS54dWVjaGVuZy1wbHVzLmNvbS9kZGRmXCIsXCJ1dHlwZVwiOlwiMTAxMDAxXCJ9Iiwic2NvcGUiOlsiYWxsIl0sImV4cCI6MTY2NzI5OTQwNiwiYXV0aG9yaXRpZXMiOlsieGNfc3lzbWFuYWdlcl9kb2MiLCJ4Y19zeXNtYW5hZ2VyX3VzZXJfdmlldyIsInhjX3RlYWNobWFuYWdlcl9jb3Vyc2UiLCJ4Y19zeXNtYW5hZ2VyX3VzZXJfYWRkIiwieGNfc3lzbWFuYWdlcl9jb21wYW55IiwieGNfc3lzbWFuYWdlcl91c2VyX2RlbGV0ZSIsInhjX3N5c21hbmFnZXJfdXNlciIsInhjX3RlYWNobWFuYWdlcl9jb3Vyc2VfYmFzZSIsInhjX3RlYWNobWFuYWdlcl9jb3Vyc2VfbGlzdCIsInhjX3N5c21hbmFnZXIiLCJ4Y19zeXNtYW5hZ2VyX2xvZyIsInhjX3N5c21hbmFnZXJfdXNlcl9lZGl0IiwieGNfdGVhY2htYW5hZ2VyX2NvdXJzZV9hZGQiXSwianRpIjoiOTYyOTYzMWQtYjRiMC00NTlkLTgzYzktM2Q4MmRiNmI4NDEzIiwiY2xpZW50X2lkIjoiWGNXZWJBcHAifQ.b77ZreiNlPoN-_dnAWxuBfH32tPIoRwg2ePgKn_aZ8c</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-2-å‰åç«¯è”è°ƒ" tabindex="-1"><a class="header-anchor" href="#_2-3-2-å‰åç«¯è”è°ƒ" aria-hidden="true">#</a> <strong>2.3.2 å‰åç«¯è”è°ƒ</strong></h4><p>æµ‹è¯•æµç¨‹ï¼š</p><p>1ã€å¯åŠ¨è®¤è¯æœåŠ¡ã€ç½‘å…³æœåŠ¡ã€éªŒè¯ç æœåŠ¡ã€å­¦ä¹ ä¸­å¿ƒæœåŠ¡ã€å†…å®¹ç®¡ç†æœåŠ¡ã€‚</p><p>2ã€å‘å¸ƒä¸€é—¨å…è´¹è¯¾ç¨‹ã€ä¸€é—¨æ”¶è´¹è¯¾ç¨‹</p><p>3ã€è¿›å…¥è¯¾ç¨‹è¯¦æƒ…ç•Œé¢ï¼Œç‚¹å‡»â€œé©¬ä¸Šå­¦ä¹ â€</p><p>4ã€æŠ¥åæˆåŠŸï¼Œè‡ªåŠ¨è·³è½¬åˆ°å­¦ä¹ ç•Œé¢ã€‚</p><p>5ã€è§‚å¯Ÿé€‰è¯¾è®°å½•è¡¨ã€æˆ‘çš„è¯¾ç¨‹è¡¨æ•°æ®æ˜¯å¦æ­£ç¡®ã€‚</p><p>å¯¹äºå…è´¹è¯¾ç¨‹åœ¨è¯¾ç¨‹è¯¦æƒ…é¡µé¢ç‚¹å‡»â€œé©¬ä¸Šå­¦ä¹ â€ï¼Œé€šè¿‡å¼•å¯¼ç•Œé¢æ·»åŠ é€‰è¯¾ã€‚</p><p>1ã€è¿›å…¥è¯¾ç¨‹è¯¦æƒ…ç‚¹å‡»é©¬ä¸Šå­¦ä¹ </p><p><img src="/MyBlog/assets/image-20230611154838147-4d93de17.png" alt="image-20230611155550670"></p><p>2ã€è¯¾ç¨‹å…è´¹æ—¶å¼•å¯¼åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ã€æˆ–è¿›å…¥å­¦ä¹ ç•Œé¢ã€‚</p><p><img src="/MyBlog/assets/image-20230611154844659-4ef6b95e.png" alt="image-20230611155554764"></p><h2 id="_3-æ”¯ä»˜" tabindex="-1"><a class="header-anchor" href="#_3-æ”¯ä»˜" aria-hidden="true">#</a> <strong>3 æ”¯ä»˜</strong></h2><h3 id="_3-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_3-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>3.1 éœ€æ±‚åˆ†æ</strong></h3><h4 id="_3-1-1-æ‰§è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-1-1-æ‰§è¡Œæµç¨‹" aria-hidden="true">#</a> <strong>3.1.1 æ‰§è¡Œæµç¨‹</strong></h4><p>ç”¨æˆ·å»å­¦ä¹ æ”¶è´¹è¯¾ç¨‹æ—¶å¼•å¯¼å…¶å»æ”¯ä»˜ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230611154849591-3d021039.png" alt="image-20230611155559312"></p><p>å½“ç”¨æˆ·ç‚¹å‡»â€œå¾®ä¿¡æ”¯ä»˜â€æˆ–æ”¯ä»˜å®æ”¯ä»˜æ—¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611155603305-105cd717.png" alt="image-20230611155603305"></p><p>1ã€è¯·æ±‚å­¦ä¹ ä¸­å¿ƒæœåŠ¡åˆ›å»ºé€‰è¯¾è®°å½•</p><p>2ã€è¯·æ±‚è®¢å•æœåŠ¡åˆ›å»ºå•†å“è®¢å•ã€ç”Ÿæˆæ”¯ä»˜äºŒç»´ç ã€‚</p><p>3ã€ç”¨æˆ·æ‰«ç è¯·æ±‚è®¢å•æ”¯ä»˜æœåŠ¡ï¼Œè®¢å•æ”¯ä»˜æœåŠ¡è¯·æ±‚ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ç”Ÿæˆæ”¯ä»˜è®¢å•ã€‚</p><p>4ã€å‰ç«¯å”¤èµ·æ”¯ä»˜å®¢æˆ·ç«¯ï¼Œç”¨æˆ·è¾“å…¥å¯†ç å®Œæˆæ”¯ä»˜ã€‚</p><p>5ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°æ”¯ä»˜å®Œæˆå‘èµ·æ”¯ä»˜é€šçŸ¥ã€‚</p><p>6ã€è®¢å•æ”¯ä»˜æœåŠ¡æ¥æ”¶ç¬¬ä¸‰æ–¹æ”¯ä»˜é€šçŸ¥ç»“æœã€‚</p><p>7ã€ç”¨æˆ·åœ¨å‰ç«¯æŸ¥è¯¢æ”¯ä»˜ç»“æœï¼Œè¯·æ±‚è®¢å•æ”¯ä»˜æœåŠ¡æŸ¥è¯¢æ”¯ä»˜ç»“æœã€‚</p><p>8ã€è®¢å•æ”¯ä»˜æœåŠ¡å‘å­¦ä¹ ä¸­å¿ƒæœåŠ¡é€šçŸ¥æ”¯ä»˜ç»“æœã€‚</p><p>9ã€å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ”¶åˆ°æ”¯ä»˜ç»“æœï¼Œå¦‚æœæ”¯ä»˜æˆåŠŸåˆ™æ›´æ–°é€‰è¯¾è®°å½•ï¼Œå¹¶æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><h4 id="_3-1-2-é€šç”¨è®¢å•æœåŠ¡è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#_3-1-2-é€šç”¨è®¢å•æœåŠ¡è®¾è®¡" aria-hidden="true">#</a> <strong>3.1.2 é€šç”¨è®¢å•æœåŠ¡è®¾è®¡</strong></h4><p>åœ¨æœ¬é¡¹ç›®ä¸­ä¸ä»…é€‰è¯¾éœ€è¦ä¸‹å•ã€è´­ä¹°å­¦ä¹ èµ„æ–™ã€è€å¸ˆä¸€å¯¹ä¸€ç­”ç–‘ç­‰æ‰€ä»¥æ”¶è´¹é¡¹ç›®éƒ½éœ€è¦ä¸‹å•æ”¯ä»˜ã€‚</p><p>æ‰€ä»¥æœ¬é¡¹ç›®è®¾è®¡é€šç”¨çš„è®¢å•æœåŠ¡ï¼Œé€šç”¨çš„è®¢å•æœåŠ¡æ‰¿æ¥å„ä¸šåŠ¡æ¨¡å—çš„æ”¶è´¹æ”¯ä»˜éœ€æ±‚ï¼Œå½“ç”¨æˆ·éœ€è¦äº¤è´¹æ—¶ç»Ÿä¸€ç”Ÿæˆå•†å“è®¢å•å¹¶è¿›è¡Œæ”¯ä»˜ã€‚</p><p><img src="/MyBlog/assets/image-20230611155609750-14c4d6cc.png" alt="image-20230611155609750"></p><p>æ‰€æœ‰æ”¶è´¹ä¸šåŠ¡æœ€ç»ˆè½¬æ¢ä¸ºå•†å“è®¢å•è®°å½•åœ¨è®¢å•æœåŠ¡çš„å•†å“è®¢å•è¡¨ã€‚</p><p><img src="/MyBlog/assets/image-20230611155614327-a1cc34a0.png" alt="image-20230611155614327"></p><p>ä»¥é€‰è¯¾ä¸ºä¾‹ï¼Œé€‰è¯¾è®°å½•è¡¨çš„ ID è®°å½•åœ¨å•†å“è®¢å•è¡¨çš„ out_business_id å­—æ®µã€‚</p><p><img src="/MyBlog/assets/image-20230611155618433-12fb514d.png" alt="image-20230611155618433"></p><h3 id="_3-2-æ”¯ä»˜æ¥å£è°ƒç ”" tabindex="-1"><a class="header-anchor" href="#_3-2-æ”¯ä»˜æ¥å£è°ƒç ”" aria-hidden="true">#</a> <strong>3.2 æ”¯ä»˜æ¥å£è°ƒç ”</strong></h3><h4 id="_3-2-1-å¾®ä¿¡æ”¯ä»˜æ¥å£è°ƒç ”" tabindex="-1"><a class="header-anchor" href="#_3-2-1-å¾®ä¿¡æ”¯ä»˜æ¥å£è°ƒç ”" aria-hidden="true">#</a> <strong>3.2.1 å¾®ä¿¡æ”¯ä»˜æ¥å£è°ƒç ”</strong></h4><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç½‘ç«™è¦æ”¯æŒåœ¨çº¿æ”¯ä»˜åŠŸèƒ½é€šå¸¸æ¥å…¥ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ï¼Œæ¯”å¦‚ï¼šå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€å…¶å®ƒçš„èšåˆæ”¯ä»˜å¹³å°ã€‚</p><p>æœ¬é¡¹ç›®çš„éœ€æ±‚å®ç°æ‰‹æœºæ‰«ç æ”¯ä»˜ï¼Œç°åœ¨å¯¹å¾®ä¿¡ã€æ”¯ä»˜å®çš„æ”¯ä»˜æ¥å£è¿›è¡Œè°ƒç ”ã€‚</p><p>å¾®ä¿¡ç›®å‰æä¾›çš„æ”¯ä»˜æ–¹å¼å¦‚ä¸‹ï¼š</p><p>åœ°å€ï¼šhttps://pay.weixin.qq.com/static/product/product_index.shtml</p><p><img src="/MyBlog/assets/image-20230611155624227-53090a7f.png" alt="image-20230611155624227"></p><p>1ã€ä»˜æ¬¾ç æ”¯ä»˜æ˜¯æŒ‡ç”¨æˆ·å±•ç¤ºå¾®ä¿¡é’±åŒ…å†…çš„â€œä»˜æ¬¾ç â€ç»™å•†æˆ·ç³»ç»Ÿæ‰«æåç›´æ¥å®Œæˆæ”¯ä»˜ï¼Œé€‚ç”¨äºçº¿ä¸‹åœºæ‰€é¢å¯¹é¢æ”¶é“¶çš„åœºæ™¯ï¼Œä¾‹å¦‚å•†è¶…ã€ä¾¿åˆ©åº—ã€é¤é¥®ã€åŒ»é™¢ã€å­¦æ ¡ã€ç”µå½±é™¢å’Œæ—…æ¸¸æ™¯åŒºç­‰å…·æœ‰æ˜ç¡®ç»è¥åœ°å€çš„å®ä½“åœºæ‰€ã€‚</p><p><img src="/MyBlog/assets/image-20230611155628749-1eb9f012.png" alt="image-20230611155628749"></p><p>2ã€JSAPI æ”¯ä»˜æ˜¯æŒ‡å•†æˆ·é€šè¿‡è°ƒç”¨å¾®ä¿¡æ”¯ä»˜æä¾›çš„ JSAPI æ¥å£ï¼Œåœ¨æ”¯ä»˜åœºæ™¯ä¸­è°ƒèµ·å¾®ä¿¡æ”¯ä»˜æ¨¡å—å®Œæˆæ”¶æ¬¾</p><p>çº¿ä¸‹åœºæ‰€ï¼šè°ƒç”¨æ¥å£ç”ŸæˆäºŒç»´ç ï¼Œç”¨æˆ·æ‰«æäºŒç»´ç ååœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢åå®Œæˆæ”¯ä»˜</p><p>å…¬ä¼—å·åœºæ™¯ï¼šç”¨æˆ·åœ¨å¾®ä¿¡å…¬ä¼—è´¦å·å†…è¿›å…¥å•†å®¶å…¬ä¼—å·ï¼Œæ‰“å¼€æŸä¸ªä¸»é¡µé¢ï¼Œå®Œæˆæ”¯ä»˜</p><p>PC ç½‘ç«™åœºæ™¯ï¼šåœ¨ç½‘ç«™ä¸­å±•ç¤ºäºŒç»´ç ï¼Œç”¨æˆ·æ‰«æäºŒç»´ç ååœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢åå®Œæˆæ”¯ä»˜</p><p><img src="/MyBlog/assets/image-20230611155634450-36b7ed24.png" alt="image-20230611155634450"></p><p>3ã€å°ç¨‹åºæ”¯ä»˜æ˜¯æŒ‡å•†æˆ·é€šè¿‡è°ƒç”¨å¾®ä¿¡æ”¯ä»˜å°ç¨‹åºæ”¯ä»˜æ¥å£ï¼Œåœ¨å¾®ä¿¡å°ç¨‹åºå¹³å°å†…å®ç°æ”¯ä»˜åŠŸèƒ½ï¼›ç”¨æˆ·æ‰“å¼€å•†å®¶åŠ©æ‰‹å°ç¨‹åºä¸‹å•ï¼Œè¾“å…¥æ”¯ä»˜å¯†ç å¹¶å®Œæˆæ”¯ä»˜åï¼Œè¿”å›å•†å®¶å°ç¨‹åºã€‚</p><p><img src="/MyBlog/assets/image-20230611155637962-092f0d2b.png" alt="image-20230611155637962"></p><p>4ã€Native æ”¯ä»˜æ˜¯æŒ‡å•†æˆ·ç³»ç»ŸæŒ‰å¾®ä¿¡æ”¯ä»˜åè®®ç”Ÿæˆæ”¯ä»˜äºŒç»´ç ï¼Œç”¨æˆ·å†ç”¨å¾®ä¿¡â€œæ‰«ä¸€æ‰«â€å®Œæˆæ”¯ä»˜çš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼é€‚ç”¨äº PC ç½‘ç«™ã€å®ä½“åº—å•å“æˆ–è®¢å•ã€åª’ä½“å¹¿å‘Šæ”¯ä»˜ç­‰åœºæ™¯ã€‚</p><p><img src="/MyBlog/assets/image-20230611155642831-3438d409.png" alt="image-20230611155642831"></p><p>5ã€APP æ”¯ä»˜æ˜¯æŒ‡å•†æˆ·é€šè¿‡åœ¨ç§»åŠ¨ç«¯åº”ç”¨ APP ä¸­é›†æˆå¼€æ”¾ SDK è°ƒèµ·å¾®ä¿¡æ”¯ä»˜æ¨¡å—æ¥å®Œæˆæ”¯ä»˜ã€‚é€‚ç”¨äºåœ¨ç§»åŠ¨ç«¯ APP ä¸­é›†æˆå¾®ä¿¡æ”¯ä»˜åŠŸèƒ½çš„åœºæ™¯ã€‚</p><p><img src="/MyBlog/assets/image-20230611155647113-f7259439.png" alt="image-20230611155647113"></p><p>6ã€åˆ·è„¸æ”¯ä»˜æ˜¯æŒ‡ç”¨æˆ·åœ¨åˆ·è„¸è®¾å¤‡å‰é€šè¿‡æ‘„åƒå¤´åˆ·è„¸ã€è¯†åˆ«èº«ä»½åè¿›è¡Œçš„ä¸€ç§æ”¯ä»˜æ–¹å¼ï¼Œå®‰å…¨ä¾¿æ·ã€‚é€‚ç”¨äºçº¿ä¸‹å®ä½“åœºæ‰€çš„æ”¶é“¶åœºæ™¯ï¼Œå¦‚å•†è¶…ã€é¤é¥®ã€ä¾¿åˆ©åº—ã€åŒ»é™¢ã€å­¦æ ¡ç­‰ã€‚</p><p><img src="/MyBlog/assets/image-20230611155651198-2877e862.png" alt="image-20230611155651198"></p><blockquote><p>ä»¥ä¸Šæ¥å£ native å’Œ JSAPI éƒ½å¯ä»¥å®ç° pc ç½‘ç«™å®ç°æ‰«ç æ”¯ä»˜ï¼Œä¸¤è€…åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆé€‰æ‹©ï¼Ÿ</p></blockquote><p>JSAPI é™¤äº†åœ¨ pc ç½‘ç«™æ‰«ç æ”¯ä»˜è¿˜å¯ä»¥å®ç°å…¬ä¼—å·é¡µé¢å†…æ”¯ä»˜ï¼Œå¯ä»¥å®ç°åœ¨æ‰‹æœºç«¯ H5 é¡µé¢å”¤èµ·å¾®ä¿¡å®¢æˆ·ç«¯å®Œæˆæ”¯ä»˜ã€‚</p><p>æœ¬é¡¹ç›®é€‰æ‹© JSAPI æ”¯ä»˜æ¥å£ã€‚</p><p>æ¥å£æ–‡æ¡£ï¼šhttps://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter3_1_1.shtml</p><blockquote><p>å¦‚ä½•å¼€é€š JSAPI æ”¯ä»˜æ¥å£?</p></blockquote><p>ä»¥ä¼ä¸šèº«ä»½æ³¨å†Œå¾®ä¿¡å…¬ä¼—å·<a href="https://mp.weixin.qq.com/" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="/MyBlog/assets/image-20230611155706237-6dcbdc15.png" alt="image-20230611155706237"></p><p>ç™»å½•å…¬ä¼—å·ï¼Œç‚¹å‡»å·¦ä¾§èœå•â€œå¾®ä¿¡æ”¯ä»˜â€å¼€é€šå¾®ä¿¡æ”¯ä»˜ï¼Œå¦‚ä¸‹ï¼š</p><p>éœ€è¦æä¾›è¥ä¸šæ‰§ç…§ã€èº«ä»½è¯ç­‰ä¿¡æ¯ã€‚</p><p><img src="/MyBlog/assets/image-20230611155710577-f01f66ae.png" alt="image-20230611155710577"></p><p>ç‚¹å‡»ç”³è¯·æ¥å…¥ï¼Œéœ€è¦æ³¨å†Œå¾®ä¿¡å•†æˆ·å·ã€‚</p><p><img src="/MyBlog/assets/image-20230611155714951-08228c06.png" alt="image-20230611155714951"></p><p>æ³¨å†Œå¾®ä¿¡å•†æˆ·å·çš„è¿‡ç¨‹è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œæœ¬æ–‡æ¡£ç•¥ã€‚å‚è€ƒåœ°å€å¦‚ä¸‹ï¼š</p><p><a href="https://pay.weixin.qq.com/index.php/apply/applyment_home/guide_normal#none" target="_blank" rel="noopener noreferrer">https://pay.weixin.qq.com/index.php/apply/applyment_home/guide_normal#none<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å¼€é€šå¾®ä¿¡æ”¯ä»˜åå³å¯åœ¨å¾®ä¿¡å•†æˆ·å¹³å°ï¼ˆpay.weixin.qq.comï¼‰å¼€é€š JSAPI æ”¯ä»˜ã€‚</p><p>ç™»å½•å•†å“å¹³å°ï¼Œè¿›å…¥äº§å“ä¸­å¿ƒï¼Œå¼€é€š JSAPI æ”¯ä»˜ï¼š</p><p><img src="/MyBlog/assets/image-20230611155720368-e19ff395.png" alt="image-20230611155720368"></p><p>æ³¨æ„ï¼šJSAPI æ”¯ä»˜æ–¹å¼éœ€è¦åœ¨å…¬ä¼—å·é…ç½®å›è°ƒåŸŸåï¼Œæ­¤åŸŸåä¸ºå·²ç»å¤‡æ¡ˆçš„å¤–ç½‘åŸŸåã€‚</p><p>æœ€ååœ¨å…¬ä¼—å·å¼€å‘ä¿¡æ¯ä¸­è·å–ï¼šå¼€å‘è€… idã€å¼€å‘è€…å¯†ç ã€‚</p><h4 id="_3-2-2-æ”¯ä»˜å®æ¥å£è°ƒç ”" tabindex="-1"><a class="header-anchor" href="#_3-2-2-æ”¯ä»˜å®æ¥å£è°ƒç ”" aria-hidden="true">#</a> <strong>3.2.2 æ”¯ä»˜å®æ¥å£è°ƒç ”</strong></h4><p>æ”¯ä»˜å®æ”¯ä»˜äº§å“å¦‚ä¸‹ï¼š</p><p>æ–‡æ¡£ï¼šhttps://b.alipay.com/signing/productSetV2.htm</p><p><img src="/MyBlog/assets/image-20230611155726032-759f7027.png" alt="image-20230611155726032"></p><p>ä¸æœ¬é¡¹ç›®éœ€æ±‚ç›¸å…³çš„æ¥å£ï¼šç”µè„‘ç½‘ç«™æ”¯ä»˜ã€æ‰‹æœºç½‘ç«™æ”¯ä»˜ã€‚</p><p>1ã€ç”µè„‘ç½‘ç«™æ”¯ä»˜</p><p>PC ç½‘ç«™è½»æ¾æ”¶æ¬¾ï¼Œèµ„é‡‘é©¬ä¸Šåˆ°è´¦ï¼šç”¨æˆ·åœ¨å•†å®¶ PC ç½‘ç«™æ¶ˆè´¹ï¼Œè‡ªåŠ¨è·³è½¬æ”¯ä»˜å® PC ç½‘ç«™æ”¶é“¶å°å®Œæˆä»˜æ¬¾ã€‚ äº¤æ˜“èµ„é‡‘ç›´æ¥æ‰“å…¥å•†å®¶æ”¯ä»˜å®è´¦æˆ·ï¼Œå®æ—¶åˆ°è´¦ã€‚</p><p><img src="/MyBlog/assets/image-20230611155730666-f935cf24.png" alt="image-20230611155730666"></p><p>2ã€æ‰‹æœºç½‘ç«™æ”¯ä»˜</p><p>ç”¨æˆ·åœ¨å•†å®¶æ‰‹æœºç½‘ç«™æ¶ˆè´¹ï¼Œé€šè¿‡æµè§ˆå™¨è‡ªåŠ¨è·³è½¬æ”¯ä»˜å® APP æˆ–æ”¯ä»˜å®ç½‘é¡µå®Œæˆä»˜æ¬¾ã€‚ è½»æ¾å®ç°å’Œ APP æ”¯ä»˜ç›¸åŒçš„æ”¯ä»˜ä½“éªŒã€‚</p><p><img src="/MyBlog/assets/image-20230611155735458-c710e05a.png" alt="image-20230611155735458"></p><p>å¯¹æ¯”ä¸¤ç§æ”¯ä»˜æ–¹å¼ï¼šæ‰‹æœºç½‘ç«™æ”¯ä»˜æ–¹å¼å¯ä»¥åœ¨ H5 ç½‘é¡µå”¤èµ·æ”¯ä»˜å®ï¼Œæ‰‹æœºæ‰«ç æ”¯ä»˜å¯ä»¥ä½¿ç”¨æ‰‹æœºç½‘ç«™æ”¯ä»˜æ–¹å¼æ¥å®Œæˆï¼Œç›¸æ¯”ç”µè„‘ç½‘ç«™æ”¯ä»˜å½¢å¼æ›´çµæ´»ã€‚</p><p>æœ¬é¡¹ç›®é€‰æ‹©æ‰‹æœºç½‘ç«™æ”¯ä»˜æ–¹å¼ã€‚</p><p>æ–‡æ¡£ï¼šhttps://opendocs.alipay.com/open/02ivbt</p><blockquote><p>å¦‚ä½•å¼€é€šæ”¯ä»˜å®æ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å£ï¼Ÿ</p></blockquote><p>è¿›å…¥ç½‘å€ï¼šhttps://b.alipay.com/signing/productDetailV2.htm?productId=I1011000290000001001</p><p>ç‚¹å‡»ï¼šç«‹å³å¼€é€š</p><p>ä¸Šä¼ è¥ä¸šæ‰§ç…§ç­‰èµ„æ–™ï¼Œæäº¤å®¡æ ¸ï¼Œæ ¹æ®æç¤ºè¿›è¡Œå¼€é€šã€‚</p><p><img src="/MyBlog/assets/image-20230611155748587-1508fbda.png" alt="image-20230611155748587"></p><h3 id="_3-3-å‡†å¤‡å¼€å‘ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_3-3-å‡†å¤‡å¼€å‘ç¯å¢ƒ" aria-hidden="true">#</a> <strong>3.3 å‡†å¤‡å¼€å‘ç¯å¢ƒ</strong></h3><h4 id="_3-3-1-æ”¯ä»˜å®å¼€å‘ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_3-3-1-æ”¯ä»˜å®å¼€å‘ç¯å¢ƒ" aria-hidden="true">#</a> <strong>3.3.1 æ”¯ä»˜å®å¼€å‘ç¯å¢ƒ</strong></h4><p>ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£æµç¨‹å¤§åŒå°å¼‚ï¼Œè€ƒè™‘å¼€å‘åŠæ•™å­¦çš„æ–¹ä¾¿æ€§ï¼Œæ”¯ä»˜å®æä¾›æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒå¼€å‘æ”¯ä»˜æ¥å£ï¼Œåœ¨æ•™å­¦ä¸­æ¥å…¥æ”¯ä»˜å®æ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å£ã€‚</p><p>1ã€é…ç½®æ²™ç®±ç¯å¢ƒ</p><p>æ²™ç®±ç¯å¢ƒæ˜¯æ”¯ä»˜å®å¼€æ”¾å¹³å°ä¸ºå¼€å‘è€…æä¾›çš„ä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨éš”ç¦»çš„è”è°ƒæµ‹è¯•ç¯å¢ƒï¼Œå¼€å‘è€…åœ¨æ²™ç®±ç¯å¢ƒä¸­å®Œæˆçš„æ¥å£è°ƒç”¨ä¸ä¼šå¯¹ç”Ÿäº§ç¯å¢ƒä¸­çš„æ•°æ®é€ æˆä»»ä½•å½±å“ã€‚</p><p>æ¥å…¥æ‰‹æœºç½‘ç«™æ”¯ä»˜éœ€è¦å…·å¤‡å¦‚ä¸‹æ¡ä»¶ï¼š</p><p>ç”³è¯·å‰å¿…é¡»æ‹¥æœ‰ç»è¿‡å®åè®¤è¯çš„æ”¯ä»˜å®è´¦æˆ·ï¼›</p><p>ä¼ä¸šæˆ–ä¸ªä½“å·¥å•†æˆ·å¯ç”³è¯·ï¼›</p><p>éœ€æä¾›çœŸå®æœ‰æ•ˆçš„è¥ä¸šæ‰§ç…§ï¼Œä¸”æ”¯ä»˜å®è´¦æˆ·åç§°éœ€ä¸è¥ä¸šæ‰§ç…§ä¸»ä½“ä¸€è‡´ï¼›</p><p>ç½‘ç«™èƒ½æ­£å¸¸è®¿é—®ä¸”é¡µé¢æ˜¾ç¤ºå®Œæ•´ï¼Œç½‘ç«™éœ€è¦æ˜ç¡®ç»è¥å†…å®¹ä¸”æœ‰å®Œæ•´çš„å•†å“ä¿¡æ¯ï¼›</p><p>ç½‘ç«™å¿…é¡»é€šè¿‡ ICP å¤‡æ¡ˆã€‚å¦‚ä¸ºä¸ªä½“å·¥å•†æˆ·ï¼Œç½‘ç«™å¤‡æ¡ˆä¸»ä½“éœ€è¦ä¸æ”¯ä»˜å®è´¦æˆ·ä¸»ä½“åç§°ä¸€è‡´ï¼›</p><p>å¦‚ä¸ºä¸ªä½“å·¥å•†æˆ·ï¼Œåˆ™å›¢è´­ä¸å¼€æ”¾ï¼Œä¸”å¤ç©ã€ç å®ç­‰å¥¢ä¾ˆå“ã€æŠ•èµ„ç±»è¡Œä¸šæ— æ³•ç”³è¯·æœ¬äº§å“ã€‚</p><p>è¯¦ç»†å‚è§ï¼š<a href="https://docs.open.alipay.com/203" target="_blank" rel="noopener noreferrer">https://docs.open.alipay.com/203<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>æœ¬æ–‡æ¡£ä½¿ç”¨æ”¯ä»˜å®æ²™ç®±è¿›è¡Œå¼€å‘æµ‹è¯•ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒé…ç½®ã€‚</p><p>è¯¦ç»†å‚è§ï¼š<a href="https://docs.open.alipay.com/200/105311/" target="_blank" rel="noopener noreferrer">https://docs.open.alipay.com/200/105311/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å¼€å‘è¿‡ç¨‹éœ€è¦ä¸‰ä¸ªæ”¯ä»˜å‚æ•°ï¼šapp_idã€åº”ç”¨ç§é’¥ã€æ”¯ä»˜å®å…¬é’¥ï¼Œä¸‹è¾¹åœ¨æ”¯ä»˜å®å¼€å‘å¹³å°é…ç½®æ²™ç®±ç¯å¢ƒã€‚</p><p>è¿›å…¥æ”¯ä»˜å®å¼€æ”¾å¹³å°ï¼šhttps://open.alipay.com/</p><p><img src="/MyBlog/assets/image-20230611160557635-062d627f.png" alt="image-20230611160557635"></p><p>ç‚¹å‡»ç™»å½•ï¼Œä½¿ç”¨è‡ªå·±çš„æ”¯ä»˜å®è´¦å·æ‰«ç ç™»å½•å³å¯ã€‚</p><p>ç™»å½•æˆåŠŸï¼Œè¿›å…¥æ§åˆ¶å°ï¼š</p><p><img src="/MyBlog/assets/image-20230611160602595-b1bda681.png" alt="image-20230611160602595"></p><p>åœ¨æ§åˆ¶å°é¦–é¡µæœ€ä¸‹æ–¹ ç‚¹å‡»è¿›å…¥æ²™ç®±ç¯å¢ƒ</p><p><img src="/MyBlog/assets/image-20230611160605932-54e6180e.png" alt="image-20230611160605932"></p><p>è¿›å…¥æ²™ç®±ç¯å¢ƒé¡µé¢åˆ—å‡ºäº†åº”ç”¨ä¿¡æ¯ï¼Œå…¶ä¸­å°±æœ‰æˆ‘ä»¬éœ€è¦çš„ appidã€‚</p><p><img src="/MyBlog/assets/image-20230611160608908-6a56bf45.png" alt="image-20230611160608908"></p><p>ç‚¹å‡»â€œæŸ¥çœ‹â€ï¼ŒæŸ¥çœ‹å¯†é’¥ï¼Œå¼€å‘éœ€è¦æ”¯ä»˜å®å…¬é’¥å’Œåº”ç”¨ç§é’¥ï¼Œç¨åæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒä»¬è¿›è¡Œå¼€å‘æµ‹è¯•ã€‚</p><p><img src="/MyBlog/assets/image-20230611160614175-848e6254.png" alt="image-20230611160614175"></p><p>æ ¹æ®æµ‹è¯•éœ€è¦è¿›è¡Œå……å€¼ï¼ˆæ²™ç®±ç¯å¢ƒä¸ºè™šæ‹Ÿå……å€¼ï¼‰</p><p><img src="/MyBlog/assets/image-20230611160618118-b69373fa.png" alt="image-20230611160618118"></p><p>2ã€æ¨¡æ‹Ÿå™¨</p><p>ä¸‹è½½æ¨¡æ‹Ÿå™¨ï¼š<a href="http://mumu.163.com/" target="_blank" rel="noopener noreferrer">http://mumu.163.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å®‰è£…æ¨¡æ‹Ÿå™¨ï¼Œå®‰è£…åœ¨æ²¡æœ‰ç©ºæ ¼å’Œä¸­æ–‡çš„ç›®å½•ã€‚</p><p>å®‰è£…æˆåŠŸï¼Œå¯åŠ¨æ¨¡æ‹Ÿå™¨</p><p><img src="/MyBlog/assets/image-20230611160623067-7b997999.png" alt="image-20230611160623067"></p><p>ä¸‹ä¸€æ­¥åœ¨æ¨¡æ‹Ÿå™¨å®‰è£…æ”¯ä»˜å®ï¼š</p><p>é€‰æ‹©è¯¾ç¨‹èµ„æ–™ä¸­æ”¯ä»˜å®å®‰è£…åŒ… wallet_101521226_client_release_201812261416.apkï¼ˆæ²™ç®±ç‰ˆæœ¬ï¼‰</p><p><img src="/MyBlog/assets/image-20230611160627678-6facb5ba.png" alt="image-20230611160627678"></p><p>å®‰è£…æˆåŠŸåæ”¯ä»˜å®å®¢æˆ·ç«¯çš„å¿«æ·æ–¹å¼å‡ºç°åœ¨æ¡Œé¢ä¸Šã€‚</p><p><img src="/MyBlog/assets/image-20230611160632712-9d6071eb.png" alt="image-20230611160632712"></p><p>ä½¿ç”¨æ²™ç®±ç¯å¢ƒçš„ä¹°å®¶è´¦å·ç™»å½•æ²™ç®±ç‰ˆæœ¬çš„æ”¯ä»˜å®ã€‚</p><p>æŸ¥çœ‹æ²™ç®±ç¯å¢ƒçš„è´¦å·ï¼š</p><p><img src="/MyBlog/assets/image-20230611160636353-177d8cc6.png" alt="image-20230611160636353"></p><h4 id="_3-3-2-åˆ›å»ºè®¢å•æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_3-3-2-åˆ›å»ºè®¢å•æœåŠ¡" aria-hidden="true">#</a> <strong>3.3.2 åˆ›å»ºè®¢å•æœåŠ¡</strong></h4><p>æ‹·è´è¯¾ç¨‹èµ„æ–™ç›®å½•ä¸‹çš„è®¢å•æœåŠ¡å·¥ç¨‹ xuecheng-plus-orders åˆ°è‡ªå·±çš„å·¥ç¨‹ç›®å½•ã€‚</p><p><img src="/MyBlog/assets/image-20230611160641126-c8fe7bbf.png" alt="image-20230611160641126"></p><p>åˆ›å»º xc_orders æ•°æ®åº“ï¼Œå¹¶å¯¼å…¥ xcplus_orders.sql</p><p>ä¿®æ”¹ nacos ä¸­ orders-service-dev.yaml çš„æ•°æ®åº“è¿æ¥å‚æ•°ã€‚</p><h3 id="_3-4-æ”¯ä»˜æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-4-æ”¯ä»˜æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>3.4 æ”¯ä»˜æ¥å£æµ‹è¯•</strong></h3><h4 id="_3-4-1-é˜…è¯»æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_3-4-1-é˜…è¯»æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>3.4.1 é˜…è¯»æ¥å£å®šä¹‰</strong></h4><p>æ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å…¥æµç¨‹è¯¦ç»†å‚è§ï¼š<a href="https://docs.open.alipay.com/203/105285/" target="_blank" rel="noopener noreferrer">https://docs.open.alipay.com/203/105285/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>1ã€æ¥å£äº¤äº’æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611160650446-752b2108.png" alt="image-20230611160650446"></p><p>1ï¼‰ç”¨æˆ·åœ¨å•†æˆ·çš„ H5 ç½‘ç«™ä¸‹å•æ”¯ä»˜åï¼Œå•†æˆ·ç³»ç»ŸæŒ‰ç…§<a href="https://docs.open.alipay.com/203/107090" target="_blank" rel="noopener noreferrer">æ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å£ alipay.trade.wap.pay<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>API çš„å‚æ•°è§„èŒƒç”Ÿæˆè®¢å•æ•°æ®</p><p>2ï¼‰å‰ç«¯é¡µé¢é€šè¿‡ Form è¡¨å•çš„å½¢å¼è¯·æ±‚åˆ°æ”¯ä»˜å®ã€‚æ­¤æ—¶æ”¯ä»˜å®ä¼šè‡ªåŠ¨å°†é¡µé¢è·³è½¬è‡³æ”¯ä»˜å® H5 æ”¶é“¶å°é¡µé¢ï¼Œå¦‚æœç”¨æˆ·æ‰‹æœºä¸Šå®‰è£…äº†æ”¯ä»˜å® APPï¼Œåˆ™è‡ªåŠ¨å”¤èµ·æ”¯ä»˜å® APPã€‚</p><p>3ï¼‰è¾“å…¥æ”¯ä»˜å¯†ç å®Œæˆæ”¯ä»˜ã€‚</p><p>4ï¼‰ç”¨æˆ·åœ¨æ”¯ä»˜å® APP æˆ– H5 æ”¶é“¶å°å®Œæˆæ”¯ä»˜åï¼Œä¼šæ ¹æ®å•†æˆ·åœ¨æ‰‹æœºç½‘ç«™æ”¯ä»˜ API ä¸­ä¼ å…¥çš„å‰å°å›è·³åœ°å€ return_url è‡ªåŠ¨è·³è½¬å›å•†æˆ·é¡µé¢ï¼ŒåŒæ—¶åœ¨ URL è¯·æ±‚ä¸­ä»¥ Query String çš„å½¢å¼é™„å¸¦ä¸Šæ”¯ä»˜ç»“æœå‚æ•°ï¼Œè¯¦ç»†å›è·³å‚æ•°è§â€œæ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å£ alipay.trade.wap.payâ€<a href="https://docs.open.alipay.com/203/107090#s2" target="_blank" rel="noopener noreferrer">å‰å°å›è·³å‚æ•°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p>5ï¼‰æ”¯ä»˜å®è¿˜ä¼šæ ¹æ®åŸå§‹æ”¯ä»˜ API ä¸­ä¼ å…¥çš„å¼‚æ­¥é€šçŸ¥åœ°å€ notify_urlï¼Œé€šè¿‡ POST è¯·æ±‚çš„å½¢å¼å°†æ”¯ä»˜ç»“æœä½œä¸ºå‚æ•°é€šçŸ¥åˆ°å•†æˆ·ç³»ç»Ÿï¼Œè¯¦æƒ…è§<a href="https://docs.open.alipay.com/203/105286" target="_blank" rel="noopener noreferrer">æ”¯ä»˜ç»“æœå¼‚æ­¥é€šçŸ¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p>2ã€æ¥å£å®šä¹‰</p><p>æ–‡æ¡£ï¼šhttps://opendocs.alipay.com/open/203/107090</p><p>æ¥å£å®šä¹‰ï¼šå¤–éƒ¨å•†æˆ·è¯·æ±‚æ”¯ä»˜å®åˆ›å»ºè®¢å•å¹¶æ”¯ä»˜</p><p>å…¬å…±å‚æ•°</p><p><strong>è¯·æ±‚åœ°å€</strong>ï¼š</p><p>å¼€å‘ä¸­ä½¿ç”¨æ²™ç®±åœ°å€ï¼š<a href="https://openapi.alipaydev.com/gateway.do" target="_blank" rel="noopener noreferrer">https://openapi.alipaydev.com/gateway.do<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>è¯·æ±‚å‚æ•°ï¼š</p><p>è¯¦ç»†æŸ¥é˜…https://opendocs.alipay.com/open/203/107090</p><p>ä¸€éƒ¨åˆ†ç”± sdk è®¾ç½®ï¼Œä¸€éƒ¨åˆ†éœ€è¦ç¼–å†™ç¨‹åºæ—¶æŒ‡å®šã€‚</p><p><img src="/MyBlog/assets/image-20230611160700930-1cca8224.png" alt="image-20230611160700930"></p><p><img src="/MyBlog/assets/image-20230611160707737-c06df359.png" alt="image-20230611160707737"></p><p><img src="/MyBlog/assets/image-20230611160711897-5d443f9f.png" alt="image-20230611160711897"></p><p><img src="/MyBlog/assets/image-20230611160714869-54f6d4e2.png" alt="image-20230611160714869"></p><p>å…¶å®ƒæ‰©å±•å‚æ•°å‚è§æ¥å£æ–‡æ¡£ã€‚</p><p>3ã€ç¤ºä¾‹ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpRequest<span class="token punctuation">,</span>
                   <span class="token class-name">HttpServletResponse</span> httpResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">AlipayClient</span> alipayClient <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">//è·å¾—åˆå§‹åŒ–çš„AlipayClient</span>
    <span class="token class-name">AlipayTradeWapPayRequest</span> alipayRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeWapPayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºAPIå¯¹åº”çš„request</span>
    alipayRequest<span class="token punctuation">.</span><span class="token function">setReturnUrl</span><span class="token punctuation">(</span><span class="token string">&quot;http://domain.com/CallBack/return_url.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    alipayRequest<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span><span class="token string">&quot;http://domain.com/CallBack/notify_url.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€</span>
    alipayRequest<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span><span class="token string">&quot;{&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;out_trade_no\&quot;:\&quot;20150320010101002\&quot;,&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;total_amount\&quot;:88.88,&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;subject\&quot;:\&quot;Iphone6 16G\&quot;,&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;product_code\&quot;:\&quot;QUICK_WAP_WAY\&quot;&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  }&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¡«å……ä¸šåŠ¡å‚æ•°</span>
    <span class="token class-name">String</span> form <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">pageExecute</span><span class="token punctuation">(</span>alipayRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è°ƒç”¨SDKç”Ÿæˆè¡¨å•</span>
    httpResponse<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=&quot;</span> <span class="token operator">+</span> <span class="token class-name">AlipayServiceEnvConstants</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç›´æ¥å°†å®Œæ•´çš„è¡¨å•htmlè¾“å‡ºåˆ°é¡µé¢</span>
    httpResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-2-ä¸‹å•æ‰§è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-4-2-ä¸‹å•æ‰§è¡Œæµç¨‹" aria-hidden="true">#</a> <strong>3.4.2 ä¸‹å•æ‰§è¡Œæµç¨‹</strong></h4><p>æ ¹æ®æ¥å£æè¿°ï¼Œæ”¯ä»˜å®ä¸‹å•æ¥å£çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611160731156-728b04b8.png" alt="image-20230611160731156"></p><h4 id="_3-4-3-æ”¯ä»˜æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-4-3-æ”¯ä»˜æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>3.4.3 æ”¯ä»˜æ¥å£æµ‹è¯•</strong></h4><h5 id="_3-4-3-1-ç¼–å†™ä¸‹å•ä»£ç " tabindex="-1"><a class="header-anchor" href="#_3-4-3-1-ç¼–å†™ä¸‹å•ä»£ç " aria-hidden="true">#</a> <strong>3.4.3.1 ç¼–å†™ä¸‹å•ä»£ç </strong></h5><p>æ ¹æ®æ¥å£æµç¨‹ï¼Œé¦–å…ˆåœ¨è®¢å•æœåŠ¡ç¼–å†™æµ‹è¯•ç±»è¯·æ±‚æ”¯ä»˜å®ä¸‹å•çš„æ¥å£ã€‚</p><p>åœ¨è®¢å•æœåŠ¡ api å·¥ç¨‹æ·»åŠ ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>
<span class="token comment">&lt;!-- æ”¯ä»˜å®SDK --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alipay.sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>alipay-sdk-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.7.73.ALL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- æ”¯ä»˜å®SDKä¾èµ–çš„æ—¥å¿— --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è½½ç¤ºä¾‹ä»£ç https://opendocs.alipay.com/open/203/105910</p><p>æ‹·è´ç¤ºä¾‹ä»£ç ï¼Œä¿®æ”¹ã€æµ‹è¯•ã€‚</p><p>æ‹·è´ AlipayConfig.java åˆ°è®¢å•æœåŠ¡çš„ service å·¥ç¨‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>orders<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AlipayApiException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AlipayClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">DefaultAlipayClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">AlipayTradeWapPayRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>orders<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">AlipayConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> æµ‹è¯•æ”¯ä»˜å®æ¥å£
 * <span class="token keyword">@date</span> 2022/10/20 22:19
 */</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayTestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.APP_ID}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token constant">APP_ID</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.APP_PRIVATE_KEY}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token constant">APP_PRIVATE_KEY</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.ALIPAY_PUBLIC_KEY}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">;</span>



    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/alipaytest&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpRequest<span class="token punctuation">,</span>
                       <span class="token class-name">HttpServletResponse</span> httpResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>
        <span class="token class-name">AlipayClient</span> alipayClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span><span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token constant">APP_ID</span><span class="token punctuation">,</span> <span class="token constant">APP_PRIVATE_KEY</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">FORMAT</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">,</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">,</span><span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">SIGNTYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è·å¾—åˆå§‹åŒ–çš„AlipayClient</span>
        <span class="token class-name">AlipayTradeWapPayRequest</span> alipayRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeWapPayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºAPIå¯¹åº”çš„request</span>
<span class="token comment">//        alipayRequest.setReturnUrl(&quot;http://domain.com/CallBack/return_url.jsp&quot;);</span>
<span class="token comment">//        alipayRequest.setNotifyUrl(&quot;http://domain.com/CallBack/notify_url.jsp&quot;);//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€</span>
        alipayRequest<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span><span class="token string">&quot;{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;out_trade_no\&quot;:\&quot;202210100010101002\&quot;,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;total_amount\&quot;:0.1,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;subject\&quot;:\&quot;Iphone6 16G\&quot;,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;product_code\&quot;:\&quot;QUICK_WAP_WAY\&quot;&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;  }&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¡«å……ä¸šåŠ¡å‚æ•°</span>
        <span class="token class-name">String</span> form <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">pageExecute</span><span class="token punctuation">(</span>alipayRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è°ƒç”¨SDKç”Ÿæˆè¡¨å•</span>
        httpResponse<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=&quot;</span> <span class="token operator">+</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç›´æ¥å°†å®Œæ•´çš„è¡¨å•htmlè¾“å‡ºåˆ°é¡µé¢</span>
        httpResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-4-3-2-ç”ŸæˆäºŒç»´ç " tabindex="-1"><a class="header-anchor" href="#_3-4-3-2-ç”ŸæˆäºŒç»´ç " aria-hidden="true">#</a> <strong>3.4.3.2 ç”ŸæˆäºŒç»´ç </strong></h5><p>ç”¨æˆ·åœ¨å‰ç«¯ä½¿ç”¨æ”¯ä»˜å®æ²™ç®±é€šè¿‡æ‰«ç è¯·æ±‚ä¸‹å•æ¥å£ï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆè®¢å•æœåŠ¡çš„ä¸‹å•æ¥å£çš„äºŒç»´ç ã€‚</p><p>ZXing æ˜¯ä¸€ä¸ªå¼€æºçš„ç±»åº“ï¼Œæ˜¯ç”¨ Java ç¼–å†™çš„å¤šæ ¼å¼çš„ 1D / 2D æ¡ç å›¾åƒå¤„ç†åº“ï¼Œä½¿ç”¨ ZXing å¯ä»¥ç”Ÿæˆã€è¯†åˆ« QR Codeï¼ˆäºŒç»´ç ï¼‰ã€‚å¸¸ç”¨çš„äºŒç»´ç å¤„ç†åº“è¿˜æœ‰ zbarï¼Œè¿‘å‡ å¹´å·²ç»ä¸å†æ›´æ–°ä»£ç ï¼Œä¸‹è¾¹ä»‹ç» ZXing ç”ŸæˆäºŒç»´ç çš„æ–¹æ³•ã€‚</p><p>1ï¼‰å¼•å…¥ä¾èµ–</p><p>åœ¨ base å·¥ç¨‹ pom.xml ä¸­æ·»åŠ ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>
        <span class="token comment">&lt;!-- äºŒç»´ç ç”Ÿæˆ&amp;è¯†åˆ«ç»„ä»¶ --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.zxing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.zxing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-lang3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰ç”ŸæˆäºŒç»´ç æ–¹æ³•</p><p>æ‹·è´è¯¾ç¨‹èµ„æ–™ä¸­ utils ä¸‹çš„ QRCodeUtil.java åˆ° base å·¥ç¨‹ util åŒ…ä¸‹ã€‚</p><p>æµ‹è¯•æ ¹æ®å†…å®¹ç”ŸæˆäºŒç»´ç æ–¹æ³•ï¼Œåœ¨ QRCodeUtil ä¸­æ·»åŠ  main æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">QRCodeUtil</span> qrCodeUtil <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QRCodeUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>qrCodeUtil<span class="token punctuation">.</span><span class="token function">createQRCode</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.itcast.cn/&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œ main æ–¹æ³•è¾“å…¥äºŒç»´ç å›¾ç‰‡çš„ base64 ä¸²ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>
data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIAQAAAACFI5MzAAABQElEQVR42u2YPZKDMAyF5aFIuUfIUThafDSOwhEoUzC8fZKMySSbrVI8ZuICBX8uIvtZPxjeDfuSf8liPi7LFSgrzRTvV3XCKawXYLptFobviz6ZzB2xEfTjhyS9OwXB3A7jbMSngLOQ0I4v2AZf96wqTWJ9+9/dYEHSx2RYqfg/oqUgiX3nFBVfcCepcSbiJP67iwZ1G+5+Am7kyTzW9OcW/kRAX+QJ953+uCl8zO5PV5UsaffUp8rqP5+jiySJU8jtNxcNrysetCNK6A/V4lEQeU+xa0eZREE1tOTpFYod0VKXsKCqvRqMkW5pkza8Ggy3WgEuTvZcz0dcUBc+9MneL1DqkXjQz0eaZA1LqVtmzcMffTKPiPwz1mh2zkGyNwtT9kguTVI7LWv6ul7DCpOjX9iaGV66HDny/ZL1WfILfc/hMHLUpekAAAAASUVORK5CYII=


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°† base64 ä¸²å¤åˆ¶åˆ°æµè§ˆå™¨åœ°å€åå›è½¦å°†å±•ç¤ºä¸€ä¸ªäºŒç»´ç ï¼Œç”¨æˆ·ç”¨æ‰‹æœºæ‰«æ­¤äºŒç»´ç å°†è¯·æ±‚è‡³http://www.itcast.cn/ã€‚</p><p><img src="/MyBlog/assets/image-20230611160853225-962d0509.png" alt="image-20230611160853225"></p><h5 id="_3-4-3-3-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-4-3-3-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>3.4.3.3 æ¥å£æµ‹è¯•</strong></h5><p>1ã€ç”Ÿæˆè®¢å•æœåŠ¡ä¸‹å•æ¥å£çš„äºŒç»´ç </p><p>ä¿®æ”¹äºŒç»´ç ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
      <span class="token class-name">QRCodeUtil</span> qrCodeUtil <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QRCodeUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>qrCodeUtil<span class="token punctuation">.</span><span class="token function">createQRCode</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:63030/orders/alipaytest&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šhttp://localhost:63030 åœ°å€ç”¨æ¨¡æ‹Ÿå™¨æ— æ³•è®¿é—®ï¼Œè¿›å…¥ cmd å‘½ä»¤çŠ¶æ€ï¼Œè¾“å…¥å‘½ä»¤ ipconfig -all æŸ¥çœ‹æœ¬åœ°ç½‘å¡åˆ†é…çš„å±€åŸŸç½‘ ip åœ°å€ï¼Œå°†ä¸Šè¾¹çš„åœ°å€ä¿®æ”¹å¦‚ä¸‹ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>
<span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//192.168.101.1:63030/orders/alipaytest</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œ main æ–¹æ³•ï¼Œå¤åˆ¶è¾“å‡ºåˆ°æ§åˆ¶å°çš„ base64 ä¸²ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>
data:image/png<span class="token punctuation">;</span>base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIAQAAAACFI5MzAAABxUlEQVR42u2YO46EMBBEGxE45AjcBC6GhCUuNtzER3DoANFbZT4zu9KmNavVOLAwj6BV/TXmvy37kL9Oopl1sS+DWV/M2oRzKyWL+95tfXDfenyzJK/vlCTZ0G1WGpzDDlKA9ST2YbfJrMnz2wiE8WQw8A2E/lkc6kQ66afnBKTGKCwaru179ApIXVBnzNb7gy+/ZbCAQJgB5zLCyrD6ZnSSlPAxm1VNyphh28NmKUFI7F3EQ55qrXJfL3VUBOGZJyssF74C45tWSjbEBW2DJslG94QPtQTNYsyzH9WSrgmXOiqCCBlgFmIUhMLwKCVcSFHkxsaagcY1vmSwgkRDZE5WO4YzT6tYSuIprNTEzskBedq5lNS4wEs2TOiEbT1tUxGslaW6OoX98+5ZKhLpmhYFi8LsTNY7T1WE7apNzE5UCgiDD2cpca+T612v0zNGZYQWMVDhJG7h2dE1BOoMSIujUjQcZUYxOWcXBodzeuKmJdddhtNTqZNcc1cxDTnuMmwbxr7dup5wjl8S44J9O75Mdkpyzo1hr/eqV9tUBE+8waBy80p1T3YictxpDyexcQUXk+Muw9m5RohZnWKU5PMX55+RLyKnzJvqtaeFAAAAAElFTkSuQmCC


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰“å¼€æ¨¡æ‹Ÿå™¨ï¼Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€æµè§ˆå™¨ï¼Œå°† base64 ä¸²å¤åˆ¶åˆ°æµè§ˆå™¨çš„åœ°å€æ ã€‚</p><p><img src="/MyBlog/assets/image-20230611160927317-fec0c69d.png" alt="image-20230611160927317"></p><p>ä½¿ç”¨æˆªå±å·¥å…·è¿›è¡Œæˆªå±ï¼Œç¨åä½¿ç”¨æ”¯ä»˜å®æ²™ç®±å®¢æˆ·ç«¯æ‰«æ­¤å›¾ç‰‡ã€‚</p><p><img src="/MyBlog/assets/image-20230611160931802-815ce84f.png" alt="image-20230611160931802"></p><p>2ã€å¯åŠ¨è®¢å•æœåŠ¡</p><p>3ã€æ‰“å¼€æ¨¡æ‹Ÿå™¨ï¼Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€æ”¯ä»˜å®æ²™ç®±å®¢æˆ·ç«¯ï¼Œå¹¶ä½¿ç”¨æ²™ç®±å®¢æˆ·ç«¯è´¦å·å¯†ç ç™»å½•ã€‚</p><p><img src="/MyBlog/assets/image-20230611160938363-bb05bf62.png" alt="image-20230611160938363"></p><p>ç‚¹å‡»æ‰«ä¸€æ‰«é€‰æ‹©ç›¸å†Œä¸­åˆšæ‰æˆªå±çš„äºŒç»´ç </p><p><img src="/MyBlog/assets/image-20230611160944292-bbf8223f.png" alt="image-20230611160944292"></p><p><img src="/MyBlog/assets/image-20230611160950503-154a99cc.png" alt="image-20230611160950503"></p><p>æ‰«ç åå¦‚æœæç¤ºç³»ç»Ÿç¹å¿™å†é‡è¯•</p><p><img src="/MyBlog/assets/image-20230611160958247-31d09cea.png" alt="image-20230611160958247"></p><p>å¦‚æœæç¤ºè¯·æ±‚å‹¿é‡å¤æäº¤åˆ™éœ€è¦ä¿®æ”¹ä¸‹å•æµ‹è¯•ä»£ç ä¸­æŒ‡å®šçš„ out_trade_no å•†å“è®¢å•å·ï¼Œè®¢å•å·åœ¨æ¯ä¸ªå•†æˆ·æ˜¯å”¯ä¸€çš„ï¼Œæ¯æ¬¡æ”¯ä»˜å‰ä¿®æ”¹ out_trade_no ä¸ºä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨è¿‡çš„è®¢å•å·ã€‚</p><p><img src="/MyBlog/assets/image-20230611161005577-c12dcd32.png" alt="image-20230611161005577"></p><p>ä¿®æ”¹è®¢å•å·åé‡å¯è®¢å•æœåŠ¡ï¼Œå†ä½¿ç”¨æ²™ç®±æ”¯ä»˜å®å®¢æˆ·ç«¯æ‰«ç </p><p><img src="/MyBlog/assets/image-20230611161011597-075d325f.png" alt="image-20230611161011597"></p><p>è¾“å…¥æ”¯ä»˜å¯†ç è¿›è¡Œæ”¯ä»˜ã€‚</p><p>æ”¯ä»˜å¯†ç ä¸ºæ²™ç®±è´¦å·çš„æ”¯ä»˜å¯†ç ï¼Œæ­¤æ”¯ä»˜æ‰€æ‰£æ¬¾ä¸ºæ²™ç®±è´¦å·çš„è™šæ‹Ÿè´§å¸ä½™é¢ã€‚</p><p><img src="/MyBlog/assets/image-20230611161021705-9687fe28.png" alt="image-20230611161021705"></p><p>æ”¯ä»˜æˆåŠŸç•Œé¢ï¼š</p><p><img src="/MyBlog/assets/image-20230611161029711-3a2bd41b.png" alt="image-20230611161029711"></p><h4 id="_3-4-4-æ”¯ä»˜ç»“æœæŸ¥è¯¢æ¥å£" tabindex="-1"><a class="header-anchor" href="#_3-4-4-æ”¯ä»˜ç»“æœæŸ¥è¯¢æ¥å£" aria-hidden="true">#</a> <strong>3.4.4 æ”¯ä»˜ç»“æœæŸ¥è¯¢æ¥å£</strong></h4><p>æ”¯ä»˜å®Œæˆå¯ä»¥è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°çš„æ”¯ä»˜ç»“æœæŸ¥è¯¢æ¥å£ æŸ¥è¯¢æ”¯ä»˜ç»“æœã€‚</p><p>æ–‡æ¡£ï¼šhttps://opendocs.alipay.com/open/02ivbt</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token class-name">AlipayClient</span> alipayClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span><span class="token string">&quot;https://openapi.alipay.com/gateway.do&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;app_id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;your private_key&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;alipay_public_key&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RSA2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">AlipayTradeQueryRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeQueryRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">JSONObject</span> bizContent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bizContent<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;20150320010101001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//bizContent.put(&quot;trade_no&quot;, &quot;2014112611001004680073956707&quot;);</span>
request<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span>bizContent<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">AlipayTradeQueryResponse</span> response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆšæ‰è®¢å•ä»˜æ¬¾æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ out_trade_no å•†å“è®¢å•å·æˆ–æ”¯ä»˜å®çš„äº¤æ˜“æµæ°´å· trade_no å»æŸ¥è¯¢æ”¯ä»˜ç»“æœã€‚</p><p>out_trade_no å•†å“è®¢å•å·: æ˜¯åœ¨ä¸‹å•è¯·æ±‚æ—¶æŒ‡å®šçš„å•†å“è®¢å•å·ã€‚</p><p>æ”¯ä»˜å®çš„äº¤æ˜“æµæ°´å· trade_noï¼šæ˜¯æ”¯ä»˜å®Œæˆåæ”¯ä»˜å®é€šçŸ¥æ”¯ä»˜ç»“æœæ—¶å‘é€çš„ trade_no</p><p>æˆ‘ä»¬ä½¿ç”¨ out_trade_no å•†å“è®¢å•å·å»æŸ¥è¯¢ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>orders<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AlipayApiException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AlipayClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">DefaultAlipayClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">AlipayTradeQueryRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span>response<span class="token punctuation">.</span></span><span class="token class-name">AlipayTradeQueryResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> æ”¯ä»˜å®æŸ¥è¯¢æ¥å£
 * <span class="token keyword">@date</span> 2022/10/4 17:18
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliPayTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.APP_ID}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token constant">APP_ID</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.APP_PRIVATE_KEY}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token constant">APP_PRIVATE_KEY</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.ALIPAY_PUBLIC_KEY}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryPayResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>
    <span class="token class-name">AlipayClient</span> alipayClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span><span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token constant">APP_ID</span><span class="token punctuation">,</span> <span class="token constant">APP_PRIVATE_KEY</span><span class="token punctuation">,</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">,</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">SIGNTYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å¾—åˆå§‹åŒ–çš„AlipayClient</span>
    <span class="token class-name">AlipayTradeQueryRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeQueryRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JSONObject</span> bizContent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bizContent<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;202210100010101002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//bizContent.put(&quot;trade_no&quot;, &quot;2014112611001004680073956707&quot;);</span>
    request<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span>bizContent<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AlipayTradeQueryResponse</span> response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> resultJson <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è½¬map</span>
        <span class="token class-name">Map</span> resultMap <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>resultJson<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span> alipay_trade_query_response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> resultMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;alipay_trade_query_response&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ”¯ä»˜ç»“æœ</span>
        <span class="token class-name">String</span> trade_status <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> alipay_trade_query_response<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;trade_status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>trade_status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œä»£ç ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>
è°ƒç”¨æˆåŠŸ
TRADE_SUCCESS

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœå³æ˜¯è°ƒç”¨æ”¯ä»˜å®æŸ¥è¯¢æ¥å£æŸ¥è¯¢åˆ°çš„æ”¯ä»˜ç»“æœ</p><p><img src="/MyBlog/assets/image-20230611161115931-d5999707.png" alt="image-20230611161115931"></p><p>å‚è€ƒæ–‡æ¡£https://opendocs.alipay.com/open/02ivbt æŸ¥é˜…æ¯ä¸ªå‚æ•°çš„æ„ä¹‰ã€‚</p><p>æˆ‘ä»¬ä¸»è¦éœ€è¦ä¸‹è¾¹çš„å‚æ•°ï¼š</p><p>&quot;out_trade_no&quot; : &quot;20220520010101026&quot;,</p><p>&quot;trade_no&quot;:&quot;2022100422001422760505740639&quot; ï¼š æ”¯ä»˜å®äº¤æ˜“æµæ°´å·</p><p>&quot;total_amount&quot; : &quot;1.30&quot;</p><p>&quot;trade_status&quot; : &quot;TRADE_SUCCESS&quot;ï¼š äº¤æ˜“çŠ¶æ€</p><p>äº¤æ˜“çŠ¶æ€ç±»å‹ï¼š</p><p>äº¤æ˜“çŠ¶æ€ï¼šWAIT_BUYER_PAYï¼ˆäº¤æ˜“åˆ›å»ºï¼Œç­‰å¾…ä¹°å®¶ä»˜æ¬¾ï¼‰</p><p>TRADE_CLOSEDï¼ˆæœªä»˜æ¬¾äº¤æ˜“è¶…æ—¶å…³é—­ï¼Œæˆ–æ”¯ä»˜å®Œæˆåå…¨é¢é€€æ¬¾ï¼‰</p><p>TRADE_SUCCESSï¼ˆäº¤æ˜“æ”¯ä»˜æˆåŠŸï¼‰</p><p>TRADE_FINISHEDï¼ˆäº¤æ˜“ç»“æŸï¼Œä¸å¯é€€æ¬¾ï¼‰</p><h4 id="_3-4-5-æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£" tabindex="-1"><a class="header-anchor" href="#_3-4-5-æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£" aria-hidden="true">#</a> <strong>3.4.5 æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£</strong></h4><h5 id="_3-4-5-1-å‡†å¤‡ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_3-4-5-1-å‡†å¤‡ç¯å¢ƒ" aria-hidden="true">#</a> <strong>3.4.5.1 å‡†å¤‡ç¯å¢ƒ</strong></h5><p>å¯¹äºæ‰‹æœºç½‘ç«™æ”¯ä»˜äº§ç”Ÿçš„äº¤æ˜“ï¼Œæ”¯ä»˜å®ä¼šé€šçŸ¥å•†æˆ·æ”¯ä»˜ç»“æœï¼Œæœ‰ä¸¤ç§é€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡ return_urlã€notify_url è¿›è¡Œé€šçŸ¥ï¼Œä½¿ç”¨ return_url ä¸èƒ½ä¿è¯é€šçŸ¥åˆ°ä½ï¼Œæ¨èä½¿ç”¨ notify_url å®Œæˆæ”¯ä»˜ç»“æ„é€šçŸ¥ã€‚</p><p><img src="/MyBlog/assets/image-20230611161122366-8d60cba4.png" alt="image-20230611161122366"></p><p>å…·ä½“çš„ä½¿ç”¨æ–¹æ³•æ˜¯åœ¨è°ƒç”¨ä¸‹å•æ¥å£çš„ API ä¸­ä¼ å…¥çš„å¼‚æ­¥é€šçŸ¥åœ°å€ notify_urlï¼Œé€šè¿‡ POST è¯·æ±‚çš„å½¢å¼å°†æ”¯ä»˜ç»“æœä½œä¸ºå‚æ•°é€šçŸ¥åˆ°å•†æˆ·ç³»ç»Ÿã€‚è¯¦æƒ…å¯æŸ¥çœ‹ <a href="https://opendocs.alipay.com/support/01raw4" target="_blank" rel="noopener noreferrer">æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥è¯´æ˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ã€‚</p><p>æ–‡æ¡£ï¼šhttps://opendocs.alipay.com/open/203/105286</p><p>æ ¹æ®ä¸‹å•æ‰§è¡Œæµç¨‹ï¼Œè®¢å•æœåŠ¡æ”¶åˆ°æ”¯ä»˜ç»“æœéœ€è¦å¯¹å†…å®¹è¿›è¡ŒéªŒç­¾ï¼ŒéªŒç­¾è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>åœ¨é€šçŸ¥è¿”å›å‚æ•°åˆ—è¡¨ä¸­ï¼Œé™¤å» signã€sign_type ä¸¤ä¸ªå‚æ•°å¤–ï¼Œå‡¡æ˜¯é€šçŸ¥è¿”å›å›æ¥çš„å‚æ•°çš†æ˜¯å¾…éªŒç­¾çš„å‚æ•°ã€‚å°†å‰©ä¸‹å‚æ•°è¿›è¡Œ url_decodeï¼Œç„¶åè¿›è¡Œå­—å…¸æ’åºï¼Œç»„æˆå­—ç¬¦ä¸²ï¼Œå¾—åˆ°å¾…ç­¾åå­—ç¬¦ä¸²ï¼› ç”Ÿæ´»å·å¼‚æ­¥é€šçŸ¥ç»„æˆçš„å¾…éªŒç­¾ä¸²é‡Œéœ€è¦ä¿ç•™ sign_type å‚æ•°ã€‚</p><p>å°†ç­¾åå‚æ•°ï¼ˆsignï¼‰ä½¿ç”¨ base64 è§£ç ä¸ºå­—èŠ‚ç ä¸²ï¼›</p><p>ä½¿ç”¨ RSA çš„éªŒç­¾æ–¹æ³•ï¼Œé€šè¿‡ç­¾åå­—ç¬¦ä¸²ã€ç­¾åå‚æ•°ï¼ˆç»è¿‡ base64 è§£ç ï¼‰åŠæ”¯ä»˜å®å…¬é’¥éªŒè¯ç­¾åã€‚</p><p>éªŒè¯ç­¾åæ­£ç¡®åï¼Œå¿…é¡»å†ä¸¥æ ¼æŒ‰ç…§å¦‚ä¸‹æè¿°æ ¡éªŒé€šçŸ¥æ•°æ®çš„æ­£ç¡®æ€§ã€‚</p><p>åœ¨ä¸Šè¿°éªŒè¯é€šè¿‡åï¼Œå•†æˆ·å¿…é¡»æ ¹æ®æ”¯ä»˜å®ä¸åŒç±»å‹çš„ä¸šåŠ¡é€šçŸ¥ï¼Œæ­£ç¡®çš„è¿›è¡Œä¸åŒçš„ä¸šåŠ¡å¤„ç†ï¼Œå¹¶ä¸”è¿‡æ»¤é‡å¤çš„é€šçŸ¥ç»“æœæ•°æ®ã€‚</p><p>é€šè¿‡éªŒè¯ out_trade_noã€total_amountã€appid å‚æ•°çš„æ­£ç¡®æ€§åˆ¤æ–­é€šçŸ¥è¯·æ±‚çš„åˆæ³•æ€§ã€‚</p><p>éªŒè¯çš„è¿‡ç¨‹å¯ä»¥å‚è€ƒ sdk demo ä»£ç ï¼Œä¸‹è½½ sdk demo ä»£ç ï¼Œhttps://opendocs.alipay.com/open/203/105910</p><p><img src="/MyBlog/assets/image-20230611161134639-aeef8c38.png" alt="image-20230611161134639"></p><p>å‚è€ƒ demo ä¸­çš„ alipay.trade.wap.pay-java-utf-8\WebContent\ notify_url.jsp</p><p>å¦å¤–ï¼Œæ”¯ä»˜å®é€šçŸ¥è®¢å•æœåŠ¡çš„åœ°å€å¿…é¡»ä¸ºå¤–ç½‘åŸŸåä¸”å¤‡æ¡ˆé€šè¿‡å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p><p>æ­¤æ¥å£ä»ç„¶ä½¿ç”¨å†…ç½‘ç©¿é€æŠ€æœ¯ã€‚</p><h5 id="_3-4-5-2-ç¼–å†™æµ‹è¯•ä»£ç " tabindex="-1"><a class="header-anchor" href="#_3-4-5-2-ç¼–å†™æµ‹è¯•ä»£ç " aria-hidden="true">#</a> <strong>3.4.5.2 ç¼–å†™æµ‹è¯•ä»£ç </strong></h5><p>1ã€åœ¨ä¸‹å•è¯·æ±‚æ—¶è®¾ç½®é€šçŸ¥åœ°å€ request.setNotifyUrl(&quot;å•†æˆ·è‡ªå·±çš„ notify_url åœ°å€&quot;);</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/alipaytest&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">alipaytest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpRequest<span class="token punctuation">,</span>
                           <span class="token class-name">HttpServletResponse</span> httpResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ„é€ sdkçš„å®¢æˆ·ç«¯å¯¹è±¡</span>
        <span class="token class-name">AlipayClient</span> alipayClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> <span class="token constant">APP_ID</span><span class="token punctuation">,</span> <span class="token constant">APP_PRIVATE_KEY</span><span class="token punctuation">,</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token constant">CHARSET</span><span class="token punctuation">,</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">,</span> sign_type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å¾—åˆå§‹åŒ–çš„AlipayClient</span>
        <span class="token class-name">AlipayTradeWapPayRequest</span> alipayRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeWapPayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºAPIå¯¹åº”çš„request</span>
<span class="token comment">//        alipayRequest.setReturnUrl(&quot;http://domain.com/CallBack/return_url.jsp&quot;);</span>
        alipayRequest<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span><span class="token string">&quot;http://tjxt-user-t.itheima.net/xuecheng/orders/paynotify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€ç¼–å†™æ¥æ”¶é€šçŸ¥æ¥å£ï¼Œæ¥æ”¶å‚æ•°å¹¶éªŒç­¾</p><p>å‚è€ƒè¯¾ç¨‹èµ„æ–™ä¸‹çš„ alipay.trade.wap.pay-java-utf-8\WebContent\notify_url.jsp</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token comment">//æ¥æ”¶é€šçŸ¥</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/paynotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paynotify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span><span class="token punctuation">,</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> requestParams <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> iter <span class="token operator">=</span> requestParams<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> requestParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> valueStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            valueStr <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> values<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    <span class="token operator">:</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ä¹±ç è§£å†³ï¼Œè¿™æ®µä»£ç åœ¨å‡ºç°ä¹±ç æ—¶ä½¿ç”¨ã€‚å¦‚æœmysignå’Œsignä¸ç›¸ç­‰ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™æ®µä»£ç è½¬åŒ–</span>
        <span class="token comment">//valueStr = new String(valueStr.getBytes(&quot;ISO-8859-1&quot;), &quot;gbk&quot;);</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> valueStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//è·å–æ”¯ä»˜å®çš„é€šçŸ¥è¿”å›å‚æ•°ï¼Œå¯å‚è€ƒæŠ€æœ¯æ–‡æ¡£ä¸­é¡µé¢è·³è½¬åŒæ­¥é€šçŸ¥å‚æ•°åˆ—è¡¨(ä»¥ä¸Šä»…ä¾›å‚è€ƒ)//</span>
    <span class="token comment">//è®¡ç®—å¾—å‡ºé€šçŸ¥éªŒè¯ç»“æœ</span>
    <span class="token comment">//boolean AlipaySignature.rsaCheckV1(Map&lt;String, String&gt; params, String publicKey, String charset, String sign_type)</span>
    <span class="token keyword">boolean</span> verify_result <span class="token operator">=</span> <span class="token class-name">AlipaySignature</span><span class="token punctuation">.</span><span class="token function">rsaCheckV1</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">,</span> <span class="token string">&quot;RSA2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>verify_result<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//éªŒè¯æˆåŠŸ</span>
        <span class="token comment">//////////////////////////////////////////////////////////////////////////////////////////</span>
        <span class="token comment">//è¯·åœ¨è¿™é‡ŒåŠ ä¸Šå•†æˆ·çš„ä¸šåŠ¡é€»è¾‘ç¨‹åºä»£ç </span>

         <span class="token comment">//å•†æˆ·è®¢å•å·</span>
        <span class="token class-name">String</span> out_trade_no <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ”¯ä»˜å®äº¤æ˜“å·</span>

        <span class="token class-name">String</span> trade_no <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//äº¤æ˜“çŠ¶æ€</span>
        <span class="token class-name">String</span> trade_status <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//â€”â€”è¯·æ ¹æ®æ‚¨çš„ä¸šåŠ¡é€»è¾‘æ¥ç¼–å†™ç¨‹åºï¼ˆä»¥ä¸‹ä»£ç ä»…ä½œå‚è€ƒï¼‰â€”â€”</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>trade_status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_FINISHED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//äº¤æ˜“ç»“æŸ</span>
            <span class="token comment">//åˆ¤æ–­è¯¥ç¬”è®¢å•æ˜¯å¦åœ¨å•†æˆ·ç½‘ç«™ä¸­å·²ç»åšè¿‡å¤„ç†</span>
            <span class="token comment">//å¦‚æœæ²¡æœ‰åšè¿‡å¤„ç†ï¼Œæ ¹æ®è®¢å•å·ï¼ˆout_trade_noï¼‰åœ¨å•†æˆ·ç½‘ç«™çš„è®¢å•ç³»ç»Ÿä¸­æŸ¥åˆ°è¯¥ç¬”è®¢å•çš„è¯¦ç»†ï¼Œå¹¶æ‰§è¡Œå•†æˆ·çš„ä¸šåŠ¡ç¨‹åº</span>
            <span class="token comment">//è¯·åŠ¡å¿…åˆ¤æ–­è¯·æ±‚æ—¶çš„total_feeã€seller_idä¸é€šçŸ¥æ—¶è·å–çš„total_feeã€seller_idä¸ºä¸€è‡´çš„</span>
            <span class="token comment">//å¦‚æœæœ‰åšè¿‡å¤„ç†ï¼Œä¸æ‰§è¡Œå•†æˆ·çš„ä¸šåŠ¡ç¨‹åº</span>

            <span class="token comment">//æ³¨æ„ï¼š</span>
            <span class="token comment">//å¦‚æœç­¾çº¦çš„æ˜¯å¯é€€æ¬¾åè®®ï¼Œé€€æ¬¾æ—¥æœŸè¶…è¿‡å¯é€€æ¬¾æœŸé™åï¼ˆå¦‚ä¸‰ä¸ªæœˆå¯é€€æ¬¾ï¼‰ï¼Œæ”¯ä»˜å®ç³»ç»Ÿå‘é€è¯¥äº¤æ˜“çŠ¶æ€é€šçŸ¥</span>
            <span class="token comment">//å¦‚æœæ²¡æœ‰ç­¾çº¦å¯é€€æ¬¾åè®®ï¼Œé‚£ä¹ˆä»˜æ¬¾å®Œæˆåï¼Œæ”¯ä»˜å®ç³»ç»Ÿå‘é€è¯¥äº¤æ˜“çŠ¶æ€é€šçŸ¥ã€‚</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>trade_status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_SUCCESS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//äº¤æ˜“æˆåŠŸ</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>trade_status<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//åˆ¤æ–­è¯¥ç¬”è®¢å•æ˜¯å¦åœ¨å•†æˆ·ç½‘ç«™ä¸­å·²ç»åšè¿‡å¤„ç†</span>
            <span class="token comment">//å¦‚æœæ²¡æœ‰åšè¿‡å¤„ç†ï¼Œæ ¹æ®è®¢å•å·ï¼ˆout_trade_noï¼‰åœ¨å•†æˆ·ç½‘ç«™çš„è®¢å•ç³»ç»Ÿä¸­æŸ¥åˆ°è¯¥ç¬”è®¢å•çš„è¯¦ç»†ï¼Œå¹¶æ‰§è¡Œå•†æˆ·çš„ä¸šåŠ¡ç¨‹åº</span>
            <span class="token comment">//è¯·åŠ¡å¿…åˆ¤æ–­è¯·æ±‚æ—¶çš„total_feeã€seller_idä¸é€šçŸ¥æ—¶è·å–çš„total_feeã€seller_idä¸ºä¸€è‡´çš„</span>
            <span class="token comment">//å¦‚æœæœ‰åšè¿‡å¤„ç†ï¼Œä¸æ‰§è¡Œå•†æˆ·çš„ä¸šåŠ¡ç¨‹åº</span>

            <span class="token comment">//æ³¨æ„ï¼š</span>
            <span class="token comment">//å¦‚æœç­¾çº¦çš„æ˜¯å¯é€€æ¬¾åè®®ï¼Œé‚£ä¹ˆä»˜æ¬¾å®Œæˆåï¼Œæ”¯ä»˜å®ç³»ç»Ÿå‘é€è¯¥äº¤æ˜“çŠ¶æ€é€šçŸ¥ã€‚</span>
        <span class="token punctuation">}</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-4-5-3-é€šçŸ¥æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-4-5-3-é€šçŸ¥æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>3.4.5.3 é€šçŸ¥æ¥å£æµ‹è¯•</strong></h5><p>1ã€é‡å¯è®¢å•æœåŠ¡ï¼Œå¹¶åœ¨æ¥æ”¶é€šçŸ¥æ¥å£ä¸­æ‰“ä¸Šæ–­ç‚¹</p><p>2ã€é…ç½®å†…ç½‘ç©¿é€çš„æœ¬åœ°ç«¯å£ä¸ºè®¢å•æœåŠ¡ç«¯å£ï¼Œå¯åŠ¨å†…ç½‘ç©¿é€å®¢æˆ·ç«¯ã€‚</p><p>3ã€æ‰“å¼€æ¨¡æ‹Ÿå™¨ã€æ”¯ä»˜å®æ²™ç®±ï¼Œæ‰«ç ã€æ”¯ä»˜ã€‚</p><p>4ã€è§‚å¯Ÿæ¥æ”¶è®¢å•æ”¯ä»˜æ•°æ®ç­‰æ˜¯å¦æ­£å¸¸ã€‚</p><h3 id="_3-5-ç”Ÿæˆæ”¯ä»˜äºŒç»´ç " tabindex="-1"><a class="header-anchor" href="#_3-5-ç”Ÿæˆæ”¯ä»˜äºŒç»´ç " aria-hidden="true">#</a> <strong>3.5 ç”Ÿæˆæ”¯ä»˜äºŒç»´ç </strong></h3><h4 id="_3-5-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_3-5-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>3.5.1 éœ€æ±‚åˆ†æ</strong></h4><h5 id="_3-5-1-1-æ‰§è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-5-1-1-æ‰§è¡Œæµç¨‹" aria-hidden="true">#</a> <strong>3.5.1.1 æ‰§è¡Œæµç¨‹</strong></h5><p>å†æ¬¡æ‰“å¼€è¯¾ç¨‹æ”¯ä»˜å¼•å¯¼ç•Œé¢ï¼Œ<code>ç‚¹å‡»â€œæ”¯ä»˜å®æ”¯ä»˜â€æŒ‰é’®ç³»ç»Ÿè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</code></p><p><img src="/MyBlog/assets/image-20230611154849591-3d021039.png" alt="image-20230611161211867"></p><p>ç‚¹å‡»â€œæ”¯ä»˜å®æ”¯ä»˜â€æ­¤æ—¶æ‰“å¼€æ”¯ä»˜äºŒç»´ç ï¼Œç”¨æˆ·æ‰«ç æ”¯ä»˜ã€‚</p><p>æ‰€ä»¥é¦–å…ˆéœ€è¦ç”Ÿæˆæ”¯ä»˜äºŒç»´ç ï¼Œç”¨æˆ·æ‰«æäºŒç»´ç å¼€å§‹è¯·æ±‚æ”¯ä»˜å®ä¸‹å•ï¼Œåœ¨å‘æ”¯ä»˜å®ä¸‹å•å‰éœ€è¦æ·»åŠ é€‰è¯¾è®°å½•ã€åˆ›å»ºå•†å“è®¢å•ã€ç”Ÿæˆæ”¯ä»˜è®°å½•ã€‚</p><p>ç”ŸæˆäºŒç»´ç æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611161217060-3228d871.png" alt="image-20230611161217060"></p><p>æ‰§è¡Œæµç¨‹ï¼š</p><p>1ã€å‰ç«¯è°ƒç”¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡çš„æ·»åŠ é€‰è¯¾æ¥å£ã€‚</p><p>2ã€æ·»åŠ é€‰è¯¾æˆåŠŸè¯·æ±‚è®¢å•æœåŠ¡ç”Ÿæˆæ”¯ä»˜äºŒç»´ç æ¥å£ã€‚</p><p>3ã€ç”ŸæˆäºŒç»´ç æ¥å£ï¼šåˆ›å»ºå•†å“è®¢å•ã€ç”Ÿæˆæ”¯ä»˜è®°å½•ã€ç”ŸæˆäºŒç»´ç ã€‚</p><p>4ã€å°†äºŒç»´ç è¿”å›åˆ°å‰ç«¯ï¼Œç”¨æˆ·æ‰«ç ã€‚</p><p>ç”¨æˆ·æ‰«ç æ”¯ä»˜æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230611160731156-728b04b8.png" alt="image-20230611161222339"></p><p>æ‰§è¡Œæµç¨‹ï¼š</p><p>1ã€ç”¨æˆ·è¾“å…¥æ”¯ä»˜å¯†ç ï¼Œæ”¯ä»˜æˆåŠŸã€‚</p><p>2ã€æ¥æ”¶ç¬¬ä¸‰æ–¹å¹³å°é€šçŸ¥çš„æ”¯ä»˜ç»“æœã€‚</p><p>3ã€æ ¹æ®æ”¯ä»˜ç»“æœæ›´æ–°æ”¯ä»˜è®°å½•çš„æ”¯ä»˜çŠ¶æ€ä¸ºæ”¯ä»˜æˆåŠŸã€‚</p><h5 id="_3-5-1-2-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_3-5-1-2-æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>3.5.1.2 æ•°æ®æ¨¡å‹</strong></h5><p>è®¢å•æ”¯ä»˜æ¨¡å¼çš„æ ¸å¿ƒç”±ä¸‰å¼ è¡¨ç»„æˆï¼šè®¢å•è¡¨ã€è®¢å•æ˜ç»†è¡¨ã€æ”¯ä»˜è®°å½•è¡¨ã€‚</p><p><img src="/MyBlog/assets/image-20230611161228016-96dd2ffc.png" alt="image-20230611161228016"></p><p>è®¢å•è¡¨ï¼šè®°å½•è®¢å•ä¿¡æ¯</p><p><img src="/MyBlog/assets/image-20230611161232342-9a810975.png" alt="image-20230611161232342"></p><p>è®¢å•æ˜ç»†è¡¨è®°å½•è®¢å•çš„è¯¦ç»†ä¿¡æ¯</p><p><img src="/MyBlog/assets/image-20230611161235094-eccd760b.png" alt="image-20230611161235094"></p><p>æ”¯ä»˜è®°å½•è¡¨è®°å½•æ¯æ¬¡æ”¯ä»˜çš„è¯¦ç»†ä¿¡æ¯</p><p><img src="/MyBlog/assets/image-20230611161238383-8771bfa7.png" alt="image-20230611161238383"></p><blockquote><p>ä¸ºä»€ä¹ˆåˆ›å»ºæ”¯ä»˜è®°å½•è¡¨ï¼Ÿ</p></blockquote><p>åœ¨è¯·æ±‚å¾®ä¿¡ã€æ”¯ä»˜å®æˆ–å…¶å®ƒç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ä¸‹å•æ¥å£æ—¶éœ€è¦ä¼ å…¥å•†æˆ·çš„è®¢å•å·ï¼Œå¦‚æœå°†æˆ‘ä»¬ç³»ç»Ÿçš„å•†å“è®¢å•å·ç›´æ¥ä¼ ç»™ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ï¼Œ<strong>å½“æ”¯ä»˜äº¤æ˜“å…³é—­æˆ–å…¶å®ƒä»€ä¹ˆåŸå› å°±å¯¼è‡´ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°æŠ¥â€œè®¢å•å·å·²å­˜åœ¨â€ï¼Œæ­¤æ—¶æˆ‘ä»¬ç³»ç»Ÿçš„è®¢å•å°†æ— æ³•å®Œæˆæ”¯ä»˜</strong>ï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯ç”¨æˆ·ä»€ä¹ˆæ—¶å€™æƒ³æ”¯ä»˜éƒ½å¯ä»¥å®Œæˆæ”¯ä»˜ã€‚</p><p>è§£å†³ä»¥ä¸Šé—®é¢˜çš„æ–¹æ¡ˆæ˜¯ï¼š</p><p>1ã€ç”¨æˆ·æ¯æ¬¡å‘èµ·æ”¯ä»˜éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„æ”¯ä»˜è®°å½• ï¼Œæ­¤æ”¯ä»˜è®°å½•ä¸å•†å“è®¢å•å…³è”ã€‚</p><p>2ã€å°†æ”¯ä»˜è®°å½•çš„æµæ°´å·ä¼ ç»™ç¬¬ä¸‰æ–¹æ”¯ä»˜ç³»ç»Ÿçš„ä¸‹å•æ¥å£ï¼Œè¿™æ ·å³å¯è§£å†³ä¸Šè¾¹çš„é—®é¢˜ã€‚</p><p>3ã€ä¸è¿‡åœ¨ç¨‹åºä¸­è¦è€ƒè™‘é‡å¤æ”¯ä»˜çš„é—®é¢˜ã€‚</p><p><img src="/MyBlog/assets/image-20230611161245410-216afbd8.png" alt="image-20230611161245410"></p><h4 id="_3-5-2-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_3-5-2-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>3.5.2 æ¥å£å®šä¹‰</strong></h4><p>åœ¨è®¢å•æœåŠ¡ä¸­å®šä¹‰ç”Ÿæˆæ”¯ä»˜äºŒç»´ç æ¥å£ã€‚</p><p>è¯·æ±‚ï¼šè®¢å•ä¿¡æ¯</p><p>å“åº”ï¼šæ”¯ä»˜è®°å½•åŠäºŒç»´ç </p><p>ä¸‹è¾¹å…ˆå®šä¹‰æ¨¡å‹ç±»å†å®šä¹‰æ¥å£ï¼š</p><p>è¯·æ±‚çš„è®¢å•æ¨¡å‹ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>orders<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>orders<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcOrders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> åˆ›å»ºå•†å“è®¢å•
 * <span class="token keyword">@date</span> 2022/10/4 10:21
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddOrderDto</span>  <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æ€»ä»·
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Float</span> totalPrice<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è®¢å•ç±»å‹
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderType<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è®¢å•åç§°
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderName<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * è®¢å•æè¿°
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderDescrip<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è®¢å•æ˜ç»†jsonï¼Œä¸å¯ä¸ºç©º
     * [<span class="token punctuation">{</span>&quot;goodsId&quot;:&quot;&quot;,&quot;goodsType&quot;:&quot;&quot;,&quot;goodsName&quot;:&quot;&quot;,&quot;goodsPrice&quot;:&quot;&quot;,&quot;goodsDetail&quot;:&quot;&quot;<span class="token punctuation">}</span>,<span class="token punctuation">{</span>...<span class="token punctuation">}</span>]
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderDetail<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å¤–éƒ¨ç³»ç»Ÿä¸šåŠ¡id
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> outBusinessId<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å“åº”ï¼šæ”¯ä»˜è®°å½•ä¿¡æ¯åŠäºŒç»´ç ä¿¡æ¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayRecordDto</span> <span class="token keyword">extends</span> <span class="token class-name">XcPayRecord</span> <span class="token punctuation">{</span>

    <span class="token comment">//äºŒç»´ç </span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> qrcode<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”Ÿæˆæ”¯ä»˜äºŒç»´ç å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è®¢å•æ”¯ä»˜æ¥å£&quot;</span><span class="token punctuation">,</span> tags <span class="token operator">=</span> <span class="token string">&quot;è®¢å•æ”¯ä»˜æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿæˆæ”¯ä»˜äºŒç»´ç &quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/generatepaycode&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">generatePayCode</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">AddOrderDto</span> addOrderDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-3-æ¥å£å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-5-3-æ¥å£å®ç°" aria-hidden="true">#</a> <strong>3.5.3 æ¥å£å®ç°</strong></h4><h5 id="_3-5-3-1-ä¿å­˜å•†å“è®¢å•" tabindex="-1"><a class="header-anchor" href="#_3-5-3-1-ä¿å­˜å•†å“è®¢å•" aria-hidden="true">#</a> <strong>3.5.3.1 ä¿å­˜å•†å“è®¢å•</strong></h5><p>å®šä¹‰ä¿å­˜è®¢å•ä¿¡æ¯æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>


   <span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> åˆ›å»ºå•†å“è®¢å•
 * <span class="token keyword">@param</span> <span class="token parameter">addOrderDto</span> è®¢å•ä¿¡æ¯
 * <span class="token keyword">@return</span> PayRecordDto æ”¯ä»˜è®°å½•(åŒ…æ‹¬äºŒç»´ç )
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/4 11:02
*/</span>
<span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span><span class="token class-name">AddOrderDto</span> addOrderDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¿å­˜è®¢å•æ¥å£ä¸­éœ€è¦å®Œæˆåˆ›å»ºå•†å“è®¢å•ã€åˆ›å»ºæ”¯ä»˜è®°å½•ï¼Œæ¥å£å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcOrdersMapper</span> ordersMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcOrdersGoodsMapper</span> ordersGoodsMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcPayRecordMapper</span> payRecordMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">AddOrderDto</span> addOrderDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//æ·»åŠ å•†å“è®¢å•</span>

        <span class="token comment">//æ·»åŠ æ”¯ä»˜è®°å½•</span>

        <span class="token comment">//ç”ŸæˆäºŒç»´ç </span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ç¼–å†™åˆ›å»ºå•†å“è®¢å•æ–¹æ³•ï¼š</p></blockquote><p>ç¬¬ä¸€ï¼šç¡®å®šè®¢å•å·çš„ç”Ÿæˆè§„åˆ™</p><p>è®¢å•å·æ³¨æ„å”¯ä¸€æ€§ã€å®‰å…¨æ€§ã€å°½é‡çŸ­ç­‰ç‰¹ç‚¹ï¼Œç”Ÿæˆæ–¹æ¡ˆå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p><p>1ã€æ—¶é—´æˆ³+éšæœºæ•°</p><p>å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¯«ç§’+éšæœºæ•°</p><p>2ã€é«˜å¹¶å‘åœºæ™¯</p><p>å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¯«ç§’+éšæœºæ•°+redis è‡ªå¢åºåˆ—</p><p>3ã€è®¢å•å·ä¸­åŠ ä¸Šä¸šåŠ¡æ ‡è¯†</p><p>è®¢å•å·åŠ ä¸Šä¸šåŠ¡æ ‡è¯†æ–¹ä¾¿å®¢æœï¼Œæ¯”å¦‚ï¼šç¬¬ 10 ä½æ˜¯ä¸šåŠ¡ç±»å‹ï¼Œç¬¬ 11 ä½æ˜¯ç”¨æˆ·ç±»å‹ç­‰ã€‚</p><p>4ã€é›ªèŠ±ç®—æ³•</p><p>é›ªèŠ±ç®—æ³•æ˜¯æ¨ç‰¹å†…éƒ¨ä½¿ç”¨çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å”¯ä¸€ ID ç”Ÿæˆç®—æ³•ï¼Œå®ƒåŸºäºæ—¶é—´æˆ³ç”Ÿæˆï¼Œä¿è¯æœ‰åºé€’å¢ï¼ŒåŠ ä»¥å…¥è®¡ç®—æœºç¡¬ä»¶ç­‰å…ƒç´ ï¼Œå¯ä»¥æ»¡è¶³é«˜å¹¶å‘ç¯å¢ƒä¸‹ ID ä¸é‡å¤ã€‚</p><p>æœ¬é¡¹ç›®è®¢å•å·ç”Ÿæˆé‡‡ç”¨é›ªèŠ±ç®—æ³•ã€‚</p><p>ç¬¬äºŒï¼šå•†å“è®¢å•çš„æ•°æ®æ¥æºäºé€‰è¯¾è®°å½•ï¼Œåœ¨è®¢å•è¡¨éœ€è¦å­˜å…¥é€‰è¯¾è®°å½•çš„ IDï¼Œè¿™é‡Œéœ€è¦ä½œå¥½å¹‚ç­‰å¤„ç†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token class-name">XcOrders</span> <span class="token function">saveXcOrders</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span><span class="token class-name">AddOrderDto</span> addOrderDto<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//å¹‚ç­‰æ€§å¤„ç†</span>
    <span class="token class-name">XcOrders</span> order <span class="token operator">=</span> <span class="token function">getOrderByBusinessId</span><span class="token punctuation">(</span>addOrderDto<span class="token punctuation">.</span><span class="token function">getOutBusinessId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>order<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> order<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ç”Ÿæˆè®¢å•å·</span>
    <span class="token keyword">long</span> orderId <span class="token operator">=</span> <span class="token class-name">IdWorkerUtils</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setTotalPrice</span><span class="token punctuation">(</span>addOrderDto<span class="token punctuation">.</span><span class="token function">getTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;600001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æœªæ”¯ä»˜</span>
    order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setOrderType</span><span class="token punctuation">(</span>addOrderDto<span class="token punctuation">.</span><span class="token function">getOrderType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setOrderName</span><span class="token punctuation">(</span>addOrderDto<span class="token punctuation">.</span><span class="token function">getOrderName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setOrderDetail</span><span class="token punctuation">(</span>addOrderDto<span class="token punctuation">.</span><span class="token function">getOrderDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setOrderDescrip</span><span class="token punctuation">(</span>addOrderDto<span class="token punctuation">.</span><span class="token function">getOrderDescrip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setOutBusinessId</span><span class="token punctuation">(</span>addOrderDto<span class="token punctuation">.</span><span class="token function">getOutBusinessId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€‰è¯¾è®°å½•id</span>
    ordersMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> orderDetailJson <span class="token operator">=</span> addOrderDto<span class="token punctuation">.</span><span class="token function">getOrderDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcOrdersGoods</span><span class="token punctuation">&gt;</span></span> xcOrdersGoodsList <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>orderDetailJson<span class="token punctuation">,</span> <span class="token class-name">XcOrdersGoods</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcOrdersGoodsList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>goods<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">XcOrdersGoods</span> xcOrdersGoods <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcOrdersGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>goods<span class="token punctuation">,</span>xcOrdersGoods<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xcOrdersGoods<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¢å•å·</span>
        ordersGoodsMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>xcOrdersGoods<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> order<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ ¹æ®ä¸šåŠ¡idæŸ¥è¯¢è®¢å•</span>
<span class="token keyword">public</span> <span class="token class-name">XcOrders</span> <span class="token function">getOrderByBusinessId</span><span class="token punctuation">(</span><span class="token class-name">String</span> businessId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">XcOrders</span> orders <span class="token operator">=</span> ordersMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcOrders</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcOrders</span><span class="token operator">::</span><span class="token function">getOutBusinessId</span><span class="token punctuation">,</span> businessId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> orders<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-5-3-2-åˆ›å»ºæ”¯ä»˜è®°å½•" tabindex="-1"><a class="header-anchor" href="#_3-5-3-2-åˆ›å»ºæ”¯ä»˜è®°å½•" aria-hidden="true">#</a> <strong>3.5.3.2 åˆ›å»ºæ”¯ä»˜è®°å½•</strong></h5><p>ç¼–å†™åˆ›å»ºæ”¯ä»˜è®°å½•çš„æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token class-name">XcPayRecord</span> <span class="token function">createPayRecord</span><span class="token punctuation">(</span><span class="token class-name">XcOrders</span> orders<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>order<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è®¢å•ä¸å­˜åœ¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>orders<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;600002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è®¢å•å·²æ”¯ä»˜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">XcPayRecord</span> payRecord <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcPayRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ç”Ÿæˆæ”¯ä»˜äº¤æ˜“æµæ°´å·</span>
    <span class="token keyword">long</span> payNo <span class="token operator">=</span> <span class="token class-name">IdWorkerUtils</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    payRecord<span class="token punctuation">.</span><span class="token function">setPayNo</span><span class="token punctuation">(</span>payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    payRecord<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orders<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å•†å“è®¢å•å·</span>
    payRecord<span class="token punctuation">.</span><span class="token function">setOrderName</span><span class="token punctuation">(</span>orders<span class="token punctuation">.</span><span class="token function">getOrderName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    payRecord<span class="token punctuation">.</span><span class="token function">setTotalPrice</span><span class="token punctuation">(</span>orders<span class="token punctuation">.</span><span class="token function">getTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    payRecord<span class="token punctuation">.</span><span class="token function">setCurrency</span><span class="token punctuation">(</span><span class="token string">&quot;CNY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    payRecord<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    payRecord<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;601001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æœªæ”¯ä»˜</span>
    payRecord<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>orders<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    payRecordMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>payRecord<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> payRecord<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-5-3-3-ç”Ÿæˆæ”¯ä»˜äºŒç»´ç " tabindex="-1"><a class="header-anchor" href="#_3-5-3-3-ç”Ÿæˆæ”¯ä»˜äºŒç»´ç " aria-hidden="true">#</a> <strong>3.5.3.3 ç”Ÿæˆæ”¯ä»˜äºŒç»´ç </strong></h5><p>1ã€åœ¨ nacos ä¸­ orders-service-dev.yaml é…ç½®äºŒç»´ç çš„ url</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
pay<span class="token operator">:</span>
 qrcodeurl<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.101</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">63030</span><span class="token operator">/</span>orders<span class="token operator">/</span>requestpay<span class="token operator">?</span>payNo<span class="token operator">=</span><span class="token operator">%</span>s

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å®Œå–„åˆ›å»ºè®¢å• service æ–¹æ³•:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.qrcodeurl}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> qrcodeurl<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">AddOrderDto</span> addOrderDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//åˆ›å»ºå•†å“è®¢å•</span>
    <span class="token class-name">XcOrders</span> orders <span class="token operator">=</span> <span class="token function">saveXcOrders</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> addOrderDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>orders<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è®¢å•åˆ›å»ºå¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ç”Ÿæˆæ”¯ä»˜è®°å½•</span>
    <span class="token class-name">XcPayRecord</span> payRecord <span class="token operator">=</span> <span class="token function">createPayRecord</span><span class="token punctuation">(</span>orders<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ç”ŸæˆäºŒç»´ç </span>
    <span class="token class-name">String</span> qrCode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//urlè¦å¯ä»¥è¢«æ¨¡æ‹Ÿå™¨è®¿é—®åˆ°ï¼Œurlä¸ºä¸‹å•æ¥å£(ç¨åå®šä¹‰)</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>qrcodeurl<span class="token punctuation">,</span> payRecord<span class="token punctuation">.</span><span class="token function">getPayNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        qrCode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QRCodeUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createQRCode</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ç”ŸæˆäºŒç»´ç å‡ºé”™&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">PayRecordDto</span> payRecordDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayRecordDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>payRecord<span class="token punctuation">,</span>payRecordDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    payRecordDto<span class="token punctuation">.</span><span class="token function">setQrcode</span><span class="token punctuation">(</span>qrCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> payRecordDto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-5-3-4-ç”ŸæˆäºŒç»´ç æ¥å£å®Œå–„" tabindex="-1"><a class="header-anchor" href="#_3-5-3-4-ç”ŸæˆäºŒç»´ç æ¥å£å®Œå–„" aria-hidden="true">#</a> <strong>3.5.3.4 ç”ŸæˆäºŒç»´ç æ¥å£å®Œå–„</strong></h5><p>å®Œå–„ç”Ÿæˆæ”¯ä»˜äºŒç»´ç  controller æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿæˆæ”¯ä»˜äºŒç»´ç &quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/generatepaycode&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">generatePayCode</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">AddOrderDto</span> addOrderDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç™»å½•ç”¨æˆ·</span>
    <span class="token class-name">SecurityUtil<span class="token punctuation">.</span>XcUser</span> user <span class="token operator">=</span> <span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·ç™»å½•åç»§ç»­é€‰è¯¾&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   <span class="token keyword">return</span> orderService<span class="token punctuation">.</span><span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> addOrderDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-5-3-5-æ‰«ç ä¸‹å•æ¥å£" tabindex="-1"><a class="header-anchor" href="#_3-5-3-5-æ‰«ç ä¸‹å•æ¥å£" aria-hidden="true">#</a> <strong>3.5.3.5 æ‰«ç ä¸‹å•æ¥å£</strong></h5><p>ç”Ÿæˆäº†æ”¯ä»˜äºŒç»´ç ï¼Œç”¨æˆ·æ‰«ç è¯·æ±‚ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ä¸‹å•ï¼Œä¸‹å•æˆåŠŸç”¨æˆ·å®Œæˆæ”¯ä»˜ã€‚</p><p>1ã€å®šä¹‰ç”¨æˆ·æ‰«ç è¯·æ±‚ä¸‹å•æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰«ç ä¸‹å•æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/requestpay&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">requestpay</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> httpResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å®šä¹‰æŸ¥è¯¢æ”¯ä»˜è®°å½•çš„ Service æ¥å£ä¸å®ç°æ–¹æ³•</p><p>æ‰«ç ä¸‹å•ä¼ å…¥çš„æ˜¯æ”¯ä»˜è®°å½•å·ï¼Œæ ¹æ®æ”¯ä»˜è®°å½•å·æŸ¥è¯¢æ”¯ä»˜è®°å½•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æŸ¥è¯¢æ”¯ä»˜è®°å½•
 * <span class="token keyword">@param</span> <span class="token parameter">payNo</span>  äº¤æ˜“è®°å½•å·
 * <span class="token keyword">@return</span> com.xuecheng.orders.model.po.XcPayRecord
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/20 23:38
*/</span>
<span class="token keyword">public</span> <span class="token class-name">XcPayRecord</span> <span class="token function">getPayRecordByPayno</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">XcPayRecord</span> <span class="token function">getPayRecordByPayno</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">XcPayRecord</span> xcPayRecord <span class="token operator">=</span> payRecordMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcPayRecord</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcPayRecord</span><span class="token operator">::</span><span class="token function">getPayNo</span><span class="token punctuation">,</span> payNo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xcPayRecord<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€å®Œå–„æ‰«ç ä¸‹å•æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.APP_ID}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token constant">APP_ID</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.APP_PRIVATE_KEY}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token constant">APP_PRIVATE_KEY</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${pay.alipay.ALIPAY_PUBLIC_KEY}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰«ç ä¸‹å•æ¥å£&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/requestpay&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">requestpay</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> httpResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¦‚æœpayNoä¸å­˜åœ¨åˆ™æç¤ºé‡æ–°å‘èµ·æ”¯ä»˜</span>
        <span class="token class-name">XcPayRecord</span> payRecord <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">getPayRecordByPayno</span><span class="token punctuation">(</span>payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>payRecord <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·é‡æ–°ç‚¹å‡»æ”¯ä»˜è·å–äºŒç»´ç &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//æ”¯ä»˜çŠ¶æ€</span>
        <span class="token class-name">String</span> status <span class="token operator">=</span> payRecord<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;601002&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è®¢å•å·²æ”¯ä»˜ï¼Œè¯·å‹¿é‡å¤æ”¯ä»˜ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//æ„é€ sdkçš„å®¢æˆ·ç«¯å¯¹è±¡</span>
        <span class="token class-name">AlipayClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span><span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token constant">APP_ID</span><span class="token punctuation">,</span> <span class="token constant">APP_PRIVATE_KEY</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">FORMAT</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">,</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">SIGNTYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å¾—åˆå§‹åŒ–çš„AlipayClient</span>
        <span class="token class-name">AlipayTradeWapPayRequest</span> alipayRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeWapPayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºAPIå¯¹åº”çš„request</span>
<span class="token comment">//        alipayRequest.setReturnUrl(&quot;http://domain.com/CallBack/return_url.jsp&quot;);</span>
<span class="token comment">//        alipayRequest.setNotifyUrl(&quot;http://tjxt-user-t.itheima.net/xuecheng/orders/paynotify&quot;);//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€</span>
        alipayRequest<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span><span class="token string">&quot;{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; \&quot;out_trade_no\&quot;:\&quot;&quot;</span><span class="token operator">+</span>payRecord<span class="token punctuation">.</span><span class="token function">getPayNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\&quot;,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; \&quot;total_amount\&quot;:\&quot;&quot;</span><span class="token operator">+</span>payRecord<span class="token punctuation">.</span><span class="token function">getTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\&quot;,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; \&quot;subject\&quot;:\&quot;&quot;</span><span class="token operator">+</span>payRecord<span class="token punctuation">.</span><span class="token function">getOrderName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\&quot;,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; \&quot;product_code\&quot;:\&quot;QUICK_WAP_PAY\&quot;&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; }&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¡«å……ä¸šåŠ¡å‚æ•°</span>
        <span class="token class-name">String</span> form <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//è¯·æ±‚æ”¯ä»˜å®ä¸‹å•æ¥å£,å‘èµ·httpè¯·æ±‚</span>
            form <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">pageExecute</span><span class="token punctuation">(</span>alipayRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è°ƒç”¨SDKç”Ÿæˆè¡¨å•</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        httpResponse<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=&quot;</span> <span class="token operator">+</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç›´æ¥å°†å®Œæ•´çš„è¡¨å•htmlè¾“å‡ºåˆ°é¡µé¢</span>
        httpResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-3-æ”¯ä»˜æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-5-3-æ”¯ä»˜æµ‹è¯•" aria-hidden="true">#</a> <strong>3.5.3 æ”¯ä»˜æµ‹è¯•</strong></h4><p>æµ‹è¯•å‡†å¤‡ï¼š</p><p>1ã€å¯åŠ¨ç½‘å…³æœåŠ¡ã€è®¤è¯æœåŠ¡ã€éªŒè¯ç æœåŠ¡ã€å­¦ä¹ ä¸­å¿ƒæœåŠ¡ã€è®¢å•æœåŠ¡ã€å†…å®¹ç®¡ç†æœåŠ¡ã€‚</p><p>2ã€å‘å¸ƒä¸€é—¨æ”¶è´¹è¯¾ç¨‹ã€‚</p><p>3ã€ä½¿ç”¨èµ„æ–™ç›®å½•ä¸­çš„æ–°æ¨¡æ¿ course_template.ftl</p><p>æµ‹è¯•æµç¨‹ï¼š</p><p>1ã€è¿›å…¥æ”¶è´¹è¯¾ç¨‹è¯¦ç»†é¡µé¢ï¼Œç‚¹å‡»é©¬ä¸Šå­¦ä¹ ã€‚</p><p>2ã€è·Ÿè¸ªæµè§ˆå™¨åŠå¾®æœåŠ¡ï¼Œè§‚å¯Ÿé€‰è¯¾è®°å½•æ˜¯å¦åˆ›å»ºæˆåŠŸã€å•†å“è®¢å•æ˜¯å¦åˆ›å»ºæˆåŠŸã€æ”¯ä»˜è®°å½•æ˜¯å¦åˆ›å»ºæˆåŠŸã€‚</p><p>3ã€è§‚å¯Ÿç”ŸæˆäºŒç»´ç æ˜¯å¦æˆåŠŸ</p><p>4ã€ä½¿ç”¨æ¨¡æ‹Ÿå™¨æ‰«ç æµ‹è¯•ï¼Œæ˜¯å¦å¯ä»¥æ­£å¸¸æ”¯ä»˜ã€‚</p><p>å¦‚æœæŠ¥è®¢å•å‚æ•°å¼‚å¸¸æŠ¥å¦‚ä¸‹é”™è¯¯ï¼Œéœ€è¦æ£€æŸ¥è¯·æ±‚æ”¯ä»˜å®çš„ä¸‹å•æ•°æ®æ˜¯å¦æ­£ç¡®ã€‚</p><p><img src="/MyBlog/assets/image-20230611161524922-5cdd660c.png" alt="image-20230611161524922"></p><h4 id="_3-5-4-é‡å¤æ”¯ä»˜é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-5-4-é‡å¤æ”¯ä»˜é—®é¢˜" aria-hidden="true">#</a> <strong>3.5.4 é‡å¤æ”¯ä»˜é—®é¢˜</strong></h4><p>ä¸Šè¾¹å®ç°ä¸­ï¼Œæ‰«ç ä¸‹å•æ—¶ä¼šæ ¹æ®æ”¯ä»˜è®°å½•å·åˆ¤æ–­æ˜¯å¦æ”¯ä»˜å®Œæˆï¼Œç”ŸæˆäºŒç»´ç æ—¶ä¹Ÿä¼šåˆ¤æ–­è®¢å•çš„çŠ¶æ€æ˜¯å¦æ”¯ä»˜å®Œæˆï¼Œå¦‚æœæ”¯ä»˜å®Œæˆå°†ä¸å†é‡æ–°æ”¯ä»˜ï¼Œå³ä½¿è¿™æ ·åšä¹Ÿæ— æ³•ç»å¯¹é¿å…é‡å¤æ”¯ä»˜ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹åŒä¸€ä¸ªç”¨æˆ·çš„åŒä¸€ä¸ªè®¢å•ä¸ä¼šå­˜åœ¨å¹¶å‘æ‰«ç æ”¯ä»˜çš„é—®é¢˜ï¼Œä½†ç³»ç»Ÿæ˜¯å¯èƒ½å­˜åœ¨é‡å¤æ”¯ä»˜çš„é—®é¢˜çš„ï¼Œè§£å†³è¯¥é—®é¢˜éœ€è¦å•ç‹¬å®šä¹‰ä»»åŠ¡ï¼Œæ¯éš” 24 å°æ—¶æŸ¥è¯¢å‰ä¸€å¤©çš„è®¢å•æ˜¯å¦å­˜åœ¨é‡å¤æ”¯ä»˜çš„é—®é¢˜ï¼Œå¦‚æœå­˜åœ¨åˆ™è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°çš„é€€æ¬¾æ¥å£è¿›è¡Œé€€æ¬¾ã€‚</p><h3 id="_3-6-æŸ¥è¯¢æ”¯ä»˜ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_3-6-æŸ¥è¯¢æ”¯ä»˜ç»“æœ" aria-hidden="true">#</a> <strong>3.6 æŸ¥è¯¢æ”¯ä»˜ç»“æœ</strong></h3><h4 id="_3-6-1-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_3-6-1-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>3.6.1 æ¥å£å®šä¹‰</strong></h4><p>æ ¹æ®å‰è¾¹æˆ‘ä»¬è°ƒç ”çš„è·å–æ”¯ä»˜ç»“æœçš„æ¥å£ï¼ŒåŒ…æ‹¬ï¼šä¸»åŠ¨æŸ¥è¯¢æ”¯ä»˜ç»“æœã€è¢«åŠ¨æ¥æ”¶æ”¯ä»˜ç»“æœã€‚</p><p>è¿™é‡Œå…ˆå®ç°ä¸»åŠ¨æŸ¥è¯¢æ”¯ä»˜ç»“æœï¼Œå½“æ”¯ä»˜å®Œæˆç”¨æˆ·ç‚¹å‡» â€œæ”¯ä»˜å®Œæˆâ€ å°†è¯·æ±‚ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°æŸ¥è¯¢æ”¯ä»˜ç»“æœã€‚</p><p>åœ¨ OrderController ç±»ä¸­å®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢æ”¯ä»˜ç»“æœ&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/payresult&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">payresult</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//æŸ¥è¯¢æ”¯ä»˜ç»“æœ</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-2-æ¥å£å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-6-2-æ¥å£å®ç°" aria-hidden="true">#</a> <strong>3.6.2 æ¥å£å®ç°</strong></h4><h5 id="_3-6-2-1-service-æ€»ä½“æ¥å£" tabindex="-1"><a class="header-anchor" href="#_3-6-2-1-service-æ€»ä½“æ¥å£" aria-hidden="true">#</a> <strong>3.6.2.1 service æ€»ä½“æ¥å£</strong></h5><p>1ã€å®šä¹‰æŸ¥è¯¢æ”¯ä»˜ç»“æœçš„ service</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * è¯·æ±‚æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœ
 * <span class="token keyword">@param</span> <span class="token parameter">payNo</span> æ”¯ä»˜è®°å½•id
 * <span class="token keyword">@return</span> æ”¯ä»˜è®°å½•ä¿¡æ¯
 */</span>
<span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">queryPayResult</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€service å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">queryPayResult</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">XcPayRecord</span> payRecord <span class="token operator">=</span> <span class="token function">getPayRecordByPayno</span><span class="token punctuation">(</span>payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>payRecord <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·é‡æ–°ç‚¹å‡»æ”¯ä»˜è·å–äºŒç»´ç &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ”¯ä»˜çŠ¶æ€</span>
    <span class="token class-name">String</span> status <span class="token operator">=</span> payRecord<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¦‚æœæ”¯ä»˜æˆåŠŸç›´æ¥è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;601002&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PayRecordDto</span> payRecordDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayRecordDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>payRecord<span class="token punctuation">,</span> payRecordDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> payRecordDto<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ä»æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœ</span>
    <span class="token class-name">PayStatusDto</span> payStatusDto <span class="token operator">=</span> <span class="token function">queryPayResultFromAlipay</span><span class="token punctuation">(</span>payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¿å­˜æ”¯ä»˜ç»“æœ</span>
    currentProxy<span class="token punctuation">.</span><span class="token function">saveAliPayStatus</span><span class="token punctuation">(</span> payStatusDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//é‡æ–°æŸ¥è¯¢æ”¯ä»˜è®°å½•</span>
    payRecord <span class="token operator">=</span> <span class="token function">getPayRecordByPayno</span><span class="token punctuation">(</span>payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PayRecordDto</span> payRecordDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayRecordDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>payRecord<span class="token punctuation">,</span> payRecordDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> payRecordDto<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * è¯·æ±‚æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœ
 * <span class="token keyword">@param</span> <span class="token parameter">payNo</span> æ”¯ä»˜äº¤æ˜“å·
 * <span class="token keyword">@return</span> æ”¯ä»˜ç»“æœ
 */</span>
<span class="token keyword">public</span> <span class="token class-name">PayStatusDto</span> <span class="token function">queryPayResultFromAlipay</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> ä¿å­˜æ”¯ä»˜å®æ”¯ä»˜ç»“æœ
 * <span class="token keyword">@param</span> <span class="token parameter">payStatusDto</span>  æ”¯ä»˜ç»“æœä¿¡æ¯
 * <span class="token keyword">@return</span> void
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/4 16:52
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAliPayStatus</span><span class="token punctuation">(</span><span class="token class-name">PayStatusDto</span> payStatusDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-6-2-2-æŸ¥è¯¢æ”¯ä»˜ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_3-6-2-2-æŸ¥è¯¢æ”¯ä»˜ç»“æœ" aria-hidden="true">#</a> <strong>3.6.2.2 æŸ¥è¯¢æ”¯ä»˜ç»“æœ</strong></h5><p>å®šä¹‰ä»æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœçš„æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * è¯·æ±‚æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœ
 * <span class="token keyword">@param</span> <span class="token parameter">payNo</span> æ”¯ä»˜äº¤æ˜“å·
 * <span class="token keyword">@return</span> æ”¯ä»˜ç»“æœ
 */</span>
<span class="token keyword">public</span> <span class="token class-name">PayStatusDto</span> <span class="token function">queryPayResultFromAlipay</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//========è¯·æ±‚æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœ=============</span>
    <span class="token class-name">AlipayClient</span> alipayClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span><span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token constant">APP_ID</span><span class="token punctuation">,</span> <span class="token constant">APP_PRIVATE_KEY</span><span class="token punctuation">,</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">,</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">SIGNTYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å¾—åˆå§‹åŒ–çš„AlipayClient</span>
    <span class="token class-name">AlipayTradeQueryRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeQueryRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JSONObject</span> bizContent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bizContent<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">,</span> payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span>bizContent<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AlipayTradeQueryResponse</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·æ±‚æ”¯ä»˜æŸ¥è¯¢æŸ¥è¯¢å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·æ±‚æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœå¼‚å¸¸:{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·æ±‚æ”¯ä»˜æŸ¥è¯¢æŸ¥è¯¢å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//è·å–æ”¯ä»˜ç»“æœ</span>
    <span class="token class-name">String</span> resultJson <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è½¬map</span>
    <span class="token class-name">Map</span> resultMap <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>resultJson<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> alipay_trade_query_response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> resultMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;alipay_trade_query_response&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ”¯ä»˜ç»“æœ</span>
    <span class="token class-name">String</span> trade_status <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> alipay_trade_query_response<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;trade_status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> total_amount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> alipay_trade_query_response<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;total_amount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> trade_no <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> alipay_trade_query_response<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¿å­˜æ”¯ä»˜ç»“æœ</span>
    <span class="token class-name">PayStatusDto</span> payStatusDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayStatusDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    payStatusDto<span class="token punctuation">.</span><span class="token function">setOut_trade_no</span><span class="token punctuation">(</span>payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    payStatusDto<span class="token punctuation">.</span><span class="token function">setTrade_status</span><span class="token punctuation">(</span>trade_status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    payStatusDto<span class="token punctuation">.</span><span class="token function">setApp_id</span><span class="token punctuation">(</span><span class="token constant">APP_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    payStatusDto<span class="token punctuation">.</span><span class="token function">setTrade_no</span><span class="token punctuation">(</span>trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
    payStatusDto<span class="token punctuation">.</span><span class="token function">setTotal_amount</span><span class="token punctuation">(</span>total_amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> payStatusDto<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-6-2-3-ä¿å­˜æ”¯ä»˜ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_3-6-2-3-ä¿å­˜æ”¯ä»˜ç»“æœ" aria-hidden="true">#</a> <strong>3.6.2.3 ä¿å­˜æ”¯ä»˜ç»“æœ</strong></h5><p>1ã€å®šä¹‰ä¿å­˜æ”¯ä»˜ç»“æœçš„æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> ä¿å­˜æ”¯ä»˜å®æ”¯ä»˜ç»“æœ
 * <span class="token keyword">@param</span> <span class="token parameter">payStatusDto</span>  æ”¯ä»˜ç»“æœä¿¡æ¯
 * <span class="token keyword">@return</span> void
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/4 16:52
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAliPayStatus</span><span class="token punctuation">(</span><span class="token class-name">PayStatusDto</span> payStatusDto<span class="token punctuation">)</span> <span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€ç¼–å†™æ¥å£å®ç°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAliPayStatus</span><span class="token punctuation">(</span><span class="token class-name">PayStatusDto</span> payStatusDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ”¯ä»˜æµæ°´å·</span>
    <span class="token class-name">String</span> payNo <span class="token operator">=</span> payStatusDto<span class="token punctuation">.</span><span class="token function">getOut_trade_no</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">XcPayRecord</span> payRecord <span class="token operator">=</span> <span class="token function">getPayRecordByPayno</span><span class="token punctuation">(</span>payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>payRecord <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¯ä»˜è®°å½•æ‰¾ä¸åˆ°&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ”¯ä»˜ç»“æœ</span>
    <span class="token class-name">String</span> trade_status <span class="token operator">=</span> payStatusDto<span class="token punctuation">.</span><span class="token function">getTrade_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æ”¯ä»˜ç»“æœ:{},æ”¯ä»˜è®°å½•:{}}&quot;</span><span class="token punctuation">,</span> payStatusDto<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>payRecord<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>trade_status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_SUCCESS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//æ”¯ä»˜é‡‘é¢å˜ä¸ºåˆ†</span>
        <span class="token class-name">Float</span> totalPrice <span class="token operator">=</span> payRecord<span class="token punctuation">.</span><span class="token function">getTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token class-name">Float</span> total_amount <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>payStatusDto<span class="token punctuation">.</span><span class="token function">getTotal_amount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token comment">//æ ¡éªŒæ˜¯å¦ä¸€è‡´</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>totalPrice<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> total_amount<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//æ ¡éªŒå¤±è´¥</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ ¡éªŒæ”¯ä»˜ç»“æœå¤±è´¥,æ”¯ä»˜è®°å½•:{},APP_ID:{},totalPrice:{}&quot;</span> <span class="token punctuation">,</span>payRecord<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>payStatusDto<span class="token punctuation">.</span><span class="token function">getApp_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>total_amount<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ ¡éªŒæ”¯ä»˜ç»“æœå¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°æ”¯ä»˜ç»“æœ,æ”¯ä»˜äº¤æ˜“æµæ°´å·:{},æ”¯ä»˜ç»“æœ:{}&quot;</span><span class="token punctuation">,</span> payNo<span class="token punctuation">,</span> trade_status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XcPayRecord</span> payRecord_u <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcPayRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payRecord_u<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;601002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ”¯ä»˜æˆåŠŸ</span>
        payRecord_u<span class="token punctuation">.</span><span class="token function">setOutPayChannel</span><span class="token punctuation">(</span><span class="token string">&quot;Alipay&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payRecord_u<span class="token punctuation">.</span><span class="token function">setOutPayNo</span><span class="token punctuation">(</span>payStatusDto<span class="token punctuation">.</span><span class="token function">getTrade_no</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ”¯ä»˜å®äº¤æ˜“å·</span>
        payRecord_u<span class="token punctuation">.</span><span class="token function">setPaySuccessTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€šçŸ¥æ—¶é—´</span>
        <span class="token keyword">int</span> update1 <span class="token operator">=</span> payRecordMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>payRecord_u<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcPayRecord</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcPayRecord</span><span class="token operator">::</span><span class="token function">getPayNo</span><span class="token punctuation">,</span> payNo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>update1 <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°æ”¯ä»˜è®°å½•çŠ¶æ€æˆåŠŸ:{}&quot;</span><span class="token punctuation">,</span> payRecord_u<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°æ”¯ä»˜è®°å½•çŠ¶æ€å¤±è´¥:{}&quot;</span><span class="token punctuation">,</span> payRecord_u<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°æ”¯ä»˜è®°å½•çŠ¶æ€å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//å…³è”çš„è®¢å•å·</span>
        <span class="token class-name">Long</span> orderId <span class="token operator">=</span> payRecord<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XcOrders</span> orders <span class="token operator">=</span> ordersMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>orders <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ ¹æ®æ”¯ä»˜è®°å½•[{}}]æ‰¾ä¸åˆ°è®¢å•&quot;</span><span class="token punctuation">,</span> payRecord_u<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ ¹æ®æ”¯ä»˜è®°å½•æ‰¾ä¸åˆ°è®¢å•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">XcOrders</span> order_u <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order_u<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;600002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ”¯ä»˜æˆåŠŸ</span>
        <span class="token keyword">int</span> update <span class="token operator">=</span> ordersMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order_u<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcOrders</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcOrders</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>update <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°è®¢å•è¡¨çŠ¶æ€æˆåŠŸ,è®¢å•å·:{}&quot;</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°è®¢å•è¡¨çŠ¶æ€å¤±è´¥,è®¢å•å·:{}&quot;</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°è®¢å•è¡¨çŠ¶æ€å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-3-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-6-3-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>3.6.3 æ¥å£æµ‹è¯•</strong></h4><p>1ã€å®Œå–„æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢æ”¯ä»˜ç»“æœ&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/payresult&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">PayRecordDto</span> <span class="token function">payresult</span><span class="token punctuation">(</span><span class="token class-name">String</span> payNo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//è°ƒç”¨æ”¯ä»˜å®æ¥å£æŸ¥è¯¢</span>
    <span class="token class-name">PayRecordDto</span> payRecordDto <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">queryPayResult</span><span class="token punctuation">(</span>payNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> payRecordDto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æµ‹è¯•æµç¨‹</p><p>å®Œæˆç”Ÿæˆæ”¯ä»˜äºŒç»´ç </p><p>ç”¨æ”¯ä»˜å®æ‰«ç ä½†ä¸æ”¯ä»˜</p><p>ä½¿ç”¨ httpclient è¯·æ±‚æŸ¥è¯¢æ”¯ä»˜ç»“æœï¼ŒæŸ¥è¯¢å¤±è´¥</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>
#### æŸ¥è¯¢æ”¯ä»˜ç»“æœ
GET {{orders_host}}/orders/payresult?payNo=1628648111951941632
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsieHVlY2hlbmctcGx1cyJdLCJ1c2VyX25hbWUiOiJ7XCJiaXJ0aGRheVwiOlwiMjAyMi0wOS0yOFQxOToyODo0NlwiLFwiY3JlYXRlVGltZVwiOlwiMjAyMi0wOS0yOFQwODozMjowM1wiLFwiaWRcIjpcIjUwXCIsXCJuYW1lXCI6XCLlrabnlJ8xXCIsXCJuaWNrbmFtZVwiOlwi5aSn5rC054mbXCIsXCJwZXJtaXNzaW9uc1wiOltdLFwic2V4XCI6XCIxXCIsXCJzdGF0dXNcIjpcIjFcIixcInVzZXJuYW1lXCI6XCJzdHUxXCIsXCJ1c2VycGljXCI6XCJodHRwOi8vZmlsZS41MXh1ZWNoZW5nLmNuL2RkZGZcIixcInV0eXBlXCI6XCIxMDEwMDFcIn0iLCJzY29wZSI6WyJhbGwiXSwiZXhwIjoxNjc3MTQwMDI1LCJhdXRob3JpdGllcyI6WyJwMSJdLCJqdGkiOiJmYThiMmY1OS03ZTQ5LTRmODUtOTBlMC05NzYwNjlkYjE3ODIiLCJjbGllbnRfaWQiOiJYY1dlYkFwcCJ9.89sp5lPdFafZ_HdGhe8Cpv0anMJC3vT4PtaGMHgCkr8</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨æ”¯ä»˜å®æ‰«ç å†æ¬¡å®Œæˆæ”¯ä»˜</p><p>ä½¿ç”¨ httpclient è¯·æ±‚æŸ¥è¯¢æ”¯ä»˜ç»“æœï¼Œæ”¯ä»˜ç»“æœä¸ºæˆåŠŸï¼Œå¹¶æ›´æ–°æ”¯ä»˜è®°å½•çŠ¶æ€å’Œè®¢å•çŠ¶æ€ã€‚</p><p>3ã€ä½¿ç”¨å‰åç«¯è”è°ƒ</p><blockquote><p>æ‹·è´èµ„æ–™ç›®å½•ä¸­ LocalDateTimeConfig.java åˆ° base å·¥ç¨‹ä¸‹ï¼Œå¤„ç† long è½¬ string ç²¾åº¦æŸå¤±çš„é—®é¢˜ã€‚</p></blockquote><p>ä½¿ç”¨æœ€æ–°çš„é—¨æˆ·ä»£ç  xc-ui-pc-static-portal.zip</p><h3 id="_3-7-æ¥æ”¶æ”¯ä»˜é€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#_3-7-æ¥æ”¶æ”¯ä»˜é€šçŸ¥" aria-hidden="true">#</a> <strong>3.7 æ¥æ”¶æ”¯ä»˜é€šçŸ¥</strong></h3><h4 id="_3-7-1-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_3-7-1-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>3.7.1 æ¥å£å®šä¹‰</strong></h4><p>æ”¯ä»˜å®Œæˆåç¬¬ä¸‰æ–¹æ”¯ä»˜ç³»ç»Ÿä¼šä¸»åŠ¨é€šçŸ¥æ”¯ä»˜ç»“æœï¼Œè¦å®ç°ä¸»åŠ¨é€šçŸ¥éœ€è¦åœ¨è¯·æ±‚æ”¯ä»˜ç³»ç»Ÿä¸‹å•æ—¶ä¼ å…¥ NotifyUrlï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ª urlï¼šNotifyUrl å’Œ ReturnUrlï¼ŒReturnUrl æ˜¯æ”¯ä»˜å®Œæˆåæ”¯ä»˜ç³»ç»Ÿæºå¸¦æ”¯ä»˜ç»“æœé‡å®šå‘åˆ° ReturnUrl åœ°å€ï¼ŒNotifyUrl æ˜¯æ”¯ä»˜å®Œæˆåæ”¯ä»˜ç³»ç»Ÿåœ¨åå°å®šæ—¶å»é€šçŸ¥ï¼Œä½¿ç”¨ NotifyUrl æ¯”ä½¿ç”¨ ReturnUrl æœ‰ä¿è¯ã€‚</p><p>æ ¹æ®æ¥å£æè¿°ï¼šhttps://opendocs.alipay.com/open/203/105286çš„å†…å®¹ä¸‹è¾¹åœ¨è®¢å•æœåŠ¡å®šä¹‰æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥çš„æ¥å£ã€‚</p><p>é¦–å…ˆåœ¨ä¸‹å•æ—¶æŒ‡å®š NotifyUrl:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>alipayRequest<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span><span class="token string">&quot;http://tjxt-user-t.itheima.net/xuecheng/orders/receivenotify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/receivenotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receivenotify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span><span class="token punctuation">,</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> requestParams <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> iter <span class="token operator">=</span> requestParams<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> requestParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> valueStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            valueStr <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> values<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    <span class="token operator">:</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> valueStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//éªŒç­¾</span>
    <span class="token keyword">boolean</span> verify_result <span class="token operator">=</span> <span class="token class-name">AlipaySignature</span><span class="token punctuation">.</span><span class="token function">rsaCheckV1</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">,</span> <span class="token string">&quot;RSA2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>verify_result<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//éªŒè¯æˆåŠŸ</span>

        <span class="token comment">//å•†æˆ·è®¢å•å·</span>
        <span class="token class-name">String</span> out_trade_no <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ”¯ä»˜å®äº¤æ˜“å·</span>
        <span class="token class-name">String</span> trade_no <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//äº¤æ˜“çŠ¶æ€</span>
        <span class="token class-name">String</span> trade_status <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//appid</span>
        <span class="token class-name">String</span> app_id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;app_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//total_amount</span>
        <span class="token class-name">String</span> total_amount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;total_amount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//äº¤æ˜“æˆåŠŸå¤„ç†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>trade_status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_SUCCESS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

           <span class="token comment">//å¤„ç†é€»è¾‘ã€‚ã€‚ã€‚</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-7-2-æ¥å£å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-7-2-æ¥å£å®ç°" aria-hidden="true">#</a> <strong>3.7.2 æ¥å£å®ç°</strong></h4><p>å®Œå–„ contorller æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/receivenotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receivenotify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span><span class="token punctuation">,</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> requestParams <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> iter <span class="token operator">=</span> requestParams<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> requestParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> valueStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            valueStr <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> values<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    <span class="token operator">:</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> valueStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//éªŒç­¾</span>
    <span class="token keyword">boolean</span> verify_result <span class="token operator">=</span> <span class="token class-name">AlipaySignature</span><span class="token punctuation">.</span><span class="token function">rsaCheckV1</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token constant">ALIPAY_PUBLIC_KEY</span><span class="token punctuation">,</span> <span class="token class-name">AlipayConfig</span><span class="token punctuation">.</span><span class="token constant">CHARSET</span><span class="token punctuation">,</span> <span class="token string">&quot;RSA2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>verify_result<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//éªŒè¯æˆåŠŸ</span>

        <span class="token comment">//å•†æˆ·è®¢å•å·</span>
        <span class="token class-name">String</span> out_trade_no <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ”¯ä»˜å®äº¤æ˜“å·</span>
        <span class="token class-name">String</span> trade_no <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//äº¤æ˜“çŠ¶æ€</span>
        <span class="token class-name">String</span> trade_status <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//appid</span>
        <span class="token class-name">String</span> app_id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;app_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//total_amount</span>
        <span class="token class-name">String</span> total_amount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;total_amount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//äº¤æ˜“æˆåŠŸå¤„ç†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>trade_status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_SUCCESS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">PayStatusDto</span> payStatusDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayStatusDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            payStatusDto<span class="token punctuation">.</span><span class="token function">setOut_trade_no</span><span class="token punctuation">(</span>out_trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
            payStatusDto<span class="token punctuation">.</span><span class="token function">setTrade_status</span><span class="token punctuation">(</span>trade_status<span class="token punctuation">)</span><span class="token punctuation">;</span>
            payStatusDto<span class="token punctuation">.</span><span class="token function">setApp_id</span><span class="token punctuation">(</span>app_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            payStatusDto<span class="token punctuation">.</span><span class="token function">setTrade_no</span><span class="token punctuation">(</span>trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
            payStatusDto<span class="token punctuation">.</span><span class="token function">setTotal_amount</span><span class="token punctuation">(</span>total_amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">//å¤„ç†é€»è¾‘ã€‚ã€‚ã€‚</span>
            orderService<span class="token punctuation">.</span><span class="token function">saveAliPayStatus</span><span class="token punctuation">(</span>payStatusDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-7-4-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-7-4-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>3.7.4 æ¥å£æµ‹è¯•</strong></h4><p>æµ‹è¯•å‡†å¤‡ï¼š</p><p>1ã€å¯åŠ¨ç½‘å…³æœåŠ¡ã€è®¤è¯æœåŠ¡ã€éªŒè¯ç æœåŠ¡ã€å­¦ä¹ ä¸­å¿ƒæœåŠ¡ã€å†…å®¹ç®¡ç†æœåŠ¡ã€‚</p><p>2ã€å‘å¸ƒä¸€é—¨æ”¶è´¹è¯¾ç¨‹ã€‚</p><p>æµ‹è¯•æµç¨‹ï¼š</p><p>1ã€å¯¹é€‰è¯¾è¿›è¡Œæ”¯ä»˜</p><p>2ã€æ”¯ä»˜æˆåŠŸè·Ÿè¸ª service æ–¹æ³•çš„æ—¥å¿—ï¼Œæ”¯ä»˜æˆåŠŸéœ€è¦æ›´æ–°æ”¯ä»˜äº¤æ˜“è¡¨è®°å½•çš„çŠ¶æ€ã€é€šçŸ¥æ—¶é—´ã€æ”¯ä»˜å®äº¤æ˜“å·ã€æ”¯ä»˜æ¸ é“(Alipay)</p><p>æ”¯ä»˜æˆåŠŸæ›´æ–°è®¢å•è¡¨çš„çŠ¶æ€ä¸ºç©ºã€‚</p><h2 id="_4-æ”¯ä»˜é€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#_4-æ”¯ä»˜é€šçŸ¥" aria-hidden="true">#</a> <strong>4 æ”¯ä»˜é€šçŸ¥</strong></h2><h3 id="_4-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>4.1 éœ€æ±‚åˆ†æ</strong></h3><p>è®¢å•æœåŠ¡ä½œä¸ºé€šç”¨æœåŠ¡åœ¨è®¢å•æ”¯ä»˜æˆåŠŸåéœ€è¦å°†æ”¯ä»˜ç»“æœå¼‚æ­¥é€šçŸ¥ç»™å…¶å®ƒå¾®æœåŠ¡ã€‚</p><p>ä¸‹å›¾ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—å®Œæˆæ”¯ä»˜ç»“æœé€šçŸ¥ï¼š</p><p><img src="/MyBlog/assets/image-20230611161756277-ae1ea375.png" alt="image-20230611161756277"></p><p>å­¦ä¹ ä¸­å¿ƒæœåŠ¡ï¼šå¯¹æ”¶è´¹è¯¾ç¨‹é€‰è¯¾éœ€è¦æ”¯ä»˜ï¼Œä¸è®¢å•æœåŠ¡å¯¹æ¥å®Œæˆæ”¯ä»˜ã€‚</p><p>å­¦ä¹ èµ„æºæœåŠ¡ï¼šå¯¹æ”¶è´¹çš„å­¦ä¹ èµ„æ–™éœ€è¦è´­ä¹°åä¸‹è½½ï¼Œä¸è®¢å•æœåŠ¡å¯¹æ¥å®Œæˆæ”¯ä»˜ã€‚</p><p>è®¢å•æœåŠ¡å®Œæˆæ”¯ä»˜åå°†æ”¯ä»˜ç»“æœå‘ç»™æ¯ä¸€ä¸ªä¸è®¢å•æœåŠ¡å¯¹æ¥çš„å¾®æœåŠ¡ï¼Œè®¢å•æœåŠ¡å°†æ¶ˆæ¯å‘ç»™äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºå¹¿æ’­æ¶ˆæ¯ï¼Œæ¯ä¸ªè®¢é˜…æ¶ˆæ¯çš„å¾®æœåŠ¡éƒ½å¯ä»¥æ¥æ”¶åˆ°æ”¯ä»˜ç»“æœ.</p><p>å¾®æœåŠ¡æ”¶åˆ°æ”¯ä»˜ç»“æœæ ¹æ®è®¢å•çš„ç±»å‹å»æ›´æ–°è‡ªå·±çš„ä¸šåŠ¡æ•°æ®ã€‚</p><h3 id="_4-2-æŠ€æœ¯æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_4-2-æŠ€æœ¯æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>4.2 æŠ€æœ¯æ–¹æ¡ˆ</strong></h3><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥é€šçŸ¥éœ€è¦ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œå³ç”Ÿäº§ç«¯å°†æ¶ˆæ¯æˆåŠŸé€šçŸ¥åˆ°æ¶ˆè´¹ç«¯ã€‚</p><p>æ¶ˆæ¯ä»ç”Ÿäº§ç«¯å‘é€åˆ°æ¶ˆè´¹ç«¯ç»å†äº†å¦‚ä¸‹è¿‡ç¨‹ï¼š</p><p>1ã€æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœº</p><p>2ã€æ¶ˆæ¯ç”±äº¤æ¢æœºå‘é€åˆ°é˜Ÿåˆ—</p><p>3ã€æ¶ˆæ¯è€…æ”¶åˆ°æ¶ˆæ¯è¿›è¡Œå¤„ç†</p><p>ä¿è¯æ¶ˆæ¯çš„å¯é æ€§éœ€è¦ä¿è¯ä»¥ä¸Šè¿‡ç¨‹çš„å¯é æ€§ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ RabbitMQ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹é¢ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ã€‚</p><p>1ã€ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</p><p>å‘é€æ¶ˆæ¯å‰ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡å°†æ¶ˆæ¯ä¿è¯åˆ°æ•°æ®åº“è¡¨ä¸­</p><p>æˆåŠŸå‘é€åˆ°äº¤æ¢æœºå°†æ¶ˆæ¯ä»æ•°æ®åº“ä¸­åˆ é™¤</p><p>2ã€mq æŒä¹…åŒ–</p><p>mq æ”¶åˆ°æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–ï¼Œå½“ mq é‡å¯å³ä½¿æ¶ˆæ¯æ²¡æœ‰æ¶ˆè´¹å®Œä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p><p>éœ€è¦é…ç½®äº¤æ¢æœºæŒä¹…åŒ–ã€é˜Ÿåˆ—æŒä¹…åŒ–ã€å‘é€æ¶ˆæ¯æ—¶è®¾ç½®æŒä¹…åŒ–ã€‚</p><p>3ã€æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</p><p>æ¶ˆè´¹è€…æ¶ˆè´¹æˆåŠŸè‡ªåŠ¨å‘é€ ackï¼Œå¦åˆ™é‡è¯•æ¶ˆè´¹ã€‚</p><h3 id="_4-3-å‘é€æ”¯ä»˜ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_4-3-å‘é€æ”¯ä»˜ç»“æœ" aria-hidden="true">#</a> <strong>4.3 å‘é€æ”¯ä»˜ç»“æœ</strong></h3><h4 id="_4-3-1-è®¢å•æœåŠ¡é›†æˆ-mq" tabindex="-1"><a class="header-anchor" href="#_4-3-1-è®¢å•æœåŠ¡é›†æˆ-mq" aria-hidden="true">#</a> <strong>4.3.1 è®¢å•æœåŠ¡é›†æˆ MQ</strong></h4><p>è®¢å•æœåŠ¡é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†æ”¯ä»˜ç»“æœå‘ç»™å­¦ä¹ ä¸­å¿ƒæœåŠ¡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—é‡‡ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚</p><p>1ã€è®¢å•æœåŠ¡åˆ›å»ºæ”¯ä»˜ç»“æœé€šçŸ¥äº¤æ¢æœºã€‚</p><p>2ã€å­¦ä¹ ä¸­å¿ƒæœåŠ¡ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºã€‚</p><p>é¡¹ç›®ä½¿ç”¨ RabbitMQ ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåœ¨è¯¾å‰ä¸‹å‘çš„è™šæ‹Ÿä¸Šå·²ç»å®‰è£…äº† RabbitMQ.</p><p>æ‰§è¡Œ docker start rabbitmq å¯åŠ¨ RabbitMQã€‚è®¿é—®ï¼šhttp://192.168.101.65:15672/</p><p>è´¦æˆ·å¯†ç ï¼šguest/guest</p><p>äº¤æ¢æœºä¸º Fanout å¹¿æ’­æ¨¡å¼ã€‚</p><p>é¦–å…ˆéœ€è¦åœ¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡å’Œè®¢å•æœåŠ¡å·¥ç¨‹é…ç½®è¿æ¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>1ã€é¦–å…ˆåœ¨è®¢å•æœåŠ¡æ·»åŠ æ¶ˆæ¯é˜Ÿåˆ—ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€åœ¨ nacos é…ç½® rabbitmq-dev.yaml ä¸ºé€šç”¨é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.101.65
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> correlated <span class="token comment">#correlated å¼‚æ­¥å›è°ƒï¼Œå®šä¹‰ConfirmCallbackï¼ŒMQè¿”å›ç»“æœæ—¶ä¼šå›è°ƒè¿™ä¸ªConfirmCallback</span>
    <span class="token key atrule">publisher-returns</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#å¼€å¯publish-returnåŠŸèƒ½ï¼ŒåŒæ ·æ˜¯åŸºäºcallbackæœºåˆ¶ï¼Œéœ€è¦å®šä¹‰ReturnCallback</span>
    <span class="token key atrule">template</span><span class="token punctuation">:</span>
      <span class="token key atrule">mandatory</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#å®šä¹‰æ¶ˆæ¯è·¯ç”±å¤±è´¥æ—¶çš„ç­–ç•¥ã€‚trueï¼Œåˆ™è°ƒç”¨ReturnCallbackï¼›falseï¼šåˆ™ç›´æ¥ä¸¢å¼ƒæ¶ˆæ¯</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefetch</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment">#æ¯æ¬¡åªèƒ½è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span>
        <span class="token key atrule">acknowledge-mode</span><span class="token punctuation">:</span> auto <span class="token comment">#auto:å‡ºç°å¼‚å¸¸æ—¶è¿”å›unackï¼Œæ¶ˆæ¯å›æ»šåˆ°mqï¼›æ²¡æœ‰å¼‚å¸¸ï¼Œè¿”å›ack ,manual:æ‰‹åŠ¨æ§åˆ¶,none:ä¸¢å¼ƒæ¶ˆæ¯ï¼Œä¸å›æ»šåˆ°mq</span>
        <span class="token key atrule">retry</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•</span>
          <span class="token key atrule">initial-interval</span><span class="token punctuation">:</span> 5000ms <span class="token comment">#åˆè¯†çš„å¤±è´¥ç­‰å¾…æ—¶é•¿ä¸º1ç§’</span>
          <span class="token key atrule">multiplier</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment">#å¤±è´¥çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = multiplier * last-interval</span>
          <span class="token key atrule">max-attempts</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment">#æœ€å¤§é‡è¯•æ¬¡æ•°</span>
          <span class="token key atrule">stateless</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#trueæ— çŠ¶æ€ï¼›falseæœ‰çŠ¶æ€ã€‚å¦‚æœä¸šåŠ¡ä¸­åŒ…å«äº‹åŠ¡ï¼Œè¿™é‡Œæ”¹ä¸ºfalse</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€åœ¨è®¢å•æœåŠ¡æ¥å£å·¥ç¨‹å¼•å…¥ rabbitmq-dev.yaml é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">shared-configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
    <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€æ‹·è´èµ„æ–™ä¸­ MQ é…ç½®ç±»åˆ°è®¢å•æœåŠ¡çš„ service å·¥ç¨‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>orders<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MqMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MqMessageService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeansException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContextAware</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2023/2/23 16:59
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayNotifyConfig</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">{</span>

    <span class="token comment">//äº¤æ¢æœº</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span> <span class="token operator">=</span> <span class="token string">&quot;paynotify_exchange_fanout&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ”¯ä»˜ç»“æœé€šçŸ¥æ¶ˆæ¯ç±»å‹</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MESSAGE_TYPE</span> <span class="token operator">=</span> <span class="token string">&quot;payresult_notify&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ”¯ä»˜é€šçŸ¥é˜Ÿåˆ—</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PAYNOTIFY_QUEUE</span> <span class="token operator">=</span> <span class="token string">&quot;paynotify_queue&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//å£°æ˜äº¤æ¢æœºï¼Œä¸”æŒä¹…åŒ–</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">FanoutExchange</span> <span class="token function">paynotify_exchange_fanout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ã€æ˜¯å¦æŒä¹…åŒ–ã€å½“æ²¡æœ‰queueä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanoutExchange</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ”¯ä»˜é€šçŸ¥é˜Ÿåˆ—,ä¸”æŒä¹…åŒ–</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_QUEUE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">course_publish_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_QUEUE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//äº¤æ¢æœºå’Œæ”¯ä»˜é€šçŸ¥é˜Ÿåˆ—ç»‘å®š</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binding_course_publish_queue</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_QUEUE</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span><span class="token punctuation">)</span> <span class="token class-name">FanoutExchange</span> exchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–RabbitTemplate</span>
        <span class="token class-name">RabbitTemplate</span> rabbitTemplate <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ¶ˆæ¯å¤„ç†service</span>
        <span class="token class-name">MqMessageService</span> mqMessageService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">MqMessageService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®ReturnCallback</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> replyCode<span class="token punctuation">,</span> replyText<span class="token punctuation">,</span> exchange<span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŠ•é€’å¤±è´¥ï¼Œè®°å½•æ—¥å¿—</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œåº”ç­”ç {}ï¼ŒåŸå› {}ï¼Œäº¤æ¢æœº{}ï¼Œè·¯ç”±é”®{},æ¶ˆæ¯{}&quot;</span><span class="token punctuation">,</span>
                    replyCode<span class="token punctuation">,</span> replyText<span class="token punctuation">,</span> exchange<span class="token punctuation">,</span> routingKey<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MqMessage</span> mqMessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MqMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å°†æ¶ˆæ¯å†æ·»åŠ åˆ°æ¶ˆæ¯è¡¨</span>
            mqMessageService<span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span>mqMessage<span class="token punctuation">.</span><span class="token function">getMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>mqMessage<span class="token punctuation">.</span><span class="token function">getBusinessKey1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>mqMessage<span class="token punctuation">.</span><span class="token function">getBusinessKey2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>mqMessage<span class="token punctuation">.</span><span class="token function">getBusinessKey3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯è®¢å•æœåŠ¡ï¼Œç™»å½• rabbitmqï¼ŒæŸ¥çœ‹äº¤æ¢æœºè‡ªåŠ¨åˆ›å»ºæˆåŠŸ</p><p><img src="/MyBlog/assets/image-20230611161913619-88fe79cc.png" alt="image-20230611161913619"></p><p>æŸ¥çœ‹é˜Ÿåˆ—è‡ªåŠ¨æˆåŠŸ</p><p><img src="/MyBlog/assets/image-20230611161916603-45eb2803.png" alt="image-20230611161916603"></p><h4 id="_4-3-2-å‘é€æ”¯ä»˜ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_4-3-2-å‘é€æ”¯ä»˜ç»“æœ" aria-hidden="true">#</a> <strong>4.3.2 å‘é€æ”¯ä»˜ç»“æœ</strong></h4><p>åœ¨ OrderService ä¸­å®šä¹‰æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * å‘é€é€šçŸ¥ç»“æœ
 * <span class="token keyword">@param</span> <span class="token parameter">message</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyPayResult</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–å†™æ¥å£å®ç°æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyPayResult</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//1ã€æ¶ˆæ¯ä½“ï¼Œè½¬json</span>
    <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®¾ç½®æ¶ˆæ¯æŒä¹…åŒ–</span>
    <span class="token class-name">Message</span> msgObj <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withBody</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setDeliveryMode</span><span class="token punctuation">(</span><span class="token class-name">MessageDeliveryMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.å…¨å±€å”¯ä¸€çš„æ¶ˆæ¯IDï¼Œéœ€è¦å°è£…åˆ°CorrelationDataä¸­</span>
    <span class="token class-name">CorrelationData</span> correlationData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.æ·»åŠ callback</span>
    correlationData<span class="token punctuation">.</span><span class="token function">getFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>
            result <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// 3.1.ackï¼Œæ¶ˆæ¯æˆåŠŸ</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;é€šçŸ¥æ”¯ä»˜ç»“æœæ¶ˆæ¯å‘é€æˆåŠŸ, ID:{}&quot;</span><span class="token punctuation">,</span> correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//åˆ é™¤æ¶ˆæ¯è¡¨ä¸­çš„è®°å½•</span>
                    mqMessageService<span class="token punctuation">.</span><span class="token function">completed</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token comment">// 3.2.nackï¼Œæ¶ˆæ¯å¤±è´¥</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;é€šçŸ¥æ”¯ä»˜ç»“æœæ¶ˆæ¯å‘é€å¤±è´¥, ID:{}, åŸå› {}&quot;</span><span class="token punctuation">,</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            ex <span class="token operator">-&gt;</span> log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€å¼‚å¸¸, ID:{}, åŸå› {}&quot;</span><span class="token punctuation">,</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å‘é€æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token class-name">PayNotifyConfig</span><span class="token punctuation">.</span><span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> msgObj<span class="token punctuation">,</span>correlationData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¢å•æœåŠ¡æ”¶åˆ°ç¬¬ä¸‰æ–¹å¹³å°çš„æ”¯ä»˜ç»“æœæ—¶ï¼Œåœ¨ saveAliPayStatus æ–¹æ³•ä¸­æ·»åŠ ä»£ç ï¼Œå‘æ•°æ®åº“æ¶ˆæ¯è¡¨æ·»åŠ æ¶ˆæ¯å¹¶è¿›è¡Œå‘é€æ¶ˆæ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAliPayStatus</span><span class="token punctuation">(</span><span class="token class-name">PayStatusDto</span> payStatusDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">//ä¿å­˜æ¶ˆæ¯è®°å½•,å‚æ•°1ï¼šæ”¯ä»˜ç»“æœé€šçŸ¥ç±»å‹ï¼Œ2: ä¸šåŠ¡idï¼Œ3:ä¸šåŠ¡ç±»å‹</span>
        <span class="token class-name">MqMessage</span> mqMessage <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span><span class="token string">&quot;payresult_notify&quot;</span><span class="token punctuation">,</span> orders<span class="token punctuation">.</span><span class="token function">getOutBusinessId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orders<span class="token punctuation">.</span><span class="token function">getOrderType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é€šçŸ¥æ¶ˆæ¯</span>
        <span class="token function">notifyPayResult</span><span class="token punctuation">(</span>mqMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-æ¥æ”¶æ”¯ä»˜ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_4-4-æ¥æ”¶æ”¯ä»˜ç»“æœ" aria-hidden="true">#</a> <strong>4.4 æ¥æ”¶æ”¯ä»˜ç»“æœ</strong></h3><h4 id="_4-4-1-å­¦ä¹ ä¸­å¿ƒæœåŠ¡é›†æˆ-mq" tabindex="-1"><a class="header-anchor" href="#_4-4-1-å­¦ä¹ ä¸­å¿ƒæœåŠ¡é›†æˆ-mq" aria-hidden="true">#</a> <strong>4.4.1 å­¦ä¹ ä¸­å¿ƒæœåŠ¡é›†æˆ MQ</strong></h4><p>1ã€åœ¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ·»åŠ æ¶ˆæ¯é˜Ÿåˆ—ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€åœ¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ¥å£å·¥ç¨‹å¼•å…¥ rabbitmq-dev.yaml é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">shared-configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
    <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€æ·»åŠ é…ç½®ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MqMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MqMessageService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeansException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContextAware</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2023/2/23 16:59
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayNotifyConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">//äº¤æ¢æœº</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span> <span class="token operator">=</span> <span class="token string">&quot;paynotify_exchange_fanout&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ”¯ä»˜ç»“æœé€šçŸ¥æ¶ˆæ¯ç±»å‹</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MESSAGE_TYPE</span> <span class="token operator">=</span> <span class="token string">&quot;payresult_notify&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ”¯ä»˜é€šçŸ¥é˜Ÿåˆ—</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PAYNOTIFY_QUEUE</span> <span class="token operator">=</span> <span class="token string">&quot;paynotify_queue&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//å£°æ˜äº¤æ¢æœºï¼Œä¸”æŒä¹…åŒ–</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">FanoutExchange</span> <span class="token function">paynotify_exchange_fanout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ã€æ˜¯å¦æŒä¹…åŒ–ã€å½“æ²¡æœ‰queueä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanoutExchange</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ”¯ä»˜é€šçŸ¥é˜Ÿåˆ—,ä¸”æŒä¹…åŒ–</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_QUEUE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">course_publish_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_QUEUE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//äº¤æ¢æœºå’Œæ”¯ä»˜é€šçŸ¥é˜Ÿåˆ—ç»‘å®š</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binding_course_publish_queue</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_QUEUE</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token constant">PAYNOTIFY_EXCHANGE_FANOUT</span><span class="token punctuation">)</span> <span class="token class-name">FanoutExchange</span> exchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-2-æ¥æ”¶æ”¯ä»˜ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_4-4-2-æ¥æ”¶æ”¯ä»˜ç»“æœ" aria-hidden="true">#</a> <strong>4.4.2 æ¥æ”¶æ”¯ä»˜ç»“æœ</strong></h4><p>ç›‘å¬ MQï¼Œæ¥æ”¶æ”¯ä»˜ç»“æœï¼Œå®šä¹‰ ReceivePayNotifyService ç±»å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">XueChengPlusException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">PayNotifyConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MyCourseTablesService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MqMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MqMessageService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> æ¥æ”¶æ”¯ä»˜ç»“æœ
 * <span class="token keyword">@date</span> 2023/2/23 19:04
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceivePayNotifyService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MqMessageService</span> mqMessageService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MyCourseTablesService</span> myCourseTablesService<span class="token punctuation">;</span>


    <span class="token comment">//ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token class-name">PayNotifyConfig</span><span class="token punctuation">.</span><span class="token constant">PAYNOTIFY_QUEUE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//è·å–æ¶ˆæ¯</span>
        <span class="token class-name">MqMessage</span> mqMessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MqMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ¥æ”¶æ”¯ä»˜ç»“æœ:{}&quot;</span><span class="token punctuation">,</span> mqMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¶ˆæ¯ç±»å‹</span>
        <span class="token class-name">String</span> messageType <span class="token operator">=</span> mqMessage<span class="token punctuation">.</span><span class="token function">getMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¢å•ç±»å‹,60201è¡¨ç¤ºè´­ä¹°è¯¾ç¨‹</span>
        <span class="token class-name">String</span> businessKey2 <span class="token operator">=</span> mqMessage<span class="token punctuation">.</span><span class="token function">getBusinessKey2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¿™é‡Œåªå¤„ç†æ”¯ä»˜ç»“æœé€šçŸ¥</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">PayNotifyConfig</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_TYPE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>messageType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;60201&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>businessKey2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//é€‰è¯¾è®°å½•id</span>
            <span class="token class-name">String</span> choosecourseId <span class="token operator">=</span> mqMessage<span class="token punctuation">.</span><span class="token function">getBusinessKey1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ·»åŠ é€‰è¯¾</span>
            <span class="token keyword">boolean</span> b <span class="token operator">=</span> myCourseTablesService<span class="token punctuation">.</span><span class="token function">saveChooseCourseSuccess</span><span class="token punctuation">(</span>choosecourseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//æ·»åŠ é€‰è¯¾å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæ¶ˆæ¯é‡å›é˜Ÿåˆ—</span>
                <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æ”¯ä»˜ç»“æœï¼Œæ·»åŠ é€‰è¯¾å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ MyCourseTablesService ä¸­å®šä¹‰ä¿å­˜é€‰è¯¾æˆåŠŸçš„æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">saveChooseCourseSuccess</span><span class="token punctuation">(</span><span class="token class-name">String</span> chooseCourseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–å†™æ¥å£å®ç°æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">saveChooseCourseSuccess</span><span class="token punctuation">(</span><span class="token class-name">String</span> chooseCourseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//æ ¹æ®choosecourseIdæŸ¥è¯¢é€‰è¯¾è®°å½•</span>
    <span class="token class-name">XcChooseCourse</span> xcChooseCourse <span class="token operator">=</span> chooseCourseMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>chooseCourseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xcChooseCourse <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æ”¯ä»˜ç»“æœé€šçŸ¥æ²¡æœ‰æŸ¥è¯¢åˆ°å…³è”çš„é€‰è¯¾è®°å½•,choosecourseId:{}&quot;</span><span class="token punctuation">,</span>chooseCourseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> status <span class="token operator">=</span> xcChooseCourse<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;701001&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//æ·»åŠ åˆ°è¯¾ç¨‹è¡¨</span>
        <span class="token function">addCourseTabls</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¾…æ”¯ä»˜çŠ¶æ€æ‰å¤„ç†</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;701002&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ›´æ–°ä¸ºé€‰è¯¾æˆåŠŸ</span>
        xcChooseCourse<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;701001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> update <span class="token operator">=</span> chooseCourseMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>update<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æ”¯ä»˜ç»“æœé€šçŸ¥å¤„ç†æˆåŠŸ,é€‰è¯¾è®°å½•:{}&quot;</span><span class="token punctuation">,</span>xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ·»åŠ åˆ°è¯¾ç¨‹è¡¨</span>
            <span class="token function">addCourseTabls</span><span class="token punctuation">(</span>xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æ”¯ä»˜ç»“æœé€šçŸ¥å¤„ç†å¤±è´¥,é€‰è¯¾è®°å½•:{}&quot;</span><span class="token punctuation">,</span>xcChooseCourse<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-é€šçŸ¥æ”¯ä»˜ç»“æœæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-5-é€šçŸ¥æ”¯ä»˜ç»“æœæµ‹è¯•" aria-hidden="true">#</a> <strong>4.5 é€šçŸ¥æ”¯ä»˜ç»“æœæµ‹è¯•</strong></h3><p>æµ‹è¯•å‡†å¤‡ï¼š</p><p>1ã€æ‰¾ä¸€é—¨å·²å‘å¸ƒçš„æ”¶è´¹è¯¾ç¨‹ã€‚</p><p>2ã€å¦‚æœåœ¨æˆ‘çš„è¯¾ç¨‹è¡¨å­˜å‚¨åˆ™åˆ é™¤ã€‚</p><p>3ã€åˆ é™¤æ­¤è¯¾ç¨‹çš„é€‰è¯¾è®°å½•åŠè®¢å•ä¿¡æ¯ã€‚</p><p>æµ‹è¯•æµç¨‹ï¼š</p><p>1ã€è¿›å…¥è¯¾ç¨‹è¯¦ç»†é¡µé¢ï¼Œç‚¹å‡»é©¬ä¸Šå­¦ä¹ ï¼Œç”ŸæˆäºŒç»´ç è¿›è¡Œæ”¯ä»˜ã€‚</p><p>2ã€æ”¯ä»˜å®Œæˆç‚¹å‡»â€œæ”¯ä»˜å®Œæˆâ€ï¼Œè§‚å¯Ÿè®¢å•æœåŠ¡æ§åˆ¶å°æ˜¯å¦å‘é€æ¶ˆæ¯ã€‚</p><p>3ã€è§‚å¯Ÿå­¦ä¹ ä¸­å¿ƒæœåŠ¡æ§åˆ¶å°æ˜¯å¦æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</p><p>4ã€è§‚å¯Ÿæ•°æ®åº“ä¸­çš„æ¶ˆæ¯è¡¨çš„ç›¸åº”è®°å½•æ˜¯å¦å·²åˆ é™¤ã€‚</p><p>æ¶ˆè´¹é‡è¯•æµ‹è¯•ï¼š</p><p>1ã€åœ¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ¥æ”¶æ”¯ä»˜ç»“æœæ–¹æ³•ä¸­åˆ¶é€ å¼‚å¸¸ã€‚</p><p>2ã€é‡æ–°æ‰§è¡Œä¸Šè¾¹çš„æµ‹è¯•æµç¨‹ï¼Œè§‚å¯Ÿæ˜¯å¦æ¶ˆè´¹é‡è¯•ã€‚</p><h2 id="_4-åœ¨çº¿å­¦ä¹ " tabindex="-1"><a class="header-anchor" href="#_4-åœ¨çº¿å­¦ä¹ " aria-hidden="true">#</a> <strong>4 åœ¨çº¿å­¦ä¹ </strong></h2><h3 id="_4-1-éœ€æ±‚åˆ†æ-1" tabindex="-1"><a class="header-anchor" href="#_4-1-éœ€æ±‚åˆ†æ-1" aria-hidden="true">#</a> <strong>4.1 éœ€æ±‚åˆ†æ</strong></h3><p>ç”¨æˆ·é€šè¿‡è¯¾ç¨‹è¯¦æƒ…ç•Œé¢ç‚¹å‡»é©¬ä¸Šå­¦ä¹  è¿›å…¥ è§†é¢‘æ’æ”¾ç•Œé¢è¿›è¡Œè§†é¢‘ç‚¹æ’­ã€‚</p><p>è·å–è§†é¢‘èµ„æºæ—¶è¿›è¡Œå­¦ä¹ èµ„æ ¼æ ¡éªŒï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230611154911811-aa2effc8.png" alt="image-20230611162129552"></p><p>æ‹¥æœ‰å­¦ä¹ èµ„æ ¼åˆ™ç»§ç»­æ’­æ”¾è§†é¢‘ï¼Œä¸å…·æœ‰å­¦ä¹ èµ„æ ¼åˆ™å¼•å¯¼å»è´­ä¹°ã€ç»­æœŸç­‰æ“ä½œã€‚</p><blockquote><p>å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ‹¥æœ‰å­¦ä¹ èµ„æ ¼ï¼Ÿ</p></blockquote><p>é¦–å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºè¯•å­¦è§†é¢‘ï¼Œå¦‚æœä¸ºè¯•å­¦è§†é¢‘åˆ™å¯ä»¥æ­£å¸¸å­¦ä¹ ã€‚</p><p>å¦‚æœä¸ºéè¯•å­¦è¯¾ç¨‹é¦–å…ˆåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¦‚æœå·²ç™»å½•åˆ™åˆ¤æ–­æ˜¯å¦é€‰è¯¾ï¼Œå¦‚æœå·²ç»é€‰è¯¾ä¸”æ²¡æœ‰è¿‡æœŸå¯ä»¥æ­£å¸¸å­¦ä¹ ã€‚</p><p>è¯¦ç»†æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230611162136288-435a8ec0.png" alt="image-20230611162136288"></p><h3 id="_4-2-æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_4-2-æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯" aria-hidden="true">#</a> <strong>4.2 æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</strong></h3><p>åœ¨è§†é¢‘ç‚¹æ’­é¡µé¢éœ€è¦æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯ï¼Œè¯¾ç¨‹ä¸Šçº¿åä¹Ÿéœ€è¦è®¿é—®/api/content/course/whole/{courseId}</p><p>è¯¾ç¨‹é¢„è§ˆæ—¶è¯·æ±‚è·å–è¯¾ç¨‹çš„æ¥å£ä¸ºï¼š/open/content/course/whole/{courseId}</p><p>åœ¨ nginx ä¸­è¿›è¡Œé…ç½®ï¼š</p><p>/openã€/api åœ¨ nginx çš„é…ç½®å¦‚ä¸‹ï¼š<code>(å·²ç»é…ç½®çš„ä¸è¦é‡å¤é…ç½®)</code></p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>
        #api
        location /api/ <span class="token punctuation">{</span>
                proxy_pass http://gatewayserver/;
        <span class="token punctuation">}</span>
        #openapi
        location /open/content/ <span class="token punctuation">{</span>
                proxy_pass http://gatewayserver/content/open/;
        <span class="token punctuation">}</span>
        location /open/media/ <span class="token punctuation">{</span>
                proxy_pass http://gatewayserver/media/open/;
        <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è¾¹å®ç°/api/content/course/whole/{courseId} è·å–è¯¾ç¨‹å‘å¸ƒä¿¡æ¯æ¥å£ã€‚</p><p>è¿›å…¥å†…å®¹ç®¡ç†æœåŠ¡ api å·¥ç¨‹ CoursePublishController ç±»ï¼Œå®šä¹‰æŸ¥è¯¢è¯¾ç¨‹é¢„è§ˆä¿¡æ¯æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–è¯¾ç¨‹å‘å¸ƒä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/course/whole/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CoursePreviewDto</span> <span class="token function">getCoursePublish</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æŸ¥è¯¢è¯¾ç¨‹å‘å¸ƒä¿¡æ¯</span>
    <span class="token class-name">CoursePublish</span> coursePublish <span class="token operator">=</span> coursePublishService<span class="token punctuation">.</span><span class="token function">getCoursePublish</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>coursePublish <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CoursePreviewDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

    <span class="token comment">//è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span>
    <span class="token class-name">CourseBaseInfoDto</span> courseBase <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CourseBaseInfoDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>coursePublish<span class="token punctuation">,</span> courseBase<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è¯¾ç¨‹è®¡åˆ’</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TeachplanDto</span><span class="token punctuation">&gt;</span></span> teachplans <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>coursePublish<span class="token punctuation">.</span><span class="token function">getTeachplan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TeachplanDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CoursePreviewDto</span> coursePreviewInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoursePreviewDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    coursePreviewInfo<span class="token punctuation">.</span><span class="token function">setCourseBase</span><span class="token punctuation">(</span>courseBase<span class="token punctuation">)</span><span class="token punctuation">;</span>
    coursePreviewInfo<span class="token punctuation">.</span><span class="token function">setTeachplans</span><span class="token punctuation">(</span>teachplans<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> coursePreviewInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯å†…å®¹ç®¡ç†æœåŠ¡ï¼Œè¿›å…¥å­¦ä¹ ç•Œé¢æŸ¥çœ‹è¯¾ç¨‹è®¡åˆ’ã€è¯¾ç¨‹åç§°ç­‰ä¿¡æ¯æ˜¯å¦æ˜¾ç¤ºæ­£å¸¸ã€‚</p><h3 id="_4-3-è·å–è§†é¢‘" tabindex="-1"><a class="header-anchor" href="#_4-3-è·å–è§†é¢‘" aria-hidden="true">#</a> <strong>4.3 è·å–è§†é¢‘</strong></h3><h4 id="_4-3-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-3-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>4.3.1 éœ€æ±‚åˆ†æ</strong></h4><p><img src="/MyBlog/assets/image-20230611162226958-8db90c9a.png" alt="image-20230611162226958"></p><h4 id="_4-3-2-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_4-3-2-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>4.3.2 æ¥å£å®šä¹‰</strong></h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>execption<span class="token punctuation">.</span></span><span class="token class-name">XueChengPlusException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">RestResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">XcChooseCourseDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">XcCourseTablesDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">LearningService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MyCourseTablesService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">SecurityUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> å­¦ä¹ è¿‡ç¨‹ç®¡ç†æ¥å£
 * <span class="token keyword">@date</span> 2022/10/2 14:52
 */</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;å­¦ä¹ è¿‡ç¨‹ç®¡ç†æ¥å£&quot;</span><span class="token punctuation">,</span> tags <span class="token operator">=</span> <span class="token string">&quot;å­¦ä¹ è¿‡ç¨‹ç®¡ç†æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLearningController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">LearningService</span> learningService<span class="token punctuation">;</span>


  <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–è§†é¢‘&quot;</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/open/learn/getvideo/{courseId}/{teachplanId}/{mediaId}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getvideo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">,</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;teachplanId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> teachplanId<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;mediaId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> mediaId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//ç™»å½•ç”¨æˆ·</span>
        <span class="token class-name">XcUser</span> user <span class="token operator">=</span> <span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            userId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//è·å–è§†é¢‘</span>


    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ service æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">RestResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">XcChooseCourseDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">XcCourseTablesDto</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> å­¦ä¹ è¿‡ç¨‹ç®¡ç†serviceæ¥å£
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/2 16:07
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LearningService</span> <span class="token punctuation">{</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è·å–æ•™å­¦è§†é¢‘
 * <span class="token keyword">@param</span> <span class="token parameter">courseId</span> è¯¾ç¨‹id
 * <span class="token keyword">@param</span> <span class="token parameter">teachplanId</span> è¯¾ç¨‹è®¡åˆ’id
 * <span class="token keyword">@param</span> <span class="token parameter">mediaId</span> è§†é¢‘æ–‡ä»¶id
 * <span class="token keyword">@return</span> com.xuecheng.base.model.RestResponse<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.lang.String</span><span class="token punctuation">&gt;</span></span>
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/5 9:08
*/</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getVideo</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span><span class="token class-name">Long</span> courseId<span class="token punctuation">,</span><span class="token class-name">Long</span> teachplanId<span class="token punctuation">,</span><span class="token class-name">String</span> mediaId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-3-è·å–è§†é¢‘è¿œç¨‹æ¥å£" tabindex="-1"><a class="header-anchor" href="#_4-3-3-è·å–è§†é¢‘è¿œç¨‹æ¥å£" aria-hidden="true">#</a> <strong>4.3.3 è·å–è§†é¢‘è¿œç¨‹æ¥å£</strong></h4><p>åœ¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡ service å·¥ç¨‹ä¸­å®šä¹‰åª’èµ„ç®¡ç† Feignclient</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>feignclient</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">RestResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CoursePublish</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> åª’èµ„ç®¡ç†æœåŠ¡è¿œç¨‹æ¥å£
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/20 20:29
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;media-api&quot;</span><span class="token punctuation">,</span>fallbackFactory <span class="token operator">=</span> <span class="token class-name">MediaServiceClientFallbackFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/media&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MediaServiceClient</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/open/preview/{mediaId}&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPlayUrlByMediaId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;mediaId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> mediaId<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>FeignClient æ¥å£çš„é™çº§ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>learning<span class="token punctuation">.</span>feignclient</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">RestResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CoursePublish</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">feign<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span><span class="token class-name">FallbackFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/10/3 8:03
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediaServiceClientFallbackFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaServiceClient</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">MediaServiceClient</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MediaServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPlayUrlByMediaId</span><span class="token punctuation">(</span><span class="token class-name">String</span> mediaId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¿œç¨‹è°ƒç”¨åª’èµ„ç®¡ç†æœåŠ¡ç†”æ–­å¼‚å¸¸ï¼š{}&quot;</span><span class="token punctuation">,</span>throwable<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-5-å­¦ä¹ èµ„æ ¼æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#_4-3-5-å­¦ä¹ èµ„æ ¼æ ¡éªŒ" aria-hidden="true">#</a> <strong>4.3.5 å­¦ä¹ èµ„æ ¼æ ¡éªŒ</strong></h4><p>ç¼–å†™è·å–è§†é¢‘çš„æ¥å£å®ç°æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getVideo</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">,</span> <span class="token class-name">Long</span> teachplanId<span class="token punctuation">,</span> <span class="token class-name">String</span> mediaId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span>
    <span class="token class-name">CoursePublish</span> coursepublish <span class="token operator">=</span> contentServiceClient<span class="token punctuation">.</span><span class="token function">getCoursepublish</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>coursepublish <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹ä¸å­˜åœ¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//todo:æ˜¯å¦å¯ä»¥è¯•å­¦</span>

    <span class="token comment">//ç”¨æˆ·å·²ç™»å½•</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å–å­¦ä¹ èµ„æ ¼</span>
        <span class="token class-name">XcCourseTablesDto</span> learningStatus <span class="token operator">=</span> myCourseTablesService<span class="token punctuation">.</span><span class="token function">getLearningStatus</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å­¦ä¹ èµ„æ ¼ï¼Œ[{&quot;code&quot;:&quot;702001&quot;,&quot;desc&quot;:&quot;æ­£å¸¸å­¦ä¹ &quot;},{&quot;code&quot;:&quot;702002&quot;,&quot;desc&quot;:&quot;æ²¡æœ‰é€‰è¯¾æˆ–é€‰è¯¾åæ²¡æœ‰æ”¯ä»˜&quot;},{&quot;code&quot;:&quot;702003&quot;,&quot;desc&quot;:&quot;å·²è¿‡æœŸéœ€è¦ç”³è¯·ç»­æœŸæˆ–é‡æ–°æ”¯ä»˜&quot;}]</span>
        <span class="token class-name">String</span> learnStatus <span class="token operator">=</span> learningStatus<span class="token punctuation">.</span><span class="token function">getLearnStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>learnStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;702001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> mediaServiceClient<span class="token punctuation">.</span><span class="token function">getPlayUrlByMediaId</span><span class="token punctuation">(</span>mediaId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>learnStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;702002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token string">&quot;æ— æ³•è§‚çœ‹ï¼Œç”±äºæ²¡æœ‰é€‰è¯¾æˆ–é€‰è¯¾åæ²¡æœ‰æ”¯ä»˜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>learnStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;702003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token string">&quot;æ‚¨çš„é€‰è¯¾å·²è¿‡æœŸéœ€è¦ç”³è¯·ç»­æœŸæˆ–é‡æ–°æ”¯ä»˜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æœªç™»å½•æˆ–æœªé€‰è¯¾åˆ¤æ–­æ˜¯å¦æ”¶è´¹</span>
    <span class="token class-name">String</span> charge <span class="token operator">=</span> coursepublish<span class="token punctuation">.</span><span class="token function">getCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>charge<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;201000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å…è´¹å¯ä»¥æ­£å¸¸å­¦ä¹ </span>
        <span class="token keyword">return</span> mediaServiceClient<span class="token punctuation">.</span><span class="token function">getPlayUrlByMediaId</span><span class="token punctuation">(</span>mediaId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">validfail</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è´­ä¹°è¯¾ç¨‹åç»§ç»­å­¦ä¹ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-6-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-3-6-æµ‹è¯•" aria-hidden="true">#</a> <strong>4.3.6 æµ‹è¯•</strong></h4><p>1ã€å®Œå–„æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–è§†é¢‘&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/open/learn/getvideo/{courseId}/{teachplanId}/{mediaId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getvideo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> teachplanId<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;mediaId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> mediaId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//ç™»å½•ç”¨æˆ·</span>
    <span class="token class-name">SecurityUtil<span class="token punctuation">.</span>XcUser</span> user <span class="token operator">=</span> <span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è·å–è§†é¢‘</span>
    <span class="token keyword">return</span> learningService<span class="token punctuation">.</span><span class="token function">getVideo</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> courseId<span class="token punctuation">,</span> teachplanId<span class="token punctuation">,</span> mediaId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æµ‹è¯•å‡†å¤‡</p><p>é€‰è¯¾æˆåŠŸä¸€é—¨è¯¾ç¨‹ã€‚</p><p>æ²¡æœ‰é€‰è¯¾çš„å…è´¹è¯¾ç¨‹ã€æ”¶è´¹è¯¾ç¨‹å„ä¸€é—¨ï¼Œå…¶ä¸­æ”¶è´¹è¯¾ç¨‹å…·æœ‰è¯•å­¦è¯¾ç¨‹ã€‚</p><p>3ã€æµ‹è¯•é¡¹ç›®</p><p>1ï¼‰é€‰è¯¾æˆåŠŸçš„è¯¾ç¨‹æ˜¯å¦å¯ä»¥æ­£å¸¸è·å–è§†é¢‘</p><p>2ï¼‰å…è´¹è¯¾ç¨‹æ²¡æœ‰é€‰è¯¾æ˜¯å¦å¯ä»¥æ­£å¸¸å­¦ä¹ </p><p>å¯ä¿®æ”¹é€‰è¯¾è®°å½•è¡¨ä¸­çš„è¯¾ç¨‹ id ä¸ºä¸å­˜åœ¨è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•å®Œå†æ¢å¤åŸæ ·ã€‚</p><p>3ï¼‰æ”¶è´¹è¯¾ç¨‹æ²¡æœ‰é€‰è¯¾æ˜¯å¦å¯ä»¥æ­£å¸¸å­¦ä¹ </p><p>å¯ä¿®æ”¹é€‰è¯¾è®°å½•è¡¨ä¸­çš„è¯¾ç¨‹ id ä¸ºä¸å­˜åœ¨è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•å®Œå†æ¢å¤åŸæ ·ã€‚</p><h3 id="_4-4-æˆ‘çš„è¯¾è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-4-æˆ‘çš„è¯¾è¡¨" aria-hidden="true">#</a> <strong>4.4 æˆ‘çš„è¯¾è¡¨</strong></h3><h4 id="_4-4-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-4-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>4.4.1 éœ€æ±‚åˆ†æ</strong></h4><h5 id="_4-4-1-1-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-4-1-1-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>4.4.1.1 ä¸šåŠ¡æµç¨‹</strong></h5><p>ç™»å½•ç½‘ç«™ï¼Œç‚¹å‡»â€œæˆ‘çš„å­¦ä¹ â€è¿›å…¥ä¸ªäººä¸­å¿ƒï¼Œ</p><p><img src="/MyBlog/assets/image-20230611162342280-55dbfbe2.png" alt="image-20230611162342280"></p><p>ä¸ªäººä¸­å¿ƒé¦–é¡µæ˜¾ç¤ºæˆ‘çš„è¯¾ç¨‹è¡¨ï¼š</p><p><img src="/MyBlog/assets/image-20230611162345470-45337528.png" alt="image-20230611162345470"></p><p>æˆ‘çš„è¯¾è¡¨ä¸­æ˜¾ç¤ºäº†é€‰è¯¾æˆåŠŸçš„å…è´¹è¯¾ç¨‹ã€æ”¶è´¹è¯¾ç¨‹ã€‚æœ€è¿‘å­¦ä¹ è¯¾ç¨‹æ˜¾ç¤ºäº†å½“å‰ç”¨æˆ·æœ€è¿‘å­¦ä¹ çš„è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>ç‚¹å‡»ç»§ç»­å­¦ä¹ è¿›å…¥å½“å‰å­¦ä¹ ç« èŠ‚çš„è§†é¢‘ç»§ç»­å­¦ä¹ ã€‚</p><p>ç‚¹å‡»è¯¾ç¨‹è¯„ä»·è¿›å…¥è¯¾ç¨‹è¯„ä»·ç•Œé¢ã€‚</p><h5 id="_4-4-1-2-é…ç½®-nginx" tabindex="-1"><a class="header-anchor" href="#_4-4-1-2-é…ç½®-nginx" aria-hidden="true">#</a> <strong>4.4.1.2 é…ç½® nginx</strong></h5><p>åœ¨ nginx é…ç½®ç”¨æˆ·ä¸­å¿ƒ server ,å¦‚ä¸‹ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>    server <span class="token punctuation">{</span>
        listen       80;
        server_name  ucenter.51xuecheng.cn;
        #charset koi8-r;
        ssi on;
        ssi_silent_errors on;
        #access_log  logs/host.access.log  main;
        location / <span class="token punctuation">{</span>
            alias   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/ucenter/;
            index  index.html index.htm;
        <span class="token punctuation">}</span>
        location /include <span class="token punctuation">{</span>
            proxy_pass   http://127.0.0.1;
        <span class="token punctuation">}</span>
        location /img/ <span class="token punctuation">{</span>
            proxy_pass   http://127.0.0.1/static/img/;
        <span class="token punctuation">}</span>
        location /api/ <span class="token punctuation">{</span>
                proxy_pass http://gatewayserver/;
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-2-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_4-4-2-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>4.4.2 æ¥å£å®šä¹‰</strong></h4><p>åœ¨ MyCourseTablesController ä¸­å®šä¹‰æˆ‘çš„è¯¾ç¨‹è¡¨æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘çš„è¯¾ç¨‹è¡¨&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/mycoursetable&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> <span class="token function">mycoursetable</span><span class="token punctuation">(</span><span class="token class-name">MyCourseTableParams</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-3-æ¥å£å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_4-4-3-æ¥å£å¼€å‘" aria-hidden="true">#</a> <strong>4.4.3 æ¥å£å¼€å‘</strong></h4><h5 id="_4-4-3-1dao" tabindex="-1"><a class="header-anchor" href="#_4-4-3-1dao" aria-hidden="true">#</a> <strong>4.4.3.1DAO</strong></h5><p>ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ mapper å³å¯å®ç°åˆ†é¡µæŸ¥è¯¢ã€‚</p><h5 id="_4-4-3-2-service" tabindex="-1"><a class="header-anchor" href="#_4-4-3-2-service" aria-hidden="true">#</a> <strong>4.4.3.2 Service</strong></h5><p>åœ¨ service ä¸­å®šä¹‰æˆ‘çš„è¯¾ç¨‹è¡¨æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æˆ‘çš„è¯¾ç¨‹è¡¨
 * <span class="token keyword">@param</span> <span class="token parameter">params</span>
 * <span class="token keyword">@return</span> com.xuecheng.base.model.PageResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.xuecheng.learning.model.po.XcCourseTables</span><span class="token punctuation">&gt;</span></span>
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/10/27 9:24
*/</span>
<span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> <span class="token function">mycoursetables</span><span class="token punctuation">(</span><span class="token class-name">MyCourseTableParams</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–å†™æ¥å£å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> <span class="token function">mycoursetables</span><span class="token punctuation">(</span> <span class="token class-name">MyCourseTableParams</span> params<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//é¡µç </span>
    <span class="token keyword">long</span> pageNo <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ¯é¡µè®°å½•æ•°</span>
    <span class="token keyword">long</span> pageSize <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆ†é¡µæ¡ä»¶</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>pageNo<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢</span>
    <span class="token class-name">String</span> userId <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> lambdaQueryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcCourseTables</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//åˆ†é¡µæŸ¥è¯¢</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> pageResult <span class="token operator">=</span> courseTablesMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> lambdaQueryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> pageResult<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®°å½•æ€»æ•°</span>
    <span class="token keyword">long</span> total <span class="token operator">=</span> pageResult<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> courseTablesResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>records<span class="token punctuation">,</span> total<span class="token punctuation">,</span> pageNo<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> courseTablesResult<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œå–„æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘çš„è¯¾ç¨‹è¡¨&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/mycoursetable&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcCourseTables</span><span class="token punctuation">&gt;</span></span> <span class="token function">mycoursetable</span><span class="token punctuation">(</span><span class="token class-name">MyCourseTableParams</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//ç™»å½•ç”¨æˆ·</span>
 <span class="token class-name">SecurityUtil<span class="token punctuation">.</span>XcUser</span> user <span class="token operator">=</span> <span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·ç™»å½•åç»§ç»­é€‰è¯¾&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token class-name">String</span> userId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//è®¾ç½®å½“å‰çš„ç™»å½•ç”¨æˆ·</span>
 params<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> myCourseTablesService<span class="token punctuation">.</span><span class="token function">mycourestabls</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-4-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-4-4-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>4.4.4 æ¥å£æµ‹è¯•</strong></h4><p>ç™»å½•ç½‘ç«™ï¼Œç‚¹å‡»â€œæˆ‘çš„å­¦ä¹ â€è¿›å…¥ä¸ªäººä¸­å¿ƒï¼ŒæŸ¥çœ‹æˆ‘çš„è¯¾ç¨‹è¡¨ä¸­è¯¾ç¨‹æ˜¯å¦æ˜¯å½“å‰ç”¨æˆ·æ‰€é€‰è¯¾ç¨‹ã€‚</p><p><img src="/MyBlog/assets/image-20230611162345470-45337528.png" alt="image-20230611162451588"></p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ZyKunn/edit/main/notes/project/02/ç¬¬6ç« -é€‰è¯¾å­¦ä¹ v3.1/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">è´¡çŒ®è€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 814342838@qq.com">ZyKun</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/" class="" aria-label="ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1"><!--[--><!--]--> ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1 <!--[--><!--]--></a></span><span class="next"><a href="/MyBlog/notes/project/02/%E7%AC%AC7%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2v3.1/" class="" aria-label="ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1"><!--[--><!--]--> ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/MyBlog/assets/app-a153c100.js" defer></script>
  </body>
</html>
