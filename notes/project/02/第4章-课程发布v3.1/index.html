<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.63">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="./img/logo.png"><title>ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1 | ZyKunã®Blog</title><meta name="description" content="">
    <link rel="preload" href="/MyBlog/assets/style-57272a59.css" as="style"><link rel="stylesheet" href="/MyBlog/assets/style-57272a59.css">
    <link rel="modulepreload" href="/MyBlog/assets/app-a153c100.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-e3209a23.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-bca2187b.js"><link rel="prefetch" href="/MyBlog/assets/index.html-ab0151fa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1249ab5a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d02565e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1c68c797.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93acf26d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2bc953d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c526d7c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-636c9f52.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4177c6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7624decc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d0b4a798.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa378d7b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ddd44d65.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbb7f41.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-34576599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1079a374.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-88d4ebe7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5e927142.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a6f13b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c85da23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-69e813d7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545062a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd7a4fcb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-910949e0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-459b0c71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a036060.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f62ffe74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-841a86c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b31c8bb6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85bae056.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73555735.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d5456cd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d2dfbeec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-746091c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9cc627ff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d411448a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4454f425.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57aa84f4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2ce52087.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76657200.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90d9409e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d6ba5e7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-41bc7856.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6140daf4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ea30461d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00114784.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3fa86cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-386f0bd2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b46ac77e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-256a258e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4ebf55b3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7268161e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a8852c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19373782.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4e33bb6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-de5ff178.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd5da14a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dbee5a73.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64025c89.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9bd15ac7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4812edff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1f3f5c2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3f85e131.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1d66d048.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-67b1b38e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-17f10f72.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ad1b5dc8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b14e7669.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa35810b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-acb9b7bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2ba9a88.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-abdb28e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b3cc33e9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ef13eee8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73fa0dcc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6f7449c7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3857ef8d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e5af1d8f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5d14c1f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-94a8b9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3931e4d3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0978879b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-617bd5bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fe008c8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0e33aa95.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00725025.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8e05ec6e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-72ca6b4c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-427c5181.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b3baf42.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-40a790c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9709e7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8eb00d02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c849262.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eda16f63.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81242655.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9f6820.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79188b74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5775eee0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eff0510c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-305de307.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e83a5de7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-761a9548.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c12ae66e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-87a73e5c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d720473a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b960b5b6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bbd98f93.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76195dca.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3bd0cfa7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8c87d147.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bac2e853.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ee6bc34.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ab7381d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5b97f6b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd33ca6f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-684189de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-63731ad7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-895bfca1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d1ff4c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b71bf26f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ce6f983b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c185f9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-29c62d64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-52c91de2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-55aa1c06.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c87ef63a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff1d9f51.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a12aedeb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-298f19f2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f881f599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c32406a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4217479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7edb7ce1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8671126f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da565d04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9deb3ec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee7cf1b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-270d6327.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ec786b75.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e98adf02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7233a0e2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79c193cf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9714081e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5dea51d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a235e4bb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cdce2101.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-389e66df.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-652ee4f6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-025e6f4e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-60711e70.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6edc93de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11bd39b1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53015219.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74dcd8ae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dd727db.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11b329fb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b6f3614.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-70ce719f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f6ca4d92.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a6833de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bf03220c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2edab58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f1e5cf7a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-21d4e18d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5235fca9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dc704c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57630906.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff165209.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6ec253a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9e4f0c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-664b232d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adf015a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4667c0e6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cc407710.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1752d212.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9b5d99c4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-43c48ae2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e8a616b7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93e7405b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-22a72a56.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-42ce3023.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f8eeab22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dd50991a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-af520db8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5ab2bfac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-965bc04f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81ebef01.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79d19f4d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9600bdfb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-560df48d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fb22a4f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd4caa82.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-370323f9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f673ebfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78d88460.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8b54347c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d30f0340.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e26bc4de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7d37b036.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3aa565ce.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c69f238.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76d60030.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7116a5e4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8f649cc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbbb7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90bb86fd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e23936a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19ad952b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-07245162.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-038b3afd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-084fe5c1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-098421fe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7baefce4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fffdfb9c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8c9612c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-05c42fda.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e1615934.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da824146.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa2d32f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545dbea7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3ca58cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b9e2188a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fc5f1f7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ec5c70d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cbf2aa55.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8beb0c08.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee54da9f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd28b91d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-98aa51a1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-03f9381a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9009c5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-71b7cfbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1759170e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa84186f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53160af7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51b685b4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ecb8e229.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9c507901.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6362722.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-faf67dd8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d7f20950.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a088985c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93b7982c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b76e6179.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d976d39c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b16efd78.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1301757e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c3240cbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2ddd21c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74fb5e20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-128f5026.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8fd9f38a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-82e84e23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-007ef014.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3dd860c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-382a2bae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b6beaec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2eb17cfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6f50213.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c8aef39.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-133f4d38.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cffd2be1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a798219d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b5fde77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-13275b71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4b6a02c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f179a12.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f45bc33f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0574e5e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0921816f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-631fbc02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8586017d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c4dbf09b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-967486c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aad17dde.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff644d77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78a4df64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d2180e8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53fbcd20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a3387e5e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-979f5ac4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0938c506.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51707e22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b1e917a0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b56a071.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d15eb498.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b0a97c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fda196b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bcc5faac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-490c208f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dce28479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62825d3c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b5a4af15.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eb40da96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d6d1c61.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-618cf3f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2a35430.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64f564d2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85181f96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f689b28.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62aa623a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b0c39cc5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73b8fff0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5466ae58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fbd0bcfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-5f041a2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/MyBlog/" class=""><!----><span class="site-name can-hide">ZyKunã®Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="router-link-active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="router-link-active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/MyBlog/notes/project/02/" class="router-link-active sidebar-item sidebar-heading active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/MyBlog/notes/project/02/%E7%AC%AC1%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAv3.1/" class="sidebar-item" aria-label="ç¬¬ 1 ç«  é¡¹ç›®ä»‹ç»&amp;ç¯å¢ƒæ­å»º v3.1"><!--[--><!--]--> ç¬¬ 1 ç«  é¡¹ç›®ä»‹ç»&amp;ç¯å¢ƒæ­å»º v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC2%E7%AB%A0-%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="sidebar-item" aria-label="ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="sidebar-item" aria-label="ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1"><!--[--><!--]--> ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-æ¨¡å—éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1 æ¨¡å—éœ€æ±‚åˆ†æ"><!--[--><!--]--> 1 æ¨¡å—éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-1-æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 æ¨¡å—ä»‹ç»"><!--[--><!--]--> 1.1 æ¨¡å—ä»‹ç» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 1.2 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-2-1-è¯¾ç¨‹é¢„è§ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.1 è¯¾ç¨‹é¢„è§ˆ"><!--[--><!--]--> 1.2.1 è¯¾ç¨‹é¢„è§ˆ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-2-2-è¯¾ç¨‹å®¡æ ¸" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.2 è¯¾ç¨‹å®¡æ ¸"><!--[--><!--]--> 1.2.2 è¯¾ç¨‹å®¡æ ¸ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-2-3-è¯¾ç¨‹å‘å¸ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.3 è¯¾ç¨‹å‘å¸ƒ"><!--[--><!--]--> 1.2.3 è¯¾ç¨‹å‘å¸ƒ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-è¯¾ç¨‹é¢„è§ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2 è¯¾ç¨‹é¢„è§ˆ"><!--[--><!--]--> 2 è¯¾ç¨‹é¢„è§ˆ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 2.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-2-æ¨¡æ¿å¼•æ“" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 æ¨¡æ¿å¼•æ“"><!--[--><!--]--> 2.2 æ¨¡æ¿å¼•æ“ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-2-1-ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.1 ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“"><!--[--><!--]--> 2.2.1 ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-2-2-freemarker-å¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2 Freemarker å¿«é€Ÿå…¥é—¨"><!--[--><!--]--> 2.2.2 Freemarker å¿«é€Ÿå…¥é—¨ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-3-æµ‹è¯•é™æ€é¡µé¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 æµ‹è¯•é™æ€é¡µé¢"><!--[--><!--]--> 2.3 æµ‹è¯•é™æ€é¡µé¢ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-3-1-éƒ¨ç½²ç½‘ç«™é—¨æˆ·" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.1 éƒ¨ç½²ç½‘ç«™é—¨æˆ·"><!--[--><!--]--> 2.3.1 éƒ¨ç½²ç½‘ç«™é—¨æˆ· <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-3-2-è¯¾ç¨‹è¯¦æƒ…é¡µé¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.2 è¯¾ç¨‹è¯¦æƒ…é¡µé¢"><!--[--><!--]--> 2.3.2 è¯¾ç¨‹è¯¦æƒ…é¡µé¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-3-3-æ–‡ä»¶æœåŠ¡å™¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.3 æ–‡ä»¶æœåŠ¡å™¨"><!--[--><!--]--> 2.3.3 æ–‡ä»¶æœåŠ¡å™¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-3-4-è§†é¢‘æ’­æ”¾é¡µé¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.4 è§†é¢‘æ’­æ”¾é¡µé¢"><!--[--><!--]--> 2.3.4 è§†é¢‘æ’­æ”¾é¡µé¢ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-4-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 æ¥å£å®šä¹‰"><!--[--><!--]--> 2.4 æ¥å£å®šä¹‰ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-4-1-å®šä¹‰è¯¾ç¨‹é¢„è§ˆæ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.1 å®šä¹‰è¯¾ç¨‹é¢„è§ˆæ¥å£"><!--[--><!--]--> 2.4.1 å®šä¹‰è¯¾ç¨‹é¢„è§ˆæ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-4-2-é…ç½®åå‘ä»£ç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.2 é…ç½®åå‘ä»£ç†"><!--[--><!--]--> 2.4.2 é…ç½®åå‘ä»£ç† <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-5-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5 æ¥å£å¼€å‘"><!--[--><!--]--> 2.5 æ¥å£å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-5-1-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5.1 æ•°æ®æ¨¡å‹"><!--[--><!--]--> 2.5.1 æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-5-2-service-æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5.2 Service æ¥å£"><!--[--><!--]--> 2.5.2 Service æ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-5-3-æ¥å£å±‚å®Œå–„" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5.3 æ¥å£å±‚å®Œå–„"><!--[--><!--]--> 2.5.3 æ¥å£å±‚å®Œå–„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-5-4-å‰åç«¯è”è°ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5.4 å‰åç«¯è”è°ƒ"><!--[--><!--]--> 2.5.4 å‰åç«¯è”è°ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-5-5-ç¼–å†™æ¨¡æ¿" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5.5 ç¼–å†™æ¨¡æ¿"><!--[--><!--]--> 2.5.5 ç¼–å†™æ¨¡æ¿ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-5-6-è§†é¢‘æ’­æ”¾é¡µé¢æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5.6 è§†é¢‘æ’­æ”¾é¡µé¢æ¥å£"><!--[--><!--]--> 2.5.6 è§†é¢‘æ’­æ”¾é¡µé¢æ¥å£ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-è¯¾ç¨‹å®¡æ ¸" class="router-link-active router-link-exact-active sidebar-item" aria-label="3 è¯¾ç¨‹å®¡æ ¸"><!--[--><!--]--> 3 è¯¾ç¨‹å®¡æ ¸ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 3.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-1-1-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.1 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 3.1.1 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-1-2-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1.2 æ•°æ®æ¨¡å‹"><!--[--><!--]--> 3.1.2 æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 æ¥å£å®šä¹‰"><!--[--><!--]--> 3.2 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-3-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 æ¥å£å¼€å‘"><!--[--><!--]--> 3.3 æ¥å£å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-3-1-dao-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.1 Dao å¼€å‘"><!--[--><!--]--> 3.3.1 Dao å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-3-1-service-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.1 Service å¼€å‘"><!--[--><!--]--> 3.3.1 Service å¼€å‘ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-4-æ¥å£å®Œå–„" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4 æ¥å£å®Œå–„"><!--[--><!--]--> 3.4 æ¥å£å®Œå–„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-5-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5 æ¥å£æµ‹è¯•"><!--[--><!--]--> 3.5 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-è¯¾ç¨‹å‘å¸ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4 è¯¾ç¨‹å‘å¸ƒ"><!--[--><!--]--> 4 è¯¾ç¨‹å‘å¸ƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 4.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-1-1-æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.1 æ•°æ®æ¨¡å‹"><!--[--><!--]--> 4.1.1 æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-2-åˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 åˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯æ–¹æ¡ˆ"><!--[--><!--]--> 4.2 åˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯æ–¹æ¡ˆ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-2-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><!--[--><!--]--> 4.2.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-2-2-ä»€ä¹ˆæ˜¯-cap-ç†è®º" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.2 ä»€ä¹ˆæ˜¯ CAP ç†è®º"><!--[--><!--]--> 4.2.2 ä»€ä¹ˆæ˜¯ CAP ç†è®º <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-2-3-åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.3 åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ"><!--[--><!--]--> 4.2.3 åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-2-4-è¯¾ç¨‹å‘å¸ƒçš„äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.4 è¯¾ç¨‹å‘å¸ƒçš„äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ"><!--[--><!--]--> 4.2.4 è¯¾ç¨‹å‘å¸ƒçš„äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-3-è¯¾ç¨‹å‘å¸ƒæ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 è¯¾ç¨‹å‘å¸ƒæ¥å£"><!--[--><!--]--> 4.3 è¯¾ç¨‹å‘å¸ƒæ¥å£ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-3-1-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.1 æ¥å£å®šä¹‰"><!--[--><!--]--> 4.3.1 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-3-3-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.3 æ¥å£å¼€å‘"><!--[--><!--]--> 4.3.3 æ¥å£å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-3-3-1-dao-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.3.1 DAO å¼€å‘"><!--[--><!--]--> 4.3.3.1 DAO å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-3-3-2-service-å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.3.2 Service å¼€å‘"><!--[--><!--]--> 4.3.3.2 Service å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-3-3-3-æ¥å£å®Œå–„" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.3.3 æ¥å£å®Œå–„"><!--[--><!--]--> 4.3.3.3 æ¥å£å®Œå–„ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-3-4-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.4 æ¥å£æµ‹è¯•"><!--[--><!--]--> 4.3.4 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-æ¶ˆæ¯å¤„ç†-sdk" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 æ¶ˆæ¯å¤„ç† SDK"><!--[--><!--]--> 4.4 æ¶ˆæ¯å¤„ç† SDK <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-1-æ¶ˆæ¯æ¨¡å—æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.1 æ¶ˆæ¯æ¨¡å—æŠ€æœ¯æ–¹æ¡ˆ"><!--[--><!--]--> 4.4.1 æ¶ˆæ¯æ¨¡å—æŠ€æœ¯æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-2-æ¶ˆæ¯æ¨¡å—-sdk-æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.2 æ¶ˆæ¯æ¨¡å— SDK æµ‹è¯•"><!--[--><!--]--> 4.4.2 æ¶ˆæ¯æ¨¡å— SDK æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-3-é›†æˆæ¶ˆæ¯-sdk" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3 é›†æˆæ¶ˆæ¯ SDK"><!--[--><!--]--> 4.4.3 é›†æˆæ¶ˆæ¯ SDK <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-3-1-æ·»åŠ æ¶ˆæ¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3.1 æ·»åŠ æ¶ˆæ¯"><!--[--><!--]--> 4.4.3.1 æ·»åŠ æ¶ˆæ¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-3-2-è¯¾ç¨‹å‘å¸ƒä»»åŠ¡å¤„ç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3.2 è¯¾ç¨‹å‘å¸ƒä»»åŠ¡å¤„ç†"><!--[--><!--]--> 4.4.3.2 è¯¾ç¨‹å‘å¸ƒä»»åŠ¡å¤„ç† <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-3-3-å¼€å¯ä»»åŠ¡è°ƒåº¦" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3.3 å¼€å¯ä»»åŠ¡è°ƒåº¦"><!--[--><!--]--> 4.4.3.3 å¼€å¯ä»»åŠ¡è°ƒåº¦ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-3-4-æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4.3.4 æµ‹è¯•"><!--[--><!--]--> 4.4.3.4 æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-é¡µé¢é™æ€åŒ–" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5 é¡µé¢é™æ€åŒ–"><!--[--><!--]--> 4.5 é¡µé¢é™æ€åŒ– <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-1-ä»€ä¹ˆæ˜¯é¡µé¢é™æ€åŒ–" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.1 ä»€ä¹ˆæ˜¯é¡µé¢é™æ€åŒ–"><!--[--><!--]--> 4.5.1 ä»€ä¹ˆæ˜¯é¡µé¢é™æ€åŒ– <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-2-é™æ€åŒ–æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.2 é™æ€åŒ–æµ‹è¯•"><!--[--><!--]--> 4.5.2 é™æ€åŒ–æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-3-ä¸Šä¼ æ–‡ä»¶æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.3 ä¸Šä¼ æ–‡ä»¶æµ‹è¯•"><!--[--><!--]--> 4.5.3 ä¸Šä¼ æ–‡ä»¶æµ‹è¯• <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-3-1-é…ç½®è¿œç¨‹è°ƒç”¨ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.3.1 é…ç½®è¿œç¨‹è°ƒç”¨ç¯å¢ƒ"><!--[--><!--]--> 4.5.3.1 é…ç½®è¿œç¨‹è°ƒç”¨ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-3-2-æ‰©å……ä¸Šä¼ æ–‡ä»¶æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.3.2 æ‰©å……ä¸Šä¼ æ–‡ä»¶æ¥å£"><!--[--><!--]--> 4.5.3.2 æ‰©å……ä¸Šä¼ æ–‡ä»¶æ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-3-3-è¿œç¨‹è°ƒç”¨æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.3.3 è¿œç¨‹è°ƒç”¨æµ‹è¯•"><!--[--><!--]--> 4.5.3.3 è¿œç¨‹è°ƒç”¨æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-4-ç†”æ–­é™çº§å¤„ç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.4 ç†”æ–­é™çº§å¤„ç†"><!--[--><!--]--> 4.5.4 ç†”æ–­é™çº§å¤„ç† <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-4-1-ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.4.1 ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§"><!--[--><!--]--> 4.5.4.1 ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-4-2-ç†”æ–­é™çº§å¤„ç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.4.2 ç†”æ–­é™çº§å¤„ç†"><!--[--><!--]--> 4.5.4.2 ç†”æ–­é™çº§å¤„ç† <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-4-è¯¾ç¨‹é™æ€åŒ–å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.4 è¯¾ç¨‹é™æ€åŒ–å¼€å‘"><!--[--><!--]--> 4.5.4 è¯¾ç¨‹é™æ€åŒ–å¼€å‘ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-4-1-é™æ€åŒ–å®ç°" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.4.1 é™æ€åŒ–å®ç°"><!--[--><!--]--> 4.5.4.1 é™æ€åŒ–å®ç° <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-4-2-æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.4.2 æµ‹è¯•"><!--[--><!--]--> 4.5.4.2 æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-4-3-æµè§ˆè¯¦ç»†é¡µé¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5.4.3 æµè§ˆè¯¦ç»†é¡µé¢"><!--[--><!--]--> 4.5.4.3 æµè§ˆè¯¦ç»†é¡µé¢ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-è¯¾ç¨‹æœç´¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="5 è¯¾ç¨‹æœç´¢"><!--[--><!--]--> 5 è¯¾ç¨‹æœç´¢ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 5.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-1-1-æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1.1 æ¨¡å—ä»‹ç»"><!--[--><!--]--> 5.1.1 æ¨¡å—ä»‹ç» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1.2 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 5.1.2 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-2-å‡†å¤‡ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 å‡†å¤‡ç¯å¢ƒ"><!--[--><!--]--> 5.2 å‡†å¤‡ç¯å¢ƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-2-1-æ­å»º-elasticsearch" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2.1 æ­å»º elasticsearch"><!--[--><!--]--> 5.2.1 æ­å»º elasticsearch <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-2-2-éƒ¨ç½²æœç´¢å·¥ç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2.2 éƒ¨ç½²æœç´¢å·¥ç¨‹"><!--[--><!--]--> 5.2.2 éƒ¨ç½²æœç´¢å·¥ç¨‹ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-ç´¢å¼•ç®¡ç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 ç´¢å¼•ç®¡ç†"><!--[--><!--]--> 5.3 ç´¢å¼•ç®¡ç† <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-1-rest-api" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.1 REST API"><!--[--><!--]--> 5.3.1 REST API <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-1-1-æ·»åŠ æ–‡æ¡£" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.1.1 æ·»åŠ æ–‡æ¡£"><!--[--><!--]--> 5.3.1.1 æ·»åŠ æ–‡æ¡£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-1-2-æŸ¥è¯¢æ–‡æ¡£" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.1.2 æŸ¥è¯¢æ–‡æ¡£"><!--[--><!--]--> 5.3.1.2 æŸ¥è¯¢æ–‡æ¡£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-1-3-æ›´æ–°æ–‡æ¡£" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.1.3 æ›´æ–°æ–‡æ¡£"><!--[--><!--]--> 5.3.1.3 æ›´æ–°æ–‡æ¡£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-1-4-åˆ é™¤æ–‡æ¡£" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.1.4 åˆ é™¤æ–‡æ¡£"><!--[--><!--]--> 5.3.1.4 åˆ é™¤æ–‡æ¡£ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.2 æ¥å£å®šä¹‰"><!--[--><!--]--> 5.3.2 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-3-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.3 æ¥å£å¼€å‘"><!--[--><!--]--> 5.3.3 æ¥å£å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-4-æ¥å£å®Œå–„" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.4 æ¥å£å®Œå–„"><!--[--><!--]--> 5.3.4 æ¥å£å®Œå–„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-5-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3.5 æ¥å£æµ‹è¯•"><!--[--><!--]--> 5.3.5 æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-æœç´¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4 æœç´¢"><!--[--><!--]--> 5.4 æœç´¢ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 5.4.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.2 æ¥å£å®šä¹‰"><!--[--><!--]--> 5.4.2 æ¥å£å®šä¹‰ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-3-åŸºæœ¬åŠŸèƒ½å®ç°" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.3 åŸºæœ¬åŠŸèƒ½å®ç°"><!--[--><!--]--> 5.4.3 åŸºæœ¬åŠŸèƒ½å®ç° <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-4-åŸºæœ¬åŠŸèƒ½æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.4 åŸºæœ¬åŠŸèƒ½æµ‹è¯•"><!--[--><!--]--> 5.4.4 åŸºæœ¬åŠŸèƒ½æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-5-æ ¹æ®æ¡ä»¶æœç´¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.5 æ ¹æ®æ¡ä»¶æœç´¢"><!--[--><!--]--> 5.4.5 æ ¹æ®æ¡ä»¶æœç´¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-6-æ¡ä»¶æœç´¢æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.6 æ¡ä»¶æœç´¢æµ‹è¯•"><!--[--><!--]--> 5.4.6 æ¡ä»¶æœç´¢æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-7-èšåˆæœç´¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.7 èšåˆæœç´¢"><!--[--><!--]--> 5.4.7 èšåˆæœç´¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-8-èšåˆæœç´¢æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.8 èšåˆæœç´¢æµ‹è¯•"><!--[--><!--]--> 5.4.8 èšåˆæœç´¢æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-9-é«˜äº®è®¾ç½®" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.9 é«˜äº®è®¾ç½®"><!--[--><!--]--> 5.4.9 é«˜äº®è®¾ç½® <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-10-é«˜äº®è®¾ç½®æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4.10 é«˜äº®è®¾ç½®æµ‹è¯•"><!--[--><!--]--> 5.4.10 é«˜äº®è®¾ç½®æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-5-è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•åŒæ­¥" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.5 è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•åŒæ­¥"><!--[--><!--]--> 5.5 è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•åŒæ­¥ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-5-1-æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.5.1 æŠ€æœ¯æ–¹æ¡ˆ"><!--[--><!--]--> 5.5.1 æŠ€æœ¯æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-5-2-è¯¾ç¨‹ç´¢å¼•ä»»åŠ¡å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.5.2 è¯¾ç¨‹ç´¢å¼•ä»»åŠ¡å¼€å‘"><!--[--><!--]--> 5.5.2 è¯¾ç¨‹ç´¢å¼•ä»»åŠ¡å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-5-3-æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.5.3 æµ‹è¯•"><!--[--><!--]--> 5.5.3 æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/" class="sidebar-item" aria-label="ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1"><!--[--><!--]--> ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/" class="sidebar-item" aria-label="ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1"><!--[--><!--]--> ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC7%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2v3.1/" class="sidebar-item" aria-label="ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1"><!--[--><!--]--> ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC8%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%963.1/" class="sidebar-item" aria-label="ç¬¬ 8 ç«  é¡¹ç›®ä¼˜åŒ– 3.1"><!--[--><!--]--> ç¬¬ 8 ç«  é¡¹ç›®ä¼˜åŒ– 3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83-%E9%83%A8%E7%BD%B2%E9%97%A8%E6%88%B7%E6%96%87%E6%A1%A3/" class="sidebar-item" aria-label="è¯¾ç¨‹å‘å¸ƒ-éƒ¨ç½²é—¨æˆ·æ–‡æ¡£ v3.1"><!--[--><!--]--> è¯¾ç¨‹å‘å¸ƒ-éƒ¨ç½²é—¨æˆ·æ–‡æ¡£ v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE/" class="sidebar-item" aria-label="å¾®ä¿¡æ‰«ç ç™»å½•é…ç½®"><!--[--><!--]--> å¾®ä¿¡æ‰«ç ç™»å½•é…ç½® <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AEv3.1/" class="sidebar-item" aria-label="å­¦æˆåœ¨çº¿é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½® v3.1"><!--[--><!--]--> å­¦æˆåœ¨çº¿é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½® v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="sidebar-item" aria-label="æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ"><!--[--><!--]--> æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" class="sidebar-item" aria-label="é¡¹ç›®æ€»ç»“"><!--[--><!--]--> é¡¹ç›®æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="ç¬¬-4-ç« -è¯¾ç¨‹å‘å¸ƒ-v3-1" tabindex="-1"><a class="header-anchor" href="#ç¬¬-4-ç« -è¯¾ç¨‹å‘å¸ƒ-v3-1" aria-hidden="true">#</a> <strong>ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1</strong></h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-æ¨¡å—éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">1 æ¨¡å—éœ€æ±‚åˆ†æ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-1-æ¨¡å—ä»‹ç»" class="router-link-active router-link-exact-active">1.1 æ¨¡å—ä»‹ç»</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active">1.2 ä¸šåŠ¡æµç¨‹</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-è¯¾ç¨‹é¢„è§ˆ" class="router-link-active router-link-exact-active">2 è¯¾ç¨‹é¢„è§ˆ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">2.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-2-æ¨¡æ¿å¼•æ“" class="router-link-active router-link-exact-active">2.2 æ¨¡æ¿å¼•æ“</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-3-æµ‹è¯•é™æ€é¡µé¢" class="router-link-active router-link-exact-active">2.3 æµ‹è¯•é™æ€é¡µé¢</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-4-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active">2.4 æ¥å£å®šä¹‰</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_2-5-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active">2.5 æ¥å£å¼€å‘</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-è¯¾ç¨‹å®¡æ ¸" class="router-link-active router-link-exact-active">3 è¯¾ç¨‹å®¡æ ¸</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">3.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-2-æ¥å£å®šä¹‰" class="router-link-active router-link-exact-active">3.2 æ¥å£å®šä¹‰</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-3-æ¥å£å¼€å‘" class="router-link-active router-link-exact-active">3.3 æ¥å£å¼€å‘</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-4-æ¥å£å®Œå–„" class="router-link-active router-link-exact-active">3.4 æ¥å£å®Œå–„</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_3-5-æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active">3.5 æ¥å£æµ‹è¯•</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-è¯¾ç¨‹å‘å¸ƒ" class="router-link-active router-link-exact-active">4 è¯¾ç¨‹å‘å¸ƒ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">4.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-2-åˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active">4.2 åˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯æ–¹æ¡ˆ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-3-è¯¾ç¨‹å‘å¸ƒæ¥å£" class="router-link-active router-link-exact-active">4.3 è¯¾ç¨‹å‘å¸ƒæ¥å£</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-4-æ¶ˆæ¯å¤„ç†-sdk" class="router-link-active router-link-exact-active">4.4 æ¶ˆæ¯å¤„ç† SDK</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_4-5-é¡µé¢é™æ€åŒ–" class="router-link-active router-link-exact-active">4.5 é¡µé¢é™æ€åŒ–</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-è¯¾ç¨‹æœç´¢" class="router-link-active router-link-exact-active">5 è¯¾ç¨‹æœç´¢</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">5.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-2-å‡†å¤‡ç¯å¢ƒ" class="router-link-active router-link-exact-active">5.2 å‡†å¤‡ç¯å¢ƒ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-3-ç´¢å¼•ç®¡ç†" class="router-link-active router-link-exact-active">5.3 ç´¢å¼•ç®¡ç†</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-4-æœç´¢" class="router-link-active router-link-exact-active">5.4 æœç´¢</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/#_5-5-è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•åŒæ­¥" class="router-link-active router-link-exact-active">5.5 è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•åŒæ­¥</a></li></ul></li></ul></nav><h2 id="_1-æ¨¡å—éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_1-æ¨¡å—éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>1 æ¨¡å—éœ€æ±‚åˆ†æ</strong></h2><h3 id="_1-1-æ¨¡å—ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-1-æ¨¡å—ä»‹ç»" aria-hidden="true">#</a> <strong>1.1 æ¨¡å—ä»‹ç»</strong></h3><p>è¯¾ç¨‹ä¿¡æ¯ç¼–è¾‘å®Œæ¯•å³å¯å‘å¸ƒè¯¾ç¨‹ï¼Œå‘å¸ƒè¯¾ç¨‹ç›¸å½“äºä¸€ä¸ªç¡®è®¤æ“ä½œï¼Œè¯¾ç¨‹å‘å¸ƒåå­¦ä¹ è€…åœ¨ç½‘ç«™å¯ä»¥æœç´¢åˆ°è¯¾ç¨‹ï¼Œç„¶åæŸ¥çœ‹è¯¾ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿›ä¸€æ­¥é€‰è¯¾ã€æ”¯ä»˜ã€åœ¨çº¿å­¦ä¹ ã€‚</p><p>ä¸‹è¾¹æ˜¯è¯¾ç¨‹ç¼–è¾‘ä¸å‘å¸ƒçš„æ•´ä½“æµç¨‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531092042421-67b247f3.png" alt="image-20230531092042421"></p><p>ä¸ºäº†è¯¾ç¨‹å†…å®¹æ²¡æœ‰è¿è§„ä¿¡æ¯ã€è¯¾ç¨‹å†…å®¹å®‰æ’åˆç†ï¼Œåœ¨è¯¾ç¨‹å‘å¸ƒä¹‹å‰è¿è¥æ–¹ä¼šè¿›è¡Œè¯¾ç¨‹å®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡åè¯¾ç¨‹æ–¹å¯å‘å¸ƒã€‚</p><p>ä½œä¸ºè¯¾ç¨‹åˆ¶ä½œæ–¹å³æ•™å­¦æœºæ„ï¼Œåœ¨è¯¾ç¨‹å‘å¸ƒå‰é€šè¿‡è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¯ä»¥çœ‹åˆ°è¯¾ç¨‹å‘å¸ƒåçš„æ•ˆæœï¼Œå“ªé‡Œçš„è¯¾ç¨‹ä¿¡æ¯å­˜åœ¨é—®é¢˜æ–¹ä¾¿æŸ¥çœ‹ï¼ŒåŠæ—¶ä¿®æ”¹ã€‚</p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹é¢„è§ˆçš„æ•ˆæœå›¾ï¼Œä¹Ÿæ˜¯è¯¾ç¨‹æ­£å¼å‘å¸ƒåçš„è¯¾ç¨‹è¯¦æƒ…ç•Œé¢ï¼š</p><p><img src="/MyBlog/assets/image-20230531093114433-7fd8c6f5.png" alt="image-20230531093114433"></p><p>æ•™å­¦æœºæ„ç¡®è®¤è¯¾ç¨‹å†…å®¹æ— è¯¯ï¼Œæäº¤å®¡æ ¸ï¼Œå¹³å°è¿è¥äººå‘˜å¯¹è¯¾ç¨‹å†…å®¹å®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡åæ•™å­¦æœºæ„äººå‘˜å‘å¸ƒè¯¾ç¨‹æˆåŠŸã€‚</p><p>è¯¾ç¨‹å‘å¸ƒæ¨¡å—å…±åŒ…æ‹¬ä¸‰å—åŠŸèƒ½ï¼š</p><p>1ã€è¯¾ç¨‹é¢„è§ˆ</p><p>2ã€è¯¾ç¨‹å®¡æ ¸</p><p>3ã€è¯¾ç¨‹å‘å¸ƒ</p><h3 id="_1-2-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-2-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>1.2 ä¸šåŠ¡æµç¨‹</strong></h3><h4 id="_1-2-1-è¯¾ç¨‹é¢„è§ˆ" tabindex="-1"><a class="header-anchor" href="#_1-2-1-è¯¾ç¨‹é¢„è§ˆ" aria-hidden="true">#</a> <strong>1.2.1 è¯¾ç¨‹é¢„è§ˆ</strong></h4><p>1.<strong>æ•™è‚²æœºæ„ç”¨æˆ·</strong>åœ¨è¯¾ç¨‹ç®¡ç†ä¸­å¯å¯¹è¯¥æœºæ„å†…æ‰€ç®¡ç†çš„è¯¾ç¨‹è¿›è¡Œæ£€ç´¢ã€‚</p><p><img src="/MyBlog/assets/image-20230531093123955-743106dd.png" alt="image-20230531093123955"></p><p>2.ç‚¹å‡»æŸè¯¾ç¨‹æ•°æ®åçš„é¢„è§ˆé“¾æ¥ï¼Œå³å¯å¯¹è¯¥è¯¾ç¨‹è¿›è¡Œé¢„è§ˆï¼Œå¯ä»¥çœ‹åˆ°å‘å¸ƒåçš„è¯¦æƒ…é¡µé¢æ•ˆæœã€‚</p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹è¯¦æƒ…é¦–é¡µï¼Œæ˜¾ç¤ºäº†è¯¾ç¨‹çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><p><img src="/MyBlog/assets/image-20230531093129385-b0bb49f4.png" alt="image-20230531093129385"></p><p>ç‚¹å‡»è¯¾ç¨‹ç›®å½•ï¼Œæ˜¾ç¤ºè¯¾ç¨‹è®¡åˆ’ï¼Œé€šè¿‡æ­¤ç•Œé¢å»æ ¸å®è¯¾ç¨‹è®¡åˆ’çš„ä¿¡æ¯æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</p><p><img src="/MyBlog/assets/image-20230531093136457-5f8bb616.png" alt="image-20230531093136457"></p><p>ç‚¹å‡»è¯¾ç¨‹ç›®å½•ä¸­çš„å…·ä½“ç« èŠ‚ï¼ŒæŸ¥çœ‹è§†é¢‘æ’­æ”¾æ˜¯å¦æ­£å¸¸</p><p><img src="/MyBlog/assets/image-20230531093141485-d3efa63a.png" alt="image-20230531093141485"></p><h4 id="_1-2-2-è¯¾ç¨‹å®¡æ ¸" tabindex="-1"><a class="header-anchor" href="#_1-2-2-è¯¾ç¨‹å®¡æ ¸" aria-hidden="true">#</a> <strong>1.2.2 è¯¾ç¨‹å®¡æ ¸</strong></h4><p>æ•™å­¦æœºæ„æäº¤è¯¾ç¨‹å®¡æ ¸åï¼Œå¹³å°è¿è¥äººå‘˜ç™»å½•è¿è¥å¹³å°è¿›è¡Œè¯¾ç¨‹å®¡æ ¸ï¼Œè¯¾ç¨‹å®¡æ ¸åŒ…æ‹¬ç¨‹åºè‡ªåŠ¨å®¡æ ¸å’Œäººå·¥å®¡æ ¸ï¼Œç¨‹åºä¼šå®¡æ ¸å†…å®¹çš„å®Œæ•´æ€§ï¼Œäººå‘˜é€šè¿‡è¯¾ç¨‹é¢„è§ˆè¿›è¡Œå®¡æ ¸ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531093151238-c5b2503b.png" alt="image-20230531093151238"></p><p>1ã€é¦–å…ˆæŸ¥è¯¢å¾…å®¡æ ¸çš„è®°å½•ã€‚</p><p>2ã€è¯¾ç¨‹å®¡æ ¸</p><p>å…·ä½“å®¡æ ¸çš„è¿‡ç¨‹ä¸è¯¾ç¨‹é¢„è§ˆçš„è¿‡ç¨‹ç±»ä¼¼ï¼Œè¿è¥äººå‘˜æŸ¥çœ‹è¯¾ç¨‹ä¿¡æ¯ã€è¯¾ç¨‹è§†é¢‘ç­‰å†…å®¹ã€‚</p><p>å¦‚æœå­˜åœ¨é—®é¢˜åˆ™å®¡æ ¸ä¸é€šè¿‡ï¼Œå¹¶é™„ä¸Šå®¡æ ¸ä¸é€šè¿‡çš„åŸå› ä¾›æ•™å­¦æœºæ„äººå‘˜æŸ¥çœ‹ã€‚</p><p>å¦‚æœè¯¾ç¨‹å†…å®¹æ²¡æœ‰è¿è§„ä¿¡æ¯ä¸”è¯¾ç¨‹å†…å®¹å…¨é¢åˆ™å®¡æ ¸é€šè¿‡ã€‚</p><p>è¯¾ç¨‹å®¡æ ¸é€šè¿‡åæ•™å­¦æœºæ„å‘å¸ƒè¯¾ç¨‹æˆåŠŸã€‚</p><h4 id="_1-2-3-è¯¾ç¨‹å‘å¸ƒ" tabindex="-1"><a class="header-anchor" href="#_1-2-3-è¯¾ç¨‹å‘å¸ƒ" aria-hidden="true">#</a> <strong>1.2.3 è¯¾ç¨‹å‘å¸ƒ</strong></h4><p>1.<strong>æ•™è‚²æœºæ„ç”¨æˆ·</strong>åœ¨è¯¾ç¨‹ç®¡ç†ä¸­å¯å¯¹æœºæ„å†…è¯¾ç¨‹è¿›è¡Œæ£€ç´¢ã€‚</p><p><img src="/MyBlog/assets/image-20230531093200128-d61f29b2.png" alt="image-20230531093200128"></p><p>2.ç‚¹å‡»æŸè¯¾ç¨‹æ•°æ®åçš„ å‘å¸ƒ é“¾æ¥ï¼ˆå®¡æ ¸çŠ¶æ€ä¸ºé€šè¿‡ï¼‰ï¼Œå³å¯å¯¹è¯¥è¯¾ç¨‹è¿›è¡Œå‘å¸ƒã€‚</p><p><img src="/MyBlog/assets/image-20230531093205346-748af5cf.png" alt="image-20230531093205346"></p><p>3ã€è¯¾ç¨‹å‘å¸ƒåå¯é€šè¿‡è¯¾ç¨‹æœç´¢æŸ¥è¯¢åˆ°è¯¾ç¨‹ä¿¡æ¯ï¼Œå¹¶æŸ¥çœ‹è¯¾ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p><img src="/MyBlog/assets/image-20230531093212678-25785b42.png" alt="image-20230531093212678"></p><p>4 ç‚¹å‡»è¯¾ç¨‹æœç´¢é¡µä¸­è¯¾ç¨‹åˆ—è¡¨çš„æŸä¸ªè¯¾ç¨‹ï¼Œå¯è¿›å…¥è¯¾ç¨‹è¯¦æƒ…é¡µã€‚</p><p><img src="/MyBlog/assets/image-20230531093129385-b0bb49f4.png" alt="image-20230531093217867"></p><h2 id="_2-è¯¾ç¨‹é¢„è§ˆ" tabindex="-1"><a class="header-anchor" href="#_2-è¯¾ç¨‹é¢„è§ˆ" aria-hidden="true">#</a> <strong>2 è¯¾ç¨‹é¢„è§ˆ</strong></h2><h3 id="_2-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_2-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>2.1 éœ€æ±‚åˆ†æ</strong></h3><p>è¯¾ç¨‹é¢„è§ˆå°±æ˜¯æŠŠè¯¾ç¨‹çš„ç›¸å…³ä¿¡æ¯è¿›è¡Œæ•´åˆï¼Œåœ¨è¯¾ç¨‹è¯¦æƒ…ç•Œé¢è¿›è¡Œå±•ç¤ºï¼Œé€šè¿‡è¯¾ç¨‹é¢„è§ˆé¡µé¢æŸ¥çœ‹ä¿¡æ¯æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</p><p><img src="/MyBlog/assets/image-20230531093129385-b0bb49f4.png" alt="image-20230531093225116"></p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹é¢„è§ˆçš„æ•°æ®æ¥æºï¼š</p><p><img src="/MyBlog/assets/image-20230531093229934-ee1e0f00.png" alt="image-20230531093229934"></p><p>åœ¨è¯¾ç¨‹é¢„è§ˆé¡µé¢ç‚¹å‡»&quot;è§†é¢‘æ’­æ”¾å›¾ç‰‡&quot;æ‰“å¼€è§†é¢‘æ’­æ”¾é¡µé¢ï¼Œé€šè¿‡è§†é¢‘æ’­æ”¾é¡µé¢æŸ¥çœ‹è¯¾ç¨‹è®¡åˆ’å¯¹åº”çš„è§†é¢‘æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</p><p><img src="/MyBlog/assets/image-20230531093235535-66d3ad77.png" alt="image-20230531093235535"></p><p>è¯¾ç¨‹é¢„è§ˆçš„æ•ˆæœä¸æœ€ç»ˆè¯¾ç¨‹å‘å¸ƒåæŸ¥çœ‹åˆ°çš„æ•ˆæœæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¯¾ç¨‹é¢„è§ˆæ—¶ä¼šé€šè¿‡ç½‘ç«™é—¨æˆ·åŸŸååœ°å€è¿›è¡Œé¢„è§ˆï¼Œä¸‹å›¾æ˜¾ç¤ºäº†æ•´ä¸ªè¯¾ç¨‹é¢„è§ˆçš„æµç¨‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531093240482-b5230709.png" alt="image-20230531093240482"></p><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><p>1ã€ç‚¹å‡»è¯¾ç¨‹é¢„è§ˆï¼Œé€šè¿‡ Nginxã€åå°æœåŠ¡ç½‘å…³è¯·æ±‚å†…å®¹ç®¡ç†æœåŠ¡è¿›è¡Œè¯¾ç¨‹é¢„è§ˆã€‚</p><p>2ã€å†…å®¹ç®¡ç†æœåŠ¡æŸ¥è¯¢è¯¾ç¨‹ç›¸å…³ä¿¡æ¯è¿›è¡Œæ•´åˆï¼Œå¹¶é€šè¿‡æ¨¡æ¿å¼•æ“æŠ€æœ¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“ç”Ÿæˆé¡µé¢ï¼Œè¿”å›ç»™æµè§ˆå™¨ã€‚</p><p>3ã€é€šè¿‡è¯¾ç¨‹é¢„è§ˆé¡µé¢ç‚¹å‡»â€é©¬ä¸Šå­¦ä¹ â€œæ‰“å¼€è§†é¢‘æ’­æ”¾é¡µé¢ã€‚</p><p>4ã€è§†é¢‘æ’­æ”¾é¡µé¢é€šè¿‡ Nginx è¯·æ±‚åå°æœåŠ¡ç½‘å…³ï¼ŒæŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯å±•ç¤ºè¯¾ç¨‹è®¡åˆ’ç›®å½•ï¼Œè¯·æ±‚åª’èµ„æœåŠ¡æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’ç»‘å®šçš„è§†é¢‘æ–‡ä»¶åœ°å€ï¼Œåœ¨çº¿æµè§ˆæ’­æ”¾è§†é¢‘ã€‚</p><h3 id="_2-2-æ¨¡æ¿å¼•æ“" tabindex="-1"><a class="header-anchor" href="#_2-2-æ¨¡æ¿å¼•æ“" aria-hidden="true">#</a> <strong>2.2 æ¨¡æ¿å¼•æ“</strong></h3><h4 id="_2-2-1-ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“" tabindex="-1"><a class="header-anchor" href="#_2-2-1-ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“" aria-hidden="true">#</a> <strong>2.2.1 ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“</strong></h4><p>æ ¹æ®å‰è¾¹çš„æ•°æ®æ¨¡å‹åˆ†æï¼Œè¯¾ç¨‹é¢„è§ˆå°±æ˜¯æŠŠè¯¾ç¨‹çš„ç›¸å…³ä¿¡æ¯è¿›è¡Œæ•´åˆï¼Œåœ¨è¯¾ç¨‹é¢„è§ˆç•Œé¢è¿›è¡Œå±•ç¤ºï¼Œè¯¾ç¨‹é¢„è§ˆç•Œé¢ä¸è¯¾ç¨‹å‘å¸ƒçš„è¯¾ç¨‹è¯¦æƒ…ç•Œé¢ä¸€è‡´ã€‚</p><p>é¡¹ç›®é‡‡ç”¨æ¨¡æ¿å¼•æ“æŠ€æœ¯å®ç°è¯¾ç¨‹é¢„è§ˆç•Œé¢ã€‚ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“ï¼Ÿ</p><p>æ—©æœŸæˆ‘ä»¬é‡‡ç”¨çš„ jsp æŠ€æœ¯å°±æ˜¯ä¸€ç§æ¨¡æ¿å¼•æ“æŠ€æœ¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531093248127-8bb2435d.png" alt="image-20230531093248127"></p><p>1ã€æµè§ˆå™¨è¯·æ±‚ web æœåŠ¡å™¨</p><p>2ã€æœåŠ¡å™¨æ¸²æŸ“é¡µé¢ï¼Œæ¸²æŸ“çš„è¿‡ç¨‹å°±æ˜¯å‘ jsp é¡µé¢(æ¨¡æ¿)å†…å¡«å……æ•°æ®(æ¨¡å‹)ã€‚</p><p>3ã€æœåŠ¡å™¨å°†æ¸²æŸ“ç”Ÿæˆçš„é¡µé¢è¿”å›ç»™æµè§ˆå™¨ã€‚</p><p>æ‰€ä»¥æ¨¡æ¿å¼•æ“å°±æ˜¯ï¼šæ¨¡æ¿+æ•°æ®=è¾“å‡ºï¼ŒJsp é¡µé¢å°±æ˜¯æ¨¡æ¿ï¼Œé¡µé¢ä¸­åµŒå…¥çš„ jsp æ ‡ç­¾å°±æ˜¯æ•°æ®ï¼Œä¸¤è€…ç›¸ç»“åˆè¾“å‡º html ç½‘é¡µã€‚</p><p>å¸¸ç”¨çš„ java æ¨¡æ¿å¼•æ“è¿˜æœ‰å“ªäº›ï¼Ÿ</p><p>Jspã€Freemarkerã€Thymeleaf ã€Velocity ç­‰ã€‚</p><p>æœ¬é¡¹ç›®é‡‡ç”¨ Freemarker ä½œä¸ºæ¨¡æ¿å¼•æ“æŠ€æœ¯ã€‚</p><p>Freemarker å®˜æ–¹åœ°å€ï¼šhttp://freemarker.foofun.cn/</p><p>FreeMarker æ˜¯ä¸€æ¬¾ <em>æ¨¡æ¿å¼•æ“</em>ï¼š å³ä¸€ç§åŸºäºæ¨¡æ¿å’Œè¦æ”¹å˜çš„æ•°æ®ï¼Œ å¹¶ç”¨æ¥ç”Ÿæˆè¾“å‡ºæ–‡æœ¬(HTML ç½‘é¡µï¼Œç”µå­é‚®ä»¶ï¼Œé…ç½®æ–‡ä»¶ï¼Œæºä»£ç ç­‰)çš„é€šç”¨å·¥å…·ã€‚ å®ƒä¸æ˜¯é¢å‘æœ€ç»ˆç”¨æˆ·çš„ï¼Œè€Œæ˜¯ä¸€ä¸ª Java ç±»åº“ï¼Œæ˜¯ä¸€æ¬¾ç¨‹åºå‘˜å¯ä»¥åµŒå…¥ä»–ä»¬æ‰€å¼€å‘äº§å“çš„ç»„ä»¶ã€‚FreeMarker æ˜¯ <a href="http://www.fsf.org/philosophy/free-sw.html" target="_blank" rel="noopener noreferrer">å…è´¹çš„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œ åŸºäº Apache è®¸å¯è¯ 2.0 ç‰ˆæœ¬å‘å¸ƒã€‚</p><h4 id="_2-2-2-freemarker-å¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_2-2-2-freemarker-å¿«é€Ÿå…¥é—¨" aria-hidden="true">#</a> <strong>2.2.2 Freemarker å¿«é€Ÿå…¥é—¨</strong></h4><p>ä¸‹è¾¹åœ¨å†…å®¹ç®¡ç†æ¥å£å±‚æ­å»º Freemarker çš„è¿è¡Œç¯å¢ƒå¹¶è¿›è¡Œæµ‹è¯•ã€‚</p><p>åœ¨å†…å®¹ç®¡ç†æ¥å£å·¥å±‚ æ·»åŠ  Freemarker ä¸ SpringBoot çš„æ•´åˆåŒ…</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- Spring Boot å¯¹ç»“æœè§†å›¾ Freemarker é›†æˆ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ nacos ä¸ºå†…å®¹ç®¡ç†æ¥å£å±‚é…ç½® freemarkerï¼Œå…¬ç”¨é…ç½®ç»„æ–°åŠ ä¸€ä¸ª freemarker-config-dev.yaml</p><p><img src="/MyBlog/assets/image-20230531093313544-11969728.png" alt="image-20230531093313544"></p><p>é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">freemarker</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•</span>
    <span class="token key atrule">settings</span><span class="token punctuation">:</span>
      <span class="token key atrule">template_update_delay</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">suffix</span><span class="token punctuation">:</span> .ftl <span class="token comment">#é¡µé¢æ¨¡æ¿åç¼€å</span>
    <span class="token key atrule">charset</span><span class="token punctuation">:</span> UTF<span class="token punctuation">-</span><span class="token number">8</span>
    <span class="token key atrule">template-loader-path</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/templates/ <span class="token comment">#é¡µé¢æ¨¡æ¿ä½ç½®(é»˜è®¤ä¸º classpath:/templates/)</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">add-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#å…³é—­é¡¹ç›®ä¸­çš„é™æ€èµ„æºæ˜ å°„(staticã€resourcesæ–‡ä»¶å¤¹ä¸‹çš„èµ„æº)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å†…å®¹ç®¡ç†æ¥å£å·¥ç¨‹æ·»åŠ  freemarker-config-dev.yaml</p><p><img src="/MyBlog/assets/image-20230531093337119-02954b67.png" alt="image-20230531093337119"></p><p>æ·»åŠ æ¨¡æ¿ï¼Œåœ¨ resources ä¸‹åˆ›å»º templates ç›®å½•ï¼Œæ·»åŠ  test.ftl æ¨¡æ¿æ–‡ä»¶</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    Hello ${name}!
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–å†™ controller æ–¹æ³•ï¼Œå‡†å¤‡æ¨¡å‹æ•°æ®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>math<span class="token punctuation">.</span>raw<span class="token punctuation">.</span></span><span class="token class-name">Mod</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> freemarkeræµ‹è¯•
 * <span class="token keyword">@date</span> 2022/9/15 19:20
 */</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FreemarkerController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testfreemarker&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®æ¨¡å‹æ•°æ®</span>
        modelAndView<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;å°æ˜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®æ¨¡æ¿åç§°</span>
        modelAndView<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨å†…å®¹ç®¡ç†æ¥å£å·¥ç¨‹ï¼Œè®¿é—® http://localhost:63040/content/testfreemarker</p><p>å±å¹•è¾“å‡ºï¼šHello å°æ˜ï¼</p><p><img src="/MyBlog/assets/image-20230531093415392-840a7212.png" alt="image-20230531093415392"></p><p>freemarker æä¾›å¾ˆå¤šæŒ‡ä»¤ç”¨äºè§£æå„ç§ç±»å‹çš„æ•°æ®æ¨¡å‹ï¼Œå‚è€ƒåœ°å€ï¼šhttp://freemarker.foofun.cn/ref_directives.html</p><h3 id="_2-3-æµ‹è¯•é™æ€é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_2-3-æµ‹è¯•é™æ€é¡µé¢" aria-hidden="true">#</a> <strong>2.3 æµ‹è¯•é™æ€é¡µé¢</strong></h3><h4 id="_2-3-1-éƒ¨ç½²ç½‘ç«™é—¨æˆ·" tabindex="-1"><a class="header-anchor" href="#_2-3-1-éƒ¨ç½²ç½‘ç«™é—¨æˆ·" aria-hidden="true">#</a> <strong>2.3.1 éƒ¨ç½²ç½‘ç«™é—¨æˆ·</strong></h4><p>åœ¨è¯¾ç¨‹é¢„è§ˆç•Œé¢ä¸Šè¦åŠ è½½ cssã€jsã€å›¾ç‰‡ç­‰å†…å®¹ï¼Œè¿™é‡Œéƒ¨ç½² nginx æ¥è®¿é—®è¿™äº›é™æ€èµ„æºï¼Œå¯¹äº SpringBoot æœåŠ¡çš„åŠ¨æ€èµ„æºç”± Nginx å»ä»£ç†è¯·æ±‚ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230526163032509-2bed204f.png" alt="image-20230531093426687"></p><p>1ã€åœ¨æœ¬æœºå®‰è£… Nginx ï¼Œä»è¯¾ç¨‹èµ„æ–™ç›®å½•è·å– nginx-1.23.1.zip å¹¶è§£å‹ã€‚</p><p>2ã€è¿è¡Œ nginx-1.23.1 ç›®å½•ä¸‹çš„ nginx.exeã€‚</p><p>é»˜è®¤ç«¯å£ä¸º 80ï¼Œå¦‚æœæœ¬æœº 80 ç«¯å£è¢«å ç”¨ï¼Œåˆ™éœ€è¦æ€æ‰å ç”¨è¿›ç¨‹åå†å¯åŠ¨ nginxã€‚</p><p>å¦‚æœæ— æ³•æ€æ‰ 80 ç«¯å£å ç”¨è¿›ç¨‹åˆ™éœ€è¦ä¿®æ”¹ nginx-1.23.1 ç›®å½•ä¸‹ conf/nginx.conf é…ç½®æ–‡ä»¶</p><p><img src="/MyBlog/assets/image-20230531093433064-9ebbe6bc.png" alt="image-20230531093433064"></p><p>å°† 80 ç«¯å£ä¿®æ”¹ä¸ºç©ºé—²ç«¯å£ã€‚</p><p>å¯åŠ¨ nginxï¼Œè®¿é—® http://localhost å‡ºç°ä¸‹è¾¹çš„ç½‘é¡µè¡¨ç¤ºå¯åŠ¨æˆåŠŸ</p><p><img src="/MyBlog/assets/image-20230531093438346-b2dda57f.png" alt="image-20230531093438346"></p><p>ä¸‹è¾¹å¼€å§‹éƒ¨ç½²å‰ç«¯å·¥ç¨‹ï¼š</p><p>1ã€ä»è¯¾ç¨‹èµ„æ–™ç›®å½•è·å– xc-ui-pc-static-portal.zip å¹¶è§£å‹ã€‚</p><p>2ã€ä¿®æ”¹æœ¬æœº hosts æ–‡ä»¶ï¼ŒåŠ å…¥ 127.0.0.1 www.51xuecheng.cn 51xuecheng.cn ucenter.51xuecheng.cn teacher.51xuecheng.cn file.51xuecheng.cnã€‚</p><p>window10 æ“ä½œç³»ç»Ÿ hosts æ–‡ä»¶åœ¨ C:\Windows\System32\drivers\etc ä¸‹</p><p>Centos7 æ“ä½œç³»ç»Ÿçš„ hosts æ–‡ä»¶åœ¨/etc ç›®å½•ä¸‹ã€‚</p><p>åœ¨ hosts æ–‡ä»¶åŠ å…¥å¦‚ä¸‹é…ç½®</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>127.0.0.1 www.51xuecheng.cn 51xuecheng.cn ucenter.51xuecheng.cn teacher.51xuecheng.cn file.51xuecheng.cn

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€åœ¨ nginx-1.23.1 ç›®å½•ä¸­æ‰¾åˆ° conf ç›®å½•ï¼Œé…ç½®ç›®å½•ä¸‹çš„ nginx.conf æ–‡ä»¶ã€‚</p><p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼Œæ³¨æ„æ›´æ”¹ xc-ui-pc-static-portal ç›®å½•çš„è·¯å¾„ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>server <span class="token punctuation">{</span>
        listen       80;
        server_name  www.51xuecheng.cn localhost;
        #rewrite ^(.*) https://<span class="token equation string">$server_name$</span>1 permanent;
        #charset koi8-r;
        ssi on;
        ssi_silent_errors on;
        #access_log  logs/host.access.log  main;

        location / <span class="token punctuation">{</span>
            alias   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/;
            index  index.html index.htm;
        <span class="token punctuation">}</span>
        #é™æ€èµ„æº
        location /static/img/ <span class="token punctuation">{</span>
                alias  D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/img/;
        <span class="token punctuation">}</span>
        location /static/css/ <span class="token punctuation">{</span>
                alias   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/css/;
        <span class="token punctuation">}</span>
        location /static/js/ <span class="token punctuation">{</span>
                alias   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/js/;
        <span class="token punctuation">}</span>
        location /static/plugins/ <span class="token punctuation">{</span>
                alias   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/plugins/;
                add_header Access-Control-Allow-Origin http://ucenter.51xuecheng.cn;
                add_header Access-Control-Allow-Credentials true;
                add_header Access-Control-Allow-Methods GET;
        <span class="token punctuation">}</span>
        location /plugins/ <span class="token punctuation">{</span>
                alias   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/plugins/;
        <span class="token punctuation">}</span>



        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html <span class="token punctuation">{</span>
            root   html;
        <span class="token punctuation">}</span>

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ <span class="token function selector">\.</span>php<span class="token equation string">$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ <span class="token equation-command regex">\.</span>php$</span> <span class="token punctuation">{</span>
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #<span class="token punctuation">}</span>

        # deny access to .htaccess files, if Apache&#39;s document root
        # concurs with nginx&#39;s one
        #
        #location ~ /<span class="token function selector">\.</span>ht <span class="token punctuation">{</span>
        #    deny  all;
        #<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨ nginx:</p><p>è¿›å…¥ä»»åŠ¡ç®¡ç†å™¨ï¼Œæ€æ­» nginx çš„ä¸¤ä¸ªè¿›ç¨‹</p><p><img src="/MyBlog/assets/image-20230531093528410-d9f9b205.png" alt="image-20230531093528410"></p><p>æ€æ­»åå†æ¬¡åŒå‡» nginx.exeã€‚</p><p>å¯åŠ¨æˆåŠŸåœ¨ä»»åŠ¡ç®¡ç†å™¨ä¼šå‡ºç° nginx çš„è¿›ç¨‹ã€‚</p><p>æ—¥å¿—æ–‡ä»¶åœ¨ nginx å®‰è£…ç›®å½•ä¸‹çš„ logs ç›®å½•ï¼š</p><p><img src="/MyBlog/assets/image-20230526163213795-e088d241.png" alt="image-20230531093533633"></p><p>å¯åŠ¨æˆåŠŸè®¿é—®http://www.51xuecheng.cn</p><p><img src="/MyBlog/assets/image-20230531093539844-61ba7699.png" alt="image-20230531093539844"></p><h4 id="_2-3-2-è¯¾ç¨‹è¯¦æƒ…é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_2-3-2-è¯¾ç¨‹è¯¦æƒ…é¡µé¢" aria-hidden="true">#</a> <strong>2.3.2 è¯¾ç¨‹è¯¦æƒ…é¡µé¢</strong></h4><p>course_template.html æ˜¯ä¸€ä¸ªé™æ€ html é¡µé¢ï¼Œé‡Œè¾¹è¿˜æ²¡æœ‰æ·»åŠ  freemarker æ ‡ç­¾ï¼Œå¦‚æœè¦é¢„è§ˆè¯¥é¡µé¢éœ€è¦å€ŸåŠ© Nginx è¿›è¡Œé¢„è§ˆï¼Œå› ä¸ºé¡µé¢éœ€è¦åŠ è½½ä¸€äº› css æ ·å¼è¡¨ã€å›¾ç‰‡ç­‰å†…å®¹ã€‚</p><p>course_template.html æ–‡ä»¶åœ¨ xc-ui-pc-static-portal\course ç›®å½•ä¸‹</p><p><img src="/MyBlog/assets/image-20230526163230151-daff61cc.png" alt="image-20230531093545789"></p><p>é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttp://www.51xuecheng.cn/course/course_template.html</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531093552400-e3d4d8a8.png" alt="image-20230531093552400"></p><p>å‡ºç°è¿™ä¸ªç”»é¢è¯´æ˜æ¨¡æ¿æ–‡ä»¶æ­£å¸¸æµè§ˆæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><h4 id="_2-3-3-æ–‡ä»¶æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_2-3-3-æ–‡ä»¶æœåŠ¡å™¨" aria-hidden="true">#</a> <strong>2.3.3 æ–‡ä»¶æœåŠ¡å™¨</strong></h4><p>åœ¨è¿›è¡Œè¯¾ç¨‹é¢„è§ˆæ—¶éœ€è¦å±•ç¤ºè¯¾ç¨‹çš„å›¾ç‰‡ï¼Œåœ¨çº¿æ’æ”¾è¯¾ç¨‹è§†é¢‘ï¼Œè¯¾ç¨‹å›¾ç‰‡ã€è§†é¢‘è¿™äº›éƒ½åœ¨ MinIO æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼Œä¸‹è¾¹ç»Ÿä¸€ç”± Nginx ä»£ç†ï¼Œé€šè¿‡æ–‡ä»¶æœåŠ¡åŸŸåç»Ÿä¸€è®¿é—®ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230526163246021-443e036e.png" alt="image-20230531093558595"></p><p>åœ¨ hosts æ–‡ä»¶é…ç½®å¦‚ä¸‹å†…å®¹ï¼Œå¦‚æœå·²å­˜åœ¨ä¸è¦é‡å¤é…ç½®ã€‚</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>127.0.0.1 www.51xuecheng.cn file.51xuecheng.cn

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ nginx.conf ä¸­é…ç½®æ–‡ä»¶æœåŠ¡å™¨çš„ä»£ç†åœ°å€</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>   #æ–‡ä»¶æœåŠ¡
  upstream fileserver<span class="token punctuation">{</span>
    server 192.168.101.65:9000 weight=10;
  <span class="token punctuation">}</span>
   server <span class="token punctuation">{</span>
        listen       80;
        server_name  file.51xuecheng.cn;
        #charset koi8-r;
        ssi on;
        ssi_silent_errors on;
        #access_log  logs/host.access.log  main;
        location /video <span class="token punctuation">{</span>
            proxy_pass   http://fileserver;
        <span class="token punctuation">}</span>

        location /mediafiles <span class="token punctuation">{</span>
            proxy_pass   http://fileserver;
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®å®Œæ¯•ï¼Œé‡æ–°åŠ è½½ nginx é…ç½®æ–‡ä»¶ã€‚</p><p>é€šè¿‡ cmd è¿›å…¥ nginx.exe æ‰€åœ¨ç›®å½•,è¿è¡Œå¦‚ä¸‹å‘½ä»¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nginx.exe <span class="token parameter variable">-s</span> reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é€šè¿‡http://file.51xuecheng.cn/mediafiles/å›¾ç‰‡æ–‡ä»¶åœ°å€ è®¿é—®å›¾ç‰‡</p><p>åœ¨åª’èµ„æ•°æ®åº“çš„æ–‡ä»¶è¡¨ä¸­æ‰¾ä¸€ä¸ªå›¾ç‰‡çš„åœ°å€è¿›è¡Œæµ‹è¯•ã€‚</p><h4 id="_2-3-4-è§†é¢‘æ’­æ”¾é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_2-3-4-è§†é¢‘æ’­æ”¾é¡µé¢" aria-hidden="true">#</a> <strong>2.3.4 è§†é¢‘æ’­æ”¾é¡µé¢</strong></h4><p>è¿›å…¥è¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡»é©¬ä¸Šå­¦ä¹ æˆ–è¯¾ç¨‹ç›®å½•ä¸‹çš„å°èŠ‚çš„åç§°å°†æ‰“å¼€è§†é¢‘æ’­æ”¾é¡µé¢ã€‚</p><p><img src="/MyBlog/assets/image-20230531093705972-9186d1c6.png" alt="image-20230531093705972"></p><p>é¦–å…ˆåœ¨ nginx.conf ä¸­é…ç½®è§†é¢‘æ’­æ”¾é¡µé¢çš„åœ°å€</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>        location /course/preview/learning.html <span class="token punctuation">{</span>
                alias D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/course/learning.html;
        <span class="token punctuation">}</span>
        location /course/search.html <span class="token punctuation">{</span>
                root   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal;
        <span class="token punctuation">}</span>
        location /course/learning.html <span class="token punctuation">{</span>
                root   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal;
        <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŠ è½½ nginx é…ç½®æ–‡ä»¶</p><p>ç‚¹å‡»è¯¾ç¨‹è¯¦æƒ…é¡µé¢ä¸Šçš„è§†é¢‘æ’­æ”¾é“¾æ¥ï¼Œæ‰“å¼€è§†é¢‘æ’­æ”¾é¡µé¢ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531093235535-66d3ad77.png" alt="image-20230531093737055"></p><p>ä¸‹è¾¹éœ€è¦é…ç½® learning.html é¡µé¢çš„è§†é¢‘æ’­æ”¾è·¯å¾„æ¥æµ‹è¯•è§†é¢‘æ’­æ”¾é¡µé¢ï¼Œæ‰¾åˆ° learning.html é¡µé¢ä¸­ videoObject å¯¹è±¡çš„å®šä¹‰å¤„ï¼Œé…ç½®è§†é¢‘çš„æ’­æ”¾åœ°å€ã€‚</p><p><img src="/MyBlog/assets/image-20230531093742648-f3ec5046.png" alt="image-20230531093742648"></p><p>é…ç½®å®Œæˆï¼Œåˆ·æ–°é¡µé¢ï¼Œè§‚å¯Ÿè§†é¢‘æ˜¯å¦å¯ä»¥æ­£å¸¸æ’­æ”¾ã€‚</p><p><img src="/MyBlog/assets/image-20230531093746645-0e87e903.png" alt="image-20230531093746645"></p><p>æ³¨æ„ï¼šæ­¤é¡µé¢ä¼šå»è¯·æ±‚åå°æ¥å£è·å–è¯¾ç¨‹è®¡åˆ’ï¼Œè¿™é‡Œæš‚æ—¶ä¸å¤„ç†ï¼Œç¨ååœ¨æ¥å£å¼€å‘å¤„è¿›è¡Œå¤„ç†ã€‚åªè¦é¡µé¢å¯ä»¥æ­£å¸¸æ‰“å¼€ï¼Œå¯ä»¥æ’­æ”¾è§†é¢‘å°±æµ‹è¯•é€šè¿‡äº†ã€‚</p><h3 id="_2-4-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_2-4-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>2.4 æ¥å£å®šä¹‰</strong></h3><h4 id="_2-4-1-å®šä¹‰è¯¾ç¨‹é¢„è§ˆæ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-4-1-å®šä¹‰è¯¾ç¨‹é¢„è§ˆæ¥å£" aria-hidden="true">#</a> <strong>2.4.1 å®šä¹‰è¯¾ç¨‹é¢„è§ˆæ¥å£</strong></h4><p>è¯¾ç¨‹é¢„è§ˆæ¥å£è¦å°†è¯¾ç¨‹ä¿¡æ¯è¿›è¡Œæ•´åˆï¼Œåœ¨æœåŠ¡ç«¯æ¸²æŸ“é¡µé¢åè¿”å›æµè§ˆå™¨ã€‚</p><p>ä¸‹è¾¹å¯¹è¯¾ç¨‹é¢„è§ˆæ¥å£è¿›è¡Œåˆ†æï¼š</p><p>1ã€è¯·æ±‚å‚æ•°</p><p>ä¼ å…¥è¯¾ç¨‹ idï¼Œè¡¨ç¤ºè¦é¢„è§ˆå“ªä¸€é—¨è¯¾ç¨‹ã€‚</p><p>2ã€å“åº”ç»“æœ</p><p>è¾“å‡ºè¯¾ç¨‹è¯¦æƒ…é¡µé¢åˆ°æµè§ˆå™¨ã€‚</p><p>å“åº”é¡µé¢åˆ°æµè§ˆå™¨ä½¿ç”¨ freemarker æ¨¡æ¿å¼•æ“æŠ€æœ¯å®ç°ï¼Œé¦–å…ˆä»è¯¾ç¨‹èµ„æ–™ç›®å½•ä¸‹è·å–è¯¾ç¨‹é¢„è§ˆé¡µé¢ course_template.htmlï¼Œæ‹·è´è‡³å†…å®¹ç®¡ç†çš„æ¥å£å·¥ç¨‹çš„ resources/templates ä¸‹ï¼Œå¹¶å°†å…¶åœ¨æœ¬ç›®å½•å¤åˆ¶ä¸€ä»½å‘½åä¸º course_template.ftl</p><p><img src="/MyBlog/assets/image-20230531093756845-200020f7.png" alt="image-20230531093756845"></p><p>ä¸‹è¾¹å¼€å§‹å®šä¹‰æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">CoursePreviewDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CoursePublishService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹é¢„è§ˆï¼Œå‘å¸ƒ
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/16 14:48
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoursePublishController</span> <span class="token punctuation">{</span>


 <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/coursepreview/{courseId}&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">preview</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>

      <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      modelAndView<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">&quot;model&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      modelAndView<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;course_template&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯å†…å®¹ç®¡ç†æ¥å£å·¥ç¨‹ï¼Œè®¿é—® http://localhost:63040/content/coursepreview/74</p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531093828831-e1164a73.png" alt="image-20230531093828831"></p><p>è¯¾ç¨‹é¢„è§ˆé¡µé¢å†…å®¹æ²¡æœ‰æ ·å¼ï¼Œç¨åè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="_2-4-2-é…ç½®åå‘ä»£ç†" tabindex="-1"><a class="header-anchor" href="#_2-4-2-é…ç½®åå‘ä»£ç†" aria-hidden="true">#</a> <strong>2.4.2 é…ç½®åå‘ä»£ç†</strong></h4><p>è¯¾ç¨‹é¢„è§ˆæ¥å£è™½ç„¶å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä½†æ˜¯é¡µé¢æ²¡æœ‰æ ·å¼ï¼ŒæŸ¥çœ‹æµè§ˆå™¨è¯·æ±‚è®°å½•ï¼Œå‘ç°å›¾ç‰‡ã€æ ·å¼æ— æ³•æ­£å¸¸è®¿é—®ã€‚</p><p><img src="/MyBlog/assets/image-20230531093835233-59072ab8.png" alt="image-20230531093835233"></p><p>è¿™äº›é™æ€èµ„æºå…¨åœ¨é—¨æˆ·ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç”± Nginx åå‘ä»£ç†è®¿é—®è¯¾ç¨‹é¢„è§ˆæ¥å£ï¼Œé€šè¿‡é—¨æˆ·çš„ URL å»è®¿é—®è¯¾ç¨‹é¢„è§ˆã€‚</p><p>1ã€åœ¨ Nginx ä¸‹é…ç½®ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>   #åå°ç½‘å…³
  upstream gatewayserver<span class="token punctuation">{</span>
    server 127.0.0.1:63010 weight=10;
  <span class="token punctuation">}</span>
  server <span class="token punctuation">{</span>
        listen       80;
        server_name  www.51xuecheng.cn localhost;
        ....
        #api
        location /api/ <span class="token punctuation">{</span>
                proxy_pass http://gatewayserver/;
        <span class="token punctuation">}</span>
        ....

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€é‡æ–°åŠ è½½ Nginx é…ç½®æ–‡ä»¶ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nginx.exe <span class="token parameter variable">-s</span> reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3ã€å¯åŠ¨å¾®æœåŠ¡ç½‘å…³</p><p>4ã€æ­¤æ—¶è®¿é—®æ–°åœ°å€ï¼š http://www.51xuecheng.cn/api/content/coursepreview/74</p><p>è¾“å‡ºå¦‚ä¸‹ï¼Œé¡µé¢æ ·å¼æ­£å¸¸ã€‚</p><p><img src="/MyBlog/assets/image-20230531093913269-235bc31c.png" alt="image-20230531093913269"></p><p>é¡µé¢è™½ç„¶æ­£å¸¸ï¼Œä½†æ˜¯é‡Œè¾¹çš„å†…å®¹éƒ½æ˜¯é™æ€å†…å®¹ï¼Œç¨åæ¥å£å±‚è°ƒç”¨ service æ–¹å¼è·å–æ¨¡å‹æ•°æ®å¹¶è¿›è¡Œé¡µé¢æ¸²æŸ“ã€‚</p><p>ç›®å‰çš„æ–¹å¼æ˜¯é€šè¿‡ Nginx è®¿é—®ç½‘å…³ï¼Œç”±ç½‘å…³å†å°†è¯·æ±‚è½¬å‘åˆ°å¾®æœåŠ¡ï¼ŒNginx æ˜¯æ•´ä¸ªçš„é¡¹ç›®æœ€å‰æ–¹çš„ä»£ç†æœåŠ¡å™¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531093918596-1b12c2bb.png" alt="image-20230531093918596"></p><h3 id="_2-5-æ¥å£å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_2-5-æ¥å£å¼€å‘" aria-hidden="true">#</a> <strong>2.5 æ¥å£å¼€å‘</strong></h3><h4 id="_2-5-1-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_2-5-1-æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>2.5.1 æ•°æ®æ¨¡å‹</strong></h4><p>è¯¾ç¨‹é¢„è§ˆå°±æ˜¯æŠŠè¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ã€è¥é”€ä¿¡æ¯ã€è¯¾ç¨‹è®¡åˆ’ã€å¸ˆèµ„ç­‰è¯¾ç¨‹çš„ç›¸å…³ä¿¡æ¯è¿›è¡Œæ•´åˆï¼Œåœ¨é¢„è§ˆé¡µé¢è¿›è¡Œå±•ç¤ºã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531093229934-ee1e0f00.png" alt="image-20230531093925185"></p><p>åœ¨ä½¿ç”¨ freemarker æ¸²æŸ“ç”Ÿæˆè§†å›¾æ—¶éœ€è¦æ•°æ®æ¨¡å‹ï¼Œæ­¤æ•°æ®æ¨¡å‹åŒ…æ‹¬äº†åŸºæœ¬ä¿¡æ¯ã€è¥é”€ä¿¡æ¯ã€è¯¾ç¨‹è®¡åˆ’ã€å¸ˆèµ„ç­‰ä¿¡æ¯ã€‚</p><p>æ‰€ä»¥é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ•°æ®æ¨¡å‹ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹é¢„è§ˆæ•°æ®æ¨¡å‹
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/16 15:03
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Data</span>
 <span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoursePreviewDto</span> <span class="token punctuation">{</span>

    <span class="token comment">//è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯,è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>
    <span class="token class-name">CourseBaseInfoDto</span> courseBase<span class="token punctuation">;</span>


    <span class="token comment">//è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TeachplanDto</span><span class="token punctuation">&gt;</span></span> teachplans<span class="token punctuation">;</span>

    <span class="token comment">//å¸ˆèµ„ä¿¡æ¯æš‚æ—¶ä¸åŠ ...</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CourseBaseInfoDtoï¼šåŒ…æ‹¬äº†è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ã€è¥é”€ä¿¡æ¯ã€‚</p><p>List&lt;TeachplanDto&gt; ï¼šåŒ…æ‹¬äº†è¯¾ç¨‹è®¡åˆ’åˆ—è¡¨ã€‚</p><h4 id="_2-5-2-service-æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-5-2-service-æ¥å£" aria-hidden="true">#</a> <strong>2.5.2 Service æ¥å£</strong></h4><p>Service è´Ÿè´£ä»æ•°æ®åº“æŸ¥è¯¢åŸºæœ¬ä¿¡æ¯ã€è¥é”€ä¿¡æ¯ã€è¯¾ç¨‹è®¡åˆ’ç­‰è¯¾ç¨‹ç›¸å…³ä¿¡æ¯ï¼Œç»„æˆ CoursePreviewDto å¯¹è±¡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">CoursePreviewDto</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹é¢„è§ˆã€å‘å¸ƒæ¥å£
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/16 14:59
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CoursePublishService</span> <span class="token punctuation">{</span>


 <span class="token doc-comment comment">/**
  * <span class="token keyword">@description</span> è·å–è¯¾ç¨‹é¢„è§ˆä¿¡æ¯
  * <span class="token keyword">@param</span> <span class="token parameter">courseId</span> è¯¾ç¨‹id
  * <span class="token keyword">@return</span> com.xuecheng.content.model.dto.CoursePreviewDto
  * <span class="token keyword">@author</span> Mr.M
  * <span class="token keyword">@date</span> 2022/9/16 15:36
 */</span>
   <span class="token keyword">public</span> <span class="token class-name">CoursePreviewDto</span> <span class="token function">getCoursePreviewInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥å£å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">CourseBaseInfoDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">CoursePreviewDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">TeachplanTreeDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CourseBaseInfoService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CoursePublishService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">TeachplanService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/16 15:37
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoursePublishServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">CoursePublishService</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">CourseBaseInfoService</span> courseBaseInfoService<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">TeachplanService</span> teachplanService<span class="token punctuation">;</span>


 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">CoursePreviewDto</span> <span class="token function">getCoursePreviewInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">//è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ã€è¥é”€ä¿¡æ¯</span>
  <span class="token class-name">CourseBaseInfoDto</span> courseBaseInfo <span class="token operator">=</span> courseBaseInfoService<span class="token punctuation">.</span><span class="token function">getCourseBaseInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TeachplanDto</span><span class="token punctuation">&gt;</span></span> teachplanTree<span class="token operator">=</span> teachplanService<span class="token punctuation">.</span><span class="token function">findTeachplanTree</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">CoursePreviewDto</span> coursePreviewDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoursePreviewDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  coursePreviewDto<span class="token punctuation">.</span><span class="token function">setCourseBase</span><span class="token punctuation">(</span>courseBaseInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  coursePreviewDto<span class="token punctuation">.</span><span class="token function">setTeachplans</span><span class="token punctuation">(</span>teachplanTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> coursePreviewDto<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-3-æ¥å£å±‚å®Œå–„" tabindex="-1"><a class="header-anchor" href="#_2-5-3-æ¥å£å±‚å®Œå–„" aria-hidden="true">#</a> <strong>2.5.3 æ¥å£å±‚å®Œå–„</strong></h4><p>æ¥å£å±‚ Controller è°ƒç”¨ Service æ–¹æ³•è·å–æ¨¡æ¿å¼•æ“éœ€è¦çš„æ¨¡å‹æ•°æ®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">CoursePublishService</span> coursePublishService<span class="token punctuation">;</span>


<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/coursepreview/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">preview</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>

     <span class="token comment">//è·å–è¯¾ç¨‹é¢„è§ˆä¿¡æ¯</span>
     <span class="token class-name">CoursePreviewDto</span> coursePreviewInfo <span class="token operator">=</span> coursePublishService<span class="token punctuation">.</span><span class="token function">getCoursePreviewInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     modelAndView<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">&quot;model&quot;</span><span class="token punctuation">,</span>coursePreviewInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
     modelAndView<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;course_template&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-4-å‰åç«¯è”è°ƒ" tabindex="-1"><a class="header-anchor" href="#_2-5-4-å‰åç«¯è”è°ƒ" aria-hidden="true">#</a> <strong>2.5.4 å‰åç«¯è”è°ƒ</strong></h4><p>åŸæ¥å‰ç«¯ç›´æ¥æŒ‡å‘åå°ç½‘å…³åœ°å€ï¼Œç°åœ¨è¦æ›´æ”¹ä¸º Nginx çš„åœ°å€ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531094037507-a4f2454f.png" alt="image-20230531094037507"></p><p>é‡å¯å‰ç«¯å·¥ç¨‹ï¼Œè¿›å…¥è¯¾ç¨‹åˆ—è¡¨ç‚¹å‡»&quot;é¢„è§ˆ&quot;æŒ‰é’®ï¼Œæ­£å¸¸æ‰“å¼€è¯¾ç¨‹é¢„è§ˆé¡µé¢http://www.51xuecheng.cn/api/content/coursepreview/2</p><p><img src="/MyBlog/assets/image-20230531093123955-743106dd.png" alt="image-20230531094041676"></p><h4 id="_2-5-5-ç¼–å†™æ¨¡æ¿" tabindex="-1"><a class="header-anchor" href="#_2-5-5-ç¼–å†™æ¨¡æ¿" aria-hidden="true">#</a> <strong>2.5.5 ç¼–å†™æ¨¡æ¿</strong></h4><p>æ¨¡å‹æ•°æ®å‡†å¤‡å¥½åä¸‹ä¸€æ­¥å°†æ¨¡å‹æ•°æ®å¡«å……åˆ° course_template.ftl ä¸Šï¼Œå¡«å……æ—¶æ³¨æ„ä¸è¦ä¸€æ¬¡å¡«å……å¤ªå¤šï¼Œä¸€è¾¹å¡«å……ä¸€è¾¹åˆ·æ–°è°ƒè¯•ã€‚</p><p>freemarker æä¾›å¾ˆå¤šæŒ‡ä»¤ç”¨äºè§£æå„ç§ç±»å‹çš„æ•°æ®æ¨¡å‹ï¼Œå‚è€ƒåœ°å€ï¼šhttp://freemarker.foofun.cn/ref_directives.html</p><p>ä¿®æ”¹æ¨¡æ¿åéœ€è¦ç¼–è¯‘ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531094049746-15c56bf5.png" alt="image-20230531094049746"></p><p>åœ¨è°ƒè¯•æ¨¡æ¿æ—¶ï¼Œå¯ä»¥çœ‹å‡ºå“ªäº›ä¿¡æ¯æœ‰ç¼ºå°‘ï¼Œåœ¨è¯¾ç¨‹ç®¡ç†å¤„è¿›è¡Œè¡¥å……ï¼Œæ¯”å¦‚ä¸‹å›¾æ˜¾ç¤ºè¯¾ç¨‹è®¡åˆ’ä¿¡æ¯ä¸å®Œæ•´ï¼Œéœ€è¦è¿›å…¥è¯¾ç¨‹è®¡åˆ’ç•Œé¢æ·»åŠ è¯¾ç¨‹è®¡åˆ’ã€‚</p><p><img src="/MyBlog/assets/image-20230531094056262-11011fc7.png" alt="image-20230531094056262"></p><p>å®Œæ•´çš„ course_template.ftl æ¨¡æ¿åœ¨è¯¾ç¨‹èµ„æ–™ç›®å½•ä¸‹ï¼Œå·®ä¸å¤šå­¦ä¼šäº† freemarker æ ‡ç­¾çš„ä½¿ç”¨æ–¹æ³•ï¼Œå°†è¯¾ç¨‹èµ„æ–™ä¸‹çš„ course_template.ftl è¦†ç›–è‡ªå·±çš„å·¥ç¨‹ä¸‹çš„ course_template.ftlã€‚</p><h4 id="_2-5-6-è§†é¢‘æ’­æ”¾é¡µé¢æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-5-6-è§†é¢‘æ’­æ”¾é¡µé¢æ¥å£" aria-hidden="true">#</a> <strong>2.5.6 è§†é¢‘æ’­æ”¾é¡µé¢æ¥å£</strong></h4><p>ä»è¯¾ç¨‹è¯¦æƒ…é¡µé¢è¿›å…¥è§†é¢‘æ’­æ”¾é¡µé¢ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531094101708-68a251be.png" alt="image-20230531094101708"></p><p>åœ¨æ­¤é¡µé¢éœ€è¦ä»åå°è·å–è¯¾ç¨‹ä¿¡æ¯ã€æ ¹æ®è¯¾ç¨‹è®¡åˆ’è·å–å¯¹åº”çš„è§†é¢‘åœ°å€ï¼Œä¸‹è¾¹ç¼–å†™è¿™ä¸¤ä¸ªæ¥å£ï¼š</p><p>è·å–è¯¾ç¨‹ä¿¡æ¯æ¥å£ï¼š/open/content/course/whole/{courseId}</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>/open/content/course/whole/è¯¾ç¨‹id

å“åº”ï¼šåŒè¯¾ç¨‹é¢„è§ˆserviceæ¥å£è¿”å›æ•°æ®

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®è¯¾ç¨‹è®¡åˆ’è·å–è§†é¢‘åœ°å€æ¥å£ï¼š/open/media/preview/{mediaId}</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>Java
/open/media/preview/è¯¾ç¨‹è®¡åˆ’id

å“åº”ï¼š
{&quot;code&quot;:0,&quot;msg&quot;:&quot;success&quot;,&quot;result&quot;:&quot;è§†é¢‘çš„url&quot;,&quot;successful&quot;:true}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1ã€åœ¨ nginx é…ç½®å¦‚ä¸‹åœ°å€</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">##openapi</span>
location /open/content/ <span class="token punctuation">{</span>
        proxy_pass http://gatewayserver/content/open/<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
location /open/media/ <span class="token punctuation">{</span>
        proxy_pass http://gatewayserver/media/open/<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®è¿è¡Œ nginx.exe -s reload åŠ è½½ nginx çš„é…ç½®æ–‡ä»¶</p><p>2ã€åœ¨å†…å®¹ç®¡ç†æ¥å£å±‚å®šä¹‰ CourseOpenController ç±»ï¼Œå¹¶å®šä¹‰æ¥å£ï¼šè·å–è¯¾ç¨‹ä¿¡æ¯æ¥å£ï¼š/open/content/course/whole/{courseId}</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹å…¬å¼€æŸ¥è¯¢æ¥å£&quot;</span><span class="token punctuation">,</span>tags <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹å…¬å¼€æŸ¥è¯¢æ¥å£&quot;</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@RestController</span>
 <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/open&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CourseOpenController</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token keyword">private</span> <span class="token class-name">CourseBaseInfoService</span> courseBaseInfoService<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token keyword">private</span> <span class="token class-name">CoursePublishService</span> coursePublishService<span class="token punctuation">;</span>


<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/course/whole/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CoursePreviewDto</span> <span class="token function">getPreviewInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è·å–è¯¾ç¨‹é¢„è§ˆä¿¡æ¯</span>
    <span class="token class-name">CoursePreviewDto</span> coursePreviewInfo <span class="token operator">=</span> coursePublishService<span class="token punctuation">.</span><span class="token function">getCoursePreviewInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> coursePreviewInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€åœ¨åª’èµ„ç®¡ç†æœåŠ¡ media-api å·¥ç¨‹å®šä¹‰ MediaOpenController ç±»ï¼Œå¹¶å®šä¹‰æ¥å£/open/media/preview/</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;åª’èµ„æ–‡ä»¶ç®¡ç†æ¥å£&quot;</span><span class="token punctuation">,</span>tags <span class="token operator">=</span> <span class="token string">&quot;åª’èµ„æ–‡ä»¶ç®¡ç†æ¥å£&quot;</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@RestController</span>
 <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/open&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediaOpenController</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Autowired</span>
  <span class="token class-name">MediaFileService</span> mediaFileService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;é¢„è§ˆæ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/preview/{mediaId}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPlayUrlByMediaId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> mediaId<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">MediaFiles</span> mediaFiles <span class="token operator">=</span> mediaFileService<span class="token punctuation">.</span><span class="token function">getFileById</span><span class="token punctuation">(</span>mediaId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>mediaFiles <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è§†é¢‘è¿˜æ²¡æœ‰è½¬ç å¤„ç†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">RestResponse</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>mediaFiles<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5ã€æµ‹è¯•</p><p>å®šä¹‰å¥½åï¼Œå¯åŠ¨å†…å®¹ç®¡ç†ã€åª’èµ„ç®¡ç†ã€åå°æœåŠ¡ç½‘å…³æœåŠ¡ï¼Œæµ‹è¯•è§†é¢‘æ’­æ”¾é¡µé¢æ˜¯å¦å¯ä»¥æ­£å¸¸è·å–è¯¾ç¨‹è®¡åˆ’ï¼Œç‚¹å‡»å…·ä½“çš„è¯¾ç¨‹è®¡åˆ’æ˜¯å¦æ­£å¸¸å¯ä»¥æ’­æ”¾è§†é¢‘ã€‚</p><h2 id="_3-è¯¾ç¨‹å®¡æ ¸" tabindex="-1"><a class="header-anchor" href="#_3-è¯¾ç¨‹å®¡æ ¸" aria-hidden="true">#</a> <strong>3 è¯¾ç¨‹å®¡æ ¸</strong></h2><h3 id="_3-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_3-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>3.1 éœ€æ±‚åˆ†æ</strong></h3><h4 id="_3-1-1-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-1-1-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>3.1.1 ä¸šåŠ¡æµç¨‹</strong></h4><p>æ ¹æ®æ¨¡å—éœ€æ±‚åˆ†æï¼Œè¯¾ç¨‹å‘å¸ƒå‰è¦å…ˆå®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡æ–¹å¯å‘å¸ƒã€‚ä¸‹å›¾æ˜¯è¯¾ç¨‹å®¡æ ¸åŠå‘å¸ƒçš„æµç¨‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531093151238-c5b2503b.png" alt="image-20230531094239325"></p><blockquote><p>ä¸ºä»€ä¹ˆè¯¾ç¨‹å®¡æ ¸é€šè¿‡æ‰å¯ä»¥å‘å¸ƒå‘¢ï¼Ÿ</p></blockquote><p>è¿™æ ·åšä¸ºäº†é˜²æ­¢è¯¾ç¨‹ä¿¡æ¯æœ‰è¿è§„æƒ…å†µï¼Œè¯¾ç¨‹ä¿¡æ¯ä¸å®Œå–„å¯¹ç½‘ç«™ç”¨æˆ·ä½“éªŒä¹Ÿä¸å¥½ï¼Œè¯¾ç¨‹å®¡æ ¸ä¸ä»…èµ·åˆ°ç›‘ç£ä½œç”¨ï¼Œä¹Ÿæ˜¯å¸®åŠ©æ•™å­¦æœºæ„è§„èŒƒä½¿ç”¨å¹³å°çš„æ‰‹æ®µã€‚</p><blockquote><p>å¦‚ä½•æ§åˆ¶è¯¾ç¨‹å®¡æ ¸é€šè¿‡æ‰å¯ä»¥å‘å¸ƒè¯¾ç¨‹å‘¢ï¼Ÿ</p></blockquote><p>åœ¨è¯¾ç¨‹åŸºæœ¬è¡¨ course_base è¡¨è®¾ç½®è¯¾ç¨‹å®¡æ ¸çŠ¶æ€å­—æ®µï¼ŒåŒ…æ‹¬ï¼šæœªæäº¤ã€å·²æäº¤(æœªå®¡æ ¸)ã€å®¡æ ¸é€šè¿‡ã€å®¡æ ¸ä¸é€šè¿‡ã€‚</p><p>ä¸‹è¾¹æ˜¯è¯¾ç¨‹çŠ¶æ€çš„è½¬åŒ–å…³ç³»ï¼š</p><p><img src="/MyBlog/assets/image-20230531094310426-03b918d7.png" alt="image-20230531094310426"></p><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><p>1ã€ä¸€é—¨è¯¾ç¨‹æ–°å¢åå®ƒçš„å®¡æ ¸çŠ¶ä¸ºâ€æœªæäº¤â€œï¼Œå‘å¸ƒçŠ¶æ€ä¸ºâ€æœªå‘å¸ƒâ€œã€‚</p><p>2ã€è¯¾ç¨‹ä¿¡æ¯ç¼–è¾‘å®Œæˆï¼Œæ•™å­¦æœºæ„äººå‘˜æ‰§è¡Œâ€æäº¤å®¡æ ¸â€œæ“ä½œã€‚æ­¤æ—¶è¯¾ç¨‹çš„å®¡æ ¸çŠ¶æ€ä¸ºâ€å·²æäº¤â€œã€‚</p><p>3ã€å½“è¯¾ç¨‹çŠ¶æ€ä¸ºå·²æäº¤æ—¶è¿è¥å¹³å°äººå‘˜å¯¹è¯¾ç¨‹è¿›è¡Œå®¡æ ¸ã€‚</p><p>4ã€è¿è¥å¹³å°äººå‘˜å®¡æ ¸è¯¾ç¨‹ï¼Œç»“æœæœ‰ä¸¤ä¸ªï¼šå®¡æ ¸é€šè¿‡ã€å®¡æ ¸ä¸é€šè¿‡ã€‚</p><p>5ã€è¯¾ç¨‹å®¡æ ¸è¿‡åä¸ç®¡çŠ¶æ€æ˜¯é€šè¿‡è¿˜æ˜¯ä¸é€šè¿‡ï¼Œæ•™å­¦æœºæ„å¯ä»¥å†æ¬¡ä¿®æ”¹è¯¾ç¨‹å¹¶æäº¤å®¡æ ¸ï¼Œæ­¤æ—¶è¯¾ç¨‹çŠ¶æ€ä¸ºâ€å·²æäº¤â€œã€‚æ­¤æ—¶è¿è¥å¹³å°äººå‘˜å†æ¬¡å®¡æ ¸è¯¾ç¨‹ã€‚</p><p>6ã€è¯¾ç¨‹å®¡æ ¸é€šè¿‡ï¼Œæ•™å­¦æœºæ„äººå‘˜å¯ä»¥å‘å¸ƒè¯¾ç¨‹ï¼Œå‘å¸ƒæˆåŠŸåè¯¾ç¨‹çš„å‘å¸ƒçŠ¶æ€ä¸ºâ€å·²å‘å¸ƒâ€œã€‚</p><p>7ã€è¯¾ç¨‹å‘å¸ƒåé€šè¿‡â€ä¸‹æ¶â€œæ“ä½œå¯ä»¥æ›´æ”¹è¯¾ç¨‹å‘å¸ƒçŠ¶æ€ä¸ºâ€ä¸‹æ¶â€œ</p><p>8ã€è¯¾ç¨‹ä¸‹æ¶åé€šè¿‡â€ä¸Šæ¶â€œæ“ä½œå¯ä»¥å†æ¬¡å‘å¸ƒè¯¾ç¨‹ï¼Œä¸Šæ¶åè¯¾ç¨‹å‘å¸ƒçŠ¶æ€ä¸ºâ€œå‘å¸ƒâ€ã€‚</p><h4 id="_3-1-2-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_3-1-2-æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>3.1.2 æ•°æ®æ¨¡å‹</strong></h4><p>é€šè¿‡ä¸šåŠ¡æµç¨‹çš„åˆ†æï¼Œç°åœ¨æˆ‘ä»¬æ€è€ƒï¼š</p><blockquote><p>1ã€è¯¾ç¨‹æäº¤å®¡æ ¸åè¿˜å…è®¸ä¿®æ”¹è¯¾ç¨‹å—ï¼Ÿ</p></blockquote><p>å¦‚æœä¸å…è®¸ä¿®æ”¹æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºæäº¤å®¡æ ¸åå¯ä»¥ç»§ç»­åšä¸‹ä¸€ä¸ªé˜¶æ®µçš„è¯¾ç¨‹å†…å®¹ï¼Œæ¯”å¦‚æ·»åŠ è¯¾ç¨‹è®¡åˆ’ï¼Œä¸Šä¼ è¯¾ç¨‹è§†é¢‘ç­‰ã€‚</p><blockquote><p>å¦‚æœå…è®¸ä¿®æ”¹é‚£ä¹ˆè¯¾ç¨‹å®¡æ ¸æ—¶çœ‹åˆ°çš„è¯¾ç¨‹å†…å®¹ä»å“ªé‡Œæ¥ï¼Ÿå¦‚æœä¹Ÿä»è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯è¡¨ã€è¯¾ç¨‹è¥é”€è¡¨ã€è¯¾ç¨‹è®¡åˆ’è¡¨æŸ¥è¯¢é‚£ä¹ˆå­˜åœ¨ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå¦‚ä¸‹å›¾ï¼š</p></blockquote><p><img src="/MyBlog/assets/image-20230531094336815-94280840.png" alt="image-20230531094336815"></p><p>è¿è¥äººå‘˜å®¡æ ¸è¯¾ç¨‹å’Œæ•™å­¦æœºæ„ç¼–è¾‘è¯¾ç¨‹æ“ä½œçš„æ•°æ®æ˜¯åŒä¸€ä»½ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´å†²çªã€‚æ¯”å¦‚ï¼šè¿è¥äººå‘˜æ­£åœ¨å®¡æ ¸æ—¶æ•™å­¦æœºæ„æŠŠæ•°æ®ä¿®æ”¹äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸“é—¨è®¾è®¡è¯¾ç¨‹é¢„å‘å¸ƒè¡¨ã€‚</p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531094342527-e0c0ab7c.png" alt="image-20230531094342527"></p><p>æäº¤è¯¾ç¨‹å®¡æ ¸ï¼Œå°†è¯¾ç¨‹ä¿¡æ¯æ±‡æ€»åå†™å…¥è¯¾ç¨‹é¢„å‘å¸ƒè¡¨ï¼Œè¯¾ç¨‹é¢„å‘å¸ƒè¡¨è®°å½•äº†æ•™å­¦æœºæ„åœ¨æŸä¸ªæ—¶é—´ç‚¹è¦å‘å¸ƒçš„è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>è¯¾ç¨‹å®¡æ ¸äººå‘˜ä»é¢„å‘å¸ƒè¡¨æŸ¥è¯¢ä¿¡æ¯è¿›è¡Œå®¡æ ¸ã€‚</p><p>è¯¾ç¨‹å®¡æ ¸çš„åŒæ—¶å¯ä»¥å¯¹è¯¾ç¨‹è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹çš„å†…å®¹ä¸ä¼šå†™å…¥è¯¾ç¨‹é¢„å‘å¸ƒè¡¨ã€‚</p><p>è¯¾ç¨‹å®¡æ ¸é€šè¿‡æ‰§è¡Œè¯¾ç¨‹å‘å¸ƒï¼Œå°†è¯¾ç¨‹é¢„å‘å¸ƒè¡¨çš„ä¿¡æ¯å†™å…¥è¯¾ç¨‹å‘å¸ƒè¡¨ã€‚</p><blockquote><p>2ã€æäº¤å®¡æ ¸è¯¾ç¨‹åï¼Œä¹Ÿä¿®æ”¹äº†è¯¾ç¨‹ä¿¡æ¯ï¼Œå¯ä»¥å†æ¬¡æäº¤å®¡æ ¸å—ï¼Ÿ</p></blockquote><p>è¿™ä¸ªé—®é¢˜åœ¨ä¸Šè¾¹åˆ†æè¯¾ç¨‹å®¡æ ¸çŠ¶æ€æ—¶å·²ç»æœ‰äº†ç­”æ¡ˆï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531094352574-7b91efc1.png" alt="image-20230531094352574"></p><p>æäº¤å®¡æ ¸è¯¾ç¨‹åï¼Œå¿…é¡»ç­‰åˆ°è¯¾ç¨‹å®¡æ ¸å®Œæˆæ‰å¯ä»¥å†æ¬¡æäº¤è¯¾ç¨‹ã€‚</p><p>è¯¾ç¨‹å®¡æ ¸åŠŸèƒ½æ¶‰åŠæ•™å­¦æœºæ„æäº¤å®¡æ ¸ï¼Œè¿è¥äººå‘˜è¿›è¡Œè¯¾ç¨‹å®¡æ ¸ã€‚åœ¨è¯¾å ‚ä¸Šæˆ‘ä»¬ä»…å®ç°æ•™å­¦æœºæ„æäº¤å®¡æ ¸åŠŸèƒ½ï¼Œè¯¾ç¨‹å®¡æ ¸çš„ç»“æœé€šè¿‡æ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“æ¥å®ç°ã€‚</p><p>è™½ç„¶è¯¾å ‚ä¸Šä¸å®ç°è¯¾ç¨‹å®¡æ ¸åŠŸèƒ½ï¼Œå®Œæ•´çš„è¯¾ç¨‹å®¡æ ¸æ•°æ®è¡¨è®¾è®¡éœ€è¦ç†è§£ã€‚</p><p>æäº¤å®¡æ ¸å°†ä¿¡æ¯å†™å…¥è¯¾ç¨‹é¢„å‘å¸ƒè¡¨ï¼Œè¯¾ç¨‹é¢„å‘å¸ƒè¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531094358070-8c8a2cb9.png" alt="image-20230531094358070"></p><p>æ›´æ–°è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯è¡¨çš„è¯¾ç¨‹å®¡æ ¸çŠ¶æ€ä¸ºï¼šå·²ç»æäº¤</p><p>è¯¾ç¨‹å®¡æ ¸åæ›´æ–°<code>è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯è¡¨çš„å®¡æ ¸çŠ¶æ€</code>ã€<code>è¯¾ç¨‹é¢„å‘å¸ƒè¡¨çš„å®¡æ ¸çŠ¶æ€</code>ï¼Œå¹¶å°†å®¡æ ¸ç»“æœå†™å…¥è¯¾ç¨‹å®¡æ ¸è®°å½•ã€‚</p><p>å®¡æ ¸è®°å½•è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531094402682-aa00f62f.png" alt="image-20230531094402682"></p><h3 id="_3-2-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_3-2-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>3.2 æ¥å£å®šä¹‰</strong></h3><p>ä¸‹è¾¹å®šä¹‰æäº¤è¯¾ç¨‹å®¡æ ¸çš„æ¥å£ï¼Œåœ¨è¯¾ç¨‹å‘å¸ƒ Controller ä¸­å®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@PostMapping</span> <span class="token punctuation">(</span><span class="token string">&quot;/courseaudit/commit/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commitAudit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>

 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-æ¥å£å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_3-3-æ¥å£å¼€å‘" aria-hidden="true">#</a> <strong>3.3 æ¥å£å¼€å‘</strong></h3><h4 id="_3-3-1-dao-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_3-3-1-dao-å¼€å‘" aria-hidden="true">#</a> <strong>3.3.1 Dao å¼€å‘</strong></h4><p>1ã€æŸ¥è¯¢è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ã€è¯¾ç¨‹è¥é”€ä¿¡æ¯ã€è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯ç­‰è¯¾ç¨‹ç›¸å…³ä¿¡æ¯ï¼Œæ•´åˆä¸ºè¯¾ç¨‹é¢„å‘å¸ƒä¿¡æ¯ã€‚</p><p>2ã€å‘è¯¾ç¨‹é¢„å‘å¸ƒè¡¨ course_publish_pre æ’å…¥ä¸€æ¡è®°å½•ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™æ›´æ–°ï¼Œå®¡æ ¸çŠ¶æ€ä¸ºï¼šå·²æäº¤ã€‚</p><p>3ã€æ›´æ–°è¯¾ç¨‹åŸºæœ¬è¡¨ course_base è¯¾ç¨‹å®¡æ ¸çŠ¶æ€ä¸ºï¼šå·²æäº¤ã€‚</p><p>çº¦æŸ(å‰ææ¡ä»¶)ï¼š</p><p>1ã€å¯¹å·²æäº¤å®¡æ ¸çš„è¯¾ç¨‹ä¸å…è®¸æäº¤å®¡æ ¸ã€‚</p><p>2ã€æœ¬æœºæ„åªå…è®¸æäº¤æœ¬æœºæ„çš„è¯¾ç¨‹ã€‚</p><p>3ã€æ²¡æœ‰ä¸Šä¼ å›¾ç‰‡ä¸å…è®¸æäº¤å®¡æ ¸ã€‚</p><p>4ã€æ²¡æœ‰æ·»åŠ è¯¾ç¨‹è®¡åˆ’ä¸å…è®¸æäº¤å®¡æ ¸ã€‚</p><p>ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆè¯¾ç¨‹å‘å¸ƒè¡¨ã€è¯¾ç¨‹é¢„å‘å¸ƒè¡¨çš„ POã€Mpperï¼Œå¹¶æ‹·è´åˆ°ç›¸åº”çš„å·¥ç¨‹ä¸‹ã€‚</p><h4 id="_3-3-1-service-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_3-3-1-service-å¼€å‘" aria-hidden="true">#</a> <strong>3.3.1 Service å¼€å‘</strong></h4><p>åœ¨è¯¾ç¨‹å‘å¸ƒ Service ç±»ä¸­å®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æäº¤å®¡æ ¸
 * <span class="token keyword">@param</span> <span class="token parameter">courseId</span>  è¯¾ç¨‹id
 * <span class="token keyword">@return</span> void
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/18 10:31
*/</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commitAudit</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥å£å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commitAudit</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

 <span class="token comment">//çº¦æŸæ ¡éªŒ</span>
 <span class="token class-name">CourseBase</span> courseBase <span class="token operator">=</span> courseBaseMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//è¯¾ç¨‹å®¡æ ¸çŠ¶æ€</span>
 <span class="token class-name">String</span> auditStatus <span class="token operator">=</span> courseBase<span class="token punctuation">.</span><span class="token function">getAuditStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//å½“å‰å®¡æ ¸çŠ¶æ€ä¸ºå·²æäº¤ä¸å…è®¸å†æ¬¡æäº¤</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;202003&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>auditStatus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰ä¸ºç­‰å¾…å®¡æ ¸çŠ¶æ€ï¼Œå®¡æ ¸å®Œæˆå¯ä»¥å†æ¬¡æäº¤ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//æœ¬æœºæ„åªå…è®¸æäº¤æœ¬æœºæ„çš„è¯¾ç¨‹</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>courseBase<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸å…è®¸æäº¤å…¶å®ƒæœºæ„çš„è¯¾ç¨‹ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token comment">//è¯¾ç¨‹å›¾ç‰‡æ˜¯å¦å¡«å†™</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>courseBase<span class="token punctuation">.</span><span class="token function">getPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æäº¤å¤±è´¥ï¼Œè¯·ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token comment">//æ·»åŠ è¯¾ç¨‹é¢„å‘å¸ƒè®°å½•</span>
 <span class="token class-name">CoursePublishPre</span> coursePublishPre <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoursePublishPre</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯åŠ éƒ¨åˆ†è¥é”€ä¿¡æ¯</span>
 <span class="token class-name">CourseBaseInfoDto</span> courseBaseInfo <span class="token operator">=</span> courseBaseInfoService<span class="token punctuation">.</span><span class="token function">getCourseBaseInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>courseBaseInfo<span class="token punctuation">,</span>coursePublishPre<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>
 <span class="token class-name">CourseMarket</span> courseMarket <span class="token operator">=</span> courseMarketMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//è½¬ä¸ºjson</span>
 <span class="token class-name">String</span> courseMarketJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>courseMarket<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//å°†è¯¾ç¨‹è¥é”€ä¿¡æ¯jsonæ•°æ®æ”¾å…¥è¯¾ç¨‹é¢„å‘å¸ƒè¡¨</span>
 coursePublishPre<span class="token punctuation">.</span><span class="token function">setMarket</span><span class="token punctuation">(</span>courseMarketJson<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">//æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯</span>
 <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TeachplanDto</span><span class="token punctuation">&gt;</span></span> teachplanTree <span class="token operator">=</span> teachplanService<span class="token punctuation">.</span><span class="token function">findTeachplanTree</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>teachplanTree<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æäº¤å¤±è´¥ï¼Œè¿˜æ²¡æœ‰æ·»åŠ è¯¾ç¨‹è®¡åˆ’&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//è½¬json</span>
 <span class="token class-name">String</span> teachplanTreeString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>teachplanTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
 coursePublishPre<span class="token punctuation">.</span><span class="token function">setTeachplan</span><span class="token punctuation">(</span>teachplanTreeString<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">//è®¾ç½®é¢„å‘å¸ƒè®°å½•çŠ¶æ€,å·²æäº¤</span>
 coursePublishPre<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;202003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//æ•™å­¦æœºæ„id</span>
 coursePublishPre<span class="token punctuation">.</span><span class="token function">setCompanyId</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//æäº¤æ—¶é—´</span>
 coursePublishPre<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">CoursePublishPre</span> coursePublishPreUpdate <span class="token operator">=</span> coursePublishPreMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>coursePublishPreUpdate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//æ·»åŠ è¯¾ç¨‹é¢„å‘å¸ƒè®°å½•</span>
  coursePublishPreMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>coursePublishPre<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  coursePublishPreMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>coursePublishPre<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token comment">//æ›´æ–°è¯¾ç¨‹åŸºæœ¬è¡¨çš„å®¡æ ¸çŠ¶æ€</span>
 courseBase<span class="token punctuation">.</span><span class="token function">setAuditStatus</span><span class="token punctuation">(</span><span class="token string">&quot;202003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 courseBaseMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>courseBase<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-æ¥å£å®Œå–„" tabindex="-1"><a class="header-anchor" href="#_3-4-æ¥å£å®Œå–„" aria-hidden="true">#</a> <strong>3.4 æ¥å£å®Œå–„</strong></h3><p>å®Œå–„æ¥å£å±‚çš„ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@PostMapping</span> <span class="token punctuation">(</span><span class="token string">&quot;/courseaudit/commit/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commitAudit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">Long</span> companyId <span class="token operator">=</span> <span class="token number">1232141425L</span><span class="token punctuation">;</span>
     coursePublishService<span class="token punctuation">.</span><span class="token function">commitAudit</span><span class="token punctuation">(</span>companyId<span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-5-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>3.5 æ¥å£æµ‹è¯•</strong></h3><p>ä½¿ç”¨å‰ç«¯æå‰è¯¾ç¨‹å®¡æ ¸ï¼š</p><p>1ã€æ‰¾ä¸€é—¨ä¿¡æ¯ä¸å…¨çš„è¯¾ç¨‹ï¼Œæµ‹è¯•å„å„çº¦æŸæ¡ä»¶ã€‚</p><p>2ã€æ­£å¸¸æäº¤åï¼Œè§‚å¯Ÿæ•°æ®åº“ä¸­è¯¾ç¨‹é¢„å‘å¸ƒè¡¨è®°å½•çš„å†…å®¹æ˜¯å¦å®Œæ•´ã€‚</p><p>3ã€æµ‹è¯•å®¡æ ¸è¿‡åå†æ¬¡æäº¤ï¼Œæäº¤åè§‚å¯Ÿæ•°æ®åº“ä¸­è¯¾ç¨‹é¢„å‘å¸ƒè¡¨è®°å½•çš„å†…å®¹æ˜¯å¦æ­£ç¡®ã€‚</p><p>å®¡æ ¸é€šè¿‡éœ€æ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“ï¼š</p><p>1ã€ä¿®æ”¹è¯¾ç¨‹é¢„å‘å¸ƒè¡¨çš„çŠ¶æ€ä¸ºå®¡æ ¸é€šè¿‡ 202004ã€‚</p><p>2ã€ä¿®æ”¹è¯¾ç¨‹åŸºæœ¬è¡¨çš„å®¡æ ¸çŠ¶æ€ä¸ºå®¡æ ¸é€šè¿‡ 202004ã€‚</p><h2 id="_4-è¯¾ç¨‹å‘å¸ƒ" tabindex="-1"><a class="header-anchor" href="#_4-è¯¾ç¨‹å‘å¸ƒ" aria-hidden="true">#</a> <strong>4 è¯¾ç¨‹å‘å¸ƒ</strong></h2><h3 id="_4-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>4.1 éœ€æ±‚åˆ†æ</strong></h3><h4 id="_4-1-1-æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_4-1-1-æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>4.1.1 æ•°æ®æ¨¡å‹</strong></h4><p>æ•™å­¦æœºæ„äººå‘˜åœ¨è¯¾ç¨‹å®¡æ ¸é€šè¿‡åå³å¯å‘å¸ƒè¯¾ç¨‹ï¼Œè¯¾ç¨‹å‘å¸ƒåä¼šå…¬å¼€å±•ç¤ºåœ¨ç½‘ç«™ä¸Šä¾›å­¦ç”ŸæŸ¥çœ‹ã€é€‰è¯¾å’Œå­¦ä¹ ã€‚</p><p>åœ¨ç½‘ç«™ä¸Šå±•ç¤ºè¯¾ç¨‹ä¿¡æ¯éœ€è¦è§£å†³è¯¾ç¨‹ä¿¡æ¯æ˜¾ç¤ºçš„æ€§èƒ½é—®é¢˜ï¼Œå¦‚æœé€Ÿåº¦æ…¢(æ’é™¤ç½‘é€Ÿ)ä¼šå½±å“ç”¨æˆ·çš„ä½“éªŒæ€§ã€‚</p><blockquote><p>å¦‚ä½•å»å¿«é€Ÿæœç´¢è¯¾ç¨‹ï¼Ÿ</p></blockquote><blockquote><p>æ‰“å¼€è¯¾ç¨‹è¯¦æƒ…é¡µé¢ä»ç„¶å»æŸ¥è¯¢æ•°æ®åº“å¯è¡Œå—ï¼Ÿ</p></blockquote><p>ä¸ºäº†æé«˜ç½‘ç«™çš„é€Ÿåº¦éœ€è¦å°†è¯¾ç¨‹ä¿¡æ¯è¿›è¡Œç¼“å­˜ï¼Œå¹¶ä¸”è¦å°†è¯¾ç¨‹ä¿¡æ¯åŠ å…¥ç´¢å¼•åº“æ–¹ä¾¿æœç´¢ï¼Œä¸‹å›¾æ˜¾ç¤ºäº†è¯¾ç¨‹å‘å¸ƒåè¯¾ç¨‹ä¿¡æ¯çš„æµè½¬æƒ…å†µï¼š</p><p><img src="/MyBlog/assets/image-20230531094526637-b3386484.png" alt="image-20230531094526637"></p><p>1ã€å‘å†…å®¹ç®¡ç†æ•°æ®åº“çš„è¯¾ç¨‹å‘å¸ƒè¡¨å­˜å‚¨è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ï¼Œæ›´æ–°è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯è¡¨ä¸­å‘å¸ƒçŠ¶æ€ä¸ºå·²å‘å¸ƒã€‚</p><p>2ã€å‘ Redis å­˜å‚¨è¯¾ç¨‹ç¼“å­˜ä¿¡æ¯ã€‚</p><p>3ã€å‘ Elasticsearch å­˜å‚¨è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯ã€‚</p><p>4ã€è¯·æ±‚åˆ†å¸ƒæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨è¯¾ç¨‹é™æ€åŒ–é¡µé¢(å³ html é¡µé¢)ï¼Œå®ç°å¿«é€Ÿæµè§ˆè¯¾ç¨‹è¯¦æƒ…é¡µé¢ã€‚</p><p>è¯¾ç¨‹å‘å¸ƒè¡¨çš„æ•°æ®æ¥æºäºè¯¾ç¨‹é¢„å‘å¸ƒè¡¨ï¼Œå®ƒä»¬çš„ç»“æ„åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯è¯¾ç¨‹å‘å¸ƒè¡¨ä¸­çš„çŠ¶æ€æ˜¯è¯¾ç¨‹å‘å¸ƒçŠ¶æ€ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531094533703-178204e1.png" alt="image-20230531094533703"></p><p>redis ä¸­çš„è¯¾ç¨‹ç¼“å­˜ä¿¡æ¯æ˜¯å°†è¯¾ç¨‹å‘å¸ƒè¡¨ä¸­çš„æ•°æ®è½¬ä¸º json è¿›è¡Œå­˜å‚¨ã€‚</p><p>elasticsearch ä¸­çš„è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯æ˜¯æ ¹æ®æœç´¢éœ€è¦å°†è¯¾ç¨‹åç§°ã€è¯¾ç¨‹ä»‹ç»ç­‰ä¿¡æ¯è¿›è¡Œç´¢å¼•å­˜å‚¨ã€‚</p><p>MinIO ä¸­å­˜å‚¨äº†è¯¾ç¨‹çš„é™æ€åŒ–é¡µé¢æ–‡ä»¶ï¼ˆhtml ç½‘é¡µï¼‰ï¼ŒæŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…æ˜¯é€šè¿‡æ–‡ä»¶ç³»ç»Ÿå»æµè§ˆè¯¾ç¨‹è¯¦æƒ…é¡µé¢ã€‚</p><h3 id="_4-2-åˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_4-2-åˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>4.2 åˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯æ–¹æ¡ˆ</strong></h3><h4 id="_4-2-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#_4-2-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" aria-hidden="true">#</a> <strong>4.2.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡</strong></h4><p>ä¸€æ¬¡è¯¾ç¨‹å‘å¸ƒæ“ä½œéœ€è¦å‘æ•°æ®åº“ã€redisã€elasticsearchã€MinIO å†™å››ä»½æ•°æ®ï¼Œè¿™é‡Œå­˜åœ¨åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</p></blockquote><blockquote><p>é¦–å…ˆç†è§£ä»€ä¹ˆæ˜¯æœ¬åœ°äº‹åŠ¡ï¼Ÿ</p></blockquote><p>å¹³å¸¸æˆ‘ä»¬åœ¨ç¨‹åºä¸­é€šè¿‡ spring å»æ§åˆ¶äº‹åŠ¡æ˜¯åˆ©ç”¨æ•°æ®åº“æœ¬èº«çš„äº‹åŠ¡ç‰¹æ€§æ¥å®ç°çš„ï¼Œå› æ­¤å«æ•°æ®åº“äº‹åŠ¡ï¼Œç”±äºåº”ç”¨ä¸»è¦é å…³ç³»æ•°æ®åº“æ¥æ§åˆ¶äº‹åŠ¡ï¼Œæ­¤æ•°æ®åº“åªå±äºè¯¥åº”ç”¨ï¼Œæ‰€ä»¥åŸºäºæœ¬åº”ç”¨è‡ªå·±çš„å…³ç³»å‹æ•°æ®åº“çš„äº‹åŠ¡åˆè¢«ç§°ä¸ºæœ¬åœ°äº‹åŠ¡ã€‚</p><p>æœ¬åœ°äº‹åŠ¡å…·æœ‰ ACID å››å¤§ç‰¹æ€§ï¼Œæ•°æ®åº“äº‹åŠ¡åœ¨å®ç°æ—¶ä¼šå°†ä¸€æ¬¡äº‹åŠ¡æ¶‰åŠçš„æ‰€æœ‰æ“ä½œå…¨éƒ¨çº³å…¥åˆ°ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ‰§è¡Œå•å…ƒï¼Œè¯¥æ‰§è¡Œå•å…ƒä¸­çš„æ‰€æœ‰æ“ä½œ è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼Œåªè¦å…¶ä¸­ä»»ä¸€æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œéƒ½å°†å¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å›æ»šã€‚</p><blockquote><p>ç†è§£äº†æœ¬åœ°äº‹åŠ¡ï¼Œä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</p></blockquote><p>ç°åœ¨çš„éœ€æ±‚æ˜¯è¯¾ç¨‹å‘å¸ƒæ“ä½œåå°†æ•°æ®å†™å…¥æ•°æ®åº“ã€redisã€elasticsearchã€MinIO å››ä¸ªåœ°æ–¹ï¼Œè¿™å››ä¸ªåœ°æ–¹å·²ç»ä¸é™åˆ¶åœ¨ä¸€ä¸ªæ•°æ®åº“å†…ï¼Œæ˜¯ç”±å››ä¸ªåˆ†æ•£çš„æœåŠ¡å»æä¾›ï¼Œä¸è¿™å››ä¸ªæœåŠ¡å»é€šä¿¡éœ€è¦ç½‘ç»œé€šä¿¡ï¼Œè€Œç½‘ç»œå­˜åœ¨ä¸å¯åˆ°è¾¾æ€§ï¼Œè¿™ç§åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œé€šè¿‡ä¸ä¸åŒçš„æœåŠ¡è¿›è¡Œç½‘ç»œé€šä¿¡å»å®Œæˆäº‹åŠ¡ç§°ä¹‹ä¸º<strong>åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</strong></p><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯å¾ˆå¤šï¼š</p><p>ä¾‹å¦‚ç”¨æˆ·æ³¨å†Œé€ç§¯åˆ†ï¼Œé“¶è¡Œè½¬è´¦ï¼Œåˆ›å»ºè®¢å•å‡åº“å­˜ï¼Œè¿™äº›éƒ½æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>æ‹¿è½¬è´¦ä¸¾ä¾‹ï¼š</p><p>æˆ‘ä»¬çŸ¥é“æœ¬åœ°äº‹åŠ¡ä¾èµ–æ•°æ®åº“æœ¬èº«æä¾›çš„äº‹åŠ¡ç‰¹æ€§æ¥å®ç°ï¼Œå› æ­¤ä»¥ä¸‹é€»è¾‘å¯ä»¥æ§åˆ¶æœ¬åœ°äº‹åŠ¡ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">begin</span> <span class="token keyword">transaction</span>ï¼›
<span class="token comment">//1.æœ¬åœ°æ•°æ®åº“æ“ä½œï¼šå¼ ä¸‰å‡å°‘é‡‘é¢</span>
<span class="token comment">//2.æœ¬åœ°æ•°æ®åº“æ“ä½œï¼šæå››å¢åŠ é‡‘é¢</span>
<span class="token keyword">commit</span> transation<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œä¼šå˜æˆä¸‹è¾¹è¿™æ ·ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">begin</span> <span class="token keyword">transaction</span>ï¼›
<span class="token comment">//1.æœ¬åœ°æ•°æ®åº“æ“ä½œï¼šå¼ ä¸‰å‡å°‘é‡‘é¢</span>
<span class="token comment">//2.è¿œç¨‹è°ƒç”¨ï¼šè®©æå››å¢åŠ é‡‘é¢</span>

<span class="token keyword">commit</span> transation<span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥è®¾æƒ³ï¼Œå½“è¿œç¨‹è°ƒç”¨è®©æå››å¢åŠ é‡‘é¢æˆåŠŸäº†ï¼Œç”±äºç½‘ç»œé—®é¢˜è¿œç¨‹è°ƒç”¨å¹¶æ²¡æœ‰è¿”å›ï¼Œæ­¤æ—¶æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥å°±å›æ»šäº†å¼ ä¸‰å‡å°‘é‡‘é¢çš„æ“ä½œï¼Œæ­¤æ—¶å¼ ä¸‰å’Œæå››çš„æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚</p><p>å› æ­¤åœ¨åˆ†å¸ƒå¼æ¶æ„çš„åŸºç¡€ä¸Šï¼Œä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡å°±æ— æ³•ä½¿ç”¨äº†ï¼Œå¼ ä¸‰å’Œæå››çš„è´¦æˆ·ä¸åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ç”šè‡³ä¸åœ¨ä¸€ä¸ªåº” ç”¨ç³»ç»Ÿé‡Œï¼Œå®ç°è½¬è´¦äº‹åŠ¡éœ€è¦é€šè¿‡è¿œç¨‹è°ƒç”¨ï¼Œç”±äºç½‘ç»œé—®é¢˜å°±ä¼šå¯¼è‡´åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</p><p>ä¸‹è¾¹çš„åœºæ™¯éƒ½ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡ï¼š</p><p>å¾®æœåŠ¡æ¶æ„ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531094635959-fea07663.png" alt="image-20230531094635959"></p><p>å•æœåŠ¡å¤šæ•°æ®åº“ï¼š</p><p><img src="/MyBlog/assets/image-20230531094640206-29770306.png" alt="image-20230531094640206"></p><p>å¤šæœåŠ¡å•æ•°æ®åº“:</p><p><img src="/MyBlog/assets/image-20230531094645288-5fbab71c.png" alt="image-20230531094645288"></p><h4 id="_4-2-2-ä»€ä¹ˆæ˜¯-cap-ç†è®º" tabindex="-1"><a class="header-anchor" href="#_4-2-2-ä»€ä¹ˆæ˜¯-cap-ç†è®º" aria-hidden="true">#</a> <strong>4.2.2 ä»€ä¹ˆæ˜¯ CAP ç†è®º</strong></h4><p>æ§åˆ¶åˆ†å¸ƒå¼äº‹åŠ¡é¦–å…ˆéœ€è¦ç†è§£ CAP ç†è®ºï¼Œ<code>ä»€ä¹ˆæ˜¯CAPç†è®ºï¼Ÿ</code></p><p>CAP æ˜¯ Consistencyã€Availabilityã€Partition tolerance ä¸‰ä¸ªè¯è¯­çš„ç¼©å†™ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹å¿æ€§ã€‚</p><p>ä½¿ç”¨ä¸‹è¾¹çš„åˆ†å¸ƒå¼ç³»ç»Ÿç»“æ„ è¿›è¡Œè¯´æ˜ï¼š</p><p><img src="/MyBlog/assets/image-20230531094700210-35cf6eb7.png" alt="image-20230531094700210"></p><p>å®¢æˆ·ç«¯ç»è¿‡ç½‘å…³è®¿é—®ç”¨æˆ·æœåŠ¡çš„ä¸¤ä¸ªç»“ç‚¹ï¼Œä¸€è‡´æ€§æ˜¯æŒ‡ç”¨æˆ·ä¸ç®¡è®¿é—®å“ªä¸€ä¸ªç»“ç‚¹æ‹¿åˆ°çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ï¼Œæ¯”å¦‚æŸ¥è¯¢å°æ˜çš„ä¿¡æ¯ï¼Œä¸èƒ½å‡ºç°åœ¨æ•°æ®æ²¡æœ‰æ”¹å˜çš„æƒ…å†µä¸‹ä¸¤æ¬¡æŸ¥è¯¢ç»“æœä¸ä¸€æ ·ã€‚</p><p>å¯ç”¨æ€§æ˜¯æŒ‡ä»»ä½•æ—¶å€™æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯éƒ½å¯ä»¥æŸ¥è¯¢åˆ°ç»“æœï¼Œä½†ä¸ä¿è¯æŸ¥è¯¢åˆ°æœ€æ–°çš„æ•°æ®ã€‚</p><p>åˆ†åŒºå®¹å¿æ€§ä¹Ÿå«åˆ†åŒºå®¹é”™æ€§ï¼Œå½“ç³»ç»Ÿé‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„æ—¶ç”±äºç½‘ç»œé€šä¿¡å¼‚å¸¸å¯¼è‡´è¯·æ±‚ä¸­æ–­ã€æ¶ˆæ¯ä¸¢å¤±ï¼Œä½†ç³»ç»Ÿä¾ç„¶å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p>CAP ç†è®ºè¦å¼ºè°ƒçš„æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¿™ä¸‰ç‚¹ä¸å¯èƒ½å…¨éƒ¨æ»¡è¶³ï¼Œç”±äºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå°±è¦æ»¡è¶³åˆ†åŒºå®¹å¿æ€§ï¼Œå› ä¸ºæœåŠ¡ä¹‹é—´éš¾å…å‡ºç°ç½‘ç»œå¼‚å¸¸ï¼Œä¸èƒ½å› ä¸ºå±€éƒ¨ç½‘ç»œå¼‚å¸¸å¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚</p><p>æ»¡è¶³ P é‚£ä¹ˆ C å’Œ A ä¸èƒ½åŒæ—¶æ»¡è¶³ï¼š</p><p>æ¯”å¦‚æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç”¨æˆ·å°æ˜çš„ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯å…ˆæ·»åŠ åˆ°ç»“ç‚¹ 1 ä¸­ï¼Œå†åŒæ­¥åˆ°ç»“ç‚¹ 2 ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531094711411-316e3a84.png" alt="image-20230531094711411"></p><p>å¦‚æœè¦æ»¡è¶³ C ä¸€è‡´æ€§ï¼Œå¿…é¡»ç­‰å¾…å°æ˜çš„ä¿¡æ¯åŒæ­¥å®Œæˆç³»ç»Ÿæ‰å¯ç”¨ï¼ˆå¦åˆ™ä¼šå‡ºç°è¯·æ±‚åˆ°ç»“ç‚¹ 2 æ—¶æŸ¥è¯¢ä¸åˆ°æ•°æ®ï¼Œè¿åäº†ä¸€è‡´æ€§ï¼‰ï¼Œåœ¨ä¿¡æ¯åŒæ­¥è¿‡ç¨‹ä¸­ç³»ç»Ÿæ˜¯ä¸å¯ç”¨çš„ï¼Œæ‰€ä»¥æ»¡è¶³ C çš„åŒæ—¶æ— æ³•æ»¡è¶³ Aã€‚</p><p>å¦‚æœè¦æ»¡è¶³ A å¯ç”¨æ€§ï¼Œè¦æ—¶åˆ»ä¿è¯ç³»ç»Ÿå¯ç”¨å°±ä¸ç”¨ç­‰å¾…ä¿¡æ¯åŒæ­¥å®Œæˆï¼Œæ­¤æ—¶ç³»ç»Ÿçš„ä¸€è‡´æ€§æ— æ³•æ»¡è¶³ã€‚</p><p>æ‰€ä»¥åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¿›è¡Œåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶ï¼Œè¦ä¹ˆä¿è¯ CPã€è¦ä¹ˆä¿è¯ APã€‚</p><h4 id="_4-2-3-åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_4-2-3-åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>4.2.3 åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ</strong></h4><blockquote><p>å­¦ä¹ äº† CAP ç†è®ºè¯¥å¦‚ä½•æ§åˆ¶åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿ</p></blockquote><p>å­¦ä¹ äº† CAP ç†è®ºæˆ‘ä»¬çŸ¥é“è¿›è¡Œåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶è¦åœ¨ C å’Œ A ä¸­ä½œå‡ºå–èˆï¼Œä¿è¯ä¸€è‡´æ€§å°±ä¸è¦ä¿è¯å¯ç”¨æ€§ï¼Œä¿è¯å¯ç”¨æ€§å°±ä¸è¦ä¿è¯ä¸€è‡´ï¼Œé¦–å…ˆä½ ç¡®è®¤æ˜¯è¦ CP è¿˜æ˜¯ APï¼Œå…·ä½“è¦æ ¹æ®åº”ç”¨åœºæ™¯è¿›è¡Œåˆ¤æ–­ã€‚</p><p>CP çš„åœºæ™¯ï¼šæ»¡è¶³ C èˆå¼ƒ Aï¼Œå¼ºè°ƒä¸€è‡´æ€§ã€‚</p><p>è·¨è¡Œè½¬è´¦ï¼šä¸€æ¬¡è½¬è´¦è¯·æ±‚è¦ç­‰å¾…åŒæ–¹é“¶è¡Œç³»ç»Ÿéƒ½å®Œæˆæ•´ä¸ªäº‹åŠ¡æ‰ç®—å®Œæˆï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªå¤±è´¥å¦ä¸€æ–¹æ‰§è¡Œå›æ»šæ“ä½œã€‚</p><p>å¼€æˆ·æ“ä½œï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿå¼€æˆ·åŒæ—¶è¦åœ¨è¿è¥å•†å¼€æˆ·ï¼Œä»»ä½•ä¸€æ–¹å¼€æˆ·å¤±è´¥è¯¥ç”¨æˆ·éƒ½ä¸å¯ä½¿ç”¨ï¼Œæ‰€ä»¥è¦æ»¡è¶³ CPã€‚</p><p>AP çš„åœºæ™¯ï¼šæ»¡è¶³ A èˆå¼ƒ Cï¼Œå¼ºè°ƒå¯ç”¨æ€§ã€‚</p><p>è®¢å•é€€æ¬¾ï¼Œä»Šæ—¥é€€æ¬¾æˆåŠŸï¼Œæ˜æ—¥è´¦æˆ·åˆ°è´¦ï¼Œåªè¦ç”¨æˆ·å¯ä»¥æ¥å—åœ¨ä¸€å®šæ—¶é—´å†…åˆ°è´¦å³å¯ã€‚</p><p>æ³¨å†Œé€ç§¯åˆ†ï¼Œæ³¨å†ŒæˆåŠŸç§¯åˆ†åœ¨ 24 åˆ†åˆ°è´¦ã€‚</p><p>æ”¯ä»˜çŸ­ä¿¡é€šä¿¡ï¼Œæ”¯ä»˜æˆåŠŸå‘çŸ­ä¿¡ï¼ŒçŸ­ä¿¡å‘é€å¯ä»¥æœ‰å»¶è¿Ÿï¼Œç”šè‡³æ²¡æœ‰å‘é€æˆåŠŸã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ç¬¦åˆ AP çš„åœºæ™¯è¾ƒå¤šï¼Œå…¶å®è™½ç„¶ AP èˆå¼ƒ C ä¸€è‡´æ€§ï¼Œå®é™…ä¸Šæœ€ç»ˆæ•°æ®è¿˜æ˜¯è¾¾åˆ°äº†ä¸€è‡´ï¼Œä¹Ÿå°±æ»¡è¶³äº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ‰€ä»¥ä¸šç•Œå®šä¹‰äº† BASE ç†è®ºã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯ BASE ç†è®ºï¼Ÿ</p></blockquote><p>BASE æ˜¯ Basically Available(åŸºæœ¬å¯ç”¨)ã€Soft state(è½¯çŠ¶æ€)å’Œ Eventually consistent (æœ€ç»ˆä¸€è‡´æ€§)ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚</p><p>åŸºæœ¬å¯ç”¨ï¼šå½“ç³»ç»Ÿæ— æ³•æ»¡è¶³å…¨éƒ¨å¯ç”¨æ—¶ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨å³å¯ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤–å–ç³»ç»Ÿï¼Œæ¯åˆ°ä¸­åˆ 12 ç‚¹å·¦å³ç³»ç»Ÿå¹¶å‘é‡å¾ˆé«˜ï¼Œæ­¤æ—¶è¦ä¿è¯ä¸‹å•æµç¨‹æ¶‰åŠçš„æœåŠ¡å¯ç”¨ï¼Œå…¶å®ƒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚</p><p>è½¯çŠ¶æ€ï¼šæ˜¯æŒ‡å¯ä»¥å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œæ¯”å¦‚ï¼šæ‰“å°è‡ªå·±çš„ç¤¾ä¿ç»Ÿè®¡æƒ…å†µï¼Œè¯¥æ“ä½œä¸ä¼šç«‹å³å‡ºç°ç»“æœï¼Œè€Œæ˜¯æç¤ºä½ æ‰“å°ä¸­ï¼Œè¯·åœ¨ XXX æ—¶é—´åæŸ¥æ”¶ã€‚è™½ç„¶å‡ºç°äº†ä¸­é—´çŠ¶æ€ï¼Œä½†æœ€ç»ˆçŠ¶æ€æ˜¯æ­£ç¡®çš„ã€‚</p><p>æœ€ç»ˆä¸€è‡´æ€§ï¼šé€€æ¬¾æ“ä½œåæ²¡æœ‰åŠæ—¶åˆ°è´¦ï¼Œç»è¿‡ä¸€å®šçš„æ—¶é—´åè´¦æˆ·åˆ°è´¦ï¼Œèˆå¼ƒå¼ºä¸€è‡´æ€§ï¼Œæ»¡è¶³æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><blockquote><p>åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶æœ‰å“ªäº›å¸¸ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆï¼Ÿ</p></blockquote><p>å®ç° CP å°±æ˜¯è¦å®ç°å¼ºä¸€è‡´æ€§:</p><p>ä½¿ç”¨ Seata æ¡†æ¶åŸºäº AT æ¨¡å¼å®ç°</p><p>ä½¿ç”¨ Seata æ¡†æ¶åŸºäº TCC æ¨¡å¼å®ç°ã€‚</p><p>å®ç° AP åˆ™è¦ä¿è¯æœ€ç»ˆæ•°æ®ä¸€è‡´æ€§:</p><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥çš„æ–¹å¼å»å®ç°ï¼Œé€šçŸ¥å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼Œè¾¾åˆ°æœ€å¤§å¤±è´¥æ¬¡æ•°éœ€è¦äººå·¥å¤„ç†ï¼›</p><p>ä½¿ç”¨ä»»åŠ¡è°ƒåº¦çš„æ–¹æ¡ˆï¼Œå¯åŠ¨ä»»åŠ¡è°ƒåº¦å°†è¯¾ç¨‹ä¿¡æ¯ç”±æ•°æ®åº“åŒæ­¥åˆ° elasticsearchã€MinIOã€redis ä¸­ã€‚</p><h4 id="_4-2-4-è¯¾ç¨‹å‘å¸ƒçš„äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_4-2-4-è¯¾ç¨‹å‘å¸ƒçš„äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>4.2.4 è¯¾ç¨‹å‘å¸ƒçš„äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆ</strong></h4><blockquote><p>å­¦ä¹ äº†è¿™ä¹ˆå¤šçš„ç†è®ºï¼Œå›åˆ°è¯¾ç¨‹å‘å¸ƒï¼Œæ‰§è¡Œè¯¾ç¨‹å‘å¸ƒæ“ä½œåè¦å‘æ•°æ®åº“ã€redisã€elasticsearchã€MinIO å†™å››ä»½æ•°æ®ï¼Œè¿™ä¸ªåœºæ™¯ç”¨å“ªç§æ–¹æ¡ˆï¼Ÿ</p></blockquote><p>æ»¡è¶³ CPï¼Ÿ</p><p>å¦‚æœè¦æ»¡è¶³ CP å°±è¡¨ç¤ºè¯¾ç¨‹å‘å¸ƒæ“ä½œåå‘æ•°æ®åº“ã€redisã€elasticsearchã€MinIO å†™å››ä»½æ•°æ®ï¼Œåªè¦æœ‰ä¸€ä»½å†™å¤±è´¥å…¶å®ƒçš„å…¨éƒ¨å›æ»šã€‚</p><p>æ»¡è¶³ APï¼Ÿ</p><p>è¯¾ç¨‹å‘å¸ƒæ“ä½œåï¼Œå…ˆæ›´æ–°æ•°æ®åº“ä¸­çš„è¯¾ç¨‹å‘å¸ƒçŠ¶æ€ï¼Œæ›´æ–°åå‘ redisã€elasticsearchã€MinIO å†™è¯¾ç¨‹ä¿¡æ¯ï¼Œåªè¦åœ¨ä¸€å®šæ—¶é—´å†…æœ€ç»ˆå‘ redisã€elasticsearchã€MinIO å†™æ•°æ®æˆåŠŸå³å¯ã€‚</p><p>ç›®å‰æˆ‘ä»¬å·²ç»æœ‰äº†ä»»åŠ¡è°ƒåº¦çš„æŠ€æœ¯ç§¯ç´¯ï¼Œè¿™é‡Œé€‰ç”¨ä»»åŠ¡è°ƒåº¦çš„æ–¹æ¡ˆå»å®ç°åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶ï¼Œè¯¾ç¨‹å‘å¸ƒæ»¡è¶³ AP å³å¯ã€‚</p><p>ä¸‹å›¾æ˜¯å…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆï¼š</p><p><img src="/MyBlog/assets/image-20230531094744663-bc7ec7c1.png" alt="image-20230531094744663"></p><p>1ã€åœ¨å†…å®¹ç®¡ç†æœåŠ¡çš„æ•°æ®åº“ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯è¡¨ï¼Œæ¶ˆæ¯è¡¨å’Œè¯¾ç¨‹å‘å¸ƒè¡¨åœ¨åŒä¸€ä¸ªæ•°æ®åº“ã€‚</p><p>2ã€ç‚¹å‡»è¯¾ç¨‹å‘å¸ƒé€šè¿‡æœ¬åœ°äº‹åŠ¡å‘è¯¾ç¨‹å‘å¸ƒè¡¨å†™å…¥è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ï¼ŒåŒæ—¶å‘æ¶ˆæ¯è¡¨å†™è¯¾ç¨‹å‘å¸ƒçš„æ¶ˆæ¯ã€‚é€šè¿‡æ•°æ®åº“è¿›è¡Œæ§åˆ¶ï¼Œåªè¦è¯¾ç¨‹å‘å¸ƒè¡¨æ’å…¥æˆåŠŸæ¶ˆæ¯è¡¨ä¹Ÿæ’å…¥æˆåŠŸï¼Œæ¶ˆæ¯è¡¨çš„æ•°æ®å°±è®°å½•äº†æŸé—¨è¯¾ç¨‹å‘å¸ƒçš„ä»»åŠ¡ã€‚</p><p>3ã€å¯åŠ¨ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿå®šæ—¶è°ƒåº¦å†…å®¹ç®¡ç†æœåŠ¡å»å®šæ—¶æ‰«ææ¶ˆæ¯è¡¨çš„è®°å½•ã€‚</p><p>4ã€å½“æ‰«æåˆ°è¯¾ç¨‹å‘å¸ƒçš„æ¶ˆæ¯æ—¶å³å¼€å§‹å®Œæˆå‘ redisã€elasticsearchã€MinIO åŒæ­¥æ•°æ®çš„æ“ä½œã€‚</p><p>5ã€åŒæ­¥æ•°æ®çš„ä»»åŠ¡å®Œæˆååˆ é™¤æ¶ˆæ¯è¡¨è®°å½•ã€‚</p><p>æ—¶åºå›¾å¦‚ä¸‹ï¼š</p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹å‘å¸ƒæ“ä½œçš„æµç¨‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531094752141-89013dbf.png" alt="image-20230531094752141"></p><p>1ã€æ‰§è¡Œå‘å¸ƒæ“ä½œï¼Œå†…å®¹ç®¡ç†æœåŠ¡å­˜å‚¨è¯¾ç¨‹å‘å¸ƒè¡¨çš„åŒæ—¶å‘æ¶ˆæ¯è¡¨æ·»åŠ ä¸€æ¡â€œè¯¾ç¨‹å‘å¸ƒä»»åŠ¡â€ã€‚è¿™é‡Œä½¿ç”¨æœ¬åœ°äº‹åŠ¡ä¿è¯è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ä¿å­˜æˆåŠŸï¼ŒåŒæ—¶æ¶ˆæ¯è¡¨ä¹Ÿä¿å­˜æˆåŠŸã€‚</p><p>2ã€ä»»åŠ¡è°ƒåº¦æœåŠ¡å®šæ—¶è°ƒåº¦å†…å®¹ç®¡ç†æœåŠ¡æ‰«ææ¶ˆæ¯è¡¨ï¼Œç”±äºè¯¾ç¨‹å‘å¸ƒæ“ä½œåå‘æ¶ˆæ¯è¡¨æ’å…¥ä¸€æ¡è¯¾ç¨‹å‘å¸ƒä»»åŠ¡ï¼Œæ­¤æ—¶æ‰«æåˆ°ä¸€æ¡ä»»åŠ¡ã€‚</p><p>3ã€æ‹¿åˆ°ä»»åŠ¡å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œåˆ†åˆ«å‘ redisã€elasticsearch åŠæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨æ•°æ®ã€‚</p><p>4ã€ä»»åŠ¡å®Œæˆååˆ é™¤æ¶ˆæ¯è¡¨è®°å½•ã€‚</p><h3 id="_4-3-è¯¾ç¨‹å‘å¸ƒæ¥å£" tabindex="-1"><a class="header-anchor" href="#_4-3-è¯¾ç¨‹å‘å¸ƒæ¥å£" aria-hidden="true">#</a> <strong>4.3 è¯¾ç¨‹å‘å¸ƒæ¥å£</strong></h3><h4 id="_4-3-1-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_4-3-1-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>4.3.1 æ¥å£å®šä¹‰</strong></h4><p>æ ¹æ®è¯¾ç¨‹å‘å¸ƒçš„åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶æ–¹æ¡ˆï¼Œè¯¾ç¨‹å‘å¸ƒæ“ä½œé¦–å…ˆé€šè¿‡æœ¬åœ°äº‹åŠ¡å‘è¯¾ç¨‹å‘å¸ƒè¡¨å†™å…¥è¯¾ç¨‹å‘å¸ƒä¿¡æ¯å¹¶å‘æ¶ˆæ¯è¡¨æ’å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™é‡Œå®šä¹‰çš„è¯¾ç¨‹å‘å¸ƒæ¥å£è¦å®ç°è¯¥åŠŸèƒ½ã€‚</p><p>åœ¨å†…å®¹ç®¡ç†æ¥å£å·¥ç¨‹ä¸­å®šä¹‰è¯¾ç¨‹å‘å¸ƒæ¥å£ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹é¢„è§ˆï¼Œå‘å¸ƒ
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/16 14:48
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹é¢„è§ˆå‘å¸ƒæ¥å£&quot;</span><span class="token punctuation">,</span>tags <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹é¢„è§ˆå‘å¸ƒæ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoursePublishController</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹å‘å¸ƒ&quot;</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@ResponseBody</span>
 <span class="token annotation punctuation">@PostMapping</span> <span class="token punctuation">(</span><span class="token string">&quot;/coursepublish/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">coursepublish</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-3-æ¥å£å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_4-3-3-æ¥å£å¼€å‘" aria-hidden="true">#</a> <strong>4.3.3 æ¥å£å¼€å‘</strong></h4><h5 id="_4-3-3-1-dao-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_4-3-3-1-dao-å¼€å‘" aria-hidden="true">#</a> <strong>4.3.3.1 DAO å¼€å‘</strong></h5><p>è¯¾ç¨‹å‘å¸ƒæ“ä½œå¯¹æ•°æ®åº“æ“ä½œå¦‚ä¸‹ï¼š</p><p>1ã€å‘è¯¾ç¨‹å‘å¸ƒè¡¨ course_publish æ’å…¥ä¸€æ¡è®°å½•,è®°å½•æ¥æºäºè¯¾ç¨‹é¢„å‘å¸ƒè¡¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æ›´æ–°ï¼Œå‘å¸ƒçŠ¶æ€ä¸ºï¼šå·²å‘å¸ƒã€‚</p><p>2ã€æ›´æ–° course_base è¡¨çš„è¯¾ç¨‹å‘å¸ƒçŠ¶æ€ä¸ºï¼šå·²å‘å¸ƒ</p><p>3ã€åˆ é™¤è¯¾ç¨‹é¢„å‘å¸ƒè¡¨çš„å¯¹åº”è®°å½•ã€‚</p><p>4ã€å‘ mq_message æ¶ˆæ¯è¡¨æ’å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆæ¯ç±»å‹ä¸ºï¼šcourse_publish</p><p>çº¦æŸï¼š</p><p>1ã€è¯¾ç¨‹å®¡æ ¸é€šè¿‡æ–¹å¯å‘å¸ƒã€‚</p><p>2ã€æœ¬æœºæ„åªå…è®¸å‘å¸ƒæœ¬æœºæ„çš„è¯¾ç¨‹ã€‚</p><p>ä»¥ä¸ŠåŠŸèƒ½ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ mapper æ¥å£å³å¯å®Œæˆã€‚</p><p>1ã€åœ¨å†…å®¹ç®¡ç†æ•°æ®åº“åˆ›å»º mq_message æ¶ˆæ¯è¡¨åŠæ¶ˆæ¯å†å²æ¶ˆæ¯è¡¨ï¼ˆå†å²è¡¨å­˜å‚¨å·²ç»å®Œæˆçš„æ¶ˆæ¯ï¼‰ã€‚</p><p><img src="/MyBlog/assets/image-20230531094820514-96725b15.png" alt="image-20230531094820514"></p><p>æ¶ˆæ¯è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531094825180-75f6db90.png" alt="image-20230531094825180"></p><p>2ã€ç”Ÿæˆ mq_message æ¶ˆæ¯è¡¨ã€course_publish è¯¾ç¨‹å‘å¸ƒè¡¨çš„ po å’Œ mapper æ¥å£</p><p>ç¨åä¼šå¼€å‘ä¸€ä¸ªé€šç”¨çš„æ¶ˆæ¯å¤„ç†ç»„ä»¶ï¼Œè¿™é‡Œå…ˆä¸ç”Ÿæˆä»£ç ã€‚</p><h5 id="_4-3-3-2-service-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_4-3-3-2-service-å¼€å‘" aria-hidden="true">#</a> <strong>4.3.3.2 Service å¼€å‘</strong></h5><p>å®šä¹‰ Service æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹å‘å¸ƒæ¥å£
 * <span class="token keyword">@param</span> <span class="token parameter">companyId</span> æœºæ„id
 * <span class="token keyword">@param</span> <span class="token parameter">courseId</span> è¯¾ç¨‹id
 * <span class="token keyword">@return</span> void
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/20 16:23
*/</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–å†™è¯¾ç¨‹å‘å¸ƒçš„ Service æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@Transactional</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">//çº¦æŸæ ¡éªŒ</span>
  <span class="token comment">//æŸ¥è¯¢è¯¾ç¨‹é¢„å‘å¸ƒè¡¨</span>
  <span class="token class-name">CoursePublishPre</span> coursePublishPre <span class="token operator">=</span> coursePublishPreMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>coursePublishPre <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·å…ˆæäº¤è¯¾ç¨‹å®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡æ‰å¯ä»¥å‘å¸ƒ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//æœ¬æœºæ„åªå…è®¸æäº¤æœ¬æœºæ„çš„è¯¾ç¨‹</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>coursePublishPre<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸å…è®¸æäº¤å…¶å®ƒæœºæ„çš„è¯¾ç¨‹ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token comment">//è¯¾ç¨‹å®¡æ ¸çŠ¶æ€</span>
  <span class="token class-name">String</span> auditStatus <span class="token operator">=</span> coursePublishPre<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//å®¡æ ¸é€šè¿‡æ–¹å¯å‘å¸ƒ</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;202004&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>auditStatus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ“ä½œå¤±è´¥ï¼Œè¯¾ç¨‹å®¡æ ¸é€šè¿‡æ–¹å¯å‘å¸ƒã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//ä¿å­˜è¯¾ç¨‹å‘å¸ƒä¿¡æ¯</span>
  <span class="token function">saveCoursePublish</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//ä¿å­˜æ¶ˆæ¯è¡¨</span>
  <span class="token function">saveCoursePublishMessage</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">//åˆ é™¤è¯¾ç¨‹é¢„å‘å¸ƒè¡¨å¯¹åº”è®°å½•</span>
  coursePublishPreMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> ä¿å­˜è¯¾ç¨‹å‘å¸ƒä¿¡æ¯
 * <span class="token keyword">@param</span> <span class="token parameter">courseId</span>  è¯¾ç¨‹id
 * <span class="token keyword">@return</span> void
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/20 16:32
*/</span>
 <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveCoursePublish</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//æ•´åˆè¯¾ç¨‹å‘å¸ƒä¿¡æ¯</span>
  <span class="token comment">//æŸ¥è¯¢è¯¾ç¨‹é¢„å‘å¸ƒè¡¨</span>
  <span class="token class-name">CoursePublishPre</span> coursePublishPre <span class="token operator">=</span> coursePublishPreMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>coursePublishPre <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹é¢„å‘å¸ƒæ•°æ®ä¸ºç©º&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">CoursePublish</span> coursePublish <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoursePublish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//æ‹·è´åˆ°è¯¾ç¨‹å‘å¸ƒå¯¹è±¡</span>
  <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>coursePublishPre<span class="token punctuation">,</span>coursePublish<span class="token punctuation">)</span><span class="token punctuation">;</span>
  coursePublish<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;203002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">CoursePublish</span> coursePublishUpdate <span class="token operator">=</span> coursePublishMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>coursePublishUpdate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   coursePublishMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>coursePublish<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
   coursePublishMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>coursePublish<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//æ›´æ–°è¯¾ç¨‹åŸºæœ¬è¡¨çš„å‘å¸ƒçŠ¶æ€</span>
  <span class="token class-name">CourseBase</span> courseBase <span class="token operator">=</span> courseBaseMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  courseBase<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;203002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  courseBaseMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>courseBase<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>

 <span class="token doc-comment comment">/**
  * <span class="token keyword">@description</span> ä¿å­˜æ¶ˆæ¯è¡¨è®°å½•ï¼Œç¨åå®ç°
  * <span class="token keyword">@param</span> <span class="token parameter">courseId</span>  è¯¾ç¨‹id
  * <span class="token keyword">@return</span> void
  * <span class="token keyword">@author</span> Mr.M
  * <span class="token keyword">@date</span> 2022/9/20 16:32
  */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveCoursePublishMessage</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-3-æ¥å£å®Œå–„" tabindex="-1"><a class="header-anchor" href="#_4-3-3-3-æ¥å£å®Œå–„" aria-hidden="true">#</a> <strong>4.3.3.3 æ¥å£å®Œå–„</strong></h5><p>å®Œå–„æ¥å£å±‚ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹å‘å¸ƒ&quot;</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@ResponseBody</span>
 <span class="token annotation punctuation">@PostMapping</span> <span class="token punctuation">(</span><span class="token string">&quot;/coursepublish/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">coursepublish</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">Long</span> companyId <span class="token operator">=</span> <span class="token number">1232141425L</span><span class="token punctuation">;</span>
     coursePublishService<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>companyId<span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-4-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-3-4-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>4.3.4 æ¥å£æµ‹è¯•</strong></h4><p>å…ˆä½¿ç”¨ httpclient æ–¹æ³•æµ‹è¯•ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### è¯¾ç¨‹å‘å¸ƒ
POST {{content_host}}/content/coursepublish/2

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…ˆæµ‹è¯•çº¦æŸæ¡ä»¶ï¼š</p><p>1ã€åœ¨æœªæäº¤å®¡æ ¸æ—¶è¿›è¡Œè¯¾ç¨‹å‘å¸ƒæµ‹è¯•ã€‚</p><p>2ã€åœ¨è¯¾ç¨‹æœªå®¡æ ¸é€šè¿‡æ—¶è¿›è¡Œå‘å¸ƒã€‚</p><p>æ­£å¸¸æµç¨‹æµ‹è¯•ï¼š</p><p>1ã€æäº¤å®¡æ ¸è¯¾ç¨‹</p><p>2ã€æ‰‹åŠ¨ä¿®æ”¹è¯¾ç¨‹é¢„å‘å¸ƒè¡¨ä¸è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯çš„å®¡æ ¸çŠ¶æ€ä¸ºå®¡æ ¸é€šè¿‡ã€‚</p><p>3ã€æ‰§è¡Œè¯¾ç¨‹å‘å¸ƒ</p><p>4ã€è§‚å¯Ÿè¯¾ç¨‹å‘å¸ƒè¡¨è®°å½•æ˜¯å¦æ­£å¸¸ï¼Œè¯¾ç¨‹é¢„å‘å¸ƒè¡¨è®°å½•å·²ç»åˆ é™¤ï¼Œè¯¾ç¨‹åŸºæœ¬ä¿¡æ¯è¡¨ä¸è¯¾ç¨‹å‘å¸ƒè¡¨çš„å‘å¸ƒçŠ¶æ€ä¸ºâ€å‘å¸ƒâ€œã€‚</p><p>ä½¿ç”¨å‰åç«¯è”è°ƒæ–¹å¼æµ‹è¯•ã€‚</p><h3 id="_4-4-æ¶ˆæ¯å¤„ç†-sdk" tabindex="-1"><a class="header-anchor" href="#_4-4-æ¶ˆæ¯å¤„ç†-sdk" aria-hidden="true">#</a> <strong>4.4 æ¶ˆæ¯å¤„ç† SDK</strong></h3><h4 id="_4-4-1-æ¶ˆæ¯æ¨¡å—æŠ€æœ¯æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_4-4-1-æ¶ˆæ¯æ¨¡å—æŠ€æœ¯æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>4.4.1 æ¶ˆæ¯æ¨¡å—æŠ€æœ¯æ–¹æ¡ˆ</strong></h4><p>è¯¾ç¨‹å‘å¸ƒæ“ä½œæ‰§è¡Œåéœ€è¦æ‰«ææ¶ˆæ¯è¡¨çš„è®°å½•ï¼Œæœ‰å…³æ¶ˆæ¯è¡¨å¤„ç†çš„æœ‰å“ªäº›ï¼Ÿ</p><p><img src="/MyBlog/assets/image-20230531094943236-adf2127e.png" alt="image-20230531094943236"></p><p>ä¸Šå›¾ä¸­çº¢è‰²æ¡†å†…çš„éƒ½æ˜¯ä¸æ¶ˆæ¯å¤„ç†ç›¸å…³çš„æ“ä½œï¼š</p><p>1ã€æ–°å¢æ¶ˆæ¯è¡¨</p><p>2ã€æ‰«ææ¶ˆæ¯è¡¨ã€‚</p><p>3ã€æ›´æ–°æ¶ˆæ¯è¡¨ã€‚</p><p>4ã€åˆ é™¤æ¶ˆæ¯è¡¨ã€‚</p><p>ä½¿ç”¨æ¶ˆæ¯è¡¨è¿™ç§æ–¹å¼å®ç°æœ€ç»ˆäº‹åŠ¡ä¸€è‡´æ€§çš„åœ°æ–¹é™¤äº†è¯¾ç¨‹å‘å¸ƒè¿˜æœ‰å…¶å®ƒä¸šåŠ¡åœºæ™¯ã€‚</p><p><img src="/MyBlog/assets/image-20230531094950223-9c6b6347.png" alt="image-20230531094950223"></p><p>å¦‚æœåœ¨æ¯ä¸ªåœ°æ–¹éƒ½å®ç°ä¸€å¥—é’ˆå¯¹æ¶ˆæ¯è¡¨å®šæ—¶æ‰«æã€å¤„ç†çš„é€»è¾‘åŸºæœ¬ä¸Šéƒ½æ˜¯é‡å¤çš„ï¼Œè½¯ä»¶çš„å¯å¤ç”¨æ€§å¤ªä½ï¼Œæˆæœ¬å¤ªé«˜ã€‚</p><blockquote><p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p></blockquote><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜å¯ä»¥æƒ³åˆ°å°†æ¶ˆæ¯å¤„ç†ç›¸å…³çš„é€»è¾‘åšæˆä¸€ä¸ªé€šç”¨çš„ä¸œè¥¿ã€‚</p><p>æ˜¯åšæˆé€šç”¨çš„æœåŠ¡ï¼Œè¿˜æ˜¯åšæˆé€šç”¨çš„ä»£ç ç»„ä»¶å‘¢ï¼Ÿ</p><p>é€šç”¨çš„æœåŠ¡æ˜¯å®Œæˆä¸€ä¸ªé€šç”¨çš„ç‹¬ç«‹åŠŸèƒ½ï¼Œå¹¶æä¾›ç‹¬ç«‹çš„ç½‘ç»œæ¥å£ï¼Œæ¯”å¦‚ï¼šé¡¹ç›®ä¸­çš„æ–‡ä»¶ç³»ç»ŸæœåŠ¡ï¼Œæä¾›æ–‡ä»¶çš„åˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡ã€‚</p><p>ä»£ç ç»„ä»¶ä¹Ÿæ˜¯å®Œæˆä¸€ä¸ªé€šç”¨çš„ç‹¬ç«‹åŠŸèƒ½ï¼Œé€šå¸¸ä¼šæä¾› API çš„æ–¹å¼ä¾›å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šfastjsonã€Apache commons å·¥å…·åŒ…ç­‰ã€‚</p><p>å¦‚æœå°†æ¶ˆæ¯å¤„ç†åšæˆä¸€ä¸ªé€šç”¨çš„æœåŠ¡ï¼Œè¯¥æœåŠ¡éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œå› ä¸ºå®ƒè¦æ‰«æå¾®æœåŠ¡æ•°æ®åº“ä¸‹çš„æ¶ˆæ¯è¡¨ï¼Œå¹¶ä¸”è¦æä¾›ä¸å¾®æœåŠ¡é€šä¿¡çš„ç½‘ç»œæ¥å£ï¼Œå•å°±é’ˆå¯¹å½“å‰éœ€æ±‚è€Œè¨€å¼€å‘æˆæœ¬æœ‰ç‚¹é«˜ã€‚</p><p>å¦‚æœå°†æ¶ˆæ¯å¤„ç†åšä¸€ä¸ª SDK å·¥å…·åŒ…ç›¸æ¯”é€šç”¨æœåŠ¡ä¸ä»…å¯ä»¥è§£å†³å°†æ¶ˆæ¯å¤„ç†é€šç”¨åŒ–çš„éœ€æ±‚ï¼Œè¿˜å¯ä»¥é™ä½æˆæœ¬ã€‚</p><p>æ‰€ä»¥ï¼Œæœ¬é¡¹ç›®ç¡®å®šå°†å¯¹æ¶ˆæ¯è¡¨ç›¸å…³çš„å¤„ç†åšæˆä¸€ä¸ª SDK ç»„ä»¶ä¾›å„å¾®æœåŠ¡ä½¿ç”¨,å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/MyBlog/assets/image-20230531095001971-0616cb07.png" alt="image-20230531095001971"></p><p>ä¸‹è¾¹å¯¹æ¶ˆæ¯ SDK çš„è®¾è®¡å†…å®¹è¿›è¡Œè¯´æ˜ï¼š</p><blockquote><p>sdk éœ€è¦æä¾›æ‰§è¡Œä»»åŠ¡çš„é€»è¾‘å—ï¼Ÿ</p></blockquote><p>æ‹¿è¯¾ç¨‹å‘å¸ƒä»»åŠ¡ä¸¾ä¾‹ï¼Œæ‰§è¡Œè¯¾ç¨‹å‘å¸ƒä»»åŠ¡æ˜¯è¦å‘ redisã€ç´¢å¼•åº“ç­‰åŒæ­¥æ•°æ®ï¼Œå…¶å®ƒä»»åŠ¡çš„æ‰§è¡Œé€»è¾‘æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æ‰§è¡Œä»»åŠ¡åœ¨ sdk ä¸­ä¸ç”¨å®ç°ä»»åŠ¡é€»è¾‘ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ç”±å…·ä½“çš„æ‰§è¡Œä»»åŠ¡æ–¹å»å®ç°ã€‚</p><blockquote><p>å¦‚ä½•ä¿è¯ä»»åŠ¡çš„å¹‚ç­‰æ€§ï¼Ÿ</p></blockquote><p>åœ¨è§†é¢‘å¤„ç†ç« èŠ‚ä»‹ç»çš„è§†é¢‘å¤„ç†çš„å¹‚ç­‰æ€§æ–¹æ¡ˆï¼Œè¿™é‡Œå¯ä»¥é‡‡ç”¨ç±»ä¼¼æ–¹æ¡ˆï¼Œä»»åŠ¡æ‰§è¡Œå®Œæˆåä¼šä»æ¶ˆæ¯è¡¨åˆ é™¤ï¼Œå¦‚æœæ¶ˆæ¯çš„çŠ¶æ€æ˜¯å®Œæˆæˆ–ä¸å­˜åœ¨æ¶ˆæ¯è¡¨ä¸­åˆ™ä¸ç”¨æ‰§è¡Œã€‚</p><blockquote><p>å¦‚ä½•ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œï¼Ÿ</p></blockquote><p>é‡‡ç”¨å’Œè§†é¢‘å¤„ç†ç« èŠ‚ä¸€è‡´æ–¹æ¡ˆï¼Œé™¤äº†ä¿è¯ä»»åŠ¡çš„å¹‚ç­‰æ€§å¤–ï¼Œä»»åŠ¡è°ƒåº¦é‡‡ç”¨åˆ†ç‰‡å¹¿æ’­ï¼Œæ ¹æ®åˆ†ç‰‡å‚æ•°å»è·å–ä»»åŠ¡ï¼Œå¦å¤–é˜»å¡è°ƒåº¦ç­–ç•¥ä¸ºä¸¢å¼ƒä»»åŠ¡ã€‚</p><p>æ³¨æ„ï¼šè¿™é‡Œæ˜¯ä¿¡æ¯åŒæ­¥ç±»ä»»åŠ¡ï¼Œå³ä½¿ä»»åŠ¡é‡å¤æ‰§è¡Œä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œä¸å†ä½¿ç”¨æŠ¢å ä»»åŠ¡çš„æ–¹å¼ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œã€‚</p><blockquote><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ ¹æ®æ¶ˆæ¯è¡¨è®°å½•æ˜¯å¦å­˜åœ¨æˆ–æ¶ˆæ¯è¡¨ä¸­çš„ä»»åŠ¡çŠ¶æ€å»ä¿è¯ä»»åŠ¡çš„å¹‚ç­‰æ€§ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡æœ‰å¥½å‡ ä¸ªå°ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼šè¯¾ç¨‹å‘å¸ƒä»»åŠ¡éœ€è¦æ‰§è¡Œä¸‰ä¸ªåŒæ­¥æ“ä½œï¼šå­˜å‚¨è¯¾ç¨‹åˆ° redisã€å­˜å‚¨è¯¾ç¨‹åˆ°ç´¢å¼•åº“ï¼Œå­˜å‚¨è¯¾ç¨‹é¡µé¢åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªå°ä»»åŠ¡å·²ç»å®Œæˆä¹Ÿä¸åº”è¯¥å»é‡å¤æ‰§è¡Œã€‚è¿™é‡Œè¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ</p></blockquote><p>å°†å°ä»»åŠ¡ä½œä¸ºä»»åŠ¡çš„ä¸åŒçš„é˜¶æ®µï¼Œåœ¨æ¶ˆæ¯è¡¨ä¸­è®¾è®¡é˜¶æ®µçŠ¶æ€ã€‚</p><p><img src="/MyBlog/assets/image-20230531095023051-1e0d2b41.png" alt="image-20230531095023051"></p><p>æ¯å®Œæˆä¸€ä¸ªé˜¶æ®µåœ¨ç›¸åº”çš„é˜¶æ®µçŠ¶æ€å­—æ®µæ‰“ä¸Šå®Œæˆæ ‡è®°ï¼Œå³ä½¿è¿™ä¸ªå¤§ä»»åŠ¡æ²¡æœ‰å®Œæˆå†é‡æ–°æ‰§è¡Œæ—¶ï¼Œå¦‚æœå°é˜¶æ®µä»»åŠ¡å®Œæˆäº†ä¹Ÿä¸ä¼šé‡å¤æ‰§è¡ŒæŸä¸ªå°é˜¶æ®µçš„ä»»åŠ¡ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œé™¤äº†æ¶ˆæ¯è¡¨çš„åŸºæœ¬çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥çš„æ¥å£å¤–ï¼Œæ¶ˆæ¯ SDK è¿˜å…·æœ‰å¦‚ä¸‹æ¥å£åŠŸèƒ½ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MqMessage</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 *  æœåŠ¡ç±»
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@since</span> 2022-09-21
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MqMessageService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MqMessage</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æ‰«ææ¶ˆæ¯è¡¨è®°å½•ï¼Œé‡‡ç”¨ä¸æ‰«æè§†é¢‘å¤„ç†è¡¨ç›¸åŒçš„æ€è·¯
     * <span class="token keyword">@param</span> <span class="token parameter">shardIndex</span> åˆ†ç‰‡åºå·
     * <span class="token keyword">@param</span> <span class="token parameter">shardTotal</span> åˆ†ç‰‡æ€»æ•°
     * <span class="token keyword">@param</span> <span class="token parameter">count</span> æ‰«æè®°å½•æ•°
     * <span class="token keyword">@return</span> java.util.List æ¶ˆæ¯è®°å½•
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/21 18:55
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MqMessage</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMessageList</span><span class="token punctuation">(</span><span class="token keyword">int</span> shardIndex<span class="token punctuation">,</span> <span class="token keyword">int</span> shardTotal<span class="token punctuation">,</span>  <span class="token class-name">String</span> messageType<span class="token punctuation">,</span><span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> å®Œæˆä»»åŠ¡
     * <span class="token keyword">@param</span> <span class="token parameter">id</span> æ¶ˆæ¯id
     * <span class="token keyword">@return</span> int æ›´æ–°æˆåŠŸï¼š1
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/21 20:49
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">completed</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> å®Œæˆé˜¶æ®µä»»åŠ¡
     * <span class="token keyword">@param</span> <span class="token parameter">id</span> æ¶ˆæ¯id
     * <span class="token keyword">@return</span> int æ›´æ–°æˆåŠŸï¼š1
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/21 20:49
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">completedStageOne</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">completedStageTwo</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">completedStageThree</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">completedStageFour</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æŸ¥è¯¢é˜¶æ®µçŠ¶æ€
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@return</span> int
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/21 20:54
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStageOne</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStageTwo</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStageThree</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStageFour</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¶ˆæ¯ SDK æä¾›æ¶ˆæ¯å¤„ç†æŠ½è±¡ç±»ï¼Œæ­¤æŠ½è±¡ç±»ä¾›ä½¿ç”¨æ–¹å»ç»§æ‰¿ä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MqMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> æ¶ˆæ¯å¤„ç†æŠ½è±¡ç±»
 * <span class="token keyword">@date</span> 2022/9/21 19:44
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MessageProcessAbstract</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MqMessageService</span> mqMessageService<span class="token punctuation">;</span>


    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">mqMessage</span> æ‰§è¡Œä»»åŠ¡å†…å®¹
     * <span class="token keyword">@return</span> boolean true:å¤„ç†æˆåŠŸï¼Œfalseå¤„ç†å¤±è´¥
     * <span class="token keyword">@description</span> ä»»åŠ¡å¤„ç†
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/21 19:47
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> mqMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æ‰«ææ¶ˆæ¯è¡¨å¤šçº¿ç¨‹æ‰§è¡Œä»»åŠ¡
     * <span class="token keyword">@param</span> <span class="token parameter">shardIndex</span> åˆ†ç‰‡åºå·
     * <span class="token keyword">@param</span> <span class="token parameter">shardTotal</span> åˆ†ç‰‡æ€»æ•°
     * <span class="token keyword">@param</span> <span class="token parameter">messageType</span>  æ¶ˆæ¯ç±»å‹
     * <span class="token keyword">@param</span> <span class="token parameter">count</span>  ä¸€æ¬¡å–å‡ºä»»åŠ¡æ€»æ•°
     * <span class="token keyword">@param</span> <span class="token parameter">timeout</span> é¢„ä¼°ä»»åŠ¡æ‰§è¡Œæ—¶é—´,åˆ°æ­¤æ—¶é—´å¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰ç»“æŸåˆ™å¼ºåˆ¶ç»“æŸ å•ä½ç§’
     * <span class="token keyword">@return</span> void
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/21 20:35
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">int</span> shardIndex<span class="token punctuation">,</span> <span class="token keyword">int</span> shardTotal<span class="token punctuation">,</span>  <span class="token class-name">String</span> messageType<span class="token punctuation">,</span><span class="token keyword">int</span> count<span class="token punctuation">,</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//æ‰«ææ¶ˆæ¯è¡¨è·å–ä»»åŠ¡æ¸…å•</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MqMessage</span><span class="token punctuation">&gt;</span></span> messageList <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">getMessageList</span><span class="token punctuation">(</span>shardIndex<span class="token punctuation">,</span> shardTotal<span class="token punctuation">,</span>messageType<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ä»»åŠ¡ä¸ªæ•°</span>
            <span class="token keyword">int</span> size <span class="token operator">=</span> messageList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å–å‡ºå¾…å¤„ç†æ¶ˆæ¯&quot;</span><span class="token operator">+</span>size<span class="token operator">+</span><span class="token string">&quot;æ¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//åˆ›å»ºçº¿ç¨‹æ± </span>
            <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è®¡æ•°å™¨</span>
            <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            messageList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>message <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹ä»»åŠ¡:{}&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//å¤„ç†ä»»åŠ¡</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token function">execute</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ:{})&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//æ›´æ–°ä»»åŠ¡çŠ¶æ€,åˆ é™¤æ¶ˆæ¯è¡¨è®°å½•,æ·»åŠ åˆ°å†å²è¡¨</span>
                            <span class="token keyword">int</span> completed <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">completed</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>completed<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ:{}&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡æ‰§è¡Œå¤±è´¥:{}&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡å‡ºç°å¼‚å¸¸:{},ä»»åŠ¡:{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//è®¡æ•°</span>
                    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æŸä»»åŠ¡:{}&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//ç­‰å¾…,ç»™ä¸€ä¸ªå……è£•çš„è¶…æ—¶æ—¶é—´,é˜²æ­¢æ— é™ç­‰å¾…ï¼Œåˆ°è¾¾è¶…æ—¶æ—¶é—´è¿˜æ²¡æœ‰å¤„ç†å®Œæˆåˆ™ç»“æŸä»»åŠ¡</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æŸ....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-2-æ¶ˆæ¯æ¨¡å—-sdk-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-4-2-æ¶ˆæ¯æ¨¡å—-sdk-æµ‹è¯•" aria-hidden="true">#</a> <strong>4.4.2 æ¶ˆæ¯æ¨¡å— SDK æµ‹è¯•</strong></h4><p>1ã€åœ¨å†…å®¹ç®¡ç†æ•°æ®åº“åˆ›å»ºæ¶ˆæ¯è¡¨å’Œæ¶ˆæ¯å†å²è¡¨</p><p>2ã€æ‹·è´è¯¾ç¨‹èµ„æ–™ä¸­çš„ xuecheng-plus-message-sdk åˆ°å·¥ç¨‹ç›®å½•ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531095112695-639ee39c.png" alt="image-20230531095112695"></p><p>3ã€ä¿®æ”¹ test ä¸‹çš„ bootstrap.yml ä¸­çš„æ•°æ®åº“è¿æ¥</p><p>ä¸‹è¾¹æµ‹è¯•æ¶ˆæ¯ SDK çš„æ¥å£ï¼š</p><p>1ã€ç»§æ‰¿ MessageProcessAbstract æŠ½è±¡ç±»ç¼–å†™ä»»åŠ¡æ‰§è¡Œæ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MqMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MessageProcessAbstract</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MqMessageService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æ¶ˆæ¯å¤„ç†æµ‹è¯•ç±»ï¼Œç»§æ‰¿MessageProcessAbstract
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/21 21:44
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageProcessClass</span> <span class="token keyword">extends</span> <span class="token class-name">MessageProcessAbstract</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MqMessageService</span> mqMessageService<span class="token punctuation">;</span>

    <span class="token comment">//æ‰§è¡Œä»»åŠ¡</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> mqMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Long</span> id <span class="token operator">=</span> mqMessage<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œä»»åŠ¡:{}&quot;</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//å–å‡ºé˜¶æ®µçŠ¶æ€</span>
        <span class="token keyword">int</span> stageOne <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">getStageOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>stageOne<span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œç¬¬ä¸€é˜¶æ®µä»»åŠ¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">completedStageOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å®Œæˆç¬¬ä¸€é˜¶æ®µä»»åŠ¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ— éœ€æ‰§è¡Œç¬¬ä¸€é˜¶æ®µä»»åŠ¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€ç¼–å†™æµ‹è¯•ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/9/21 21:51
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageProcessClassTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MessageProcessClass</span> messageProcessClass<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œ-----ã€‹&quot;</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageProcessClass<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æŸæ‰§è¡Œ-----ã€‹&quot;</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">9000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€å‡†å¤‡æµ‹è¯•æ•°æ®ï¼Œåœ¨æ¶ˆæ¯è¡¨æ·»åŠ æ¶ˆæ¯ç±»å‹ä¸º&quot;test&quot;çš„æ¶ˆæ¯</p><p>4ã€æ‰§è¡Œ MessageProcessClassTest ç±»ä¸­çš„ test()æ–¹æ³•ï¼Œè§‚å¯Ÿæ§åˆ¶å°ä»»åŠ¡æ‰§è¡Œçš„æ—¥å¿—ä¿¡æ¯ã€‚</p><h4 id="_4-4-3-é›†æˆæ¶ˆæ¯-sdk" tabindex="-1"><a class="header-anchor" href="#_4-4-3-é›†æˆæ¶ˆæ¯-sdk" aria-hidden="true">#</a> <strong>4.4.3 é›†æˆæ¶ˆæ¯ SDK</strong></h4><h5 id="_4-4-3-1-æ·»åŠ æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_4-4-3-1-æ·»åŠ æ¶ˆæ¯" aria-hidden="true">#</a> <strong>4.4.3.1 æ·»åŠ æ¶ˆæ¯</strong></h5><p>1ã€åœ¨å†…å®¹ç®¡ç†æ•°æ®åº“åˆ›å»ºæ¶ˆæ¯è¡¨å’Œæ¶ˆæ¯å†å²è¡¨</p><p>2ã€æ‹·è´è¯¾ç¨‹èµ„æ–™ä¸­çš„ xuecheng-plus-message-sdk åˆ°å·¥ç¨‹ç›®å½•ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531095112695-639ee39c.png" alt="image-20230531095215703"></p><p>3ã€åœ¨å†…å®¹ç®¡ç† service å·¥ç¨‹ä¸­æ·»åŠ  sdk ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.xuecheng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xuecheng-plus-message-sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€è¯¾ç¨‹å‘å¸ƒæ“ä½œä½¿ç”¨æœ¬åœ°äº‹åŠ¡ä¿å­˜è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ã€æ·»åŠ æ¶ˆæ¯è¡¨ã€‚</p><p>å›åˆ°å½“åˆç¼–å†™è¯¾ç¨‹å‘å¸ƒæ—¶çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

 <span class="token comment">//çº¦æŸæ ¡éªŒ</span>
 <span class="token comment">//æŸ¥è¯¢è¯¾ç¨‹é¢„å‘å¸ƒè¡¨</span>
 <span class="token class-name">CoursePublishPre</span> coursePublishPre <span class="token operator">=</span> coursePublishPreMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>coursePublishPre <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·å…ˆæäº¤è¯¾ç¨‹å®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡æ‰å¯ä»¥å‘å¸ƒ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//æœ¬æœºæ„åªå…è®¸æäº¤æœ¬æœºæ„çš„è¯¾ç¨‹</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>coursePublishPre<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸å…è®¸æäº¤å…¶å®ƒæœºæ„çš„è¯¾ç¨‹ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token comment">//è¯¾ç¨‹å®¡æ ¸çŠ¶æ€</span>
 <span class="token class-name">String</span> auditStatus <span class="token operator">=</span> coursePublishPre<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//å®¡æ ¸é€šè¿‡æ–¹å¯å‘å¸ƒ</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;202004&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>auditStatus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ“ä½œå¤±è´¥ï¼Œè¯¾ç¨‹å®¡æ ¸é€šè¿‡æ–¹å¯å‘å¸ƒã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//ä¿å­˜è¯¾ç¨‹å‘å¸ƒä¿¡æ¯</span>
 <span class="token function">saveCoursePublish</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">//ä¿å­˜æ¶ˆæ¯è¡¨</span>
 <span class="token function">saveCoursePublishMessage</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//åˆ é™¤è¯¾ç¨‹é¢„å‘å¸ƒè¡¨å¯¹åº”è®°å½•</span>
 coursePublishPreMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬è¦å¡«å……çš„ saveCoursePublishMessage(courseId)æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token doc-comment comment">/**
  * <span class="token keyword">@description</span> ä¿å­˜æ¶ˆæ¯è¡¨è®°å½•
  * <span class="token keyword">@param</span> <span class="token parameter">courseId</span>  è¯¾ç¨‹id
  * <span class="token keyword">@return</span> void
  * <span class="token keyword">@author</span> Mr.M
  * <span class="token keyword">@date</span> 2022/9/20 16:32
  */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveCoursePublishMessage</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token class-name">MqMessage</span> mqMessage <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span><span class="token string">&quot;course_publish&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>mqMessage<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token class-name">CommonError</span><span class="token punctuation">.</span><span class="token constant">UNKOWN_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è¾¹è¿›è¡Œæµ‹è¯•ï¼š</p><p>å‘å¸ƒä¸€é—¨è¯¾ç¨‹ï¼Œè§‚å¯Ÿæ¶ˆæ¯è¡¨æ˜¯å¦æ­£å¸¸æ·»åŠ æ¶ˆæ¯ã€‚</p><p>éœ€è¦æ‰‹åŠ¨ä¿®æ”¹è¯¾ç¨‹å®¡æ ¸çŠ¶æ€ä¸ºå®¡æ ¸é€šè¿‡æ‰§è¡Œå‘å¸ƒæ“ä½œï¼Œå‘å¸ƒåå¯ä»¥ä¿®æ”¹å‘å¸ƒçŠ¶æ€ä¸ºä¸‹æ¶é‡æ–°å‘å¸ƒæµ‹è¯•ã€‚</p><h5 id="_4-4-3-2-è¯¾ç¨‹å‘å¸ƒä»»åŠ¡å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_4-4-3-2-è¯¾ç¨‹å‘å¸ƒä»»åŠ¡å¤„ç†" aria-hidden="true">#</a> <strong>4.4.3.2 è¯¾ç¨‹å‘å¸ƒä»»åŠ¡å¤„ç†</strong></h5><p>åœ¨å†…å®¹ç®¡ç†æœåŠ¡æ·»åŠ æ¶ˆæ¯å¤„ç† sdk çš„ä¾èµ–å³å¯ä½¿ç”¨å®ƒï¼Œå®ç° sdk ä¸­çš„ MessageProcessAbstract ç±»ï¼Œé‡å†™ execte æ–¹æ³•ã€‚</p><p>å®ç° sdk ä¸­çš„ MessageProcessAbstract ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>service<span class="token punctuation">.</span>jobhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">MqMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>messagesdk<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">MessageProcessAbstract</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">XxlJobHelper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">XxlJob</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/9/22 10:16
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoursePublishTask</span> <span class="token keyword">extends</span> <span class="token class-name">MessageProcessAbstract</span> <span class="token punctuation">{</span>

    <span class="token comment">//è¯¾ç¨‹å‘å¸ƒä»»åŠ¡å¤„ç†</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> mqMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–æ¶ˆæ¯ç›¸å…³çš„ä¸šåŠ¡ä¿¡æ¯</span>
        <span class="token class-name">String</span> businessKey1 <span class="token operator">=</span> mqMessage<span class="token punctuation">.</span><span class="token function">getBusinessKey1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> courseId <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>businessKey1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¯¾ç¨‹é™æ€åŒ–</span>
        <span class="token function">generateCourseHtml</span><span class="token punctuation">(</span>mqMessage<span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¯¾ç¨‹ç´¢å¼•</span>
        <span class="token function">saveCourseIndex</span><span class="token punctuation">(</span>mqMessage<span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¯¾ç¨‹ç¼“å­˜</span>
        <span class="token function">saveCourseCache</span><span class="token punctuation">(</span>mqMessage<span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//ç”Ÿæˆè¯¾ç¨‹é™æ€åŒ–é¡µé¢å¹¶ä¸Šä¼ è‡³æ–‡ä»¶ç³»ç»Ÿ</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">generateCourseHtml</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> mqMessage<span class="token punctuation">,</span><span class="token keyword">long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>

        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹è¿›è¡Œè¯¾ç¨‹é™æ€åŒ–,è¯¾ç¨‹id:{}&quot;</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ¶ˆæ¯id</span>
        <span class="token class-name">Long</span> id <span class="token operator">=</span> mqMessage<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ¶ˆæ¯å¤„ç†çš„service</span>
        <span class="token class-name">MqMessageService</span> mqMessageService <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMqMessageService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ¶ˆæ¯å¹‚ç­‰æ€§å¤„ç†</span>
        <span class="token keyword">int</span> stageOne <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">getStageOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>stageOne <span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹é™æ€åŒ–å·²å¤„ç†ç›´æ¥è¿”å›ï¼Œè¯¾ç¨‹id:{}&quot;</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ä¿å­˜ç¬¬ä¸€é˜¶æ®µçŠ¶æ€</span>
        mqMessageService<span class="token punctuation">.</span><span class="token function">completedStageOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//å°†è¯¾ç¨‹ä¿¡æ¯ç¼“å­˜è‡³redis</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveCourseCache</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> mqMessage<span class="token punctuation">,</span><span class="token keyword">long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å°†è¯¾ç¨‹ä¿¡æ¯ç¼“å­˜è‡³redis,è¯¾ç¨‹id:{}&quot;</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>
    <span class="token comment">//ä¿å­˜è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveCourseIndex</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> mqMessage<span class="token punctuation">,</span><span class="token keyword">long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯,è¯¾ç¨‹id:{}&quot;</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-4-3-3-å¼€å¯ä»»åŠ¡è°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#_4-4-3-3-å¼€å¯ä»»åŠ¡è°ƒåº¦" aria-hidden="true">#</a> <strong>4.4.3.3 å¼€å¯ä»»åŠ¡è°ƒåº¦</strong></h5><p>1ã€é¦–å…ˆåœ¨å†…å®¹ç®¡ç† service å·¥ç¨‹ä¸­æ·»åŠ  xxl-job ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.xuxueli<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xxl-job-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€é…ç½®æ‰§è¡Œå™¨</p><p>åœ¨ nacos ä¸­åœ¨ content-service-dev.yaml ä¸­é…ç½®</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">xxl</span><span class="token punctuation">:</span>
  <span class="token key atrule">job</span><span class="token punctuation">:</span>
    <span class="token key atrule">admin</span><span class="token punctuation">:</span>
      <span class="token key atrule">addresses</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//192.168.101.65<span class="token punctuation">:</span>8088/xxl<span class="token punctuation">-</span>job<span class="token punctuation">-</span>admin
    <span class="token key atrule">executor</span><span class="token punctuation">:</span>
      <span class="token key atrule">appname</span><span class="token punctuation">:</span> coursepublish<span class="token punctuation">-</span>job
      <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token key atrule">ip</span><span class="token punctuation">:</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8999</span>
      <span class="token key atrule">logpath</span><span class="token punctuation">:</span> /data/applogs/xxl<span class="token punctuation">-</span>job/jobhandler
      <span class="token key atrule">logretentiondays</span><span class="token punctuation">:</span> <span class="token number">30</span>
    <span class="token key atrule">accessToken</span><span class="token punctuation">:</span> default_token
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€ä»åª’èµ„ç®¡ç†æœåŠ¡å±‚å·¥ç¨‹ä¸­æ‹·è´ä¸€ä¸ª XxlJobConfig é…ç½®ç±»åˆ°å†…å®¹ç®¡ç† service å·¥ç¨‹ä¸­ã€‚</p><p>åœ¨ xxl-job-admin æ§åˆ¶å°ä¸­æ·»åŠ æ‰§è¡Œå™¨</p><p><img src="/MyBlog/assets/image-20230531095400772-b6fd48c5.png" alt="image-20230531095400772"></p><p>3ã€ç¼–å†™ä»»åŠ¡è°ƒåº¦å…¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoursePublishTask</span> <span class="token keyword">extends</span> <span class="token class-name">MessageProcessAbstract</span> <span class="token punctuation">{</span>

    <span class="token comment">//ä»»åŠ¡è°ƒåº¦å…¥å£</span>
    <span class="token annotation punctuation">@XxlJob</span><span class="token punctuation">(</span><span class="token string">&quot;CoursePublishJobHandler&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">coursePublishJobHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ†ç‰‡å‚æ•°</span>
        <span class="token keyword">int</span> shardIndex <span class="token operator">=</span> <span class="token class-name">XxlJobHelper</span><span class="token punctuation">.</span><span class="token function">getShardIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> shardTotal <span class="token operator">=</span> <span class="token class-name">XxlJobHelper</span><span class="token punctuation">.</span><span class="token function">getShardTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;shardIndex=&quot;</span><span class="token operator">+</span>shardIndex<span class="token operator">+</span><span class="token string">&quot;,shardTotal=&quot;</span><span class="token operator">+</span>shardTotal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å‚æ•°:åˆ†ç‰‡åºå·ã€åˆ†ç‰‡æ€»æ•°ã€æ¶ˆæ¯ç±»å‹ã€ä¸€æ¬¡æœ€å¤šå–åˆ°çš„ä»»åŠ¡æ•°é‡ã€ä¸€æ¬¡ä»»åŠ¡è°ƒåº¦æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´</span>
        <span class="token function">process</span><span class="token punctuation">(</span>shardIndex<span class="token punctuation">,</span>shardTotal<span class="token punctuation">,</span><span class="token string">&quot;course_publish&quot;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€åœ¨ xxl-job æ·»åŠ ä»»åŠ¡</p><p><img src="/MyBlog/assets/image-20230531095419302-9b340b8b.png" alt="image-20230531095419302"></p><p>ä»»åŠ¡é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531095422599-63a10e3d.png" alt="image-20230531095422599"></p><p>åˆ°æ­¤ SDK å¼€å‘ã€é›†æˆå®Œæˆï¼Œä¸‹ä¸€æ­¥æ·»åŠ è¯¾ç¨‹å‘å¸ƒåé¡µé¢é™æ€åŒ–ã€è¯¾ç¨‹ç¼“å­˜ã€è¯¾ç¨‹ç´¢å¼•ç­‰ä»»åŠ¡ã€‚</p><h5 id="_4-4-3-4-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-4-3-4-æµ‹è¯•" aria-hidden="true">#</a> <strong>4.4.3.4 æµ‹è¯•</strong></h5><p>åœ¨æ¶ˆæ¯è¡¨æ·»åŠ è¯¾ç¨‹å‘å¸ƒçš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯ç±»å‹ä¸º course_publish,business_key1 ä¸ºå‘å¸ƒè¯¾ç¨‹çš„ ID</p><p>1ã€æµ‹è¯•æ˜¯å¦å¯ä»¥æ­£å¸¸è°ƒåº¦æ‰§è¡Œã€‚</p><p>2ã€æµ‹è¯•ä»»åŠ¡å¹‚ç­‰æ€§</p><p>åœ¨ saveCourseCache(mqMessage,courseId);å¤„æ‰“æ–­ç‚¹ï¼Œå¾…æ‰§è¡Œåˆ°è¿™é‡Œè§‚å¯Ÿæ•°æ®åº“ç¬¬ä¸€é˜¶æ®µå®Œæˆçš„æ ‡è®°é¢„æœŸæ ‡è®°ä¸º 1ã€‚</p><p>ç»“æŸè¿›ç¨‹ï¼Œå†é‡æ–°å¯åŠ¨ï¼Œè§‚å¯Ÿç¬¬ä¸€é˜¶æ®µçš„ä»»åŠ¡é¢„æœŸä¸å†æ‰§è¡Œã€‚</p><p>3ã€ä»»åŠ¡æ‰§è¡Œå®Œæˆåˆ é™¤æ¶ˆæ¯è¡¨è®°å½•ï¼Œæ’å…¥å†å²è¡¨ï¼Œstate çŠ¶æ€å­—æ®µä¸º 1</p><h3 id="_4-5-é¡µé¢é™æ€åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-5-é¡µé¢é™æ€åŒ–" aria-hidden="true">#</a> <strong>4.5 é¡µé¢é™æ€åŒ–</strong></h3><h4 id="_4-5-1-ä»€ä¹ˆæ˜¯é¡µé¢é™æ€åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-5-1-ä»€ä¹ˆæ˜¯é¡µé¢é™æ€åŒ–" aria-hidden="true">#</a> <strong>4.5.1 ä»€ä¹ˆæ˜¯é¡µé¢é™æ€åŒ–</strong></h4><p>æ ¹æ®è¯¾ç¨‹å‘å¸ƒçš„æ“ä½œæµç¨‹ï¼Œæ‰§è¡Œè¯¾ç¨‹å‘å¸ƒåè¦å°†è¯¾ç¨‹è¯¦æƒ…ä¿¡æ¯é¡µé¢é™æ€åŒ–ï¼Œç”Ÿæˆ html é¡µé¢ä¸Šä¼ è‡³æ–‡ä»¶ç³»ç»Ÿã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯é¡µé¢é™æ€åŒ–ï¼Ÿ</p></blockquote><p>è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½é€šè¿‡æ¨¡æ¿å¼•æ“æŠ€æœ¯åœ¨é¡µé¢æ¨¡æ¿ä¸­å¡«å……æ•°æ®ï¼Œç”Ÿæˆ html é¡µé¢ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å½“å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨æ—¶æœåŠ¡å™¨æ‰å¼€å§‹æ¸²æŸ“ç”Ÿæˆ html é¡µé¢ï¼Œæœ€åå“åº”ç»™æµè§ˆå™¨ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“çš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚</p><p>é¡µé¢é™æ€åŒ–åˆ™å¼ºè°ƒå°†ç”Ÿæˆ html é¡µé¢çš„è¿‡ç¨‹æå‰ï¼Œæå‰ä½¿ç”¨æ¨¡æ¿å¼•æ“æŠ€æœ¯ç”Ÿæˆ html é¡µé¢ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚æ—¶ç›´æ¥è¯·æ±‚ html é¡µé¢ï¼Œç”±äºæ˜¯é™æ€é¡µé¢å¯ä»¥ä½¿ç”¨ nginxã€apache ç­‰é«˜æ€§èƒ½çš„ web æœåŠ¡å™¨ï¼Œå¹¶å‘æ€§èƒ½é«˜ã€‚</p><blockquote><p>ä»€ä¹ˆæ—¶å€™èƒ½ç”¨é¡µé¢é™æ€åŒ–æŠ€æœ¯ï¼Ÿ</p></blockquote><p>å½“æ•°æ®å˜åŒ–ä¸é¢‘ç¹ï¼Œä¸€æ—¦ç”Ÿæˆé™æ€é¡µé¢å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…å¾ˆå°‘å˜åŒ–ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨é¡µé¢é™æ€åŒ–ã€‚å› ä¸ºå¦‚æœæ•°æ®å˜åŒ–é¢‘ç¹ï¼Œä¸€æ—¦æ”¹å˜å°±éœ€è¦é‡æ–°ç”Ÿæˆé™æ€é¡µé¢ï¼Œå¯¼è‡´ç»´æŠ¤é™æ€é¡µé¢çš„å·¥ä½œé‡å¾ˆå¤§ã€‚</p><p>æ ¹æ®è¯¾ç¨‹å‘å¸ƒçš„ä¸šåŠ¡éœ€æ±‚ï¼Œè™½ç„¶è¯¾ç¨‹å‘å¸ƒåä»å¯ä»¥ä¿®æ”¹è¯¾ç¨‹ä¿¡æ¯ï¼Œä½†éœ€è¦ç»è¿‡è¯¾ç¨‹å®¡æ ¸ï¼Œä¸”ä¿®æ”¹é¢‘åº¦ä¸å¤§ï¼Œæ‰€ä»¥é€‚åˆä½¿ç”¨é¡µé¢é™æ€åŒ–ã€‚</p><h4 id="_4-5-2-é™æ€åŒ–æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-5-2-é™æ€åŒ–æµ‹è¯•" aria-hidden="true">#</a> <strong>4.5.2 é™æ€åŒ–æµ‹è¯•</strong></h4><p>ä¸‹è¾¹ä½¿ç”¨ freemarker æŠ€æœ¯å¯¹é¡µé¢é™æ€åŒ–ç”Ÿæˆ html é¡µé¢ã€‚</p><p>åœ¨å†…å®¹ç®¡ç† service å·¥ç¨‹ä¸­æ·»åŠ  freemarker ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–å†™æµ‹è¯•æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">CoursePreviewDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CoursePublishService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">freemarker<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">freemarker<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">Template</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">freemarker<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">TemplateException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>freemarker<span class="token punctuation">.</span></span><span class="token class-name">FreeMarkerTemplateUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> freemarkeræµ‹è¯•
 * <span class="token keyword">@date</span> 2022/9/20 18:42
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FreemarkerTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">CoursePublishService</span> coursePublishService<span class="token punctuation">;</span>


    <span class="token comment">//æµ‹è¯•é¡µé¢é™æ€åŒ–</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGenerateHtmlByTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TemplateException</span> <span class="token punctuation">{</span>
        <span class="token comment">//é…ç½®freemarker</span>
        <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//åŠ è½½æ¨¡æ¿</span>
        <span class="token comment">//é€‰æŒ‡å®šæ¨¡æ¿è·¯å¾„,classpathä¸‹templatesä¸‹</span>
        <span class="token comment">//å¾—åˆ°classpathè·¯å¾„</span>
        <span class="token class-name">String</span> classpath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">setDirectoryForTemplateLoading</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>classpath <span class="token operator">+</span> <span class="token string">&quot;/templates/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®å­—ç¬¦ç¼–ç </span>
        configuration<span class="token punctuation">.</span><span class="token function">setDefaultEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æŒ‡å®šæ¨¡æ¿æ–‡ä»¶åç§°</span>
        <span class="token class-name">Template</span> template <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;course_template.ftl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//å‡†å¤‡æ•°æ®</span>
        <span class="token class-name">CoursePreviewDto</span> coursePreviewInfo <span class="token operator">=</span> coursePublishService<span class="token punctuation">.</span><span class="token function">getCoursePreviewInfo</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;model&quot;</span><span class="token punctuation">,</span> coursePreviewInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//é™æ€åŒ–</span>
        <span class="token comment">//å‚æ•°1ï¼šæ¨¡æ¿ï¼Œå‚æ•°2ï¼šæ•°æ®æ¨¡å‹</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token class-name">FreeMarkerTemplateUtils</span><span class="token punctuation">.</span><span class="token function">processTemplateIntoString</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†é™æ€åŒ–å†…å®¹è¾“å‡ºåˆ°æ–‡ä»¶ä¸­</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">toInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¾“å‡ºæµ</span>
        <span class="token class-name">FileOutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\develop\\test.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°† content-api å·¥ç¨‹ä¸‹çš„æ¨¡æ¿æ‹·è´åˆ° content-service å·¥ç¨‹ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531095526797-404ef62d.png" alt="image-20230531095526797"></p><p>æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼Œè§‚å¯Ÿ D:\\develop\\test.html æ˜¯å¦æˆåŠŸç”Ÿæˆã€‚</p><h4 id="_4-5-3-ä¸Šä¼ æ–‡ä»¶æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-5-3-ä¸Šä¼ æ–‡ä»¶æµ‹è¯•" aria-hidden="true">#</a> <strong>4.5.3 ä¸Šä¼ æ–‡ä»¶æµ‹è¯•</strong></h4><h5 id="_4-5-3-1-é…ç½®è¿œç¨‹è°ƒç”¨ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_4-5-3-1-é…ç½®è¿œç¨‹è°ƒç”¨ç¯å¢ƒ" aria-hidden="true">#</a> <strong>4.5.3.1 é…ç½®è¿œç¨‹è°ƒç”¨ç¯å¢ƒ</strong></h5><p>é™æ€åŒ–ç”Ÿæˆæ–‡ä»¶åéœ€è¦ä¸Šä¼ è‡³åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ ¹æ®å¾®æœåŠ¡çš„èŒè´£åˆ’åˆ†ï¼Œåª’èµ„ç®¡ç†æœåŠ¡è´Ÿè´£ç»´æŠ¤æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ï¼Œæ‰€ä»¥å†…å®¹ç®¡ç†æœåŠ¡å¯¹é¡µé¢é™æ€åŒ–ç”Ÿæˆ html æ–‡ä»¶éœ€è¦è°ƒç”¨åª’èµ„ç®¡ç†æœåŠ¡çš„ä¸Šä¼ æ–‡ä»¶æ¥å£ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531094752141-89013dbf.png" alt="image-20230531095531832"></p><p>å¾®æœåŠ¡ä¹‹é—´éš¾å…ä¼šå­˜åœ¨è¿œç¨‹è°ƒç”¨ï¼Œåœ¨ Spring Cloud ä¸­å¯ä»¥ä½¿ç”¨ Feign è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œ</p><p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ http å®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€ï¼š<a href="https://github.com/OpenFeign/feign" target="_blank" rel="noopener noreferrer">https://github.com/OpenFeign/feign<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å…¶ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„å®ç° http è¯·æ±‚çš„å‘é€ï¼Œè§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚</p><p>ä¸‹è¾¹å…ˆå‡†å¤‡ Feign çš„å¼€å‘ç¯å¢ƒ:</p><p>1ã€åœ¨å†…å®¹ç®¡ç† content-service å·¥ç¨‹æ·»åŠ ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Spring Cloud å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--feignæ”¯æŒMultipartæ ¼å¼ä¼ å‚--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign.form<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-form<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign.form<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-form-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€åœ¨ nacos é…ç½® feign-dev.yaml å…¬ç”¨é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">hystrix</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">circuitbreaker</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">hystrix</span><span class="token punctuation">:</span>
  <span class="token key atrule">command</span><span class="token punctuation">:</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">execution</span><span class="token punctuation">:</span>
        <span class="token key atrule">isolation</span><span class="token punctuation">:</span>
          <span class="token key atrule">thread</span><span class="token punctuation">:</span>
            <span class="token key atrule">timeoutInMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span> <span class="token comment">#ç†”æ–­è¶…æ—¶æ—¶é—´</span>
<span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
  <span class="token key atrule">ConnectTimeout</span><span class="token punctuation">:</span> <span class="token number">60000</span> <span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´</span>
  <span class="token key atrule">ReadTimeout</span><span class="token punctuation">:</span> <span class="token number">60000</span> <span class="token comment">#è¯»è¶…æ—¶æ—¶é—´</span>
  <span class="token key atrule">MaxAutoRetries</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment">#é‡è¯•æ¬¡æ•°</span>
  <span class="token key atrule">MaxAutoRetriesNextServer</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment">#åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€åœ¨å†…å®¹ç®¡ç† service å·¥ç¨‹å’Œå†…å®¹ç®¡ç† api å·¥ç¨‹éƒ½å¼•å…¥æ­¤é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">shared-configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> feign<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
    <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€åœ¨å†…å®¹ç®¡ç† service å·¥ç¨‹é…ç½® feign æ”¯æŒ Multipartï¼Œæ‹·è´è¯¾ç¨‹èµ„æ–™ä¸‹çš„ MultipartSupportConfig åˆ° content-service å·¥ç¨‹ä¸‹çš„ config åŒ…ä¸‹ã€‚</p><h5 id="_4-5-3-2-æ‰©å……ä¸Šä¼ æ–‡ä»¶æ¥å£" tabindex="-1"><a class="header-anchor" href="#_4-5-3-2-æ‰©å……ä¸Šä¼ æ–‡ä»¶æ¥å£" aria-hidden="true">#</a> <strong>4.5.3.2 æ‰©å……ä¸Šä¼ æ–‡ä»¶æ¥å£</strong></h5><p>ç°åœ¨éœ€è¦å°†è¯¾ç¨‹çš„é™æ€æ–‡ä»¶ä¸Šä¼ åˆ° minioï¼Œå•ç‹¬å­˜å‚¨åˆ° course ç›®å½•ä¸‹ï¼Œæ–‡ä»¶çš„ objectname ä¸º&quot;è¯¾ç¨‹ id.html&quot;ï¼ŒåŸæœ‰çš„ä¸Šä¼ æ–‡ä»¶æ¥å£éœ€è¦å¢åŠ ä¸€ä¸ªå‚æ•° objectnameã€‚</p><p>ä¸‹è¾¹æ‰©å……åª’èµ„æœåŠ¡çš„ä¸Šä¼ æ–‡ä»¶æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ æ–‡ä»¶&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/upload/coursefile&quot;</span><span class="token punctuation">,</span>consumes <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">MULTIPART_FORM_DATA_VALUE</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UploadFileResultDto</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">&quot;filedata&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> filedata<span class="token punctuation">,</span>
                                  <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value<span class="token operator">=</span> <span class="token string">&quot;objectName&quot;</span><span class="token punctuation">,</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
                                  <span class="token comment">//....</span>
 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>service æ¥å£ä¹Ÿå¢åŠ ä¸€ä¸ªå‚æ•°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä¸Šä¼ æ–‡ä»¶
 * <span class="token keyword">@param</span> <span class="token parameter">companyId</span> æœºæ„id
 * <span class="token keyword">@param</span> <span class="token parameter">uploadFileParamsDto</span> ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯
 * <span class="token keyword">@param</span> <span class="token parameter">localFilePath</span> æ–‡ä»¶ç£ç›˜è·¯å¾„
 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> å¯¹è±¡å
 * <span class="token keyword">@return</span> æ–‡ä»¶ä¿¡æ¯
 */</span>
<span class="token keyword">public</span> <span class="token class-name">UploadFileResultDto</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span> <span class="token class-name">UploadFileParamsDto</span> uploadFileParamsDto<span class="token punctuation">,</span> <span class="token class-name">String</span> localFilePath<span class="token punctuation">,</span><span class="token class-name">String</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹åŸæœ‰ uploadFile æ–¹æ³•ï¼Œåˆ¤æ–­å¦‚æœ objectName ä¸ºç©ºåˆ™é‡‡å–å¹´æœˆæ—¥æ ·å¼çš„è·¯å¾„æ–¹å¼ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//å­˜å‚¨åˆ°minioä¸­çš„å¯¹è±¡å(å¸¦ç›®å½•)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    objectName <span class="token operator">=</span>  defaultFolderPath <span class="token operator">+</span> fileMd5 <span class="token operator">+</span> extension<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//        String objectName = defaultFolderPath + fileMd5 + extension;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-5-3-3-è¿œç¨‹è°ƒç”¨æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-5-3-3-è¿œç¨‹è°ƒç”¨æµ‹è¯•" aria-hidden="true">#</a> <strong>4.5.3.3 è¿œç¨‹è°ƒç”¨æµ‹è¯•</strong></h5><p>åœ¨ content-service ä¸‹ç¼–å†™ feign æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>feignclient</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">MultipartSupportConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestPart</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> åª’èµ„ç®¡ç†æœåŠ¡è¿œç¨‹æ¥å£
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/20 20:29
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;media-api&quot;</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">MultipartSupportConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MediaServiceClient</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/media/upload/coursefile&quot;</span><span class="token punctuation">,</span>consumes <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">MULTIPART_FORM_DATA_VALUE</span><span class="token punctuation">)</span>
 <span class="token class-name">String</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">&quot;filedata&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> upload<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;objectName&quot;</span><span class="token punctuation">,</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¯åŠ¨ç±»æ·»åŠ @EnableFeignClients æ³¨è§£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;com.xuecheng.content.feignclient&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–å†™æµ‹è¯•æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>feignclient<span class="token punctuation">.</span></span><span class="token class-name">MediaServiceClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span></span><span class="token class-name">FileItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span>disk<span class="token punctuation">.</span></span><span class="token class-name">DiskFileItemFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span>commons<span class="token punctuation">.</span></span><span class="token class-name">CommonsMultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> æµ‹è¯•ä½¿ç”¨feignè¿œç¨‹ä¸Šä¼ æ–‡ä»¶
 * <span class="token keyword">@date</span> 2022/9/20 20:36
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignUploadTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MediaServiceClient</span> mediaServiceClient<span class="token punctuation">;</span>

    <span class="token comment">//è¿œç¨‹è°ƒç”¨ï¼Œä¸Šä¼ æ–‡ä»¶</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">MultipartFile</span> multipartFile <span class="token operator">=</span> <span class="token class-name">MultipartSupportConfig</span><span class="token punctuation">.</span><span class="token function">getMultipartFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\develop\\test.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaServiceClient<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>multipartFile<span class="token punctuation">,</span><span class="token string">&quot;course/test.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è¾¹è¿›è¡Œæµ‹è¯•ï¼Œå¯åŠ¨åª’èµ„æœåŠ¡ï¼Œæ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼Œä¸Šä¼ æ–‡ä»¶æˆåŠŸï¼Œè¿›å…¥ minIO æŸ¥çœ‹æ–‡ä»¶</p><p><img src="/MyBlog/assets/image-20230531095749816-02baf242.png" alt="image-20230531095749816"></p><p>è®¿é—®ï¼šhttp://192.168.101.65:9000/mediafiles/course/74b386417bb9f3764009dc94068a5e44.html</p><p>æŸ¥çœ‹æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p><h4 id="_4-5-4-ç†”æ–­é™çº§å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_4-5-4-ç†”æ–­é™çº§å¤„ç†" aria-hidden="true">#</a> <strong>4.5.4 ç†”æ–­é™çº§å¤„ç†</strong></h4><h5 id="_4-5-4-1-ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§" tabindex="-1"><a class="header-anchor" href="#_4-5-4-1-ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§" aria-hidden="true">#</a> <strong>4.5.4.1 ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§</strong></h5><p>å¾®æœåŠ¡ä¸­éš¾å…å­˜åœ¨æœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨ï¼Œæ¯”å¦‚ï¼šå†…å®¹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨åª’èµ„æœåŠ¡çš„ä¸Šä¼ æ–‡ä»¶æ¥å£ï¼Œå½“å¾®æœåŠ¡è¿è¡Œä¸æ­£å¸¸ä¼šå¯¼è‡´æ— æ³•æ­£å¸¸è°ƒç”¨å¾®æœåŠ¡ï¼Œæ­¤æ—¶ä¼šå‡ºç°å¼‚å¸¸ï¼Œå¦‚æœè¿™ç§å¼‚å¸¸ä¸å»å¤„ç†å¯èƒ½å¯¼è‡´é›ªå´©æ•ˆåº”ã€‚</p><p>å¾®æœåŠ¡çš„é›ªå´©æ•ˆåº”è¡¨ç°åœ¨æœåŠ¡ä¸æœåŠ¡ä¹‹é—´è°ƒç”¨ï¼Œå½“å…¶ä¸­ä¸€ä¸ªæœåŠ¡æ— æ³•æä¾›æœåŠ¡å¯èƒ½å¯¼è‡´å…¶å®ƒæœåŠ¡ä¹Ÿæ­»æ‰ï¼Œæ¯”å¦‚ï¼šæœåŠ¡ B è°ƒç”¨æœåŠ¡ Aï¼Œç”±äº A æœåŠ¡å¼‚å¸¸å¯¼è‡´ B æœåŠ¡å“åº”ç¼“æ…¢ï¼Œæœ€å Bã€C ç­‰æœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œåƒè¿™æ ·ç”±ä¸€ä¸ªæœåŠ¡æ‰€å¼•èµ·çš„ä¸€è¿ä¸²çš„å¤šä¸ªæœåŠ¡æ— æ³•æä¾›æœåŠ¡å³æ˜¯å¾®æœåŠ¡çš„é›ªå´©æ•ˆåº”ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531095756887-7bfe01ab.png" alt="image-20230531095756887"></p><p>å¦‚ä½•è§£å†³ç”±äºå¾®æœåŠ¡å¼‚å¸¸å¼•èµ·çš„é›ªå´©æ•ˆåº”å‘¢ï¼Ÿ</p><p>å¯ä»¥é‡‡ç”¨ç†”æ–­ã€é™çº§çš„æ–¹æ³•å»è§£å†³ã€‚</p><p>ç†”æ–­é™çº§çš„ç›¸åŒç‚¹éƒ½æ˜¯ä¸ºäº†è§£å†³å¾®æœåŠ¡ç³»ç»Ÿå´©æºƒçš„é—®é¢˜ï¼Œä½†å®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æŠ€æœ¯æ‰‹æ®µï¼Œä¸¤è€…åˆå­˜åœ¨è”ç³»ã€‚</p><p>ç†”æ–­ï¼š</p><p>å½“ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸è€Œæ–­å¼€ä¸ä¸Šæ¸¸æœåŠ¡çš„äº¤äº’ï¼Œå®ƒå°±ç›¸å½“äºä¿é™©ä¸ï¼Œä¸‹æ¸¸æœåŠ¡å¼‚å¸¸è§¦å‘äº†ç†”æ–­ï¼Œä»è€Œä¿è¯ä¸Šæ¸¸æœåŠ¡ä¸å—å½±å“ã€‚</p><p><img src="/MyBlog/assets/image-20230531095803107-a6f22ab3.png" alt="image-20230531095803107"></p><p>é™çº§ï¼š</p><p>å½“ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸è§¦å‘ç†”æ–­åï¼Œä¸Šæ¸¸æœåŠ¡å°±ä¸å†å»è°ƒç”¨å¼‚å¸¸çš„å¾®æœåŠ¡è€Œæ˜¯æ‰§è¡Œäº†é™çº§å¤„ç†é€»è¾‘ï¼Œè¿™ä¸ªé™çº§å¤„ç†é€»è¾‘å¯ä»¥æ˜¯æœ¬åœ°ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</p><p><img src="/MyBlog/assets/image-20230531095809466-9b74a196.png" alt="image-20230531095809466"></p><p>ä¸¤è€…éƒ½æ˜¯ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œç†”æ–­æ˜¯å½“ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸æ—¶ä¸€ç§ä¿æŠ¤ç³»ç»Ÿçš„æ‰‹æ®µï¼Œé™çº§æ˜¯ç†”æ–­åä¸Šæ¸¸æœåŠ¡å¤„ç†ç†”æ–­çš„æ–¹æ³•ã€‚</p><h5 id="_4-5-4-2-ç†”æ–­é™çº§å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_4-5-4-2-ç†”æ–­é™çº§å¤„ç†" aria-hidden="true">#</a> <strong>4.5.4.2 ç†”æ–­é™çº§å¤„ç†</strong></h5><p>é¡¹ç›®ä½¿ç”¨ Hystrix æ¡†æ¶å®ç°ç†”æ–­ã€é™çº§å¤„ç†ï¼Œåœ¨ feign-dev.yaml ä¸­é…ç½®ã€‚</p><p>1ã€å¼€å¯ Feign ç†”æ–­ä¿æŠ¤</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">hystrix</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">circuitbreaker</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€è®¾ç½®ç†”æ–­çš„è¶…æ—¶æ—¶é—´ï¼Œä¸ºäº†é˜²æ­¢ä¸€æ¬¡å¤„ç†æ—¶é—´è¾ƒé•¿è§¦å‘ç†”æ–­è¿™é‡Œè¿˜éœ€è¦è®¾ç½®è¯·æ±‚å’Œè¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">hystrix</span><span class="token punctuation">:</span>
  <span class="token key atrule">command</span><span class="token punctuation">:</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">execution</span><span class="token punctuation">:</span>
        <span class="token key atrule">isolation</span><span class="token punctuation">:</span>
          <span class="token key atrule">thread</span><span class="token punctuation">:</span>
            <span class="token key atrule">timeoutInMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span> <span class="token comment">#ç†”æ–­è¶…æ—¶æ—¶é—´</span>
<span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
  <span class="token key atrule">ConnectTimeout</span><span class="token punctuation">:</span> <span class="token number">60000</span> <span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´</span>
  <span class="token key atrule">ReadTimeout</span><span class="token punctuation">:</span> <span class="token number">60000</span> <span class="token comment">#è¯»è¶…æ—¶æ—¶é—´</span>
  <span class="token key atrule">MaxAutoRetries</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment">#é‡è¯•æ¬¡æ•°</span>
  <span class="token key atrule">MaxAutoRetriesNextServer</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment">#åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€å®šä¹‰é™çº§é€»è¾‘</p><p>ä¸¤ç§æ–¹æ³•ï¼š</p><p>1ï¼‰fallback</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;media-api&quot;</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">MultipartSupportConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token class-name">MediaServiceClientFallback</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/media&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MediaServiceClient</span><span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ä¸€ä¸ª fallback ç±» MediaServiceClientFallbackï¼Œæ­¤ç±»å®ç°äº† MediaServiceClient æ¥å£ã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•æ— æ³•å–å‡ºç†”æ–­æ‰€æŠ›å‡ºçš„å¼‚å¸¸ï¼Œç¬¬äºŒç§æ–¹æ³•å®šä¹‰ MediaServiceClientFallbackFactory å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>2ï¼‰fallbackFactory</p><p>ç¬¬äºŒç§æ–¹æ³•åœ¨ FeignClient ä¸­æŒ‡å®š fallbackFactory ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;media-api&quot;</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">MultipartSupportConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>fallbackFactory <span class="token operator">=</span> <span class="token class-name">MediaServiceClientFallbackFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ MediaServiceClientFallbackFactory å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediaServiceClientFallbackFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaServiceClient</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">MediaServiceClient</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MediaServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> upload<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//é™çº§æ–¹æ³•</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨åª’èµ„ç®¡ç†æœåŠ¡ä¸Šä¼ æ–‡ä»¶æ—¶å‘ç”Ÿç†”æ–­ï¼Œå¼‚å¸¸ä¿¡æ¯:{}&quot;</span><span class="token punctuation">,</span>throwable<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>throwable<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é™çº§å¤„ç†é€»è¾‘ï¼š</p><p>è¿”å›ä¸€ä¸ª null å¯¹è±¡ï¼Œä¸Šæ¸¸æœåŠ¡è¯·æ±‚æ¥å£å¾—åˆ°ä¸€ä¸ª null è¯´æ˜æ‰§è¡Œäº†é™çº§å¤„ç†ã€‚</p><p>æµ‹è¯•ï¼š</p><p>åœæ­¢åª’èµ„ç®¡ç†æœåŠ¡æˆ–äººä¸ºåˆ¶é€ å¼‚å¸¸è§‚å¯Ÿæ˜¯å¦æ‰§è¡Œé™çº§é€»è¾‘ã€‚</p><h4 id="_4-5-4-è¯¾ç¨‹é™æ€åŒ–å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_4-5-4-è¯¾ç¨‹é™æ€åŒ–å¼€å‘" aria-hidden="true">#</a> <strong>4.5.4 è¯¾ç¨‹é™æ€åŒ–å¼€å‘</strong></h4><p>è¯¾ç¨‹é¡µé¢é™æ€åŒ–å’Œé™æ€é¡µé¢è¿œç¨‹ä¸Šä¼ æµ‹è¯•é€šè¿‡ï¼Œä¸‹ä¸€æ­¥å¼€å‘è¯¾ç¨‹é™æ€åŒ–åŠŸèƒ½ï¼Œæœ€ç»ˆä½¿ç”¨æ¶ˆæ¯å¤„ç† SDK å»è°ƒåº¦æ‰§è¡Œã€‚</p><h5 id="_4-5-4-1-é™æ€åŒ–å®ç°" tabindex="-1"><a class="header-anchor" href="#_4-5-4-1-é™æ€åŒ–å®ç°" aria-hidden="true">#</a> <strong>4.5.4.1 é™æ€åŒ–å®ç°</strong></h5><p>è¯¾ç¨‹é™æ€åŒ–åŒ…æ‹¬ä¸¤éƒ¨åˆ†å·¥ä½œï¼šç”Ÿæˆè¯¾ç¨‹é™æ€åŒ–é¡µé¢ï¼Œä¸Šä¼ é™æ€é¡µé¢åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚</p><p>åœ¨è¯¾ç¨‹å‘å¸ƒçš„ service ç¼–å†™è¿™ä¸¤éƒ¨åˆ†å†…å®¹ï¼Œæœ€åé€šè¿‡æ¶ˆæ¯å»è°ƒåº¦æ‰§è¡Œã€‚</p><p>1ã€æ¥å£å®šä¹‰</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹é™æ€åŒ–
 * <span class="token keyword">@param</span> <span class="token parameter">courseId</span>  è¯¾ç¨‹id
 * <span class="token keyword">@return</span> File é™æ€åŒ–æ–‡ä»¶
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/23 16:59
*/</span>
<span class="token keyword">public</span> <span class="token class-name">File</span> <span class="token function">generateCourseHtml</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> ä¸Šä¼ è¯¾ç¨‹é™æ€åŒ–é¡µé¢
 * <span class="token keyword">@param</span> <span class="token parameter">file</span>  é™æ€åŒ–æ–‡ä»¶
 * <span class="token keyword">@return</span> void
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/23 16:59
*/</span>
<span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">uploadCourseHtml</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">,</span><span class="token class-name">File</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æ¥å£å®ç°</p><p>å°†ä¹‹å‰ç¼–å†™çš„é™æ€åŒ–æµ‹è¯•ä»£ç ä»¥åŠä¸Šä¼ é™æ€æ–‡ä»¶æµ‹è¯•ä»£ç æ‹·è´è¿‡æ¥ä½¿ç”¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Java</span>
<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">File</span> <span class="token function">generateCourseHtml</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//é™æ€åŒ–æ–‡ä»¶</span>
        <span class="token class-name">File</span> htmlFile  <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//é…ç½®freemarker</span>
            <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//åŠ è½½æ¨¡æ¿</span>
            <span class="token comment">//é€‰æŒ‡å®šæ¨¡æ¿è·¯å¾„,classpathä¸‹templatesä¸‹</span>
            <span class="token comment">//å¾—åˆ°classpathè·¯å¾„</span>
            <span class="token class-name">String</span> classpath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            configuration<span class="token punctuation">.</span><span class="token function">setDirectoryForTemplateLoading</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>classpath <span class="token operator">+</span> <span class="token string">&quot;/templates/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è®¾ç½®å­—ç¬¦ç¼–ç </span>
            configuration<span class="token punctuation">.</span><span class="token function">setDefaultEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//æŒ‡å®šæ¨¡æ¿æ–‡ä»¶åç§°</span>
            <span class="token class-name">Template</span> template <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;course_template.ftl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//å‡†å¤‡æ•°æ®</span>
            <span class="token class-name">CoursePreviewDto</span> coursePreviewInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCoursePreviewInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;model&quot;</span><span class="token punctuation">,</span> coursePreviewInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//é™æ€åŒ–</span>
            <span class="token comment">//å‚æ•°1ï¼šæ¨¡æ¿ï¼Œå‚æ•°2ï¼šæ•°æ®æ¨¡å‹</span>
            <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token class-name">FreeMarkerTemplateUtils</span><span class="token punctuation">.</span><span class="token function">processTemplateIntoString</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//            System.out.println(content);</span>
            <span class="token comment">//å°†é™æ€åŒ–å†…å®¹è¾“å‡ºåˆ°æ–‡ä»¶ä¸­</span>
            <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">toInputStream</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//åˆ›å»ºé™æ€åŒ–æ–‡ä»¶</span>
            htmlFile <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span><span class="token string">&quot;course&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹é™æ€åŒ–ï¼Œç”Ÿæˆé™æ€æ–‡ä»¶:{}&quot;</span><span class="token punctuation">,</span>htmlFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è¾“å‡ºæµ</span>
            <span class="token class-name">FileOutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>htmlFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹é™æ€åŒ–å¼‚å¸¸:{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹é™æ€åŒ–å¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> htmlFile<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uploadCourseHtml</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">,</span> <span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MultipartFile</span> multipartFile <span class="token operator">=</span> <span class="token class-name">MultipartSupportConfig</span><span class="token punctuation">.</span><span class="token function">getMultipartFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> course <span class="token operator">=</span> mediaServiceClient<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>multipartFile<span class="token punctuation">,</span> <span class="token string">&quot;course/&quot;</span><span class="token operator">+</span>courseId<span class="token operator">+</span><span class="token string">&quot;.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>course<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ é™æ€æ–‡ä»¶å¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œå–„è¯¾ç¨‹å‘å¸ƒä»»åŠ¡ CoursePublishTask ç±»çš„ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ç”Ÿæˆè¯¾ç¨‹é™æ€åŒ–é¡µé¢å¹¶ä¸Šä¼ è‡³æ–‡ä»¶ç³»ç»Ÿ</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">generateCourseHtml</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> mqMessage<span class="token punctuation">,</span><span class="token keyword">long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹è¿›è¡Œè¯¾ç¨‹é™æ€åŒ–,è¯¾ç¨‹id:{}&quot;</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ¶ˆæ¯id</span>
    <span class="token class-name">Long</span> id <span class="token operator">=</span> mqMessage<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ¶ˆæ¯å¤„ç†çš„service</span>
    <span class="token class-name">MqMessageService</span> mqMessageService <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMqMessageService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ¶ˆæ¯å¹‚ç­‰æ€§å¤„ç†</span>
    <span class="token keyword">int</span> stageOne <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">getStageOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>stageOne <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹é™æ€åŒ–å·²å¤„ç†ç›´æ¥è¿”å›ï¼Œè¯¾ç¨‹id:{}&quot;</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç”Ÿæˆé™æ€åŒ–é¡µé¢</span>
    <span class="token class-name">File</span> file <span class="token operator">=</span> coursePublishService<span class="token punctuation">.</span><span class="token function">generateCourseHtml</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¸Šä¼ é™æ€åŒ–é¡µé¢</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        coursePublishService<span class="token punctuation">.</span><span class="token function">uploadCourseHtml</span><span class="token punctuation">(</span>courseId<span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ä¿å­˜ç¬¬ä¸€é˜¶æ®µçŠ¶æ€</span>
    mqMessageService<span class="token punctuation">.</span><span class="token function">completedStageOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-5-4-2-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-5-4-2-æµ‹è¯•" aria-hidden="true">#</a> <strong>4.5.4.2 æµ‹è¯•</strong></h5><p>1ã€å¯åŠ¨ç½‘å…³ã€åª’èµ„ç®¡ç†æœåŠ¡å·¥ç¨‹ã€‚</p><p>2ã€åœ¨å†…å®¹ç®¡ç† api å·¥ç¨‹çš„å¯åŠ¨ç±»ä¸Šé…ç½® FeignClient</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Java</span>
<span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;com.xuecheng.content.feignclient&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ bootstrap.yml å¼•ç”¨ feign-dev.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> feign<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
  <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
  <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#profilesé»˜è®¤ä¸ºdev</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨å†…å®¹ç®¡ç†æ¥å£å·¥ç¨‹ã€‚</p><p>åœ¨ CoursePublishTask ç±»çš„ execute æ–¹æ³•ä¸­æ‰“ä¸Šæ–­ç‚¹ã€‚</p><p>3ã€å‘å¸ƒä¸€é—¨è¯¾ç¨‹ï¼Œä¿å­˜æ¶ˆæ¯è¡¨å­˜åœ¨æœªå¤„ç†çš„å¤„ç†ã€‚</p><p>4ã€å¯åŠ¨ xxl-job è°ƒåº¦ä¸­å¿ƒã€å¯åŠ¨è¯¾ç¨‹å‘å¸ƒä»»åŠ¡ï¼Œç­‰å¾…å®šæ—¶è°ƒåº¦ã€‚</p><p><img src="/MyBlog/assets/image-20230531100057397-e479bae7.png" alt="image-20230531100057397"></p><p>5ã€è§‚å¯Ÿä»»åŠ¡è°ƒåº¦æ—¥å¿—ï¼Œè§‚å¯Ÿä»»åŠ¡æ˜¯å¦å¯ä»¥æ­£å¸¸å¤„ç†ã€‚</p><p>6ã€å¤„ç†å®Œæˆè¿›å…¥æ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥è¯¢ mediafiles æ¡¶å†…æ˜¯å¦å­˜åœ¨ä»¥è¯¾ç¨‹ id å‘½åçš„ html æ–‡ä»¶</p><p><img src="/MyBlog/assets/image-20230531100101680-f032cae5.png" alt="image-20230531100101680"></p><p>å¦‚æœä¸å­˜åœ¨è¯´æ˜è¯¾ç¨‹é™æ€åŒ–å­˜åœ¨é—®é¢˜ï¼Œå†ä»”ç»†æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—ï¼Œæ’æŸ¥é—®é¢˜ã€‚</p><p>å¦‚æœå­˜åœ¨åˆ™è¯´æ˜è¯¾ç¨‹é™æ€åŒ–å¹¶ä¸Šä¼ åˆ° minio æˆåŠŸã€‚</p><h5 id="_4-5-4-3-æµè§ˆè¯¦ç»†é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_4-5-4-3-æµè§ˆè¯¦ç»†é¡µé¢" aria-hidden="true">#</a> <strong>4.5.4.3 æµè§ˆè¯¦ç»†é¡µé¢</strong></h5><p>è¯¾ç¨‹é™æ€åŒ–æˆåŠŸåå¯ä»¥ç”¨æµè§ˆå™¨è®¿é—® html æ–‡ä»¶æ˜¯å¦å¯ä»¥æ­£å¸¸æµè§ˆï¼Œä¸‹å›¾è¡¨ç¤ºå¯ä»¥æ­£å¸¸æµè§ˆã€‚</p><p><img src="/MyBlog/assets/image-20230531100108692-eb9afe7d.png" alt="image-20230531100108692"></p><p>é¡µé¢è¿˜æ²¡æœ‰æ ·å¼ï¼Œéœ€è¦åœ¨ nginx é…ç½®è™šæ‹Ÿç›®å½•ï¼Œåœ¨www.51xuecheng.cnä¸‹é…ç½®ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>location /course/ <span class="token punctuation">{</span>
        proxy_pass http://fileserver/mediafiles/course/;
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŠ è½½ nginx é…ç½®æ–‡ä»¶</p><p>è®¿é—®ï¼šhttp://www.51xuecheng.cn/course/2.html</p><p>2.html ä¸ºä»¥è¯¾ç¨‹ id å‘½åçš„ html æ–‡ä»¶ã€‚</p><h2 id="_5-è¯¾ç¨‹æœç´¢" tabindex="-1"><a class="header-anchor" href="#_5-è¯¾ç¨‹æœç´¢" aria-hidden="true">#</a> <strong>5 è¯¾ç¨‹æœç´¢</strong></h2><h3 id="_5-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_5-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>5.1 éœ€æ±‚åˆ†æ</strong></h3><h4 id="_5-1-1-æ¨¡å—ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_5-1-1-æ¨¡å—ä»‹ç»" aria-hidden="true">#</a> <strong>5.1.1 æ¨¡å—ä»‹ç»</strong></h4><p>æœç´¢åŠŸèƒ½æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„é‡è¦åŠŸèƒ½ï¼Œæ˜¯ä¿¡æ¯æŸ¥è¯¢çš„æ–¹å¼ã€‚è¯¾ç¨‹æœç´¢æ˜¯è¯¾ç¨‹å±•ç¤ºçš„æ¸ é“ï¼Œç”¨æˆ·é€šè¿‡è¯¾ç¨‹æœç´¢æ‰¾åˆ°è¯¾ç¨‹ä¿¡æ¯ï¼Œè¿›ä¸€æ­¥å»æŸ¥çœ‹è¯¾ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿›è¡Œé€‰è¯¾ã€æ”¯ä»˜ã€å­¦ä¹ ã€‚</p><p>æœ¬é¡¹ç›®çš„è¯¾ç¨‹æœç´¢æ”¯æŒå…¨æ–‡æ£€ç´¢æŠ€æœ¯ï¼Œä»€ä¹ˆæ˜¯å…¨æ–‡æ£€ç´¢ï¼Ÿ</p><p><a href="https://baike.baidu.com/item/%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/8028630?fromModule=lemma_inlink" target="_blank" rel="noopener noreferrer">å…¨æ–‡æ£€ç´¢<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ˜¯æŒ‡è®¡ç®—æœºç´¢å¼•ç¨‹åºé€šè¿‡æ‰«ææ–‡ç« ä¸­çš„æ¯ä¸€ä¸ªè¯ï¼Œå¯¹æ¯ä¸€ä¸ªè¯å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼ŒæŒ‡æ˜è¯¥è¯åœ¨æ–‡ç« ä¸­å‡ºç°çš„æ¬¡æ•°å’Œä½ç½®ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢æ—¶ï¼Œæ£€ç´¢ç¨‹åºå°±æ ¹æ®äº‹å…ˆå»ºç«‹çš„ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¹¶å°†æŸ¥æ‰¾çš„ç»“æœåé¦ˆç»™ç”¨æˆ·çš„æ£€ç´¢æ–¹å¼ã€‚è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºé€šè¿‡å­—å…¸ä¸­çš„æ£€ç´¢å­—è¡¨æŸ¥å­—çš„è¿‡ç¨‹ã€‚</p><p>å…¨æ–‡æ£€ç´¢å¯ä»¥ç®€å•ç†è§£ä¸ºé€šè¿‡ç´¢å¼•æœç´¢æ–‡ç« ã€‚</p><p><img src="/MyBlog/assets/image-20230531100148575-fd76fa81.png" alt="image-20230531100148575"></p><p>å…¨æ–‡æ£€ç´¢çš„é€Ÿåº¦éå¸¸å¿«ï¼Œæ—©æœŸåº”ç”¨åœ¨æœç´¢å¼•æ“æŠ€æœ¯ä¸­ï¼Œæ¯”å¦‚ï¼šç™¾åº¦ã€google ç­‰ï¼Œç°åœ¨é€šå¸¸ä¸€äº›å¤§å‹ç½‘ç«™çš„æœç´¢åŠŸèƒ½éƒ½æ˜¯é‡‡ç”¨å…¨æ–‡æ£€ç´¢æŠ€æœ¯ã€‚</p><p><img src="/MyBlog/assets/image-20230531100152847-dd867122.png" alt="image-20230531100152847"></p><p>è¯¾ç¨‹æœç´¢ä¹Ÿè¦å°†è¯¾ç¨‹ä¿¡æ¯å»ºç«‹ç´¢å¼•ï¼Œåœ¨è¯¾ç¨‹å‘å¸ƒæ—¶å»ºç«‹è¯¾ç¨‹ç´¢å¼•ï¼Œç´¢å¼•å»ºç«‹å¥½ç”¨æˆ·å¯é€šè¿‡æœç´¢ç½‘é¡µå»æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p><img src="/MyBlog/assets/image-20230531100158031-665b45eb.png" alt="image-20230531100158031"></p><p>æ‰€ä»¥ï¼Œè¯¾ç¨‹æœç´¢æ¨¡å—åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šè¯¾ç¨‹ç´¢å¼•ã€è¯¾ç¨‹æœç´¢ã€‚</p><p>è¯¾ç¨‹ç´¢å¼•æ˜¯å°†è¯¾ç¨‹ä¿¡æ¯å»ºç«‹ç´¢å¼•ã€‚</p><p>è¯¾ç¨‹æœç´¢æ˜¯é€šè¿‡å‰ç«¯ç½‘é¡µï¼Œé€šè¿‡å…³é”®å­—ç­‰æ¡ä»¶å»æœç´¢è¯¾ç¨‹ã€‚</p><h4 id="_5-1-2-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_5-1-2-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>5.1.2 ä¸šåŠ¡æµç¨‹</strong></h4><p>æ ¹æ®æ¨¡å—ä»‹ç»çš„å†…å®¹ï¼Œè¯¾ç¨‹æœç´¢æ¨¡å—åŒ…æ‹¬è¯¾ç¨‹ç´¢å¼•ã€è¯¾ç¨‹æœç´¢ä¸¤éƒ¨åˆ†ã€‚</p><p>1ã€è¯¾ç¨‹ç´¢å¼•</p><p>åœ¨è¯¾ç¨‹å‘å¸ƒæ“ä½œæ‰§è¡Œåé€šè¿‡æ¶ˆæ¯å¤„ç†æ–¹å¼åˆ›å»ºè¯¾ç¨‹ç´¢å¼•ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531100204973-50b21bbf.png" alt="image-20230531100204973"></p><p>æœ¬é¡¹ç›®ä½¿ç”¨ elasticsearch ä½œä¸ºç´¢å¼•åŠæœç´¢æœåŠ¡ã€‚</p><p>2ã€è¯¾ç¨‹æœç´¢</p><p>è¯¾ç¨‹ç´¢å¼•åˆ›å»ºå®Œæˆï¼Œç”¨æˆ·æ‰å¯ä»¥é€šè¿‡å‰ç«¯æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>è¯¾ç¨‹æœç´¢å¯ä»¥ä»é¦–é¡µè¿›å…¥æœç´¢é¡µé¢ã€‚</p><p><img src="/MyBlog/assets/image-20230531100209431-8190f7f3.png" alt="image-20230531100209431"></p><p>ä¸‹å›¾æ˜¯æœç´¢ç•Œé¢ï¼Œå¯ä»¥é€šè¿‡è¯¾ç¨‹åˆ†ç±»ã€è¯¾ç¨‹éš¾åº¦ç­‰çº§ç­‰æ¡ä»¶è¿›è¡Œæœç´¢ã€‚</p><p><img src="/MyBlog/assets/image-20230531100215209-ca32fd0e.png" alt="image-20230531100215209"></p><h3 id="_5-2-å‡†å¤‡ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_5-2-å‡†å¤‡ç¯å¢ƒ" aria-hidden="true">#</a> <strong>5.2 å‡†å¤‡ç¯å¢ƒ</strong></h3><h4 id="_5-2-1-æ­å»º-elasticsearch" tabindex="-1"><a class="header-anchor" href="#_5-2-1-æ­å»º-elasticsearch" aria-hidden="true">#</a> <strong>5.2.1 æ­å»º elasticsearch</strong></h4><p>åœ¨è¯¾å‰ä¸‹å‘çš„è™šæ‹Ÿä¸­å·²ç»åœ¨ docker å®¹å™¨ä¸­å®‰è£…äº† elasticsearch å’Œ kibanaã€‚</p><p>kibana æ˜¯ ELKï¼ˆElasticsearch , Logstash, Kibana ï¼‰ä¹‹ä¸€ï¼Œkibana ä¸€æ¬¾å¼€æºçš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œé€šè¿‡å¯è§†åŒ–ç•Œé¢è®¿é—® elasticsearch çš„ç´¢å¼•åº“ï¼Œå¹¶å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ•°æ®æŠ¥è¡¨ã€‚</p><p>å¼€å‘ä¸­ä¸»è¦ä½¿ç”¨ kibana é€šè¿‡ api å¯¹ elasticsearch è¿›è¡Œç´¢å¼•å’Œæœç´¢æ“ä½œï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® http://192.168.101.65:5601/app/dev_tools#/consoleè¿›å…¥kibanaçš„å¼€å‘å·¥å…·ç•Œé¢ã€‚</p><p>ä¿®æ”¹è™šæ‹Ÿæœºä¸­çš„å¯åŠ¨è„šæœ¬ restart.sh æ·»åŠ </p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> stop elasticsearch
<span class="token function">docker</span> stop kibana

<span class="token function">docker</span> start elasticsearch
<span class="token function">docker</span> start kibana

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/MyBlog/assets/image-20230531100240725-041820cf.png" alt="image-20230531100240725"></p><p>å¯é€šè¿‡å‘½ä»¤ï¼šGET /_cat/indices?v æŸ¥çœ‹æ‰€æœ‰çš„ç´¢å¼•ï¼Œé€šè¿‡æ­¤å‘½ä»¤åˆ¤æ–­ kibana æ˜¯å¦æ­£å¸¸è¿æ¥ elasticsearchã€‚</p><p>ç´¢å¼•ç›¸å½“äº MySQL ä¸­çš„è¡¨ï¼ŒElasticsearch ä¸ MySQL ä¹‹é—´æ¦‚å¿µçš„å¯¹åº”å…³ç³»è§ä¸‹è¡¨ï¼š</p><p><img src="/MyBlog/assets/image-20230531100245698-2f6488e8.png" alt="image-20230531100245698"></p><p>è¦ä½¿ç”¨ elasticsearch éœ€è¦å»ºç«‹ç´¢å¼•ï¼ŒMapping ç›¸å½“äºè¡¨ç»“æ„ï¼ŒMapping åˆ›å»ºåå…¶å­—æ®µä¸èƒ½åˆ é™¤ï¼Œå¦‚æœè¦åˆ é™¤éœ€è¦åˆ é™¤æ•´ä¸ªç´¢å¼•ï¼Œä¸‹è¾¹ä»‹ç»åˆ›å»ºç´¢å¼•ã€æŸ¥è¯¢ç´¢å¼•ã€åˆ é™¤ç´¢å¼•çš„æ–¹æ³•ï¼š</p><p>1ã€åˆ›å»ºç´¢å¼•ï¼Œå¹¶æŒ‡å®š Mappingã€‚</p><p>PUT /course-publish</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;number_of_shards&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;number_of_replicas&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;companyId&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;companyName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;mt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;mtName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;st&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;stName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;teachmode&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pic&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;createDate&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;remark&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;charge&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scaled_float&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;scaling_factor&quot;</span><span class="token operator">:</span> <span class="token number">100</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;originalPrice&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scaled_float&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;scaling_factor&quot;</span><span class="token operator">:</span> <span class="token number">100</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;validDays&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æŸ¥è¯¢ç´¢å¼•</p><p>é€šè¿‡ GET /_cat/indices?v æŸ¥è¯¢æ‰€æœ‰çš„ç´¢å¼•ï¼ŒæŸ¥æ‰¾ course-publish æ˜¯å¦åˆ›å»ºæˆåŠŸã€‚</p><p>é€šè¿‡ GET /course-publish/_mapping æŸ¥è¯¢ course-publish çš„ç´¢å¼•ç»“æ„ã€‚</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;course-publish&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;charge&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;companyId&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;companyName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;createDate&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mtName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;originalPrice&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scaled_float&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;scaling_factor&quot;</span><span class="token operator">:</span> <span class="token number">100.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;pic&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scaled_float&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;scaling_factor&quot;</span><span class="token operator">:</span> <span class="token number">100.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;remark&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;st&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;stName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;teachmode&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;validDays&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€åˆ é™¤ç´¢å¼•</p><p>å¦‚æœå‘ç°åˆ›å»ºçš„ course-publish ä¸æ­£ç¡®å¯ä»¥åˆ é™¤é‡æ–°åˆ›å»ºã€‚</p><p>åˆ é™¤ç´¢å¼•åå½“ä¸­çš„æ–‡æ¡£æ•°æ®ä¹ŸåŒæ—¶åˆ é™¤ï¼Œä¸€å®šè¦è°¨æ…æ“ä½œï¼</p><p>åˆ é™¤ç´¢å¼•å‘½ä»¤ï¼šDELETE /course-publish</p><h4 id="_5-2-2-éƒ¨ç½²æœç´¢å·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#_5-2-2-éƒ¨ç½²æœç´¢å·¥ç¨‹" aria-hidden="true">#</a> <strong>5.2.2 éƒ¨ç½²æœç´¢å·¥ç¨‹</strong></h4><p>æ‹·è´è¯¾ç¨‹èµ„æ–™ä¸­çš„ xuecheng-plus-search æœç´¢å·¥ç¨‹åˆ°è‡ªå·±çš„å·¥ç¨‹ç›®å½•ã€‚</p><p><img src="/MyBlog/assets/image-20230531100332701-8b6ce9b4.png" alt="image-20230531100332701"></p><p>ä¿®æ”¹ bootstrap.xml ä¸­ nacos çš„ namespace ä¸ºè‡ªå·±çš„å‘½åç©ºé—´ã€‚</p><p>å¯åŠ¨ç½‘å…³ã€æœç´¢æœåŠ¡ã€‚</p><p>éƒ¨ç½²å®Œæˆé€šè¿‡ httpclient è¿›è¡Œæµ‹è¯•</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### æ·»åŠ è¯¾ç¨‹ç´¢å¼•
POST {{search_host}}/search/index/course
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span>
<span class="token application-json">
<span class="token punctuation">{</span>
  <span class="token property">&quot;charge&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;201000&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;companyId&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;companyName&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;åŒ—äº¬é»‘é©¬ç¨‹åº&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;createDate&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2022-09-25 09:36:11&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ã€ŠSpringç¼–ç¨‹æ€æƒ³ã€‹æ˜¯2007å¹´6æœˆ1æ—¥æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾å‡ºç‰ˆçš„å›¾ä¹¦ï¼Œä½œè€…æ˜¯åŸƒå…‹å°”ï¼Œè¯‘è€…æ˜¯é™ˆæ˜Šé¹ã€‚ä¸»è¦å†…å®¹æœ¬ä¹¦èµ¢å¾—äº†å…¨çƒç¨‹åºå‘˜çš„å¹¿æ³›èµèª‰ï¼Œå³ä½¿æ˜¯æœ€æ™¦æ¶©çš„æ¦‚å¿µï¼Œåœ¨Bruce Eckelçš„æ–‡å­—äº²å’ŒåŠ›å’Œå°è€Œç›´æ¥çš„ç¼–ç¨‹ç¤ºä¾‹é¢å‰ä¹Ÿä¼šåŒ–è§£äºæ— å½¢ã€‚ä»Javaçš„åŸºç¡€è¯­æ³•åˆ°æœ€é«˜çº§ç‰¹æ€§ï¼ˆæ·±å…¥çš„é¢å‘å¯¹è±¡æ¦‚å¿µã€å¤šçº¿ç¨‹ã€è‡ªåŠ¨é¡¹ç›®æ„å»ºã€å•å…ƒæµ‹è¯•å’Œè°ƒè¯•ç­‰ï¼‰ï¼Œæœ¬ä¹¦éƒ½èƒ½é€æ­¥æŒ‡å¯¼ä½ è½»æ¾æŒæ¡ã€‚ä»æœ¬ä¹¦è·å¾—çš„å„é¡¹å¤§å¥–ä»¥åŠæ¥è‡ªä¸–ç•Œå„åœ°çš„è¯»è€…è¯„è®ºä¸­ï¼Œä¸éš¾çœ‹å‡ºè¿™æ˜¯ä¸€æœ¬ç»å…¸ä¹‹ä½œ&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;grade&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;204001&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span> <span class="token operator">:</span> <span class="token number">102</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mt&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1-3&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mtName&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ç¼–ç¨‹å¼€å‘&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Springç¼–ç¨‹æ€æƒ³&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;originalPrice&quot;</span> <span class="token operator">:</span> <span class="token number">200.0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pic&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;/mediafiles/2022/09/20/1d0f0e6ed8a0c4a89bfd304b84599d9c.png&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;price&quot;</span> <span class="token operator">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;remark&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;æ²¡æœ‰å¤‡æ³¨&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;st&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1-3-2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;stName&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Javaè¯­è¨€&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;status&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;203002&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tags&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;æ²¡æœ‰æ ‡ç­¾&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;teachmode&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;200002&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;validDays&quot;</span> <span class="token operator">:</span> <span class="token number">222</span>
<span class="token punctuation">}</span>



#### æœç´¢è¯¾ç¨‹
GET <span class="token punctuation">{</span><span class="token punctuation">{</span>search_host<span class="token punctuation">}</span><span class="token punctuation">}</span>/search/course/list?pageNo=<span class="token number">1</span>&amp;keywords=spring
Content-Type<span class="token operator">:</span> application/json



</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿›å…¥å‰ç«¯æœç´¢ç•Œé¢http://www.51xuecheng.cn/course/search.html</p><p><img src="/MyBlog/assets/image-20230531100405411-dd4f643d.png" alt="image-20230531100405411"></p><h3 id="_5-3-ç´¢å¼•ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_5-3-ç´¢å¼•ç®¡ç†" aria-hidden="true">#</a> <strong>5.3 ç´¢å¼•ç®¡ç†</strong></h3><h4 id="_5-3-1-rest-api" tabindex="-1"><a class="header-anchor" href="#_5-3-1-rest-api" aria-hidden="true">#</a> <strong>5.3.1 REST API</strong></h4><h5 id="_5-3-1-1-æ·»åŠ æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#_5-3-1-1-æ·»åŠ æ–‡æ¡£" aria-hidden="true">#</a> <strong>5.3.1.1 æ·»åŠ æ–‡æ¡£</strong></h5><p>ç´¢å¼•åˆ›å»ºå¥½å°±å¯ä»¥å‘å…¶ä¸­æ·»åŠ æ–‡æ¡£ï¼Œæ­¤æ—¶ elasticsearch ä¼šæ ¹æ®ç´¢å¼•çš„ mapping é…ç½®å¯¹æœ‰äº›å­—æ®µè¿›è¡Œåˆ†è¯ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬è¦å‘ course_publish ä¸­æ·»åŠ è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨ rest api è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹ï¼š</p><p>ä½¿ç”¨ post è¯·æ±‚ï¼Œ/course-publish/_doc/103 ç¬¬ä¸€éƒ¨åˆ†ä¸ºç´¢å¼•åç§°ï¼Œ_doc å›ºå®šï¼Œ103 ä¸ºæ–‡æ¡£çš„ä¸»é”® idï¼Œè¿™é‡Œä¸ºè¯¾ç¨‹ idã€‚</p><p>è¯¾ç¨‹å†…å®¹ä½¿ç”¨ json è¡¨ç¤ºã€‚</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>POST /course-publish/_doc/103
{
  &quot;charge&quot; : &quot;201001&quot;,
  &quot;companyId&quot; : 100000,
  &quot;companyName&quot; : &quot;åŒ—äº¬é»‘é©¬ç¨‹åº&quot;,
  &quot;createDate&quot; : &quot;2022-09-25 09:36:11&quot;,
  &quot;description&quot; : &quot;HTML/CSS&quot;,
  &quot;grade&quot; : &quot;204001&quot;,
  &quot;id&quot; : 102,
  &quot;mt&quot; : &quot;1-1&quot;,
  &quot;mtName&quot; : &quot;å‰ç«¯å¼€å‘&quot;,
  &quot;name&quot; : &quot;Htmlå‚è€ƒå¤§å…¨&quot;,
  &quot;originalPrice&quot; : 200.0,
  &quot;pic&quot; : &quot;/mediafiles/2022/09/20/e726b71ba99c70e8c9d2850c2a7019d7.jpg&quot;,
  &quot;price&quot; : 100.0,
  &quot;remark&quot; : &quot;æ²¡æœ‰å¤‡æ³¨&quot;,
  &quot;st&quot; : &quot;1-1-1&quot;,
  &quot;stName&quot; : &quot;HTML/CSS&quot;,
  &quot;status&quot; : &quot;203002&quot;,
  &quot;tags&quot; : &quot;æ²¡æœ‰æ ‡ç­¾&quot;,
  &quot;teachmode&quot; : &quot;200002&quot;,
  &quot;validDays&quot; : 222
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦ä¿®æ”¹æ–‡æ¡£çš„å†…å®¹å¯ä»¥ä½¿ç”¨ä¸Šè¾¹ç›¸åŒçš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ ï¼Œå¦‚æœå­˜åœ¨åˆ™æ›´æ–°ã€‚</p><h5 id="_5-3-1-2-æŸ¥è¯¢æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#_5-3-1-2-æŸ¥è¯¢æ–‡æ¡£" aria-hidden="true">#</a> <strong>5.3.1.2 æŸ¥è¯¢æ–‡æ¡£</strong></h5><p>æ·»åŠ æ–‡æ¡£æˆåŠŸåå¯ä»¥é€šè¿‡ä¸»é”® id æŸ¥è¯¢è¯¥æ–‡æ¡£çš„ä¿¡æ¯ã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>GET /{ç´¢å¼•åº“åç§°}/_doc/{id}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-3-1-3-æ›´æ–°æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#_5-3-1-3-æ›´æ–°æ–‡æ¡£" aria-hidden="true">#</a> <strong>5.3.1.3 æ›´æ–°æ–‡æ¡£</strong></h5><p>æ›´æ–°æ–‡æ¡£åˆ†ä¸ºå…¨é‡æ›´æ–°å’Œå±€éƒ¨æ›´æ–°ã€‚</p><p>å…¨é‡æ›´æ–°æ˜¯æŒ‡å…ˆåˆ é™¤å†æ›´æ–°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>PUT /{ç´¢å¼•åº“å}/_doc/æ–‡æ¡£id
{
    &quot;å­—æ®µ1&quot;: &quot;å€¼1&quot;,
    &quot;å­—æ®µ2&quot;: &quot;å€¼2&quot;,
    // ... ç•¥
}


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å±€éƒ¨æ›´æ–°è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>POST /{ç´¢å¼•åº“å}/_update/æ–‡æ¡£id
{
    &quot;doc&quot;: {
         &quot;å­—æ®µå&quot;: &quot;æ–°çš„å€¼&quot;,
    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-3-1-4-åˆ é™¤æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#_5-3-1-4-åˆ é™¤æ–‡æ¡£" aria-hidden="true">#</a> <strong>5.3.1.4 åˆ é™¤æ–‡æ¡£</strong></h5><p>åˆ é™¤æ–‡æ¡£å°†ä»ç´¢å¼•ä¸­åˆ é™¤æ–‡æ¡£çš„è®°å½•ã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>DELETE /{ç´¢å¼•åº“å}/_doc/idå€¼

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_5-3-2-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>5.3.2 æ¥å£å®šä¹‰</strong></h4><p>å½“è¯¾ç¨‹å‘å¸ƒæ—¶è¯·æ±‚æ·»åŠ è¯¾ç¨‹æ¥å£æ·»åŠ è¯¾ç¨‹ä¿¡æ¯åˆ°ç´¢å¼•ï¼Œå½“è¯¾ç¨‹ä¸‹æ¶æ—¶è¯·æ±‚åˆ é™¤è¯¾ç¨‹æ¥å£ä»ç´¢å¼•ä¸­åˆ é™¤è¯¾ç¨‹ä¿¡æ¯ï¼Œè¿™é‡Œå…ˆå®ç°æ·»åŠ è¯¾ç¨‹æ¥å£ã€‚</p><p>æ ¹æ®ç´¢å¼•çš„ mapping ç»“æ„åˆ›å»º po ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>po</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JSONField</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword">@author</span> itcast
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CourseIndex</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ä¸»é”®
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æœºæ„ID
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> companyId<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å…¬å¸åç§°
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> companyName<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è¯¾ç¨‹åç§°
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * é€‚ç”¨äººç¾¤
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> users<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ ‡ç­¾
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tags<span class="token punctuation">;</span>


    <span class="token doc-comment comment">/**
     * å¤§åˆ†ç±»
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mt<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å¤§åˆ†ç±»åç§°
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mtName<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å°åˆ†ç±»
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> st<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å°åˆ†ç±»åç§°
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> stName<span class="token punctuation">;</span>



    <span class="token doc-comment comment">/**
     * è¯¾ç¨‹ç­‰çº§
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> grade<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ•™è‚²æ¨¡å¼
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> teachmode<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * è¯¾ç¨‹å›¾ç‰‡
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> pic<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è¯¾ç¨‹ä»‹ç»
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>


    <span class="token doc-comment comment">/**
     * å‘å¸ƒæ—¶é—´
     */</span>
    <span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>format<span class="token operator">=</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createDate<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * çŠ¶æ€
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å¤‡æ³¨
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> remark<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ”¶è´¹è§„åˆ™ï¼Œå¯¹åº”æ•°æ®å­—å…¸--203
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> charge<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ç°ä»·
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Float</span> price<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * åŸä»·
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Float</span> originalPrice<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è¯¾ç¨‹æœ‰æ•ˆæœŸå¤©æ•°
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> validDays<span class="token punctuation">;</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºç´¢å¼•æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>execption<span class="token punctuation">.</span></span><span class="token class-name">XueChengPlusException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CourseIndex</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IndexService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestBody</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> è¯¾ç¨‹ç´¢å¼•æ¥å£
 * <span class="token keyword">@date</span> 2022/9/24 22:31
 */</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•æ¥å£&quot;</span><span class="token punctuation">,</span> tags <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CourseIndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ·»åŠ è¯¾ç¨‹ç´¢å¼•&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;course&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CourseIndex</span> courseIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-3-æ¥å£å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_5-3-3-æ¥å£å¼€å‘" aria-hidden="true">#</a> <strong>5.3.3 æ¥å£å¼€å‘</strong></h4><p>å®šä¹‰ service æ¥å£ï¼Œè¯·æ±‚ elasticsearch æ·»åŠ è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>æ³¨æ„ï¼šä¸ºäº†é€‚åº”å…¶å®ƒæ–‡æ¡£ä¿¡æ¯ï¼Œå°†æ·»åŠ æ–‡æ¡£å®šä¹‰ä¸ºé€šç”¨çš„æ·»åŠ æ–‡æ¡£æ¥å£ï¼Œæ­¤æ¥å£ä¸ä»…é€‚åº”æ·»åŠ è¯¾ç¨‹è¿˜é€‚åº”æ·»åŠ å…¶å®ƒä¿¡æ¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CourseIndex</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> è¯¾ç¨‹ç´¢å¼•service
 * <span class="token keyword">@date</span> 2022/9/24 22:40
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IndexService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">indexName</span> ç´¢å¼•åç§°
     * <span class="token keyword">@param</span> <span class="token parameter">id</span> ä¸»é”®
     * <span class="token keyword">@param</span> <span class="token parameter">object</span> ç´¢å¼•å¯¹è±¡
     * <span class="token keyword">@return</span> Boolean trueè¡¨ç¤ºæˆåŠŸ,falseå¤±è´¥
     * <span class="token keyword">@description</span> æ·»åŠ ç´¢å¼•
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/24 22:57
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">addCourseIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> indexName<span class="token punctuation">,</span><span class="token class-name">String</span> id<span class="token punctuation">,</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥å£å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>execption<span class="token punctuation">.</span></span><span class="token class-name">XueChengPlusException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CourseIndex</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IndexService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span></span><span class="token class-name">DocWriteResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>delete<span class="token punctuation">.</span></span><span class="token class-name">DeleteRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>delete<span class="token punctuation">.</span></span><span class="token class-name">DeleteResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>index<span class="token punctuation">.</span></span><span class="token class-name">IndexRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>index<span class="token punctuation">.</span></span><span class="token class-name">IndexResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>update<span class="token punctuation">.</span></span><span class="token class-name">UpdateRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>update<span class="token punctuation">.</span></span><span class="token class-name">UpdateResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RequestOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestHighLevelClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>common<span class="token punctuation">.</span>xcontent<span class="token punctuation">.</span></span><span class="token class-name">XContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹ç´¢å¼•ç®¡ç†æ¥å£å®ç°
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/25 7:23
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IndexService</span> <span class="token punctuation">{</span>



 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">addCourseIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> indexName<span class="token punctuation">,</span><span class="token class-name">String</span> id<span class="token punctuation">,</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> jsonString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">IndexRequest</span> indexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//æŒ‡å®šç´¢å¼•æ–‡æ¡£å†…å®¹</span>
  indexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">,</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//ç´¢å¼•å“åº”å¯¹è±¡</span>
  <span class="token class-name">IndexResponse</span> indexResponse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
   indexResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ·»åŠ ç´¢å¼•å‡ºé”™:{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ·»åŠ ç´¢å¼•å‡ºé”™&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token class-name">String</span> name <span class="token operator">=</span> indexResponse<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;created&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;updated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-4-æ¥å£å®Œå–„" tabindex="-1"><a class="header-anchor" href="#_5-3-4-æ¥å£å®Œå–„" aria-hidden="true">#</a> <strong>5.3.4 æ¥å£å®Œå–„</strong></h4><p>å®Œå–„æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>execption<span class="token punctuation">.</span></span><span class="token class-name">XueChengPlusException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CourseIndex</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IndexService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestBody</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> è¯¾ç¨‹ç´¢å¼•æ¥å£
 * <span class="token keyword">@date</span> 2022/9/24 22:31
 */</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•æ¥å£&quot;</span><span class="token punctuation">,</span> tags <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CourseIndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${elasticsearch.course.index}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> courseIndexStore<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">IndexService</span> indexService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ·»åŠ è¯¾ç¨‹ç´¢å¼•&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;course&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CourseIndex</span> courseIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Long</span> id <span class="token operator">=</span> courseIndex<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹idä¸ºç©º&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Boolean</span> result <span class="token operator">=</span> indexService<span class="token punctuation">.</span><span class="token function">addCourseIndex</span><span class="token punctuation">(</span>courseIndexStore<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> courseIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ·»åŠ è¯¾ç¨‹ç´¢å¼•å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-5-æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-3-5-æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>5.3.5 æ¥å£æµ‹è¯•</strong></h4><p>ä½¿ç”¨ httpclient è¿›è¡Œæµ‹è¯•</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### æ·»åŠ è¯¾ç¨‹ç´¢å¼•
POST {{search_host}}/search/index/course
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span>
<span class="token application-json">
<span class="token punctuation">{</span>
  <span class="token property">&quot;charge&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;201000&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;companyId&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;companyName&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;åŒ—äº¬é»‘é©¬ç¨‹åºå‘˜&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;createDate&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2022-09-25 09:36:11&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹æ˜¯2007å¹´6æœˆ1æ—¥æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾å‡ºç‰ˆçš„å›¾ä¹¦ï¼Œä½œè€…æ˜¯åŸƒå…‹å°”ï¼Œè¯‘è€…æ˜¯é™ˆæ˜Šé¹ã€‚ä¸»è¦å†…å®¹æœ¬ä¹¦èµ¢å¾—äº†å…¨çƒç¨‹åºå‘˜çš„å¹¿æ³›èµèª‰ï¼Œå³ä½¿æ˜¯æœ€æ™¦æ¶©çš„æ¦‚å¿µï¼Œåœ¨Bruce Eckelçš„æ–‡å­—äº²å’ŒåŠ›å’Œå°è€Œç›´æ¥çš„ç¼–ç¨‹ç¤ºä¾‹é¢å‰ä¹Ÿä¼šåŒ–è§£äºæ— å½¢ã€‚ä»Javaçš„åŸºç¡€è¯­æ³•åˆ°æœ€é«˜çº§ç‰¹æ€§ï¼ˆæ·±å…¥çš„é¢å‘å¯¹è±¡æ¦‚å¿µã€å¤šçº¿ç¨‹ã€è‡ªåŠ¨é¡¹ç›®æ„å»ºã€å•å…ƒæµ‹è¯•å’Œè°ƒè¯•ç­‰ï¼‰ï¼Œæœ¬ä¹¦éƒ½èƒ½é€æ­¥æŒ‡å¯¼ä½ è½»æ¾æŒæ¡ã€‚ä»æœ¬ä¹¦è·å¾—çš„å„é¡¹å¤§å¥–ä»¥åŠæ¥è‡ªä¸–ç•Œå„åœ°çš„è¯»è€…è¯„è®ºä¸­ï¼Œä¸éš¾çœ‹å‡ºè¿™æ˜¯ä¸€æœ¬ç»å…¸ä¹‹ä½œ&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;grade&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;204001&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span> <span class="token operator">:</span> <span class="token number">102</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mt&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1-3&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mtName&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ç¼–ç¨‹å¼€å‘&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Javaç¼–ç¨‹æ€æƒ³&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;originalPrice&quot;</span> <span class="token operator">:</span> <span class="token number">200.0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pic&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;/mediafiles/2022/09/20/1d0f0e6ed8a0c4a89bfd304b84599d9c.png&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;price&quot;</span> <span class="token operator">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;remark&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;æ²¡æœ‰å¤‡æ³¨&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;st&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1-3-2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;stName&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Javaè¯­è¨€&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;status&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;203002&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tags&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;æ²¡æœ‰æ ‡ç­¾&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;teachmode&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;200002&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;validDays&quot;</span> <span class="token operator">:</span> <span class="token number">222</span>
<span class="token punctuation">}</span>

</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-æœç´¢" tabindex="-1"><a class="header-anchor" href="#_5-4-æœç´¢" aria-hidden="true">#</a> <strong>5.4 æœç´¢</strong></h3><h4 id="_5-4-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_5-4-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>5.4.1 éœ€æ±‚åˆ†æ</strong></h4><p>ç´¢å¼•ä¿¡æ¯ç»´æŠ¤å®Œæˆä¸‹ä¸€æ­¥å®šä¹‰æœç´¢æ¥å£æœç´¢è¯¾ç¨‹ä¿¡æ¯ï¼Œé¦–å…ˆéœ€è¦ææ¸…æ¥šæœç´¢åŠŸèƒ½çš„éœ€æ±‚ã€‚</p><p>è¿›å…¥æœç´¢ç•Œé¢ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531100837646-915cf25d.png" alt="image-20230531100837646"></p><p>æ ¹æ®æœç´¢ç•Œé¢å¯çŸ¥éœ€æ±‚å¦‚ä¸‹ï¼š</p><p>1ã€æ ¹æ®ä¸€çº§åˆ†ç±»ã€äºŒçº§åˆ†ç±»æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>2ã€æ ¹æ®å…³é”®å­—æœç´¢è¯¾ç¨‹ä¿¡æ¯ï¼Œæœç´¢æ–¹å¼ä¸ºå…¨æ–‡æ£€ç´¢ï¼Œå…³é”®å­—éœ€è¦åŒ¹é…è¯¾ç¨‹çš„åç§°ã€ è¯¾ç¨‹å†…å®¹ã€‚</p><p>3ã€æ ¹æ®éš¾åº¦ç­‰çº§æœç´¢è¯¾ç¨‹ã€‚</p><p>4ã€æœç´¢ç»“ç‚¹åˆ†é¡µæ˜¾ç¤ºã€‚</p><p>æŠ€æœ¯ç‚¹ï¼š</p><p>1ã€æ•´ä½“é‡‡ç”¨å¸ƒå°”æŸ¥è¯¢ã€‚</p><p>2ã€æ ¹æ®å…³é”®å­—æœç´¢ï¼Œé‡‡ç”¨ MultiMatchQueryï¼Œæœç´¢ nameã€description å­—æ®µã€‚</p><p>3ã€æ ¹æ®åˆ†ç±»ã€è¯¾ç¨‹ç­‰çº§æœç´¢é‡‡ç”¨è¿‡æ»¤å™¨å®ç°ã€‚</p><p>4ã€åˆ†é¡µæŸ¥è¯¢ã€‚</p><p>5ã€é«˜äº®æ˜¾ç¤ºã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¯¾ç¨‹åˆ†ç±»ã€è¯¾ç¨‹ç­‰çº§ç­‰æŸ¥è¯¢ä½¿ç”¨è¿‡æ»¤å™¨æ–¹å¼ï¼Ÿ</p></blockquote><p>ä½¿ç”¨å…³é”®å­—æŸ¥è¯¢éœ€è¦è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œæ ¹æ®è¯¾ç¨‹åˆ†ç±»ã€è¯¾ç¨‹ç­‰çº§å»æŸ¥è¯¢ä¸éœ€è¦è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œä½¿ç”¨è¿‡æ»¤å™¨å®ç°æ ¹æ®è¯¾ç¨‹åˆ†ç±»ã€è¯¾ç¨‹ç­‰çº§æŸ¥è¯¢çš„è¿‡ç¨‹ä¸ä¼šè®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p><h4 id="_5-4-2-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_5-4-2-æ¥å£å®šä¹‰" aria-hidden="true">#</a> <strong>5.4.2 æ¥å£å®šä¹‰</strong></h4><p>1ã€å®šä¹‰æœç´¢æ¡ä»¶ DTO ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æœç´¢è¯¾ç¨‹å‚æ•°dtl
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/24 22:36
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Data</span>
 <span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchCourseParamDto</span> <span class="token punctuation">{</span>

  <span class="token comment">//å…³é”®å­—</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> keywords<span class="token punctuation">;</span>

  <span class="token comment">//å¤§åˆ†ç±»</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> mt<span class="token punctuation">;</span>

  <span class="token comment">//å°åˆ†ç±»</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> st<span class="token punctuation">;</span>
  <span class="token comment">//éš¾åº¦ç­‰çº§</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> grade<span class="token punctuation">;</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€ä¸ºäº†é€‚åº”åæœŸçš„æ‰©å±•ï¼Œå®šä¹‰æœç´¢ç»“æœç±»ï¼Œè®©å®ƒç»§æ‰¿ PageResult</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/9/25 17:51
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">PageResult</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">SearchPageResultDto</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">,</span> <span class="token keyword">long</span> counts<span class="token punctuation">,</span> <span class="token keyword">long</span> page<span class="token punctuation">,</span> <span class="token keyword">long</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> counts<span class="token punctuation">,</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageParams</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">SearchCourseParamDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CourseIndex</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CourseSearchService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹æœç´¢æ¥å£
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/24 22:31
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹æœç´¢æ¥å£&quot;</span><span class="token punctuation">,</span>tags <span class="token operator">=</span> <span class="token string">&quot;è¯¾ç¨‹æœç´¢æ¥å£&quot;</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@RestController</span>
 <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/course&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CourseSearchController</span> <span class="token punctuation">{</span>



 <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹æœç´¢åˆ—è¡¨&quot;</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">PageParams</span> pageParams<span class="token punctuation">,</span> <span class="token class-name">SearchCourseParamDto</span> searchCourseParamDto<span class="token punctuation">)</span><span class="token punctuation">{</span>



  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-3-åŸºæœ¬åŠŸèƒ½å®ç°" tabindex="-1"><a class="header-anchor" href="#_5-4-3-åŸºæœ¬åŠŸèƒ½å®ç°" aria-hidden="true">#</a> <strong>5.4.3 åŸºæœ¬åŠŸèƒ½å®ç°</strong></h4><p>å®šä¹‰ service æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageParams</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">SearchCourseParamDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">SearchPageResultDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CourseIndex</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è¯¾ç¨‹æœç´¢service
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/24 22:40
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CourseSearchService</span> <span class="token punctuation">{</span>


    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æœç´¢è¯¾ç¨‹åˆ—è¡¨
     * <span class="token keyword">@param</span> <span class="token parameter">pageParams</span> åˆ†é¡µå‚æ•°
     * <span class="token keyword">@param</span> <span class="token parameter">searchCourseParamDto</span> æœç´¢æ¡ä»¶
     * <span class="token keyword">@return</span> com.xuecheng.base.model.PageResult<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.xuecheng.search.po.CourseIndex</span><span class="token punctuation">&gt;</span></span> è¯¾ç¨‹åˆ—è¡¨
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/24 22:45
    */</span>
    <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryCoursePubIndex</span><span class="token punctuation">(</span><span class="token class-name">PageParams</span> pageParams<span class="token punctuation">,</span> <span class="token class-name">SearchCourseParamDto</span> searchCourseParamDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœç´¢æ¥å£çš„å†…å®¹è¾ƒå¤šï¼Œæˆ‘ä»¬åˆ†å‡ æ­¥å®ç°ï¼Œé¦–å…ˆå®ç°æ ¹æ®åˆ†é¡µæœç´¢ï¼Œæ¥å£å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageParams</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">SearchCourseParamDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">SearchPageResultDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">CourseIndex</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CourseSearchService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>lucene<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">TotalHits</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">SearchRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">SearchResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RequestOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestHighLevelClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>common<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">Text</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>index<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">BoolQueryBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>index<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">MultiMatchQueryBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>index<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">QueryBuilders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">SearchHit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">SearchHits</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>aggregations<span class="token punctuation">.</span></span><span class="token class-name">AggregationBuilders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>aggregations<span class="token punctuation">.</span></span><span class="token class-name">Aggregations</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>aggregations<span class="token punctuation">.</span>bucket<span class="token punctuation">.</span>terms<span class="token punctuation">.</span></span><span class="token class-name">Terms</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">SearchSourceBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>fetch<span class="token punctuation">.</span>subphase<span class="token punctuation">.</span>highlight<span class="token punctuation">.</span></span><span class="token class-name">HighlightBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>search<span class="token punctuation">.</span>fetch<span class="token punctuation">.</span>subphase<span class="token punctuation">.</span>highlight<span class="token punctuation">.</span></span><span class="token class-name">HighlightField</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> è¯¾ç¨‹æœç´¢serviceå®ç°ç±»
 * <span class="token keyword">@date</span> 2022/9/24 22:48
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CourseSearchServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">CourseSearchService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${elasticsearch.course.index}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> courseIndexStore<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${elasticsearch.course.source_fields}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sourceFields<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryCoursePubIndex</span><span class="token punctuation">(</span><span class="token class-name">PageParams</span> pageParams<span class="token punctuation">,</span> <span class="token class-name">SearchCourseParamDto</span> courseSearchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//è®¾ç½®ç´¢å¼•</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span>courseIndexStore<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SearchSourceBuilder</span> searchSourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//sourceæºå­—æ®µè¿‡è™‘</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sourceFieldsArray <span class="token operator">=</span> sourceFields<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">fetchSource</span><span class="token punctuation">(</span>sourceFieldsArray<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//åˆ†é¡µ</span>
        <span class="token class-name">Long</span> pageNo <span class="token operator">=</span> pageParams<span class="token punctuation">.</span><span class="token function">getPageNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> pageSize <span class="token operator">=</span> pageParams<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pageNo<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">toIntExact</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//å¸ƒå°”æŸ¥è¯¢</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è¯·æ±‚æœç´¢</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>searchSourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            searchResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹æœç´¢å¼‚å¸¸ï¼š{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//ç»“æœé›†å¤„ç†</span>
        <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> searchHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®°å½•æ€»æ•°</span>
        <span class="token class-name">TotalHits</span> totalHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ•°æ®åˆ—è¡¨</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> searchHits<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CourseIndex</span> courseIndex <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">CourseIndex</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>courseIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> pageResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> totalHits<span class="token punctuation">.</span>value<span class="token punctuation">,</span>pageNo<span class="token punctuation">,</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>



        <span class="token keyword">return</span> pageResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-4-åŸºæœ¬åŠŸèƒ½æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-4-4-åŸºæœ¬åŠŸèƒ½æµ‹è¯•" aria-hidden="true">#</a> <strong>5.4.4 åŸºæœ¬åŠŸèƒ½æµ‹è¯•</strong></h4><p>å½“è¾“å…¥æŸ¥è¯¢æ¡ä»¶æ—¶ä¼šæŸ¥è¯¢å…¨éƒ¨è¯¾ç¨‹ä¿¡æ¯å¹¶æ”¯æŒåˆ†é¡µæŸ¥è¯¢ã€‚</p><p>1ã€å‡†å¤‡æµ‹è¯•</p><p>å¯åŠ¨ nginxã€ç½‘å…³ã€æœç´¢æœåŠ¡ã€‚</p><p>ä½¿ç”¨ kibana é€šè¿‡ rest api å‘ç´¢å¼•åº“æ·»åŠ è¯¾ç¨‹ä¿¡æ¯ï¼Œæˆ–é€šè¿‡ httpclient æ·»åŠ è¯¾ç¨‹ä¿¡æ¯ï¼Œè‡³å°‘æ·»åŠ ä¸¤æ¡ä¿¡æ¯ã€‚</p><p>2ã€è¿›å…¥æœç´¢ç•Œé¢</p><p>é»˜è®¤æŸ¥è¯¢å‡ºåˆšæ‰æ·»åŠ çš„è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>3ã€ä¿®æ”¹åˆ†é¡µå‚æ•°æµ‹è¯•åˆ†é¡µ</p><p>æ‰“å¼€ course/ search.html é¡µé¢ ï¼Œæ‰¾åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºä½ç½®ï¼š</p><p><img src="/MyBlog/assets/image-20230531101012368-7fc2aa0f.png" alt="image-20230531101012368"></p><p>ä¿®æ”¹ pageSize ä¸º 1,å³ä¸€é¡µæ˜¾ç¤ºä¸€æ¡è®°å½•ã€‚</p><p>åˆ·æ–°æœç´¢ç•Œé¢ï¼Œæ¯é¡µæ˜¾ç¤ºä¸€æ¡è®°å½•ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531101017200-68b62597.png" alt="image-20230531101017200"></p><h4 id="_5-4-5-æ ¹æ®æ¡ä»¶æœç´¢" tabindex="-1"><a class="header-anchor" href="#_5-4-5-æ ¹æ®æ¡ä»¶æœç´¢" aria-hidden="true">#</a> <strong>5.4.5 æ ¹æ®æ¡ä»¶æœç´¢</strong></h4><p>ä¸‹è¾¹å®ç°æ ¹æ®å…³é”®ã€ä¸€çº§åˆ†ç±»ã€äºŒçº§åˆ†ç±»ã€éš¾åº¦ç­‰çº§æœç´¢ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryCoursePubIndex</span><span class="token punctuation">(</span><span class="token class-name">PageParams</span> pageParams<span class="token punctuation">,</span> <span class="token class-name">SearchCourseParamDto</span> courseSearchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//è®¾ç½®ç´¢å¼•</span>
    <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span>courseIndexStore<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SearchSourceBuilder</span> searchSourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//sourceæºå­—æ®µè¿‡è™‘</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sourceFieldsArray <span class="token operator">=</span> sourceFields<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">fetchSource</span><span class="token punctuation">(</span>sourceFieldsArray<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>courseSearchParam<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        courseSearchParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchCourseParamDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å…³é”®å­—</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//åŒ¹é…å…³é”®å­—</span>
        <span class="token class-name">MultiMatchQueryBuilder</span> multiMatchQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">multiMatchQuery</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®åŒ¹é…å æ¯”</span>
        multiMatchQueryBuilder<span class="token punctuation">.</span><span class="token function">minimumShouldMatch</span><span class="token punctuation">(</span><span class="token string">&quot;70%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æå‡å¦ä¸ªå­—æ®µçš„Boostå€¼</span>
        multiMatchQueryBuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span>multiMatchQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è¿‡è™‘</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getMt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;mtName&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getMt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getSt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;stName&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getSt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;grade&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//åˆ†é¡µ</span>
    <span class="token class-name">Long</span> pageNo <span class="token operator">=</span> pageParams<span class="token punctuation">.</span><span class="token function">getPageNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> pageSize <span class="token operator">=</span> pageParams<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pageNo<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">toIntExact</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¸ƒå°”æŸ¥è¯¢</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//è¯·æ±‚æœç´¢</span>
    searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>searchSourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        searchResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹æœç´¢å¼‚å¸¸ï¼š{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç»“æœé›†å¤„ç†</span>
    <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> searchHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®°å½•æ€»æ•°</span>
    <span class="token class-name">TotalHits</span> totalHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ•°æ®åˆ—è¡¨</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> searchHits<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CourseIndex</span> courseIndex <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">CourseIndex</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>courseIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> pageResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> totalHits<span class="token punctuation">.</span>value<span class="token punctuation">,</span>pageNo<span class="token punctuation">,</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token keyword">return</span> pageResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-6-æ¡ä»¶æœç´¢æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-4-6-æ¡ä»¶æœç´¢æµ‹è¯•" aria-hidden="true">#</a> <strong>5.4.6 æ¡ä»¶æœç´¢æµ‹è¯•</strong></h4><p>è¿›å…¥æœç´¢ç•Œé¢ï¼Œè¾“å…¥å…³é”®å­—è¿›è¡Œæµ‹è¯•ã€‚</p><p>ä¸€çº§åˆ†ç±»ã€äºŒçº§åˆ†ç±»åœ¨ä¸‹è¾¹çš„èšåˆæœç´¢ä¸­æµ‹è¯•ã€‚</p><h4 id="_5-4-7-èšåˆæœç´¢" tabindex="-1"><a class="header-anchor" href="#_5-4-7-èšåˆæœç´¢" aria-hidden="true">#</a> <strong>5.4.7 èšåˆæœç´¢</strong></h4><p>æœç´¢ç•Œé¢ä¸Šæ˜¾ç¤ºçš„ä¸€çº§åˆ†ç±»ã€äºŒçº§åˆ†ç±»æ¥æºäºæœç´¢ç»“æœï¼Œä½¿ç”¨èšåˆæœç´¢å®ç°æ‰¾åˆ°æœç´¢ç»“æœä¸­çš„ä¸€çº§åˆ†ç±»ã€äºŒçº§åˆ†ç±»ã€‚</p><p>1ã€é¦–å…ˆåœ¨æœç´¢ç»“æ„ DTO ä¸­æ·»åŠ ä¸€çº§åˆ†ç±»ã€äºŒçº§åˆ†ç±»åˆ—è¡¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>search<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PageResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/9/25 17:51
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">PageResult</span> <span class="token punctuation">{</span>

    <span class="token comment">//å¤§åˆ†ç±»åˆ—è¡¨</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mtList<span class="token punctuation">;</span>
    <span class="token comment">//å°åˆ†ç±»åˆ—è¡¨</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stList<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SearchPageResultDto</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">,</span> <span class="token keyword">long</span> counts<span class="token punctuation">,</span> <span class="token keyword">long</span> page<span class="token punctuation">,</span> <span class="token keyword">long</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> counts<span class="token punctuation">,</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æœç´¢æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryCoursePubIndex</span><span class="token punctuation">(</span><span class="token class-name">PageParams</span> pageParams<span class="token punctuation">,</span> <span class="token class-name">SearchCourseParamDto</span> courseSearchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//è®¾ç½®ç´¢å¼•</span>
    <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span>courseIndexStore<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SearchSourceBuilder</span> searchSourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//sourceæºå­—æ®µè¿‡è™‘</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sourceFieldsArray <span class="token operator">=</span> sourceFields<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">fetchSource</span><span class="token punctuation">(</span>sourceFieldsArray<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>courseSearchParam<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        courseSearchParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchCourseParamDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å…³é”®å­—</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//åŒ¹é…å…³é”®å­—</span>
        <span class="token class-name">MultiMatchQueryBuilder</span> multiMatchQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">multiMatchQuery</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®åŒ¹é…å æ¯”</span>
        multiMatchQueryBuilder<span class="token punctuation">.</span><span class="token function">minimumShouldMatch</span><span class="token punctuation">(</span><span class="token string">&quot;70%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æå‡å¦ä¸ªå­—æ®µçš„Boostå€¼</span>
        multiMatchQueryBuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span>multiMatchQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è¿‡è™‘</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getMt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;mtName&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getMt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getSt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;stName&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getSt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;grade&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//åˆ†é¡µ</span>
    <span class="token class-name">Long</span> pageNo <span class="token operator">=</span> pageParams<span class="token punctuation">.</span><span class="token function">getPageNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> pageSize <span class="token operator">=</span> pageParams<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pageNo<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">toIntExact</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¸ƒå°”æŸ¥è¯¢</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">//è¯·æ±‚æœç´¢</span>
    searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>searchSourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//èšåˆè®¾ç½®</span>
    <span class="token function">buildAggregation</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        searchResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹æœç´¢å¼‚å¸¸ï¼š{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç»“æœé›†å¤„ç†</span>
    <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> searchHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®°å½•æ€»æ•°</span>
    <span class="token class-name">TotalHits</span> totalHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ•°æ®åˆ—è¡¨</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> searchHits<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CourseIndex</span> courseIndex <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">CourseIndex</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>courseIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> pageResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> totalHits<span class="token punctuation">.</span>value<span class="token punctuation">,</span>pageNo<span class="token punctuation">,</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//è·å–èšåˆç»“æœ</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mtList<span class="token operator">=</span> <span class="token function">getAggregation</span><span class="token punctuation">(</span>searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;mtAgg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stList <span class="token operator">=</span> <span class="token function">getAggregation</span><span class="token punctuation">(</span>searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;stAgg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    pageResult<span class="token punctuation">.</span><span class="token function">setMtList</span><span class="token punctuation">(</span>mtList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageResult<span class="token punctuation">.</span><span class="token function">setStList</span><span class="token punctuation">(</span>stList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> pageResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-8-èšåˆæœç´¢æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-4-8-èšåˆæœç´¢æµ‹è¯•" aria-hidden="true">#</a> <strong>5.4.8 èšåˆæœç´¢æµ‹è¯•</strong></h4><p>è¿›å…¥æœç´¢ç•Œé¢ï¼Œè§‚å¯Ÿæœç´¢è¯·æ±‚çš„å“åº”å†…å®¹ä¸­æ˜¯å¦å­˜åœ¨ mtList å’Œ stList.</p><p>è§‚å¯Ÿé¡µé¢ä¸€çº§åˆ†ç±»ã€äºŒçº§åˆ†ç±»æ˜¯å¦æœ‰åˆ†ç±»ä¿¡æ¯ã€‚</p><p>æ³¨æ„ï¼šå½“é€‰ä¸­ä¸€ä¸ªä¸€çº§åˆ†ç±»æ—¶æ‰ä¼šæ˜¾ç¤ºäºŒçº§åˆ†ç±»ã€‚</p><h4 id="_5-4-9-é«˜äº®è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_5-4-9-é«˜äº®è®¾ç½®" aria-hidden="true">#</a> <strong>5.4.9 é«˜äº®è®¾ç½®</strong></h4><p>æœ€åå®ç°å…³é”®è¯åœ¨è¯¾ç¨‹åç§°ä¸­é«˜äº®æ˜¾ç¤ºã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryCoursePubIndex</span><span class="token punctuation">(</span><span class="token class-name">PageParams</span> pageParams<span class="token punctuation">,</span> <span class="token class-name">SearchCourseParamDto</span> courseSearchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//è®¾ç½®ç´¢å¼•</span>
    <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span>courseIndexStore<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SearchSourceBuilder</span> searchSourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//sourceæºå­—æ®µè¿‡è™‘</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sourceFieldsArray <span class="token operator">=</span> sourceFields<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">fetchSource</span><span class="token punctuation">(</span>sourceFieldsArray<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>courseSearchParam<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        courseSearchParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchCourseParamDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å…³é”®å­—</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//åŒ¹é…å…³é”®å­—</span>
        <span class="token class-name">MultiMatchQueryBuilder</span> multiMatchQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">multiMatchQuery</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®åŒ¹é…å æ¯”</span>
        multiMatchQueryBuilder<span class="token punctuation">.</span><span class="token function">minimumShouldMatch</span><span class="token punctuation">(</span><span class="token string">&quot;70%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æå‡å¦ä¸ªå­—æ®µçš„Boostå€¼</span>
        multiMatchQueryBuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span>multiMatchQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è¿‡è™‘</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getMt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;mtName&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getMt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getSt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;stName&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getSt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;grade&quot;</span><span class="token punctuation">,</span>courseSearchParam<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//åˆ†é¡µ</span>
    <span class="token class-name">Long</span> pageNo <span class="token operator">=</span> pageParams<span class="token punctuation">.</span><span class="token function">getPageNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> pageSize <span class="token operator">=</span> pageParams<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pageNo<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">toIntExact</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¸ƒå°”æŸ¥è¯¢</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//é«˜äº®è®¾ç½®</span>
    <span class="token class-name">HighlightBuilder</span> highlightBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    highlightBuilder<span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;font class=&#39;eslight&#39;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    highlightBuilder<span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/font&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®¾ç½®é«˜äº®å­—æ®µ</span>
    highlightBuilder<span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HighlightBuilder<span class="token punctuation">.</span>Field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchSourceBuilder<span class="token punctuation">.</span><span class="token function">highlighter</span><span class="token punctuation">(</span>highlightBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è¯·æ±‚æœç´¢</span>
    searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>searchSourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//èšåˆè®¾ç½®</span>
    <span class="token function">buildAggregation</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        searchResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹æœç´¢å¼‚å¸¸ï¼š{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç»“æœé›†å¤„ç†</span>
    <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> searchHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®°å½•æ€»æ•°</span>
    <span class="token class-name">TotalHits</span> totalHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ•°æ®åˆ—è¡¨</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> searchHits<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CourseIndex</span> courseIndex <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">CourseIndex</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//å–å‡ºsource</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sourceAsMap <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è¯¾ç¨‹id</span>
        <span class="token class-name">Long</span> id <span class="token operator">=</span> courseIndex<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å–å‡ºåç§°</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> courseIndex<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å–å‡ºé«˜äº®å­—æ®µå†…å®¹</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">HighlightField</span><span class="token punctuation">&gt;</span></span> highlightFields <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>highlightFields<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">HighlightField</span> nameField <span class="token operator">=</span> highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>nameField<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">Text</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fragments <span class="token operator">=</span> nameField<span class="token punctuation">.</span><span class="token function">getFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">StringBuffer</span> stringBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Text</span> str <span class="token operator">:</span> fragments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    stringBuffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                name <span class="token operator">=</span> stringBuffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        courseIndex<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        courseIndex<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>courseIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseIndex</span><span class="token punctuation">&gt;</span></span> pageResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchPageResultDto</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> totalHits<span class="token punctuation">.</span>value<span class="token punctuation">,</span>pageNo<span class="token punctuation">,</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//è·å–èšåˆç»“æœ</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mtList<span class="token operator">=</span> <span class="token function">getAggregation</span><span class="token punctuation">(</span>searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;mtAgg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stList <span class="token operator">=</span> <span class="token function">getAggregation</span><span class="token punctuation">(</span>searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;stAgg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    pageResult<span class="token punctuation">.</span><span class="token function">setMtList</span><span class="token punctuation">(</span>mtList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageResult<span class="token punctuation">.</span><span class="token function">setStList</span><span class="token punctuation">(</span>stList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> pageResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-10-é«˜äº®è®¾ç½®æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-4-10-é«˜äº®è®¾ç½®æµ‹è¯•" aria-hidden="true">#</a> <strong>5.4.10 é«˜äº®è®¾ç½®æµ‹è¯•</strong></h4><p>è¾“å…¥å…³é”®å­—ï¼Œè§‚å¯Ÿæœç´¢ç»“æœï¼Œæ ‡é¢˜ä¸­æ˜¯å¦å¯¹å…³é”®å­—ä¿¡æ¯è¿›è¡Œé«˜äº®æ˜¾ç¤ºã€‚</p><h3 id="_5-5-è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_5-5-è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•åŒæ­¥" aria-hidden="true">#</a> <strong>5.5 è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•åŒæ­¥</strong></h3><h4 id="_5-5-1-æŠ€æœ¯æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_5-5-1-æŠ€æœ¯æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>5.5.1 æŠ€æœ¯æ–¹æ¡ˆ</strong></h4><p>é€šè¿‡å‘ç´¢å¼•ä¸­æ·»åŠ è¯¾ç¨‹ä¿¡æ¯æœ€ç»ˆå®ç°äº†è¯¾ç¨‹çš„æœç´¢ï¼Œæˆ‘ä»¬å‘ç°è¯¾ç¨‹ä¿¡æ¯æ˜¯å…ˆä¿å­˜åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œè€Œåå†å†™å…¥ç´¢å¼•ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å°†å…³ç³»æ•°æ®ä¸­çš„æ•°æ®åŒæ­¥åˆ° elasticsearch ç´¢å¼•ä¸­çš„è¿‡ç¨‹ï¼Œå¯ä»¥ç®€å•æˆä¸ºç´¢å¼•åŒæ­¥ã€‚</p><p>é€šå¸¸é¡¹ç›®ä¸­ä½¿ç”¨ elasticsearch éœ€è¦å®Œæˆç´¢å¼•åŒæ­¥ï¼Œç´¢å¼•åŒæ­¥çš„æ–¹æ³•å¾ˆå¤šï¼š</p><p>1ã€é’ˆå¯¹å®æ—¶æ€§éå¸¸é«˜çš„åœºæ™¯éœ€è¦æ»¡è¶³æ•°æ®çš„åŠæ—¶åŒæ­¥ï¼Œå¯ä»¥åŒæ­¥è°ƒç”¨ï¼Œæˆ–ä½¿ç”¨ Canal å»å®ç°ã€‚</p><p>1ï¼‰åŒæ­¥è°ƒç”¨å³åœ¨å‘ MySQL å†™æ•°æ®åè¿œç¨‹è°ƒç”¨æœç´¢æœåŠ¡çš„æ¥å£å†™å…¥ç´¢å¼•ï¼Œæ­¤æ–¹æ³•ç®€å•ä½†æ˜¯è€¦åˆä»£ç å¤ªé«˜ã€‚</p><p>2ï¼‰å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸­é—´çš„è½¯ä»¶ canal è§£å†³è€¦åˆæ€§çš„é—®é¢˜ï¼Œä½†å­˜åœ¨å­¦ä¹ ä¸ç»´æŠ¤æˆæœ¬ã€‚</p><p>canal ä¸»è¦ç”¨é€”æ˜¯åŸºäº MySQL æ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œå¹¶èƒ½æä¾›å¢é‡æ•°æ®è®¢é˜…å’Œæ¶ˆè´¹ï¼Œå®ç°å°† MySQL çš„æ•°æ®åŒæ­¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€Elasticsearchã€å…¶å®ƒæ•°æ®åº“ç­‰ï¼Œåº”ç”¨åœºæ™¯ååˆ†ä¸°å¯Œã€‚</p><p><img src="/MyBlog/assets/image-20230531101151392-8e9ec088.png" alt="image-20230531101151392"></p><p>å®ƒçš„åœ°å€ï¼š</p><p>github åœ°å€ï¼šhttps://github.com/alibaba/canal</p><p>ç‰ˆæœ¬ä¸‹è½½åœ°å€ï¼šhttps://github.com/alibaba/canal/releases</p><p>æ–‡æ¡£åœ°å€ï¼šhttps://github.com/alibaba/canal/wiki/Docker-QuickStart</p><p>Canal åŸºäº mysql çš„ binlog æŠ€æœ¯å®ç°æ•°æ®åŒæ­¥ï¼Œä»€ä¹ˆæ˜¯ binlogï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ŒäºŒè¿›åˆ¶æ ¼å¼ï¼Œè®°å½•äº†å¯¹æ•°æ®åº“æ›´æ–°çš„ SQL è¯­å¥ï¼Œå‘æ•°æ®åº“å†™æ•°æ®çš„åŒæ—¶å‘ binlog æ–‡ä»¶é‡Œè®°å½•å¯¹åº”çš„ sql è¯­å¥ã€‚å½“æ•°æ®åº“æœåŠ¡å™¨å‘ç”Ÿäº†æ•…éšœå°±å¯ä»¥ä½¿ç”¨ binlog æ–‡ä»¶å¯¹æ•°æ®åº“è¿›è¡Œæ¢å¤ã€‚</p><p>æ‰€ä»¥ï¼Œä½¿ç”¨ canal æ˜¯éœ€è¦å¼€å¯ mysql çš„ binlog å†™å…¥åŠŸèƒ½ï¼ŒCanal å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230531101158112-ff7e84c8.png" alt="image-20230531101158112"></p><p>1ã€canal æ¨¡æ‹Ÿ MySQL slave çš„äº¤äº’åè®®ï¼Œä¼ªè£…è‡ªå·±ä¸º MySQL slave ï¼Œå‘ MySQL master å‘é€ dump åè®®</p><p>2ã€MySQL master æ”¶åˆ° dump è¯·æ±‚ï¼Œå¼€å§‹æ¨é€ binary log ç»™ slave (å³ canal )</p><p>3ã€canal è§£æ binary log å¯¹è±¡(åŸå§‹ä¸º byte æµ)</p><p>è¯¦ç»†ä½¿ç”¨ Canal è¿›è¡Œç´¢å¼•åŒæ­¥çš„æ­¥éª¤å‚è€ƒï¼šCanal å®ç°ç´¢å¼•åŒæ­¥.pdf</p><p>2ã€å½“ç´¢å¼•åŒæ­¥çš„å®æ—¶æ€§è¦æ±‚ä¸é«˜æ—¶å¯ç”¨çš„æŠ€æœ¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ï¼šMQã€Logstashã€ä»»åŠ¡è°ƒåº¦ç­‰ã€‚</p><p>MQï¼šå‘ mysql å†™æ•°æ®çš„æ—¶å€™å‘ mq å†™å…¥æ¶ˆæ¯ï¼Œæœç´¢æœåŠ¡ç›‘å¬ MQï¼Œæ”¶åˆ°æ¶ˆæ¯åå†™å…¥ç´¢å¼•ã€‚ä½¿ç”¨ MQ çš„ä¼˜åŠ¿æ˜¯ä»£ç è§£è€¦ï¼Œä½†æ˜¯éœ€è¦å¤„ç†æ¶ˆæ¯å¯é æ€§çš„é—®é¢˜æœ‰ä¸€å®šçš„æŠ€æœ¯æˆæœ¬ï¼Œåšåˆ°æ¶ˆæ¯å¯é æ€§éœ€è¦åšåˆ°ç”Ÿäº§è€…æŠ•é€’æˆåŠŸã€æ¶ˆæ¯æŒä¹…åŒ–ä»¥åŠæ¶ˆè´¹è€…æ¶ˆè´¹æˆåŠŸä¸‰ä¸ªæ–¹é¢ï¼Œå¦å¤–è¿˜è¦åšå¥½æ¶ˆæ¯å¹‚ç­‰æ€§é—®é¢˜ã€‚</p><p>Logstashï¼š å¼€æºå®æ—¶æ—¥å¿—åˆ†æå¹³å° ELK åŒ…æ‹¬ Elasticsearchã€Kibanaã€Logstashï¼ŒLogstash è´Ÿè´£æ”¶é›†ã€è§£æå’Œè½¬æ¢æ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥å®ç° MySQL ä¸ Elasticsearch ä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚ä¹Ÿå¯ä»¥å®ç°è§£è€¦åˆå¹¶ä¸”æ˜¯å®˜æ–¹æ¨èï¼Œä½†éœ€è¦å¢åŠ å­¦ä¹ ä¸ç»´æŠ¤æˆæœ¬ã€‚</p><p>ä»»åŠ¡è°ƒåº¦ï¼šå‘ mysql å†™æ•°æ®çš„æ—¶å€™è®°å½•ä¿®æ”¹è®°å½•ï¼Œå¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ ¹æ®ä¿®æ”¹è®°å½•å°†æ•°æ®åŒæ­¥åˆ° Elasticsearchã€‚</p><p>æ ¹æ®æœ¬é¡¹ç›®çš„éœ€æ±‚ï¼Œè¯¾ç¨‹å‘å¸ƒåä¿¡æ¯åŒæ­¥çš„å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œä»æäº¤å®¡æ ¸åˆ°å‘å¸ƒæˆåŠŸä¸€èˆ¬ä¸¤ä¸ªå·¥ä½œæ—¥å®Œæˆã€‚ç»¼åˆæ¯”è¾ƒä»¥ä¸ŠæŠ€æœ¯æ–¹æ¡ˆæœ¬é¡¹ç›®çš„ç´¢å¼•åŒæ­¥æŠ€æœ¯ä½¿ç”¨ä»»åŠ¡è°ƒåº¦çš„æ–¹æ³•ã€‚</p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230531101205123-572da1c2.png" alt="image-20230531101205123"></p><p>1ã€è¯¾ç¨‹å‘å¸ƒå‘æ¶ˆæ¯è¡¨æ’å…¥è®°å½•ã€‚</p><p>2ã€ç”±ä»»åŠ¡è°ƒåº¦ç¨‹åºé€šè¿‡æ¶ˆæ¯å¤„ç† SDK å¯¹æ¶ˆæ¯è®°å½•è¿›è¡Œå¤„ç†ã€‚</p><p>3ã€å‘ elasticsearch ç´¢å¼•ä¸­ä¿å­˜è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>å¦‚ä½•å‘å‘ elasticsearch ç´¢å¼•ä¸­ä¿å­˜è¯¾ç¨‹ä¿¡æ¯ï¼Ÿ</p><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>ç”±å†…å®¹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨æœç´¢æœåŠ¡æ·»åŠ è¯¾ç¨‹ä¿¡æ¯ç´¢å¼•ï¼Œæœç´¢æœåŠ¡å†è¯·æ±‚ elasticsearch å‘è¯¾ç¨‹ç´¢å¼•ä¸­æ·»åŠ æ–‡æ¡£ã€‚</p><h4 id="_5-5-2-è¯¾ç¨‹ç´¢å¼•ä»»åŠ¡å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_5-5-2-è¯¾ç¨‹ç´¢å¼•ä»»åŠ¡å¼€å‘" aria-hidden="true">#</a> <strong>5.5.2 è¯¾ç¨‹ç´¢å¼•ä»»åŠ¡å¼€å‘</strong></h4><p>1ã€æ‹·è´ CourseIndex æ¨¡å‹ç±»åˆ°å†…å®¹ç®¡ç† model å·¥ç¨‹çš„ dto åŒ…ä¸‹ã€‚</p><p>2ã€åœ¨å†…å®¹ç®¡ç†æœåŠ¡ä¸­æ·»åŠ  FeignClient</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>feignclient</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">CourseIndex</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestBody</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> æœç´¢æœåŠ¡è¿œç¨‹æ¥å£
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/20 20:29
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;search&quot;</span><span class="token punctuation">,</span>fallbackFactory <span class="token operator">=</span> <span class="token class-name">SearchServiceClientFallbackFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SearchServiceClient</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/search/index/course&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CourseIndex</span> courseIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ SearchServiceClientFallbackFactory ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchServiceClientFallbackFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchServiceClient</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SearchServiceClient</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SearchServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CourseIndex</span> courseIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                throwable<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨æœç´¢å‘ç”Ÿç†”æ–­èµ°é™çº§æ–¹æ³•,ç†”æ–­å¼‚å¸¸:&quot;</span><span class="token punctuation">,</span> throwable<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€ç¼–å†™è¯¾ç¨‹ç´¢å¼•ä»»åŠ¡æ‰§è¡Œæ–¹æ³•</p><p>å®Œå–„ CoursePublishTask ç±»ä¸­çš„ saveCourseIndex æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¿å­˜è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveCourseIndex</span><span class="token punctuation">(</span><span class="token class-name">MqMessage</span> mqMessage<span class="token punctuation">,</span><span class="token keyword">long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯,è¯¾ç¨‹id:{}&quot;</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æ¶ˆæ¯id</span>
    <span class="token class-name">Long</span> id <span class="token operator">=</span> mqMessage<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ¶ˆæ¯å¤„ç†çš„service</span>
    <span class="token class-name">MqMessageService</span> mqMessageService <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMqMessageService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ¶ˆæ¯å¹‚ç­‰æ€§å¤„ç†</span>
    <span class="token keyword">int</span> stageTwo <span class="token operator">=</span> mqMessageService<span class="token punctuation">.</span><span class="token function">getStageTwo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>stageTwo <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹ç´¢å¼•å·²å¤„ç†ç›´æ¥è¿”å›ï¼Œè¯¾ç¨‹id:{}&quot;</span><span class="token punctuation">,</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Boolean</span> result <span class="token operator">=</span> <span class="token function">saveCourseIndex</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ä¿å­˜ç¬¬ä¸€é˜¶æ®µçŠ¶æ€</span>
        mqMessageService<span class="token punctuation">.</span><span class="token function">completedStageTwo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">Boolean</span> <span class="token function">saveCourseIndex</span><span class="token punctuation">(</span><span class="token class-name">Long</span> courseId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//å–å‡ºè¯¾ç¨‹å‘å¸ƒä¿¡æ¯</span>
    <span class="token class-name">CoursePublish</span> coursePublish <span class="token operator">=</span> coursePublishMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ‹·è´è‡³è¯¾ç¨‹ç´¢å¼•å¯¹è±¡</span>
    <span class="token class-name">CourseIndex</span> courseIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CourseIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>coursePublish<span class="token punctuation">,</span>courseIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è¿œç¨‹è°ƒç”¨æœç´¢æœåŠ¡apiæ·»åŠ è¯¾ç¨‹ä¿¡æ¯åˆ°ç´¢å¼•</span>
    <span class="token class-name">Boolean</span> add <span class="token operator">=</span> searchServiceClient<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>courseIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>add<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">XueChengPlusException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token string">&quot;æ·»åŠ ç´¢å¼•å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> add<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-5-3-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-5-3-æµ‹è¯•" aria-hidden="true">#</a> <strong>5.5.3 æµ‹è¯•</strong></h4><p>æµ‹è¯•æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€å¯åŠ¨ elasticsearchã€kibanaã€‚</p><p>2ã€å¯åŠ¨ç½‘å…³ã€å†…å®¹ç®¡ç†ã€æœç´¢æœåŠ¡ã€nginxã€‚</p><p>3ã€å¯åŠ¨ xxl-job è°ƒåº¦ä¸­å¿ƒã€‚</p><p>4ã€åœ¨ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒå¼€å§‹è¯¾ç¨‹å‘å¸ƒä»»åŠ¡ã€‚</p><p>5ã€å‘å¸ƒä¸€é—¨è¯¾ç¨‹ï¼Œé¡µé¢æç¤ºæ“ä½œæˆåŠŸï¼ŒæŸ¥çœ‹å‘å¸ƒè¯¾ç¨‹ä»»åŠ¡æ˜¯å¦å†™åˆ°ä»»åŠ¡è¡¨ã€‚</p><p>6ã€ç»è¿‡ä»»åŠ¡è°ƒåº¦å°†è¯¾ç¨‹ä¿¡æ¯å†™å…¥ç´¢å¼•ã€‚</p><p>7ã€é€šè¿‡é—¨æˆ·è¿›å…¥æœç´¢é¡µé¢ï¼ŒæŸ¥çœ‹è¯¾ç¨‹ä¿¡æ¯æ˜¯å¦å±•ç¤ºã€‚</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ZyKunn/edit/main/notes/project/02/ç¬¬4ç« -è¯¾ç¨‹å‘å¸ƒv3.1/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">è´¡çŒ®è€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 814342838@qq.com">ZyKun</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="" aria-label="ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a></span><span class="next"><a href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/" class="" aria-label="ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1"><!--[--><!--]--> ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/MyBlog/assets/app-a153c100.js" defer></script>
  </body>
</html>
