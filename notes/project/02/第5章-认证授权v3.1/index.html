<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.63">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="./img/logo.png"><title>ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1 | ZyKunã®Blog</title><meta name="description" content="">
    <link rel="preload" href="/MyBlog/assets/style-57272a59.css" as="style"><link rel="stylesheet" href="/MyBlog/assets/style-57272a59.css">
    <link rel="modulepreload" href="/MyBlog/assets/app-a153c100.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-cdce2101.js"><link rel="modulepreload" href="/MyBlog/assets/index.html-85181f96.js"><link rel="prefetch" href="/MyBlog/assets/index.html-ab0151fa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1249ab5a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d02565e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1c68c797.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93acf26d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2bc953d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c526d7c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-636c9f52.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4177c6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7624decc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d0b4a798.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa378d7b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ddd44d65.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbb7f41.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-34576599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1079a374.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-88d4ebe7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5e927142.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a6f13b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c85da23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-69e813d7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545062a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd7a4fcb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-910949e0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-459b0c71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9a036060.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f62ffe74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-841a86c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b31c8bb6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-85bae056.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73555735.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d5456cd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d2dfbeec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-746091c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9cc627ff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d411448a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4454f425.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57aa84f4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2ce52087.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76657200.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90d9409e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4d6ba5e7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-41bc7856.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6140daf4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ea30461d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00114784.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3fa86cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-386f0bd2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b46ac77e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-256a258e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4ebf55b3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7268161e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a8852c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19373782.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4e33bb6b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-de5ff178.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd5da14a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dbee5a73.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64025c89.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9bd15ac7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4812edff.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1f3f5c2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3f85e131.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1d66d048.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-67b1b38e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-17f10f72.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ad1b5dc8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b14e7669.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa35810b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-acb9b7bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2ba9a88.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-abdb28e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b3cc33e9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ef13eee8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73fa0dcc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6f7449c7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3857ef8d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e5af1d8f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5d14c1f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-94a8b9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3931e4d3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0978879b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-617bd5bf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fe008c8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0e33aa95.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-00725025.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8e05ec6e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-72ca6b4c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-427c5181.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b3baf42.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-40a790c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9709e7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8eb00d02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c849262.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eda16f63.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81242655.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9f6820.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79188b74.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5775eee0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eff0510c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-305de307.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e83a5de7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-761a9548.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c12ae66e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-87a73e5c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d720473a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b960b5b6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bbd98f93.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76195dca.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3bd0cfa7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8c87d147.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bac2e853.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ee6bc34.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ab7381d6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5b97f6b8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd33ca6f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-684189de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-63731ad7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-895bfca1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6d1ff4c2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b71bf26f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ce6f983b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c185f9a2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-29c62d64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-52c91de2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-55aa1c06.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c87ef63a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff1d9f51.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a12aedeb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-298f19f2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f881f599.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c32406a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d4217479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7edb7ce1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8671126f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da565d04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9deb3ec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee7cf1b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-270d6327.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ec786b75.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e98adf02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7233a0e2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79c193cf.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9714081e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d5dea51d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a235e4bb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e3209a23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-389e66df.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-652ee4f6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-025e6f4e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-60711e70.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6edc93de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11bd39b1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53015219.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74dcd8ae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dd727db.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-11b329fb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3b6f3614.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-70ce719f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f6ca4d92.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5a6833de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bf03220c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2edab58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f1e5cf7a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-21d4e18d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5235fca9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2dc704c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-57630906.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff165209.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6ec253a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f9e4f0c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-664b232d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adf015a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4667c0e6.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cc407710.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1752d212.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9b5d99c4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-43c48ae2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e8a616b7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93e7405b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-22a72a56.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-42ce3023.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f8eeab22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dd50991a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-af520db8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5ab2bfac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-965bc04f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-81ebef01.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-79d19f4d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9600bdfb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-560df48d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fb22a4f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bd4caa82.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-370323f9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f673ebfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78d88460.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8b54347c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d30f0340.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e26bc4de.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7d37b036.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-3aa565ce.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4c69f238.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-76d60030.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7116a5e4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8f649cc.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-adbbb7c9.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-90bb86fd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e23936a3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-19ad952b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-07245162.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-038b3afd.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-084fe5c1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-098421fe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7baefce4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fffdfb9c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d8c9612c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-05c42fda.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-e1615934.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-da824146.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fa2d32f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-545dbea7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3ca58cb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b9e2188a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4fc5f1f7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1ec5c70d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cbf2aa55.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8beb0c08.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ee54da9f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fd28b91d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-98aa51a1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-03f9381a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2c9009c5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-71b7cfbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1759170e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aa84186f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53160af7.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51b685b4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ecb8e229.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-9c507901.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6362722.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-faf67dd8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d7f20950.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a088985c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-93b7982c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b76e6179.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d976d39c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b16efd78.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-1301757e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c3240cbe.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a2ddd21c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-74fb5e20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-128f5026.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8fd9f38a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-82e84e23.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-007ef014.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f3dd860c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-382a2bae.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b6beaec.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-2eb17cfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c6f50213.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0c8aef39.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-133f4d38.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-cffd2be1.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a798219d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b5fde77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-13275b71.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-4b6a02c3.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f179a12.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f45bc33f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0574e5e5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0921816f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-631fbc02.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8586017d.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-c4dbf09b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-967486c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-aad17dde.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-ff644d77.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-78a4df64.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d2180e8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-53fbcd20.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-a3387e5e.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-979f5ac4.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-0938c506.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-51707e22.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b1e917a0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-6b56a071.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-d15eb498.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7b0a97c0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fda196b5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bcc5faac.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-490c208f.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-dce28479.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62825d3c.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b5a4af15.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-eb40da96.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-8d6d1c61.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-618cf3f0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-f2a35430.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-64f564d2.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-bca2187b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-7f689b28.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-62aa623a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-b0c39cc5.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-73b8fff0.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-5466ae58.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index.html-fbd0bcfa.js" as="script"><link rel="prefetch" href="/MyBlog/assets/404.html-5f041a2b.js" as="script"><link rel="prefetch" href="/MyBlog/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/MyBlog/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/MyBlog/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/MyBlog/" class=""><!----><span class="site-name can-hide">ZyKunã®Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="router-link-active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/MyBlog/" class="" aria-label="ğŸŒ±Home"><!--[--><!--]--> ğŸŒ±Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¥Java"><span class="title">ğŸ¥Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/01/" class="" aria-label="åŸºç¡€è¯­æ³•"><!--[--><!--]--> åŸºç¡€è¯­æ³• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/02/" class="" aria-label="é¢å‘å¯¹è±¡ç¼–ç¨‹"><!--[--><!--]--> é¢å‘å¯¹è±¡ç¼–ç¨‹ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/03/" class="" aria-label="å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶"><!--[--><!--]--> å¸¸ç”¨ç±»&amp;é›†åˆæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/04/" class="" aria-label="JDBC"><!--[--><!--]--> JDBC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/05/" class="" aria-label="Javaé«˜çº§"><!--[--><!--]--> Javaé«˜çº§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/java/06/" class="" aria-label="JavaWeb"><!--[--><!--]--> JavaWeb <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸPython"><span class="title">ğŸPython</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/python/01/" class="" aria-label="Pythonå…¥é—¨"><!--[--><!--]--> Pythonå…¥é—¨ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸŒ‹å¾®æœåŠ¡"><span class="title">ğŸŒ‹å¾®æœåŠ¡</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/01/" class="" aria-label="å®ç”¨ç¯‡"><!--[--><!--]--> å®ç”¨ç¯‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/microservices/02/" class="" aria-label="é«˜çº§ç¯‡"><!--[--><!--]--> é«˜çº§ç¯‡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/mysql/" class="" aria-label="ğŸ“Mysql"><!--[--><!--]--> ğŸ“Mysql <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤å‰ç«¯"><span class="title">ğŸ¤å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/01/" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/02/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/03/" class="" aria-label="JQuery"><!--[--><!--]--> JQuery <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/04/" class="" aria-label="Layui"><!--[--><!--]--> Layui <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/front-end/05/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¢Project"><span class="title">ğŸ¢Project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/01/" class="" aria-label="Reggie"><!--[--><!--]--> Reggie <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MyBlog/notes/project/02/" class="router-link-active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/MyBlog/notes/record/" class="" aria-label="ğŸéšç¬”"><!--[--><!--]--> ğŸéšç¬” <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ZyKunn" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/MyBlog/notes/project/02/" class="router-link-active sidebar-item sidebar-heading active" aria-label="51XueCheng"><!--[--><!--]--> 51XueCheng <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/MyBlog/notes/project/02/%E7%AC%AC1%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAv3.1/" class="sidebar-item" aria-label="ç¬¬ 1 ç«  é¡¹ç›®ä»‹ç»&amp;ç¯å¢ƒæ­å»º v3.1"><!--[--><!--]--> ç¬¬ 1 ç«  é¡¹ç›®ä»‹ç»&amp;ç¯å¢ƒæ­å»º v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC2%E7%AB%A0-%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="sidebar-item" aria-label="ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 2 ç«  å†…å®¹ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC3%E7%AB%A0-%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97v3.1/" class="sidebar-item" aria-label="ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1"><!--[--><!--]--> ç¬¬ 3 ç« åª’èµ„ç®¡ç†æ¨¡å— v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/" class="sidebar-item" aria-label="ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1"><!--[--><!--]--> ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1"><!--[--><!--]--> ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-æ¨¡å—éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1 æ¨¡å—éœ€æ±‚åˆ†æ"><!--[--><!--]--> 1 æ¨¡å—éœ€æ±‚åˆ†æ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-1-ä»€ä¹ˆæ˜¯è®¤è¯æˆæƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 ä»€ä¹ˆæ˜¯è®¤è¯æˆæƒ"><!--[--><!--]--> 1.1 ä»€ä¹ˆæ˜¯è®¤è¯æˆæƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 ä¸šåŠ¡æµç¨‹"><!--[--><!--]--> 1.2 ä¸šåŠ¡æµç¨‹ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-2-1-ç»Ÿä¸€è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.1 ç»Ÿä¸€è®¤è¯"><!--[--><!--]--> 1.2.1 ç»Ÿä¸€è®¤è¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-2-2-å•ç‚¹ç™»å½•" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.2 å•ç‚¹ç™»å½•"><!--[--><!--]--> 1.2.2 å•ç‚¹ç™»å½• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-2-3-ç¬¬ä¸‰æ–¹è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2.3 ç¬¬ä¸‰æ–¹è®¤è¯"><!--[--><!--]--> 1.2.3 ç¬¬ä¸‰æ–¹è®¤è¯ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-spring-security-è®¤è¯ç ”ç©¶" class="router-link-active router-link-exact-active sidebar-item" aria-label="2 Spring Security è®¤è¯ç ”ç©¶"><!--[--><!--]--> 2 Spring Security è®¤è¯ç ”ç©¶ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-1-spring-security-ä»‹ç»" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 Spring Security ä»‹ç»"><!--[--><!--]--> 2.1 Spring Security ä»‹ç» <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-2-è®¤è¯æˆæƒå…¥é—¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 è®¤è¯æˆæƒå…¥é—¨"><!--[--><!--]--> 2.2 è®¤è¯æˆæƒå…¥é—¨ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-2-1-åˆ›å»ºè®¤è¯æœåŠ¡å·¥ç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.1 åˆ›å»ºè®¤è¯æœåŠ¡å·¥ç¨‹"><!--[--><!--]--> 2.2.1 åˆ›å»ºè®¤è¯æœåŠ¡å·¥ç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-2-2-è®¤è¯æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.2 è®¤è¯æµ‹è¯•"><!--[--><!--]--> 2.2.2 è®¤è¯æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-2-3-æˆæƒæµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.3 æˆæƒæµ‹è¯•"><!--[--><!--]--> 2.2.3 æˆæƒæµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-2-4-å·¥ä½œåŸç†" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.4 å·¥ä½œåŸç†"><!--[--><!--]--> 2.2.4 å·¥ä½œåŸç† <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-ä»€ä¹ˆæ˜¯-oauth2" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 ä»€ä¹ˆæ˜¯ OAuth2"><!--[--><!--]--> 2.3 ä»€ä¹ˆæ˜¯ OAuth2 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-1-oauth2-è®¤è¯æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.1 OAuth2 è®¤è¯æµç¨‹"><!--[--><!--]--> 2.3.1 OAuth2 è®¤è¯æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-2-oauth2-åœ¨æœ¬é¡¹ç›®çš„åº”ç”¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.2 OAuth2 åœ¨æœ¬é¡¹ç›®çš„åº”ç”¨"><!--[--><!--]--> 2.3.2 OAuth2 åœ¨æœ¬é¡¹ç›®çš„åº”ç”¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-3-oauth2-çš„æˆæƒæ¨¡å¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.3 OAuth2 çš„æˆæƒæ¨¡å¼"><!--[--><!--]--> 2.3.3 OAuth2 çš„æˆæƒæ¨¡å¼ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-3-1-æˆæƒç æ¨¡å¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.3.1 æˆæƒç æ¨¡å¼"><!--[--><!--]--> 2.3.3.1 æˆæƒç æ¨¡å¼ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-3-2-æˆæƒç æ¨¡å¼æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.3.2 æˆæƒç æ¨¡å¼æµ‹è¯•"><!--[--><!--]--> 2.3.3.2 æˆæƒç æ¨¡å¼æµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-3-3-å¯†ç æ¨¡å¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.3.3 å¯†ç æ¨¡å¼"><!--[--><!--]--> 2.3.3.3 å¯†ç æ¨¡å¼ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-3-4-æœ¬é¡¹ç›®çš„åº”ç”¨æ–¹å¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3.3.4 æœ¬é¡¹ç›®çš„åº”ç”¨æ–¹å¼"><!--[--><!--]--> 2.3.3.4 æœ¬é¡¹ç›®çš„åº”ç”¨æ–¹å¼ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-4-jwt" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 JWT"><!--[--><!--]--> 2.4 JWT <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-4-1-æ™®é€šä»¤ç‰Œçš„é—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.1 æ™®é€šä»¤ç‰Œçš„é—®é¢˜"><!--[--><!--]--> 2.4.1 æ™®é€šä»¤ç‰Œçš„é—®é¢˜ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-4-2-ä»€ä¹ˆæ˜¯-jwt" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.2 ä»€ä¹ˆæ˜¯ JWT"><!--[--><!--]--> 2.4.2 ä»€ä¹ˆæ˜¯ JWT <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-4-3-æµ‹è¯•ç”Ÿæˆ-jwt-ä»¤ç‰Œ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.3 æµ‹è¯•ç”Ÿæˆ JWT ä»¤ç‰Œ"><!--[--><!--]--> 2.4.3 æµ‹è¯•ç”Ÿæˆ JWT ä»¤ç‰Œ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-4-4-æºå¸¦ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.4 æºå¸¦ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡"><!--[--><!--]--> 2.4.4 æºå¸¦ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-4-5-æµ‹è¯•è·å–ç”¨æˆ·èº«ä»½" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4.5 æµ‹è¯•è·å–ç”¨æˆ·èº«ä»½"><!--[--><!--]--> 2.4.5 æµ‹è¯•è·å–ç”¨æˆ·èº«ä»½ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-5-ç½‘å…³è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5 ç½‘å…³è®¤è¯"><!--[--><!--]--> 2.5 ç½‘å…³è®¤è¯ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-5-1-æŠ€æœ¯æ–¹æ¡ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5.1 æŠ€æœ¯æ–¹æ¡ˆ"><!--[--><!--]--> 2.5.1 æŠ€æœ¯æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-5-2-å®ç°ç½‘å…³è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5.2 å®ç°ç½‘å…³è®¤è¯"><!--[--><!--]--> 2.5.2 å®ç°ç½‘å…³è®¤è¯ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-ç”¨æˆ·è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="3 ç”¨æˆ·è®¤è¯"><!--[--><!--]--> 3 ç”¨æˆ·è®¤è¯ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 3.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-2-è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“"><!--[--><!--]--> 3.2 è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-2-1-è¿æ¥æ•°æ®åº“è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.1 è¿æ¥æ•°æ®åº“è®¤è¯"><!--[--><!--]--> 3.2.1 è¿æ¥æ•°æ®åº“è®¤è¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-2-2-æ‰©å±•ç”¨æˆ·èº«ä»½ä¿¡æ¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.2 æ‰©å±•ç”¨æˆ·èº«ä»½ä¿¡æ¯"><!--[--><!--]--> 3.2.2 æ‰©å±•ç”¨æˆ·èº«ä»½ä¿¡æ¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-2-3-èµ„æºæœåŠ¡è·å–ç”¨æˆ·èº«ä»½" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2.3 èµ„æºæœåŠ¡è·å–ç”¨æˆ·èº«ä»½"><!--[--><!--]--> 3.2.3 èµ„æºæœåŠ¡è·å–ç”¨æˆ·èº«ä»½ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-3-æ”¯æŒè®¤è¯æ–¹å¼å¤šæ ·" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 æ”¯æŒè®¤è¯æ–¹å¼å¤šæ ·"><!--[--><!--]--> 3.3 æ”¯æŒè®¤è¯æ–¹å¼å¤šæ · <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-3-1-ç»Ÿä¸€è®¤è¯å…¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.1 ç»Ÿä¸€è®¤è¯å…¥å£"><!--[--><!--]--> 3.3.1 ç»Ÿä¸€è®¤è¯å…¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-3-2-å®ç°è´¦å·å¯†ç è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3.2 å®ç°è´¦å·å¯†ç è®¤è¯"><!--[--><!--]--> 3.3.2 å®ç°è´¦å·å¯†ç è®¤è¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-4-éªŒè¯ç æœåŠ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4 éªŒè¯ç æœåŠ¡"><!--[--><!--]--> 3.4 éªŒè¯ç æœåŠ¡ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-4-1-éƒ¨ç½²éªŒè¯ç æœåŠ¡å·¥ç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.1 éƒ¨ç½²éªŒè¯ç æœåŠ¡å·¥ç¨‹"><!--[--><!--]--> 3.4.1 éƒ¨ç½²éªŒè¯ç æœåŠ¡å·¥ç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-4-2-éªŒè¯ç æ¥å£æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.2 éªŒè¯ç æ¥å£æµ‹è¯•"><!--[--><!--]--> 3.4.2 éªŒè¯ç æ¥å£æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-5-è´¦å·å¯†ç è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5 è´¦å·å¯†ç è®¤è¯"><!--[--><!--]--> 3.5 è´¦å·å¯†ç è®¤è¯ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-5-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.1 éœ€æ±‚åˆ†æ"><!--[--><!--]--> 3.5.1 éœ€æ±‚åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-5-2-è´¦å·å¯†ç è®¤è¯å¼€å‘" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.2 è´¦å·å¯†ç è®¤è¯å¼€å‘"><!--[--><!--]--> 3.5.2 è´¦å·å¯†ç è®¤è¯å¼€å‘ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-5-3-è´¦å·å¯†ç è®¤è¯æµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5.3 è´¦å·å¯†ç è®¤è¯æµ‹è¯•"><!--[--><!--]--> 3.5.3 è´¦å·å¯†ç è®¤è¯æµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-å¾®ä¿¡æ‰«ç ç™»å½•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4 å¾®ä¿¡æ‰«ç ç™»å½•"><!--[--><!--]--> 4 å¾®ä¿¡æ‰«ç ç™»å½• <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-1-æ¥å…¥è§„èŒƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 æ¥å…¥è§„èŒƒ"><!--[--><!--]--> 4.1 æ¥å…¥è§„èŒƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-1-1-æ¥å…¥æµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.1 æ¥å…¥æµç¨‹"><!--[--><!--]--> 4.1.1 æ¥å…¥æµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-1-2-è¯·æ±‚è·å–æˆæƒç " class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.2 è¯·æ±‚è·å–æˆæƒç "><!--[--><!--]--> 4.1.2 è¯·æ±‚è·å–æˆæƒç  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-1-3-é€šè¿‡-code-è·å–-access-token" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.3 é€šè¿‡ code è·å– access_token"><!--[--><!--]--> 4.1.3 é€šè¿‡ code è·å– access_token <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-1-4-é€šè¿‡-access-token-è°ƒç”¨æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1.4 é€šè¿‡ access_token è°ƒç”¨æ¥å£"><!--[--><!--]--> 4.1.4 é€šè¿‡ access_token è°ƒç”¨æ¥å£ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-2-å‡†å¤‡å¼€å‘ç¯å¢ƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 å‡†å¤‡å¼€å‘ç¯å¢ƒ"><!--[--><!--]--> 4.2 å‡†å¤‡å¼€å‘ç¯å¢ƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-2-1-æ·»åŠ åº”ç”¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.1 æ·»åŠ åº”ç”¨"><!--[--><!--]--> 4.2.1 æ·»åŠ åº”ç”¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-2-2-å†…ç½‘ç©¿é€" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2.2 å†…ç½‘ç©¿é€"><!--[--><!--]--> 4.2.2 å†…ç½‘ç©¿é€ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-3-æ¥å…¥å¾®ä¿¡ç™»å½•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 æ¥å…¥å¾®ä¿¡ç™»å½•"><!--[--><!--]--> 4.3 æ¥å…¥å¾®ä¿¡ç™»å½• <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-3-1-æ¥å…¥åˆ†æ" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.1 æ¥å…¥åˆ†æ"><!--[--><!--]--> 4.3.1 æ¥å…¥åˆ†æ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-3-2-å®šä¹‰æ¥å£" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.2 å®šä¹‰æ¥å£"><!--[--><!--]--> 4.3.2 å®šä¹‰æ¥å£ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-3-3-æ¥å£ç¯å¢ƒæµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.3 æ¥å£ç¯å¢ƒæµ‹è¯•"><!--[--><!--]--> 4.3.3 æ¥å£ç¯å¢ƒæµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-3-4-æ¥å…¥å¾®ä¿¡è®¤è¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.4 æ¥å…¥å¾®ä¿¡è®¤è¯"><!--[--><!--]--> 4.3.4 æ¥å…¥å¾®ä¿¡è®¤è¯ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-3-5-ä¿å­˜ç”¨æˆ·ä¿¡æ¯" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3.5 ä¿å­˜ç”¨æˆ·ä¿¡æ¯"><!--[--><!--]--> 4.3.5 ä¿å­˜ç”¨æˆ·ä¿¡æ¯ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-ç”¨æˆ·æˆæƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5 ç”¨æˆ·æˆæƒ"><!--[--><!--]--> 5 ç”¨æˆ·æˆæƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-1-rbac" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 RBAC"><!--[--><!--]--> 5.1 RBAC <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-2-èµ„æºæœåŠ¡æˆæƒæµç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 èµ„æºæœåŠ¡æˆæƒæµç¨‹"><!--[--><!--]--> 5.2 èµ„æºæœåŠ¡æˆæƒæµç¨‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-3-æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹"><!--[--><!--]--> 5.3 æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-4-æŸ¥è¯¢ç”¨æˆ·æƒé™" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4 æŸ¥è¯¢ç”¨æˆ·æƒé™"><!--[--><!--]--> 5.4 æŸ¥è¯¢ç”¨æˆ·æƒé™ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-5-æˆæƒæµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.5 æˆæƒæµ‹è¯•"><!--[--><!--]--> 5.5 æˆæƒæµ‹è¯• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-6-ç»†ç²’åº¦æˆæƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.6 ç»†ç²’åº¦æˆæƒ"><!--[--><!--]--> 5.6 ç»†ç²’åº¦æˆæƒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-6-1-ä»€ä¹ˆæ˜¯ç»†ç²’åº¦æˆæƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.6.1 ä»€ä¹ˆæ˜¯ç»†ç²’åº¦æˆæƒ"><!--[--><!--]--> 5.6.1 ä»€ä¹ˆæ˜¯ç»†ç²’åº¦æˆæƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-6-2-æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.6.2 æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒ"><!--[--><!--]--> 5.6.2 æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-6-3-æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒæµ‹è¯•" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.6.3 æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒæµ‹è¯•"><!--[--><!--]--> 5.6.3 æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒæµ‹è¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_6-å®æˆ˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="6 å®æˆ˜"><!--[--><!--]--> 6 å®æˆ˜ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_6-1-æ‰¾å›å¯†ç -å®æˆ˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1 æ‰¾å›å¯†ç (å®æˆ˜)"><!--[--><!--]--> 6.1 æ‰¾å›å¯†ç (å®æˆ˜) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_6-2-æ³¨å†Œ-å®æˆ˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2 æ³¨å†Œ(å®æˆ˜)"><!--[--><!--]--> 6.2 æ³¨å†Œ(å®æˆ˜) <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/" class="sidebar-item" aria-label="ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1"><!--[--><!--]--> ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC7%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2v3.1/" class="sidebar-item" aria-label="ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1"><!--[--><!--]--> ç¬¬ 7 ç«  é¡¹ç›®éƒ¨ç½² v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E7%AC%AC8%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%963.1/" class="sidebar-item" aria-label="ç¬¬ 8 ç«  é¡¹ç›®ä¼˜åŒ– 3.1"><!--[--><!--]--> ç¬¬ 8 ç«  é¡¹ç›®ä¼˜åŒ– 3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83-%E9%83%A8%E7%BD%B2%E9%97%A8%E6%88%B7%E6%96%87%E6%A1%A3/" class="sidebar-item" aria-label="è¯¾ç¨‹å‘å¸ƒ-éƒ¨ç½²é—¨æˆ·æ–‡æ¡£ v3.1"><!--[--><!--]--> è¯¾ç¨‹å‘å¸ƒ-éƒ¨ç½²é—¨æˆ·æ–‡æ¡£ v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE/" class="sidebar-item" aria-label="å¾®ä¿¡æ‰«ç ç™»å½•é…ç½®"><!--[--><!--]--> å¾®ä¿¡æ‰«ç ç™»å½•é…ç½® <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AEv3.1/" class="sidebar-item" aria-label="å­¦æˆåœ¨çº¿é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½® v3.1"><!--[--><!--]--> å­¦æˆåœ¨çº¿é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½® v3.1 <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="sidebar-item" aria-label="æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ"><!--[--><!--]--> æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ <!--[--><!--]--></a><!----></li><li><a href="/MyBlog/notes/project/02/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" class="sidebar-item" aria-label="é¡¹ç›®æ€»ç»“"><!--[--><!--]--> é¡¹ç›®æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="ç¬¬-5-ç« -è®¤è¯æˆæƒ-v3-1" tabindex="-1"><a class="header-anchor" href="#ç¬¬-5-ç« -è®¤è¯æˆæƒ-v3-1" aria-hidden="true">#</a> <strong>ç¬¬ 5 ç«  è®¤è¯æˆæƒ v3.1</strong></h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-æ¨¡å—éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">1 æ¨¡å—éœ€æ±‚åˆ†æ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-1-ä»€ä¹ˆæ˜¯è®¤è¯æˆæƒ" class="router-link-active router-link-exact-active">1.1 ä»€ä¹ˆæ˜¯è®¤è¯æˆæƒ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_1-2-ä¸šåŠ¡æµç¨‹" class="router-link-active router-link-exact-active">1.2 ä¸šåŠ¡æµç¨‹</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-spring-security-è®¤è¯ç ”ç©¶" class="router-link-active router-link-exact-active">2 Spring Security è®¤è¯ç ”ç©¶</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-1-spring-security-ä»‹ç»" class="router-link-active router-link-exact-active">2.1 Spring Security ä»‹ç»</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-2-è®¤è¯æˆæƒå…¥é—¨" class="router-link-active router-link-exact-active">2.2 è®¤è¯æˆæƒå…¥é—¨</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-3-ä»€ä¹ˆæ˜¯-oauth2" class="router-link-active router-link-exact-active">2.3 ä»€ä¹ˆæ˜¯ OAuth2</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-4-jwt" class="router-link-active router-link-exact-active">2.4 JWT</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_2-5-ç½‘å…³è®¤è¯" class="router-link-active router-link-exact-active">2.5 ç½‘å…³è®¤è¯</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-ç”¨æˆ·è®¤è¯" class="router-link-active router-link-exact-active">3 ç”¨æˆ·è®¤è¯</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-1-éœ€æ±‚åˆ†æ" class="router-link-active router-link-exact-active">3.1 éœ€æ±‚åˆ†æ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-2-è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“" class="router-link-active router-link-exact-active">3.2 è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-3-æ”¯æŒè®¤è¯æ–¹å¼å¤šæ ·" class="router-link-active router-link-exact-active">3.3 æ”¯æŒè®¤è¯æ–¹å¼å¤šæ ·</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-4-éªŒè¯ç æœåŠ¡" class="router-link-active router-link-exact-active">3.4 éªŒè¯ç æœåŠ¡</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_3-5-è´¦å·å¯†ç è®¤è¯" class="router-link-active router-link-exact-active">3.5 è´¦å·å¯†ç è®¤è¯</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-å¾®ä¿¡æ‰«ç ç™»å½•" class="router-link-active router-link-exact-active">4 å¾®ä¿¡æ‰«ç ç™»å½•</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-1-æ¥å…¥è§„èŒƒ" class="router-link-active router-link-exact-active">4.1 æ¥å…¥è§„èŒƒ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-2-å‡†å¤‡å¼€å‘ç¯å¢ƒ" class="router-link-active router-link-exact-active">4.2 å‡†å¤‡å¼€å‘ç¯å¢ƒ</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_4-3-æ¥å…¥å¾®ä¿¡ç™»å½•" class="router-link-active router-link-exact-active">4.3 æ¥å…¥å¾®ä¿¡ç™»å½•</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-ç”¨æˆ·æˆæƒ" class="router-link-active router-link-exact-active">5 ç”¨æˆ·æˆæƒ</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-1-rbac" class="router-link-active router-link-exact-active">5.1 RBAC</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-2-èµ„æºæœåŠ¡æˆæƒæµç¨‹" class="router-link-active router-link-exact-active">5.2 èµ„æºæœåŠ¡æˆæƒæµç¨‹</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-3-æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹" class="router-link-active router-link-exact-active">5.3 æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-4-æŸ¥è¯¢ç”¨æˆ·æƒé™" class="router-link-active router-link-exact-active">5.4 æŸ¥è¯¢ç”¨æˆ·æƒé™</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-5-æˆæƒæµ‹è¯•" class="router-link-active router-link-exact-active">5.5 æˆæƒæµ‹è¯•</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_5-6-ç»†ç²’åº¦æˆæƒ" class="router-link-active router-link-exact-active">5.6 ç»†ç²’åº¦æˆæƒ</a></li></ul></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_6-å®æˆ˜" class="router-link-active router-link-exact-active">6 å®æˆ˜</a><ul><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_6-1-æ‰¾å›å¯†ç -å®æˆ˜" class="router-link-active router-link-exact-active">6.1 æ‰¾å›å¯†ç (å®æˆ˜)</a></li><li><a aria-current="page" href="/MyBlog/notes/project/02/%E7%AC%AC5%E7%AB%A0-%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83v3.1/#_6-2-æ³¨å†Œ-å®æˆ˜" class="router-link-active router-link-exact-active">6.2 æ³¨å†Œ(å®æˆ˜)</a></li></ul></li></ul></nav><h2 id="_1-æ¨¡å—éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_1-æ¨¡å—éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>1 æ¨¡å—éœ€æ±‚åˆ†æ</strong></h2><h3 id="_1-1-ä»€ä¹ˆæ˜¯è®¤è¯æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_1-1-ä»€ä¹ˆæ˜¯è®¤è¯æˆæƒ" aria-hidden="true">#</a> <strong>1.1 ä»€ä¹ˆæ˜¯è®¤è¯æˆæƒ</strong></h3><p>æˆªè‡³ç›®å‰ï¼Œé¡¹ç›®å·²ç»å®Œæˆäº†è¯¾ç¨‹å‘å¸ƒåŠŸèƒ½ï¼Œè¯¾ç¨‹å‘å¸ƒåç”¨æˆ·é€šè¿‡åœ¨çº¿å­¦ä¹ é¡µé¢ç‚¹æ’­è§†é¢‘è¿›è¡Œå­¦ä¹ ã€‚å¦‚ä½•å»è®°å½•å­¦ç”Ÿçš„å­¦ä¹ è¿‡ç¨‹å‘¢ï¼Ÿè¦æƒ³æŒæ¡å­¦ç”Ÿçš„å­¦ä¹ æƒ…å†µå°±éœ€è¦çŸ¥é“ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œè®°å½•å“ªä¸ªç”¨æˆ·åœ¨ä»€ä¹ˆæ—¶é—´å­¦ä¹ ä»€ä¹ˆè¯¾ç¨‹ï¼Œå¦‚æœç”¨æˆ·è¦è´­ä¹°è¯¾ç¨‹ä¹Ÿéœ€è¦çŸ¥é“ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œå»ç®¡ç†å­¦ç”Ÿçš„å­¦ä¹ è¿‡ç¨‹æœ€åŸºæœ¬çš„è¦å®ç°ç”¨æˆ·çš„èº«ä»½è®¤è¯ã€‚</p><p>è®¤è¯æˆæƒæ¨¡å—å®ç°å¹³å°æ‰€æœ‰ç”¨æˆ·çš„èº«ä»½è®¤è¯ä¸ç”¨æˆ·æˆæƒåŠŸèƒ½ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯ç”¨æˆ·èº«ä»½è®¤è¯ï¼Ÿ</p></blockquote><p>ç”¨æˆ·èº«ä»½è®¤è¯å³ç”¨æˆ·å»è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ç³»ç»Ÿè¦æ±‚éªŒè¯ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œèº«ä»½åˆæ³•æ–¹å¯ç»§ç»­è®¿é—®ã€‚å¸¸è§çš„ç”¨æˆ·èº«ä»½è®¤è¯çš„è¡¨ç°å½¢å¼æœ‰ï¼šç”¨æˆ·åå¯†ç ç™»å½•ï¼Œå¾®ä¿¡æ‰«ç ç­‰æ–¹å¼ã€‚</p><p>é¡¹ç›®åŒ…æ‹¬å­¦ç”Ÿã€å­¦ä¹ æœºæ„çš„è€å¸ˆã€å¹³å°è¿è¥äººå‘˜ä¸‰ç±»ç”¨æˆ·ï¼Œä¸ç®¡å“ªä¸€ç±»ç”¨æˆ·åœ¨è®¿é—®é¡¹ç›®å—ä¿æŠ¤èµ„æºæ—¶éƒ½éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯ã€‚æ¯”å¦‚ï¼šå‘å¸ƒè¯¾ç¨‹æ“ä½œï¼Œéœ€è¦å­¦ä¹ æœºæ„çš„è€å¸ˆé¦–å…ˆç™»å½•ç³»ç»ŸæˆåŠŸï¼Œç„¶åå†æ‰§è¡Œå‘å¸ƒè¯¾ç¨‹æ“ä½œã€‚åˆ›å»ºè®¢å•ï¼Œéœ€è¦å­¦ç”Ÿç”¨æˆ·é¦–å…ˆç™»å½•ç³»ç»Ÿï¼Œæ‰å¯ä»¥åˆ›å»ºè®¢å•ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180213876-f793b9ca.png" alt="image-20230604180213876"></p><blockquote><p>ä»€ä¹ˆæ˜¯ç”¨æˆ·æˆæƒï¼Ÿ</p></blockquote><p>ç”¨æˆ·è®¤è¯é€šè¿‡åå»è®¿é—®ç³»ç»Ÿçš„èµ„æºï¼Œç³»ç»Ÿä¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®èµ„æºçš„æƒé™ï¼Œåªå…è®¸è®¿é—®æœ‰æƒé™çš„ç³»ç»Ÿèµ„æºï¼Œæ²¡æœ‰æƒé™çš„èµ„æºå°†æ— æ³•è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«ç”¨æˆ·æˆæƒã€‚æ¯”å¦‚ï¼šç”¨æˆ·å»å‘å¸ƒè¯¾ç¨‹ï¼Œç³»ç»Ÿé¦–å…ˆè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯ï¼Œè®¤è¯é€šè¿‡åç»§ç»­åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰å‘å¸ƒè¯¾ç¨‹çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰æƒé™åˆ™æ‹’ç»ç»§ç»­è®¿é—®ç³»ç»Ÿï¼Œå¦‚æœæœ‰æƒé™åˆ™ç»§ç»­å‘å¸ƒè¯¾ç¨‹ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180228222-76e5f6ab.png" alt="image-20230604180228222"></p><h3 id="_1-2-ä¸šåŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-2-ä¸šåŠ¡æµç¨‹" aria-hidden="true">#</a> <strong>1.2 ä¸šåŠ¡æµç¨‹</strong></h3><h4 id="_1-2-1-ç»Ÿä¸€è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_1-2-1-ç»Ÿä¸€è®¤è¯" aria-hidden="true">#</a> <strong>1.2.1 ç»Ÿä¸€è®¤è¯</strong></h4><p>é¡¹ç›®åŒ…æ‹¬å­¦ç”Ÿã€å­¦ä¹ æœºæ„çš„è€å¸ˆã€å¹³å°è¿è¥äººå‘˜ä¸‰ç±»ç”¨æˆ·ï¼Œä¸‰ç±»ç”¨æˆ·å°†ä½¿ç”¨ç»Ÿä¸€çš„è®¤è¯å…¥å£ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180233705-7f1683c2.png" alt="image-20230604180233705"></p><p>ç”¨æˆ·è¾“å…¥è´¦å·å’Œå¯†ç æäº¤è®¤è¯ï¼Œè®¤è¯é€šè¿‡åˆ™ç»§ç»­æ“ä½œã€‚</p><p>é¡¹ç›®ç”±ç»Ÿä¸€è®¤è¯æœåŠ¡å—ç†ç”¨æˆ·çš„è®¤è¯è¯·æ±‚ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180239882-0cdc767b.png" alt="image-20230604180239882"></p><p>è®¤è¯é€šè¿‡ç”±è®¤è¯æœåŠ¡å‘ç»™ç”¨æˆ·é¢å‘ä»¤ç‰Œï¼Œç›¸å½“äºè®¿é—®ç³»ç»Ÿçš„é€šè¡Œè¯ï¼Œç”¨æˆ·æ‹¿ç€ä»¤ç‰Œå»è®¿é—®ç³»ç»Ÿçš„èµ„æºã€‚</p><h4 id="_1-2-2-å•ç‚¹ç™»å½•" tabindex="-1"><a class="header-anchor" href="#_1-2-2-å•ç‚¹ç™»å½•" aria-hidden="true">#</a> <strong>1.2.2 å•ç‚¹ç™»å½•</strong></h4><p>æœ¬é¡¹ç›®åŸºäºå¾®æœåŠ¡æ¶æ„æ„å»ºï¼Œå¾®æœåŠ¡åŒ…æ‹¬ï¼šå†…å®¹ç®¡ç†æœåŠ¡ã€åª’èµ„ç®¡ç†æœåŠ¡ã€å­¦ä¹ ä¸­å¿ƒæœåŠ¡ã€ç³»ç»Ÿç®¡ç†æœåŠ¡ç­‰ï¼Œä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒæ€§ï¼Œç”¨æˆ·åªéœ€è¦è®¤è¯ä¸€æ¬¡ä¾¿å¯ä»¥åœ¨å¤šä¸ªæ‹¥æœ‰è®¿é—®æƒé™çš„ç³»ç»Ÿä¸­è®¿é—®ï¼Œè¿™ä¸ªåŠŸèƒ½å«åšå•ç‚¹ç™»å½•ã€‚</p><p>å¼•ç”¨ç™¾åº¦ç™¾ç§‘ï¼šå•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰ï¼Œç®€ç§°ä¸º SSOï¼Œæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚SSO çš„å®šä¹‰æ˜¯åœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œç”¨æˆ·åªéœ€è¦è®¤è¯ä¸€æ¬¡ï¼Œä¾¿å¯ä»¥åœ¨å¤šä¸ªæ‹¥æœ‰è®¿é—®æƒé™çš„ç³»ç»Ÿä¸­è®¿é—®ã€‚</p><p><img src="/MyBlog/assets/image-20230604180246419-a19e5cac.png" alt="image-20230604180246419"></p><h4 id="_1-2-3-ç¬¬ä¸‰æ–¹è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_1-2-3-ç¬¬ä¸‰æ–¹è®¤è¯" aria-hidden="true">#</a> <strong>1.2.3 ç¬¬ä¸‰æ–¹è®¤è¯</strong></h4><p>ä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒï¼Œå¾ˆå¤šç½‘ç«™æœ‰æ‰«ç ç™»å½•çš„åŠŸèƒ½ï¼Œå¦‚ï¼šå¾®ä¿¡æ‰«ç ç™»å½•ã€QQ æ‰«ç ç™»å½•ç­‰ã€‚æ‰«ç ç™»å½•çš„å¥½å¤„æ˜¯ç”¨æˆ·ä¸ç”¨è¾“å…¥è´¦å·å’Œå¯†ç ï¼Œæ“ä½œç®€ä¾¿ï¼Œå¦å¤–ä¸€ä¸ªå¥½å¤„å°±æ˜¯æœ‰åˆ©äºç”¨æˆ·ä¿¡æ¯çš„å…±äº«ï¼Œäº’è”ç½‘çš„ä¼˜åŠ¿å°±æ˜¯èµ„æºå…±äº«ï¼Œç”¨æˆ·ä¹Ÿæ˜¯ä¸€ç§èµ„æºï¼Œå¯¹äºä¸€ä¸ªæ–°ç½‘ç«™å¦‚æœè®©ç”¨æˆ·å»æ³¨å†Œæ˜¯å¾ˆå›°éš¾çš„ï¼Œå¦‚æœæä¾›äº†å¾®ä¿¡æ‰«ç ç™»å½•å°†çœå»ç”¨æˆ·æ³¨å†Œçš„æˆæœ¬ï¼Œæ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„æ¨å¹¿æ‰‹æ®µã€‚</p><p>å¾®ä¿¡æ‰«ç ç™»å½•å…¶ä¸­çš„åŸç†æ­£æ˜¯ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹è®¤è¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180252345-284d646e.png" alt="image-20230604180252345"></p><h2 id="_2-spring-security-è®¤è¯ç ”ç©¶" tabindex="-1"><a class="header-anchor" href="#_2-spring-security-è®¤è¯ç ”ç©¶" aria-hidden="true">#</a> <strong>2 Spring Security è®¤è¯ç ”ç©¶</strong></h2><h3 id="_2-1-spring-security-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_2-1-spring-security-ä»‹ç»" aria-hidden="true">#</a> <strong>2.1 Spring Security ä»‹ç»</strong></h3><p>è®¤è¯åŠŸèƒ½å‡ ä¹æ˜¯æ¯ä¸ªé¡¹ç›®éƒ½è¦å…·å¤‡çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å®ƒä¸ä¸šåŠ¡æ— å…³ï¼Œå¸‚é¢ä¸Šæœ‰å¾ˆå¤šè®¤è¯æ¡†æ¶ï¼Œå¦‚ï¼šApache Shiroã€CASã€Spring Security ç­‰ã€‚ç”±äºæœ¬é¡¹ç›®åŸºäº Spring Cloud æŠ€æœ¯æ„å»ºï¼ŒSpring Security æ˜¯ spring å®¶æ—çš„ä¸€ä»½å­ä¸”å’Œ Spring Cloud é›†æˆçš„å¾ˆå¥½ï¼Œæ‰€ä»¥æœ¬é¡¹ç›®é€‰ç”¨ Spring Security ä½œä¸ºè®¤è¯æœåŠ¡çš„æŠ€æœ¯æ¡†æ¶ã€‚</p><p>Spring Security æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”é«˜åº¦å¯å®šåˆ¶çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶æ¡†æ¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸“æ³¨äºä¸º Java åº”ç”¨ç¨‹åºæä¾›èº«ä»½éªŒè¯å’Œæˆæƒçš„æ¡†æ¶ã€‚</p><p>é¡¹ç›®ä¸»é¡µï¼šhttps://spring.io/projects/spring-security</p><p>Spring cloud Securityï¼š https://spring.io/projects/spring-cloud-security</p><h3 id="_2-2-è®¤è¯æˆæƒå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_2-2-è®¤è¯æˆæƒå…¥é—¨" aria-hidden="true">#</a> <strong>2.2 è®¤è¯æˆæƒå…¥é—¨</strong></h3><h4 id="_2-2-1-åˆ›å»ºè®¤è¯æœåŠ¡å·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-2-1-åˆ›å»ºè®¤è¯æœåŠ¡å·¥ç¨‹" aria-hidden="true">#</a> <strong>2.2.1 åˆ›å»ºè®¤è¯æœåŠ¡å·¥ç¨‹</strong></h4><p>ä¸‹è¾¹æˆ‘ä»¬ä½¿ç”¨ Spring Security æ¡†æ¶å¿«é€Ÿæ„å»ºè®¤è¯æˆæƒåŠŸèƒ½ä½“ç³»ã€‚</p><p>1ã€éƒ¨ç½²è®¤è¯æœåŠ¡å·¥ç¨‹</p><p>ä»è¯¾ç¨‹èµ„æ–™ä¸­æ‹·è´ xuecheng-plus-auth å·¥ç¨‹åˆ°è‡ªå·±çš„å·¥ç¨‹ç›®å½•ä¸‹ã€‚</p><p>æ­¤å·¥ç¨‹æ˜¯ä¸€ä¸ªæ™®é€šçš„ spring boot å·¥ç¨‹ï¼Œå¯ä»¥è¿æ¥æ•°æ®åº“ã€‚</p><p>æ­¤å·¥ç¨‹ä¸å…·å¤‡è®¤è¯æˆæƒçš„åŠŸèƒ½ã€‚</p><p>2ã€åˆ›å»ºæ•°æ®åº“</p><p>åˆ›å»º xc_users æ•°æ®åº“</p><p>å¯¼å…¥è¯¾ç¨‹èµ„æ–™ä¸­çš„ xcplus_users.sql è„šæœ¬ã€‚</p><p><img src="/MyBlog/assets/image-20230604180303618-3c9d3f04.png" alt="image-20230604180303618"></p><p>åœ¨ nacos ä¸­æ–°å¢ auth-service-dev.yamlï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /auth
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">63070</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//.168.101.65<span class="token punctuation">:</span>3306/xc1010_users<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;userUnicode=true&amp;useSSL=false&amp;</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆå§‹å·¥ç¨‹è‡ªå¸¦äº†ä¸€ä¸ª Controller ç±»ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> æµ‹è¯•controller
 * <span class="token keyword">@date</span> 2022/9/27 17:25
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Autowired</span>
  <span class="token class-name">XcUserMapper</span> userMapper<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

      <span class="token keyword">return</span> <span class="token string">&quot;ç™»å½•æˆåŠŸ&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/{id}&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">XcUser</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">XcUser</span> xcUser <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xcUser<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;è®¿é—®r1èµ„æº&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;è®¿é—®r2èµ„æº&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>



<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨å·¥ç¨‹ï¼Œå°è¯•è®¿é—® http://localhost:63070/auth/r/r1 :</p><p><img src="/MyBlog/assets/image-20230604180335576-e05577f6.png" alt="image-20230604180335576"></p><p>è®¿é—®ç”¨æˆ·ä¿¡æ¯ï¼šhttp://localhost:63070/auth/user/52</p><p><img src="/MyBlog/assets/image-20230604180339915-f2aec087.png" alt="image-20230604180339915"></p><p>ä»¥ä¸Šæµ‹è¯•ä¸€åˆ‡æ­£å¸¸è¯´æ˜æ­¤å·¥ç¨‹éƒ¨ç½²æˆåŠŸã€‚</p><h4 id="_2-2-2-è®¤è¯æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-2-2-è®¤è¯æµ‹è¯•" aria-hidden="true">#</a> <strong>2.2.2 è®¤è¯æµ‹è¯•</strong></h4><p>ä¸‹è¾¹å‘ auth è®¤è¯å·¥ç¨‹é›†æˆ Spring securityï¼Œå‘ pom.xml åŠ å…¥ Spring Security æ‰€éœ€è¦çš„ä¾èµ–</p><blockquote><p>åªè¦ä¸€åŠ ä¸Šä¾èµ– ç³»ç»Ÿå°±ä¼šè¢« Springsecurity æ‰€ç®¡æ§</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-oauth2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯å·¥ç¨‹ï¼Œè®¿é—® http://localhost:63070/auth/r/r1</p><p>è‡ªåŠ¨è¿›å…¥/login ç™»å½•é¡µé¢ï¼Œ/login æ˜¯ spring security æä¾›çš„,æ­¤é¡µé¢æœ‰å‡ ä¸ª css æ ·å¼åŠ è½½ä¼šç¨å¾®æ…¢ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180359263-0c60e8e2.png" alt="image-20230604180359263"></p><p>è´¦å·å’Œå¯†ç æ˜¯å¤šå°‘å‘¢ï¼Ÿä¸‹ä¸€æ­¥éœ€è¦è¿›è¡Œå®‰å…¨é…ç½®ã€‚</p><p>æ‹·è´è¯¾ç¨‹èµ„æ–™ä¸‹çš„ WebSecurityConfig.java åˆ° config ä¸‹éœ€è¦ä¸‰éƒ¨åˆ†å†…å®¹ï¼š</p><p>1ã€ç”¨æˆ·ä¿¡æ¯</p><p>åœ¨å†…å­˜é…ç½®ä¸¤ä¸ªç”¨æˆ·ï¼šzhangsanã€lisi</p><p>zhangsan ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ä¸º p1</p><p>lisi ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ä¸º p2</p><p>2ã€å¯†ç æ–¹å¼</p><p>æš‚æ—¶é‡‡ç”¨æ˜æ–‡æ–¹å¼</p><p>3ã€å®‰å…¨æ‹¦æˆªæœºåˆ¶</p><p>/r/**å¼€å¤´çš„è¯·æ±‚éœ€è¦è®¤è¯</p><p>ç™»å½•æˆåŠŸåˆ°æˆåŠŸé¡µé¢</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//é…ç½®ç”¨æˆ·ä¿¡æ¯æœåŠ¡</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è¿™é‡Œé…ç½®ç”¨æˆ·ä¿¡æ¯,è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼å°†ç”¨æˆ·å­˜å‚¨åœ¨å†…å­˜ä¸­</span>
    <span class="token class-name">InMemoryUserDetailsManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> manager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¯†ç ä¸ºæ˜æ–‡æ–¹å¼</span>
        <span class="token keyword">return</span> <span class="token class-name">NoOpPasswordEncoder</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//é…ç½®å®‰å…¨æ‹¦æˆªæœºåˆ¶</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//è®¿é—®/rå¼€å§‹çš„è¯·æ±‚éœ€è¦è®¤è¯é€šè¿‡</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//å…¶å®ƒè¯·æ±‚å…¨éƒ¨æ”¾è¡Œ</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç™»å½•æˆåŠŸè·³è½¬åˆ°/login-success</span>
                http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€€å‡ºåœ°å€</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯å·¥ç¨‹</p><p>1ã€è®¿é—® http://localhost:63070/auth/user/52 å¯ä»¥æ­£å¸¸è®¿é—®</p><p>2ã€è®¿é—® http://localhost:63070/auth/r/r1 æ˜¾ç¤ºç™»å½•é¡µé¢</p><p>è´¦å· zhangsanï¼Œå¯†ç ä¸º 123ï¼Œå¦‚æœè¾“å…¥çš„å¯†ç ä¸æ­£ç¡®ä¼šè®¤è¯å¤±è´¥ï¼Œè¾“å…¥æ­£ç¡®æ˜¾ç¤ºç™»å½•æˆåŠŸã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆ http://localhost:63070/auth/user/52 å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œè®¿é—® http://localhost:63070/auth/r/r1 æ˜¾ç¤ºç™»å½•é¡µé¢ï¼Ÿ</p></blockquote><p>http.logout().logoutUrl(&quot;/logout&quot;);é…ç½®äº†é€€å‡ºé¡µé¢ï¼Œè®¤è¯æˆåŠŸåè®¿é—®/logout å¯é€€å‡ºç™»å½•ã€‚</p><h4 id="_2-2-3-æˆæƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-2-3-æˆæƒæµ‹è¯•" aria-hidden="true">#</a> <strong>2.2.3 æˆæƒæµ‹è¯•</strong></h4><p>ç”¨æˆ·è®¤è¯é€šè¿‡å»è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ spring security è¿›è¡Œæˆæƒæ§åˆ¶ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰è¯¥èµ„æºçš„è®¿é—®æƒé™ï¼Œå¦‚æœæœ‰åˆ™ç»§ç»­è®¿é—®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‹’ç»è®¿é—®ã€‚</p><p>ä¸‹è¾¹æµ‹è¯•æˆæƒåŠŸèƒ½ï¼š</p><p>1ã€é…ç½®ç”¨æˆ·æ‹¥æœ‰å“ªäº›æƒé™ã€‚</p><p>åœ¨ WebSecurityConfig ç±»é…ç½® zhangsan æ‹¥æœ‰ p1 æƒé™ï¼Œlisi æ‹¥æœ‰ p2 æƒé™ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è¿™é‡Œé…ç½®ç”¨æˆ·ä¿¡æ¯,è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼å°†ç”¨æˆ·å­˜å‚¨åœ¨å†…å­˜ä¸­</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> manager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æŒ‡å®šèµ„æºä¸æƒé™çš„å…³ç³»ã€‚</p><p>ä»€ä¹ˆæ˜¯ç³»ç»Ÿçš„èµ„æºï¼Ÿ</p><p>æ¯”å¦‚ï¼šæŸ¥è¯¢ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œç”¨æˆ·ä¿¡æ¯å°±æ˜¯ç³»ç»Ÿçš„èµ„æºï¼Œè¦è®¿é—®èµ„æºéœ€è¦é€šè¿‡ URLï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ controller ä¸­å®šä¹‰çš„æ¯ä¸ª http çš„æ¥å£å°±æ˜¯è®¿é—®èµ„æºçš„æ¥å£ã€‚</p><p>ä¸‹è¾¹åœ¨ controller ä¸­é…ç½®/r/r1 éœ€è¦ p1 æƒé™ï¼Œ/r/r2 éœ€è¦ p2 æƒé™ã€‚</p><p>hasAuthority(&#39;p1&#39;)è¡¨ç¤ºæ‹¥æœ‰ p1 æƒé™æ–¹å¯è®¿é—®ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;p1&#39;)&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ‹¥æœ‰p1æƒé™æ–¹å¯è®¿é—®</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;è®¿é—®r1èµ„æº&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;p2&#39;)&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ‹¥æœ‰p2æƒé™æ–¹å¯è®¿é—®</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;è®¿é—®r2èµ„æº&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨é‡å¯å·¥ç¨‹ã€‚</p><p>å½“è®¿é—®ä»¥/r/å¼€å¤´çš„ url æ—¶ä¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦è®¤è¯ï¼Œå¦‚æœæ²¡æœ‰è®¤è¯åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œå¦‚æœå·²ç»è®¤è¯åˆ™åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·æœ‰è¯¥ URL çš„è®¿é—®æƒé™ï¼Œå¦‚æœå…·æœ‰è¯¥ URL çš„è®¿é—®æƒé™åˆ™ç»§ç»­ï¼Œå¦åˆ™æ‹’ç»è®¿é—®ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>è®¿é—®/r/r1ï¼Œä½¿ç”¨ zhangsan ç™»å½•å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œå› ä¸ºåœ¨/r/r1 çš„æ–¹æ³•ä¸ŠæŒ‡å®šäº†æƒé™ p1ï¼Œzhangsan ç”¨æˆ·æ‹¥æœ‰æƒé™ p1,æ‰€ä»¥å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p><p>è®¿é—®/r/r1ï¼Œä½¿ç”¨ lisi ç™»å½•åˆ™æ‹’ç»è®¿é—®ï¼Œç”±äº lisi ç”¨æˆ·ä¸å…·æœ‰æƒé™ p1 éœ€è¦æ‹’ç»è®¿é—®</p><p>æ³¨æ„ï¼šå¦‚æœè®¿é—®ä¸Šä¸åŠ @PreAuthorizeï¼Œæ­¤æ–¹æ³•æ²¡æœ‰æˆæƒæ§åˆ¶ã€‚</p><p>æ•´ç†æˆæƒçš„è¿‡ç¨‹è§ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/MyBlog/assets/image-20230604180455661-fab9254e.png" alt="image-20230604180455661"></p><h4 id="_2-2-4-å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#_2-2-4-å·¥ä½œåŸç†" aria-hidden="true">#</a> <strong>2.2.4 å·¥ä½œåŸç†</strong></h4><p>é€šè¿‡æµ‹è¯•è®¤è¯å’Œæˆæƒä¸¤ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬äº†è§£äº† Spring Security çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œä¸‹è¾¹äº†è§£å®ƒçš„å·¥ä½œæµç¨‹ã€‚</p><p>Spring Security æ‰€è§£å†³çš„é—®é¢˜å°±æ˜¯<strong>å®‰å…¨è®¿é—®æ§åˆ¶</strong>ï¼Œè€Œå®‰å…¨è®¿é—®æ§åˆ¶åŠŸèƒ½å…¶å®å°±æ˜¯å¯¹æ‰€æœ‰è¿›å…¥ç³»ç»Ÿçš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œæ ¡éªŒæ¯ä¸ªè¯·æ±‚æ˜¯å¦èƒ½å¤Ÿè®¿é—®å®ƒæ‰€æœŸæœ›çš„èµ„æºã€‚æ ¹æ®å‰è¾¹çŸ¥è¯†çš„å­¦ä¹ ï¼Œå¯ä»¥é€šè¿‡ Filter æˆ– AOP ç­‰æŠ€æœ¯æ¥å®ç°ï¼ŒSpring Security å¯¹ Web èµ„æºçš„ä¿æŠ¤æ˜¯é  Filter å®ç°çš„ï¼Œæ‰€ä»¥ä»è¿™ä¸ª Filter æ¥å…¥æ‰‹ï¼Œé€æ­¥æ·±å…¥ Spring Security åŸç†ã€‚</p><p>å½“åˆå§‹åŒ– Spring Security æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸º SpringSecurityFilterChain çš„ Servlet è¿‡æ»¤å™¨ï¼Œç±»å‹ä¸º org.springframework.security.web.FilterChainProxyï¼Œå®ƒå®ç°äº† javax.servlet.Filterï¼Œå› æ­¤å¤–éƒ¨çš„è¯·æ±‚ä¼šç»è¿‡æ­¤ç±»ï¼Œä¸‹å›¾æ˜¯ Spring Security è¿‡è™‘å™¨é“¾ç»“æ„å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180502578-98f612f5.png" alt="image-20230604180502578"></p><p>FilterChainProxy æ˜¯ä¸€ä¸ªä»£ç†ï¼ŒçœŸæ­£èµ·ä½œç”¨çš„æ˜¯ FilterChainProxy ä¸­ SecurityFilterChain æ‰€åŒ…å«çš„å„ä¸ª Filterï¼ŒåŒæ—¶è¿™äº› Filter ä½œä¸º Bean è¢« Spring ç®¡ç†ï¼Œå®ƒä»¬æ˜¯ Spring Security æ ¸å¿ƒï¼Œå„æœ‰å„çš„èŒè´£ï¼Œä½†ä»–ä»¬å¹¶ä¸ç›´æ¥å¤„ç†ç”¨æˆ·çš„<strong>è®¤è¯</strong>ï¼Œä¹Ÿä¸ç›´æ¥å¤„ç†ç”¨æˆ·çš„<strong>æˆæƒ</strong>ï¼Œè€Œæ˜¯æŠŠå®ƒä»¬äº¤ç»™äº†è®¤è¯ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰å’Œå†³ç­–ç®¡ç†å™¨ï¼ˆAccessDecisionManagerï¼‰è¿›è¡Œå¤„ç†ã€‚</p><p>spring Security åŠŸèƒ½çš„å®ç°ä¸»è¦æ˜¯ç”±ä¸€ç³»åˆ—è¿‡æ»¤å™¨é“¾ç›¸äº’é…åˆå®Œæˆã€‚</p><p><img src="/MyBlog/assets/image-20230604180509698-9f02dd04.png" alt="image-20230604180509698"></p><p>ä¸‹é¢ä»‹ç»è¿‡æ»¤å™¨é“¾ä¸­ä¸»è¦çš„å‡ ä¸ªè¿‡æ»¤å™¨åŠå…¶ä½œç”¨ï¼š</p><p><strong>SecurityContextPersistenceFilter</strong> è¿™ä¸ª Filter æ˜¯æ•´ä¸ªæ‹¦æˆªè¿‡ç¨‹çš„å…¥å£å’Œå‡ºå£ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ‹¦æˆªå™¨ï¼‰ï¼Œä¼šåœ¨è¯·æ±‚å¼€å§‹æ—¶ä»é…ç½®å¥½çš„ SecurityContextRepository ä¸­è·å– SecurityContextï¼Œç„¶åæŠŠå®ƒè®¾ç½®ç»™ SecurityContextHolderã€‚åœ¨è¯·æ±‚å®Œæˆåå°† SecurityContextHolder æŒæœ‰çš„ SecurityContext å†ä¿å­˜åˆ°é…ç½®å¥½çš„ SecurityContextRepositoryï¼ŒåŒæ—¶æ¸…é™¤ securityContextHolder æ‰€æŒæœ‰çš„ SecurityContextï¼›</p><p><strong>UsernamePasswordAuthenticationFilter</strong> ç”¨äºå¤„ç†æ¥è‡ªè¡¨å•æäº¤çš„è®¤è¯ã€‚è¯¥è¡¨å•å¿…é¡»æä¾›å¯¹åº”çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå…¶å†…éƒ¨è¿˜æœ‰ç™»å½•æˆåŠŸæˆ–å¤±è´¥åè¿›è¡Œå¤„ç†çš„ AuthenticationSuccessHandler å’Œ AuthenticationFailureHandlerï¼Œè¿™äº›éƒ½å¯ä»¥æ ¹æ®éœ€æ±‚åšç›¸å…³æ”¹å˜ï¼›</p><p><strong>FilterSecurityInterceptor</strong> æ˜¯ç”¨äºä¿æŠ¤ web èµ„æºçš„ï¼Œä½¿ç”¨ AccessDecisionManager å¯¹å½“å‰ç”¨æˆ·è¿›è¡Œæˆæƒè®¿é—®ï¼Œå‰é¢å·²ç»è¯¦ç»†ä»‹ç»è¿‡äº†ï¼›</p><p><strong>ExceptionTranslationFilter</strong> èƒ½å¤Ÿæ•è·æ¥è‡ª FilterChain æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯å®ƒåªä¼šå¤„ç†ä¸¤ç±»å¼‚å¸¸ï¼šAuthenticationException å’Œ AccessDeniedExceptionï¼Œå…¶å®ƒçš„å¼‚å¸¸å®ƒä¼šç»§ç»­æŠ›å‡ºã€‚</p><p>Spring Security çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604180517699-2ce2e59f.png" alt="image-20230604180517699"></p><p>ç”¨æˆ·æäº¤ç”¨æˆ·åã€å¯†ç è¢« SecurityFilterChain ä¸­çš„ UsernamePasswordAuthenticationFilter è¿‡æ»¤å™¨è·å–åˆ°ï¼Œå°è£…ä¸ºè¯·æ±‚ Authenticationï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ UsernamePasswordAuthenticationToken è¿™ä¸ªå®ç°ç±»ã€‚</p><p>ç„¶åè¿‡æ»¤å™¨å°† Authentication æäº¤è‡³è®¤è¯ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰è¿›è¡Œè®¤è¯</p><p>è®¤è¯æˆåŠŸåï¼ŒAuthenticationManager èº«ä»½ç®¡ç†å™¨è¿”å›ä¸€ä¸ªè¢«å¡«å……æ»¡äº†ä¿¡æ¯çš„ï¼ˆåŒ…æ‹¬ä¸Šé¢æåˆ°çš„æƒé™ä¿¡æ¯ï¼Œèº«ä»½ä¿¡æ¯ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œä½†å¯†ç é€šå¸¸ä¼šè¢«ç§»é™¤ï¼‰Authentication å®ä¾‹ã€‚</p><p>SecurityContextHolder å®‰å…¨ä¸Šä¸‹æ–‡å®¹å™¨å°†ç¬¬ 3 æ­¥å¡«å……äº†ä¿¡æ¯çš„ Authenticationï¼Œé€šè¿‡ SecurityContextHolder.getContext().setAuthentication(â€¦)æ–¹æ³•ï¼Œè®¾ç½®åˆ°å…¶ä¸­ã€‚</p><p>å¯ä»¥çœ‹å‡º AuthenticationManager æ¥å£ï¼ˆè®¤è¯ç®¡ç†å™¨ï¼‰æ˜¯è®¤è¯ç›¸å…³çš„æ ¸å¿ƒæ¥å£ï¼Œä¹Ÿæ˜¯å‘èµ·è®¤è¯çš„å‡ºå‘ç‚¹ï¼Œå®ƒçš„å®ç°ç±»ä¸º ProviderManagerã€‚è€Œ Spring Security æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå› æ­¤ ProviderManager ç»´æŠ¤ç€ä¸€ä¸ª List&lt;AuthenticationProvider&gt;åˆ—è¡¨ï¼Œå­˜æ”¾å¤šç§è®¤è¯æ–¹å¼ï¼Œæœ€ç»ˆå®é™…çš„è®¤è¯å·¥ä½œæ˜¯ç”± AuthenticationProvider å®Œæˆçš„ã€‚å’±ä»¬çŸ¥é“ web è¡¨å•çš„å¯¹åº”çš„ AuthenticationProvider å®ç°ç±»ä¸º DaoAuthenticationProviderï¼Œå®ƒçš„å†…éƒ¨åˆç»´æŠ¤ç€ä¸€ä¸ª UserDetailsService è´Ÿè´£ UserDetails çš„è·å–ã€‚æœ€ç»ˆ AuthenticationProvider å°† UserDetails å¡«å……è‡³ Authenticationã€‚</p><h3 id="_2-3-ä»€ä¹ˆæ˜¯-oauth2" tabindex="-1"><a class="header-anchor" href="#_2-3-ä»€ä¹ˆæ˜¯-oauth2" aria-hidden="true">#</a> <strong>2.3 ä»€ä¹ˆæ˜¯ OAuth2</strong></h3><h4 id="_2-3-1-oauth2-è®¤è¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-3-1-oauth2-è®¤è¯æµç¨‹" aria-hidden="true">#</a> <strong>2.3.1 OAuth2 è®¤è¯æµç¨‹</strong></h4><p>åœ¨å‰è¾¹æˆ‘ä»¬æåˆ°å¾®ä¿¡æ‰«ç è®¤è¯ï¼Œè¿™æ˜¯ä¸€ç§ç¬¬ä¸‰æ–¹è®¤è¯çš„æ–¹å¼ï¼Œè¿™ç§è®¤è¯æ–¹å¼æ˜¯åŸºäº OAuth2 åè®®å®ç°ï¼Œ</p><p>OAUTH åè®®ä¸ºç”¨æˆ·èµ„æºçš„æˆæƒæä¾›äº†ä¸€ä¸ªå®‰å…¨çš„ã€å¼€æ”¾è€Œåˆç®€æ˜“çš„æ ‡å‡†ã€‚åŒæ—¶ï¼Œä»»ä½•ç¬¬ä¸‰æ–¹éƒ½å¯ä»¥ä½¿ç”¨ OAUTH è®¤è¯æœåŠ¡ï¼Œä»»ä½•æœåŠ¡æä¾›å•†éƒ½å¯ä»¥å®ç°è‡ªèº«çš„ OAUTH è®¤è¯æœåŠ¡ï¼Œå› è€Œ OAUTH æ˜¯å¼€æ”¾çš„ã€‚ä¸šç•Œæä¾›äº† OAUTH çš„å¤šç§å®ç°å¦‚ PHPã€JavaScriptï¼ŒJavaï¼ŒRuby ç­‰å„ç§è¯­è¨€å¼€å‘åŒ…ï¼Œå¤§å¤§èŠ‚çº¦äº†ç¨‹åºå‘˜çš„æ—¶é—´ï¼Œå› è€Œ OAUTH æ˜¯ç®€æ˜“çš„ã€‚äº’è”ç½‘å¾ˆå¤šæœåŠ¡å¦‚ Open APIï¼Œå¾ˆå¤šå¤§å…¬å¸å¦‚ Googleï¼ŒYahooï¼ŒMicrosoft ç­‰éƒ½æä¾›äº† OAUTH è®¤è¯æœåŠ¡ï¼Œè¿™äº›éƒ½è¶³ä»¥è¯´æ˜ OAUTH æ ‡å‡†é€æ¸æˆä¸ºå¼€æ”¾èµ„æºæˆæƒçš„æ ‡å‡†ã€‚</p><p>Oauth åè®®ç›®å‰å‘å±•åˆ° 2.0 ç‰ˆæœ¬ï¼Œ1.0 ç‰ˆæœ¬è¿‡äºå¤æ‚ï¼Œ2.0 ç‰ˆæœ¬å·²å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p><p>å‚è€ƒï¼š<a href="https://baike.baidu.com/item/oAuth/7153134?fr=aladdin" target="_blank" rel="noopener noreferrer">https://baike.baidu.com/item/oAuth/7153134?fr=aladdin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Oauth åè®®ï¼š<a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener noreferrer">https://tools.ietf.org/html/rfc6749<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä¸‹è¾¹åˆ†æä¸€ä¸ª Oauth2 è®¤è¯çš„ä¾‹å­ï¼Œé»‘é©¬ç¨‹åºå‘˜ç½‘ç«™ä½¿ç”¨å¾®ä¿¡è®¤è¯æ‰«ç ç™»å½•çš„è¿‡ç¨‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604180528863-b5c2b918.png" alt="image-20230604180528863"></p><p>å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€ç”¨æˆ·ç‚¹å‡»å¾®ä¿¡æ‰«ç </p><p>ç”¨æˆ·è¿›å…¥é»‘é©¬ç¨‹åºçš„ç™»å½•é¡µé¢ï¼Œç‚¹å‡»å¾®ä¿¡çš„å›¾æ ‡å¼€æ‰“å¾®ä¿¡æ‰«ç ç•Œé¢ã€‚</p><p><img src="/MyBlog/assets/image-20230604180535057-1534abc3.png" alt="image-20230604180535057"></p><p><img src="/MyBlog/assets/image-20230604180541510-7e351d1a.png" alt="image-20230604180541510"></p><p>å¾®ä¿¡æ‰«ç çš„ç›®çš„æ˜¯é€šè¿‡å¾®ä¿¡è®¤è¯ç™»å½•é»‘é©¬ç¨‹åºå‘˜å®˜ç½‘ï¼Œé»‘é©¬ç¨‹åºå‘˜ç½‘ç«™éœ€è¦ä»å¾®ä¿¡è·å–å½“å‰ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯æ‰ä¼šè®©å½“å‰ç”¨æˆ·åœ¨é»‘é©¬ç½‘ç«™ç™»å½•æˆåŠŸã€‚</p><p>ç°åœ¨ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µï¼š</p><p>èµ„æºï¼šç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨å¾®ä¿¡ä¸­å­˜å‚¨ã€‚</p><p>èµ„æºæ‹¥æœ‰è€…ï¼šç”¨æˆ·æ˜¯ç”¨æˆ·ä¿¡æ¯èµ„æºçš„æ‹¥æœ‰è€…ã€‚</p><p>è®¤è¯æœåŠ¡ï¼šå¾®ä¿¡è´Ÿè´£è®¤è¯å½“å‰ç”¨æˆ·çš„èº«ä»½ï¼Œè´Ÿè´£ä¸ºå®¢æˆ·ç«¯é¢å‘ä»¤ç‰Œã€‚</p><p>å®¢æˆ·ç«¯ï¼šå®¢æˆ·ç«¯ä¼šæºå¸¦ä»¤ç‰Œè¯·æ±‚å¾®ä¿¡è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œé»‘é©¬ç¨‹åºå‘˜ç½‘ç«™å³å®¢æˆ·ç«¯ï¼Œé»‘é©¬ç½‘ç«™éœ€è¦åœ¨æµè§ˆå™¨æ‰“å¼€ã€‚</p><p>2ã€ç”¨æˆ·æˆæƒé»‘é©¬ç½‘ç«™è®¿é—®ç”¨æˆ·ä¿¡æ¯</p><p>èµ„æºæ‹¥æœ‰è€…æ‰«æäºŒç»´ç è¡¨ç¤ºèµ„æºæ‹¥æœ‰è€…è¯·æ±‚å¾®ä¿¡è¿›è¡Œè®¤è¯ï¼Œå¾®ä¿¡è®¤è¯é€šè¿‡å‘ç”¨æˆ·æ‰‹æœºè¿”å›æˆæƒé¡µé¢ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180551007-875f9228.png" alt="image-20230604180551007"></p><p>è¯¢é—®ç”¨æˆ·æ˜¯å¦æˆæƒé»‘é©¬ç¨‹åºå‘˜è®¿é—®è‡ªå·±åœ¨å¾®ä¿¡çš„ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·ç‚¹å‡»â€œç¡®è®¤ç™»å½•â€è¡¨ç¤ºåŒæ„æˆæƒï¼Œå¾®ä¿¡è®¤è¯æœåŠ¡å™¨ä¼šé¢å‘ä¸€ä¸ªæˆæƒç ç»™é»‘é©¬ç¨‹åºå‘˜çš„ç½‘ç«™ã€‚</p><p>åªæœ‰èµ„æºæ‹¥æœ‰è€…åŒæ„å¾®ä¿¡æ‰å…è®¸é»‘é©¬ç½‘ç«™è®¿é—®èµ„æºã€‚</p><p>3ã€é»‘é©¬ç¨‹åºå‘˜çš„ç½‘ç«™è·å–åˆ°æˆæƒç </p><p>4ã€æºå¸¦æˆæƒç è¯·æ±‚å¾®ä¿¡è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œ</p><p>æ­¤äº¤äº’è¿‡ç¨‹ç”¨æˆ·çœ‹ä¸åˆ°ã€‚</p><p>5ã€å¾®ä¿¡è®¤è¯æœåŠ¡å™¨å‘é»‘é©¬ç¨‹åºå‘˜çš„ç½‘ç«™å“åº”ä»¤ç‰Œ</p><p>æ­¤äº¤äº’è¿‡ç¨‹ç”¨æˆ·çœ‹ä¸åˆ°ã€‚</p><p>6ã€é»‘é©¬ç¨‹åºå‘˜ç½‘ç«™è¯·æ±‚å¾®ä¿¡èµ„æºæœåŠ¡å™¨è·å–èµ„æºå³ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>é»‘é©¬ç¨‹åºå‘˜ç½‘ç«™æºå¸¦ä»¤ç‰Œè¯·æ±‚è®¿é—®å¾®ä¿¡æœåŠ¡å™¨è·å–ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><p>7ã€èµ„æºæœåŠ¡å™¨è¿”å›å—ä¿æŠ¤èµ„æºå³ç”¨æˆ·ä¿¡æ¯</p><p>8ã€é»‘é©¬ç½‘ç«™æ¥æ”¶åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ­¤æ—¶ç”¨æˆ·åœ¨é»‘é©¬ç½‘ç«™ç™»å½•æˆåŠŸã€‚</p><p>ç†è§£äº†å¾®ä¿¡æ‰«ç ç™»å½•é»‘é©¬ç½‘ç«™çš„æµç¨‹ï¼Œæ¥ä¸‹æ¥è®¤è¯† Oauth2.0 çš„è®¤è¯æµç¨‹ï¼Œå¦‚ä¸‹ï¼š</p><p>å¼•è‡ª Oauth2.0 åè®® rfc6749 <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener noreferrer">https://tools.ietf.org/html/rfc6749<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="/MyBlog/assets/image-20230604180558722-9816be29.png" alt="image-20230604180558722"></p><p>Oauth2 åŒ…æ‹¬ä»¥ä¸‹è§’è‰²ï¼š</p><p>1ã€å®¢æˆ·ç«¯</p><p>æœ¬èº«ä¸å­˜å‚¨èµ„æºï¼Œéœ€è¦é€šè¿‡èµ„æºæ‹¥æœ‰è€…çš„æˆæƒå»è¯·æ±‚èµ„æºæœåŠ¡å™¨çš„èµ„æºï¼Œæ¯”å¦‚ï¼šæ‰‹æœºå®¢æˆ·ç«¯ã€æµè§ˆå™¨ç­‰ã€‚</p><p>ä¸Šè¾¹ç¤ºä¾‹ä¸­é»‘é©¬ç½‘ç«™å³ä¸ºå®¢æˆ·ç«¯ï¼Œå®ƒéœ€è¦é€šè¿‡æµè§ˆå™¨æ‰“å¼€ã€‚</p><p>2ã€èµ„æºæ‹¥æœ‰è€…</p><p>é€šå¸¸ä¸ºç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥æ˜¯åº”ç”¨ç¨‹åºï¼Œå³è¯¥èµ„æºçš„æ‹¥æœ‰è€…ã€‚</p><p>A è¡¨ç¤º å®¢æˆ·ç«¯è¯·æ±‚èµ„æºæ‹¥æœ‰è€…æˆæƒã€‚</p><p>B è¡¨ç¤º èµ„æºæ‹¥æœ‰è€…æˆæƒå®¢æˆ·ç«¯å³é»‘é©¬ç½‘ç«™è®¿é—®è‡ªå·±çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>3ã€æˆæƒæœåŠ¡å™¨ï¼ˆä¹Ÿç§°è®¤è¯æœåŠ¡å™¨ï¼‰</p><p>è®¤è¯æœåŠ¡å™¨å¯¹èµ„æºæ‹¥æœ‰è€…è¿›è¡Œè®¤è¯ï¼Œè¿˜ä¼šå¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯å¹¶é¢å‘ä»¤ç‰Œã€‚</p><p>C å®¢æˆ·ç«¯å³é»‘é©¬ç½‘ç«™æºå¸¦æˆæƒç è¯·æ±‚è®¤è¯ã€‚</p><p>D è®¤è¯é€šè¿‡é¢å‘ä»¤ç‰Œã€‚</p><p>4ã€èµ„æºæœåŠ¡å™¨</p><p>å­˜å‚¨èµ„æºçš„æœåŠ¡å™¨ã€‚</p><p>E è¡¨ç¤ºå®¢æˆ·ç«¯å³é»‘é©¬ç½‘ç«™æºå¸¦ä»¤ç‰Œè¯·æ±‚èµ„æºæœåŠ¡å™¨è·å–èµ„æºã€‚</p><p>F è¡¨ç¤ºèµ„æºæœåŠ¡å™¨æ ¡éªŒä»¤ç‰Œé€šè¿‡åæä¾›å—ä¿æŠ¤èµ„æºã€‚</p><h4 id="_2-3-2-oauth2-åœ¨æœ¬é¡¹ç›®çš„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_2-3-2-oauth2-åœ¨æœ¬é¡¹ç›®çš„åº”ç”¨" aria-hidden="true">#</a> <strong>2.3.2 OAuth2 åœ¨æœ¬é¡¹ç›®çš„åº”ç”¨</strong></h4><p>Oauth2 æ˜¯ä¸€ä¸ªæ ‡å‡†çš„å¼€æ”¾çš„æˆæƒåè®®ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®è‡ªå·±çš„è¦æ±‚å»ä½¿ç”¨ Oauth2ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ Oauth2 å®ç°å¦‚ä¸‹ç›®æ ‡ï¼š</p><p>1ã€å­¦æˆåœ¨çº¿è®¿é—®ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„èµ„æºã€‚</p><p>æœ¬é¡¹ç›®è¦æ¥å…¥å¾®ä¿¡æ‰«ç ç™»å½•æ‰€ä»¥æœ¬é¡¹ç›®è¦ä½¿ç”¨ OAuth2 åè®®è®¿é—®å¾®ä¿¡ä¸­çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>2ã€å¤–éƒ¨ç³»ç»Ÿè®¿é—®å­¦æˆåœ¨çº¿çš„èµ„æº ã€‚</p><p>åŒæ ·å½“ç¬¬ä¸‰æ–¹ç³»ç»Ÿæƒ³è¦è®¿é—®å­¦æˆåœ¨çº¿ç½‘ç«™çš„èµ„æºä¹Ÿå¯ä»¥åŸºäº OAuth2 åè®®ã€‚</p><p>3ã€å­¦æˆåœ¨çº¿å‰ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰ è®¿é—®å­¦æˆåœ¨çº¿å¾®æœåŠ¡çš„èµ„æºã€‚</p><p>æœ¬é¡¹ç›®æ˜¯å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå‰ç«¯è®¿é—®å¾®æœåŠ¡èµ„æºä¹Ÿå¯ä»¥åŸºäº OAuth2 åè®®è¿›è¡Œè®¤è¯ã€‚</p><h4 id="_2-3-3-oauth2-çš„æˆæƒæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-3-3-oauth2-çš„æˆæƒæ¨¡å¼" aria-hidden="true">#</a> <strong>2.3.3 OAuth2 çš„æˆæƒæ¨¡å¼</strong></h4><p>Spring Security æ”¯æŒ OAuth2 è®¤è¯ï¼ŒOAuth2 æä¾›æˆæƒç æ¨¡å¼ã€å¯†ç æ¨¡å¼ã€ç®€åŒ–æ¨¡å¼ã€å®¢æˆ·ç«¯æ¨¡å¼ç­‰å››ç§æˆæƒæ¨¡å¼ï¼Œå‰è¾¹ä¸¾çš„å¾®ä¿¡æ‰«ç ç™»å½•çš„ä¾‹å­å°±æ˜¯åŸºäºæˆæƒç æ¨¡å¼ï¼Œè¿™å››ç§æ¨¡å¼ä¸­æˆæƒç æ¨¡å¼å’Œå¯†ç æ¨¡å¼åº”ç”¨è¾ƒå¤šï¼Œæœ¬èŠ‚ä½¿ç”¨ Spring Security æ¼”ç¤ºæˆæƒç æ¨¡å¼ã€å¯†ç æ¨¡å¼ï¼Œå…¶ä½™ä¸¤ç§è¯·è‡ªè¡ŒæŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚</p><h5 id="_2-3-3-1-æˆæƒç æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-3-3-1-æˆæƒç æ¨¡å¼" aria-hidden="true">#</a> <strong>2.3.3.1 æˆæƒç æ¨¡å¼</strong></h5><p>OAuth2 çš„å‡ ä¸ªæˆæƒæ¨¡å¼æ˜¯æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯ä»¥ä¸åŒçš„æ–¹å¼å»è·å–ä»¤ç‰Œï¼Œæœ€ç»ˆç›®çš„æ˜¯è¦è·å–è®¤è¯æœåŠ¡é¢å‘çš„ä»¤ç‰Œï¼Œæœ€ç»ˆé€šè¿‡ä»¤ç‰Œå»è·å–èµ„æºã€‚</p><p>æˆæƒç æ¨¡å¼ç®€å•ç†è§£æ˜¯ä½¿ç”¨æˆæƒç å»è·å–ä»¤ç‰Œï¼Œè¦æƒ³è·å–ä»¤ç‰Œå…ˆè¦è·å–æˆæƒç ï¼Œæˆæƒç çš„è·å–éœ€è¦èµ„æºæ‹¥æœ‰è€…äº²è‡ªæˆæƒåŒæ„æ‰å¯ä»¥è·å–ã€‚</p><p>ä¸‹å›¾æ˜¯æˆæƒç æ¨¡å¼çš„äº¤äº’å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180611293-9693c8bd.png" alt="image-20230604180611293"></p><p>è¿˜ä»¥é»‘é©¬ç½‘ç«™å¾®ä¿¡æ‰«ç ç™»å½•ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼š</p><p>1ã€ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ã€‚</p><p>2ã€é€šè¿‡æµè§ˆå™¨è®¿é—®å®¢æˆ·ç«¯å³é»‘é©¬ç½‘ç«™ã€‚</p><p>3ã€ç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘è®¤è¯æœåŠ¡è¯·æ±‚æˆæƒï¼Œè¯·æ±‚æˆæƒæ—¶ä¼šæºå¸¦å®¢æˆ·ç«¯çš„ URLï¼Œæ­¤ URL ä¸ºä¸‹å‘æˆæƒç çš„é‡å®šå‘åœ°å€ã€‚</p><p>4ã€è®¤è¯æœåŠ¡å‘èµ„æºæ‹¥æœ‰è€…è¿”å›æˆæƒé¡µé¢ã€‚</p><p>5ã€èµ„æºæ‹¥æœ‰è€…äº²è‡ªæˆæƒåŒæ„ã€‚</p><p>6ã€é€šè¿‡æµè§ˆå™¨å‘è®¤è¯æœåŠ¡å‘é€æˆæƒåŒæ„ã€‚</p><p>7ã€è®¤è¯æœåŠ¡å‘å®¢æˆ·ç«¯åœ°å€é‡å®šå‘å¹¶æºå¸¦æˆæƒç ã€‚</p><p>8ã€å®¢æˆ·ç«¯å³é»‘é©¬ç½‘ç«™æ”¶åˆ°æˆæƒç ã€‚</p><p>9ã€å®¢æˆ·ç«¯æºå¸¦æˆæƒç å‘è®¤è¯æœåŠ¡ç”³è¯·ä»¤ç‰Œã€‚</p><p>10ã€è®¤è¯æœåŠ¡å‘å®¢æˆ·ç«¯é¢å‘ä»¤ç‰Œã€‚</p><h5 id="_2-3-3-2-æˆæƒç æ¨¡å¼æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-3-3-2-æˆæƒç æ¨¡å¼æµ‹è¯•" aria-hidden="true">#</a> <strong>2.3.3.2 æˆæƒç æ¨¡å¼æµ‹è¯•</strong></h5><p>è¦æƒ³æµ‹è¯•æˆæƒæ¨¡å¼é¦–å…ˆè¦é…ç½®æˆæƒæœåŠ¡å™¨å³ä¸Šå›¾ä¸­çš„è®¤è¯æœåŠ¡å™¨ï¼Œéœ€è¦é…ç½®æˆæƒæœåŠ¡åŠä»¤ç‰Œç­–ç•¥ã€‚</p><p>1ã€ä»è¯¾ç¨‹èµ„æ–™ä¸­æ‹·è´ AuthorizationServer.javaã€TokenConfig.java åˆ°è®¤è¯æœåŠ¡çš„ config åŒ…ä¸‹ã€‚</p><p>è¯´æ˜ï¼šAuthorizationServer ç”¨ @EnableAuthorizationServer æ³¨è§£æ ‡è¯†å¹¶ç»§æ‰¿ AuthorizationServerConfigurerAdapter æ¥é…ç½® OAuth2.0 æˆæƒæœåŠ¡å™¨ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">/</span>
 <span class="token annotation punctuation">@Configuration</span>
 <span class="token annotation punctuation">@EnableAuthorizationServer</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthorizationServer</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizationServerConfigurerAdapter</span> <span class="token punctuation">{</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AuthorizationServerConfigurerAdapter è¦æ±‚é…ç½®ä»¥ä¸‹å‡ ä¸ªç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthorizationServerConfigurerAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">AuthorizationServerConfigurer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthorizationServerConfigurerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationServerSecurityConfigurer</span> security<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">ClientDetailsServiceConfigurer</span> clients<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationServerEndpointsConfigurer</span> endpoints<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>1ï¼‰ClientDetailsServiceConfigurer</strong>ï¼šç”¨æ¥é…ç½®å®¢æˆ·ç«¯è¯¦æƒ…æœåŠ¡ï¼ˆClientDetailsServiceï¼‰ï¼Œ</p><p>éšä¾¿ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥éšä¾¿æ¥å…¥åˆ°å®ƒçš„è®¤è¯æœåŠ¡å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼ŒæœåŠ¡æä¾›å•†ä¼šç»™æ‰¹å‡†æ¥å…¥çš„å®¢æˆ·ç«¯ä¸€ä¸ªèº«ä»½ï¼Œç”¨äºæ¥å…¥æ—¶çš„å‡­æ®ï¼Œæœ‰å®¢æˆ·ç«¯æ ‡è¯†å’Œå®¢æˆ·ç«¯ç§˜é’¥ï¼Œåœ¨è¿™é‡Œé…ç½®æ‰¹å‡†æ¥å…¥çš„å®¢æˆ·ç«¯çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p><strong>2ï¼‰AuthorizationServerEndpointsConfigurer</strong>ï¼šç”¨æ¥é…ç½®ä»¤ç‰Œï¼ˆtokenï¼‰çš„è®¿é—®ç«¯ç‚¹å’Œä»¤ç‰ŒæœåŠ¡(token services)ã€‚</p><p><strong>3ï¼‰AuthorizationServerSecurityConfigurer</strong>ï¼šç”¨æ¥é…ç½®ä»¤ç‰Œç«¯ç‚¹çš„å®‰å…¨çº¦æŸ.</p><p>2ã€TokenConfig ä¸ºä»¤ç‰Œç­–ç•¥é…ç½®ç±»</p><p>æš‚æ—¶å…ˆä½¿ç”¨ InMemoryTokenStore åœ¨å†…å­˜å­˜å‚¨ä»¤ç‰Œï¼Œä»¤ç‰Œçš„æœ‰æ•ˆæœŸç­‰ä¿¡æ¯é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">//ä»¤ç‰Œç®¡ç†æœåŠ¡</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;authorizationServerTokenServicesCustom&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthorizationServerTokenServices</span> <span class="token function">tokenService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultTokenServices</span> service<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DefaultTokenServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service<span class="token punctuation">.</span><span class="token function">setSupportRefreshToken</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ”¯æŒåˆ·æ–°ä»¤ç‰Œ</span>
        service<span class="token punctuation">.</span><span class="token function">setTokenStore</span><span class="token punctuation">(</span>tokenStore<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä»¤ç‰Œå­˜å‚¨ç­–ç•¥</span>
        service<span class="token punctuation">.</span><span class="token function">setAccessTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">7200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ2å°æ—¶</span>
        service<span class="token punctuation">.</span><span class="token function">setRefreshTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">259200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ·æ–°ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ3å¤©</span>
        <span class="token keyword">return</span> service<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€é…ç½®è®¤è¯ç®¡ç† bean</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token annotation punctuation">@EnableGlobalMethodSecurity</span><span class="token punctuation">(</span>securedEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>prePostEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯è®¤è¯æœåŠ¡</p><p>1ã€get è¯·æ±‚è·å–æˆæƒç </p><p>åœ°å€: http://localhost:63070/auth/oauth/authorize?client_id=XcWebApp&amp;response_type=code&amp;scope=all&amp;redirect_uri=http://www.51xuecheng.cn</p><p>å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š</p><p>client_idï¼šå®¢æˆ·ç«¯å‡†å…¥æ ‡è¯†ã€‚</p><p>response_typeï¼šæˆæƒç æ¨¡å¼å›ºå®šä¸º codeã€‚</p><p>scopeï¼šå®¢æˆ·ç«¯æƒé™ã€‚</p><p>redirect_uriï¼šè·³è½¬ uriï¼Œå½“æˆæƒç ç”³è¯·æˆåŠŸåä¼šè·³è½¬åˆ°æ­¤åœ°å€ï¼Œå¹¶åœ¨åè¾¹å¸¦ä¸Š code å‚æ•°ï¼ˆæˆæƒç ï¼‰ã€‚</p><blockquote><p>è¾“å…¥è´¦å· zhangsanã€å¯†ç  123 ç™»å½•æˆåŠŸï¼Œè¾“å…¥/oauth/authorize?client_id=XcWebApp&amp;response_type=code&amp;scope=all&amp;redirect_uri=http://www.51xuecheng.cn</p></blockquote><p>æ˜¾ç¤ºæˆæƒé¡µé¢</p><p><img src="/MyBlog/assets/image-20230604180703888-00157902.png" alt="image-20230604180703888"></p><p>æˆæƒâ€œXcWebAppâ€è®¿é—®è‡ªå·±çš„å—ä¿æŠ¤èµ„æº?</p><p>é€‰æ‹©åŒæ„ã€‚</p><p>2ã€è¯·æ±‚æˆåŠŸï¼Œé‡å®šå‘è‡³http://www.51xuecheng.cn/?code=æˆæƒç ï¼Œæ¯”å¦‚ï¼šhttp://www.51xuecheng.cn/?code=Wqjb5H</p><p>3ã€ä½¿ç”¨ httpclient å·¥å…· post ç”³è¯·ä»¤ç‰Œ</p><blockquote><p>/oauth/token?client_id=XcWebApp&amp;client_secret=XcWebApp&amp;grant_type=authorization_code&amp;code=æˆæƒç &amp;redirect_uri=http://www.51xuecheng.cn/</p></blockquote><p>å‚æ•°åˆ—è¡¨å¦‚ä¸‹</p><p>client_idï¼šå®¢æˆ·ç«¯å‡†å…¥æ ‡è¯†ã€‚</p><p>client_secretï¼šå®¢æˆ·ç«¯ç§˜é’¥ã€‚</p><p>grant_typeï¼šæˆæƒç±»å‹ï¼Œå¡«å†™ authorization_codeï¼Œè¡¨ç¤ºæˆæƒç æ¨¡å¼</p><p>codeï¼šæˆæƒç ï¼Œå°±æ˜¯åˆšåˆšè·å–çš„æˆæƒç ï¼Œæ³¨æ„ï¼šæˆæƒç åªä½¿ç”¨ä¸€æ¬¡å°±æ— æ•ˆäº†ï¼Œéœ€è¦é‡æ–°ç”³è¯·ã€‚</p><p>redirect_uriï¼šç”³è¯·æˆæƒç æ—¶çš„è·³è½¬ urlï¼Œä¸€å®šå’Œç”³è¯·æˆæƒç æ—¶ç”¨çš„ redirect_uri ä¸€è‡´ã€‚</p><p>httpclient è„šæœ¬å¦‚ä¸‹ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### æˆæƒç æ¨¡å¼
#### ç¬¬ä¸€æ­¥ç”³è¯·æˆæƒç (æµè§ˆå™¨è¯·æ±‚)/oauth/authorize?client_id=c1&amp;response_type=code&amp;scope=all&amp;redirect_uri=http://www.51xuecheng.cn
#### ç¬¬äºŒæ­¥ç”³è¯·ä»¤ç‰Œ
POST {{auth_host}}/auth/oauth/token?client_id=XcWebApp&amp;client_secret=XcWebApp&amp;grant_type=authorization_code&amp;code=CTvCrB&amp;redirect_uri=http://www.51xuecheng.cn

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”³è¯·ä»¤ç‰ŒæˆåŠŸå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;368b1ee7-a9ee-4e9a-aae6-0fcab243aad2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;token_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bearer&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;refresh_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3d56e139-0ee6-4ace-8cbe-1311dfaa991f&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;expires_in&quot;</span><span class="token operator">:</span> <span class="token number">7199</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜ï¼š</p><p>1ã€access_tokenï¼Œè®¿é—®ä»¤ç‰Œï¼Œç”¨äºè®¿é—®èµ„æºä½¿ç”¨ã€‚</p><p>2ã€token_typeï¼Œbearer æ˜¯åœ¨ RFC6750 ä¸­å®šä¹‰çš„ä¸€ç§ token ç±»å‹ï¼Œåœ¨æºå¸¦ä»¤ç‰Œè®¿é—®èµ„æºæ—¶éœ€è¦åœ¨ head ä¸­åŠ å…¥ bearer ç©ºæ ¼ ä»¤ç‰Œå†…å®¹</p><p>3ã€refresh_tokenï¼Œå½“ä»¤ç‰Œå¿«è¿‡æœŸæ—¶ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œå¯ä»¥å†æ¬¡ç”Ÿæˆä»¤ç‰Œã€‚</p><p>4ã€expires_inï¼šè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</p><p>5ã€scopeï¼Œä»¤ç‰Œçš„æƒé™èŒƒå›´ï¼ŒæœåŠ¡ç«¯å¯ä»¥æ ¹æ®ä»¤ç‰Œçš„æƒé™èŒƒå›´å»å¯¹ä»¤ç‰Œæˆæƒã€‚</p><h5 id="_2-3-3-3-å¯†ç æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-3-3-3-å¯†ç æ¨¡å¼" aria-hidden="true">#</a> <strong>2.3.3.3 å¯†ç æ¨¡å¼</strong></h5><p>å¯†ç æ¨¡å¼ç›¸å¯¹æˆæƒç æ¨¡å¼ç®€å•ï¼Œæˆæƒç æ¨¡å¼éœ€è¦å€ŸåŠ©æµè§ˆå™¨ä¾›ç”¨æˆ·äº²è‡ªæˆæƒï¼Œå¯†ç æ¨¡å¼ä¸ç”¨å€ŸåŠ©æµè§ˆå™¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180746941-0d2dc6fd.png" alt="image-20230604180746941"></p><p>1ã€èµ„æºæ‹¥æœ‰è€…æä¾›è´¦å·å’Œå¯†ç </p><p>2ã€å®¢æˆ·ç«¯å‘è®¤è¯æœåŠ¡ç”³è¯·ä»¤ç‰Œï¼Œè¯·æ±‚ä¸­æºå¸¦è´¦å·å’Œå¯†ç </p><p>3ã€è®¤è¯æœåŠ¡æ ¡éªŒè´¦å·å’Œå¯†ç æ­£ç¡®é¢å‘ä»¤ç‰Œã€‚</p><p>å¼€å§‹æµ‹è¯•ï¼š</p><p>1ã€POST è¯·æ±‚è·å–ä»¤ç‰Œ</p><p>/oauth/token?client_id=XcWebApp&amp;client_secret=XcWebApp&amp;grant_type=password&amp;username=shangsan&amp;password=123</p><p>å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š</p><p>client_idï¼šå®¢æˆ·ç«¯å‡†å…¥æ ‡è¯†ã€‚</p><p>client_secretï¼šå®¢æˆ·ç«¯ç§˜é’¥ã€‚</p><p>grant_typeï¼šæˆæƒç±»å‹ï¼Œå¡«å†™ password è¡¨ç¤ºå¯†ç æ¨¡å¼</p><p>usernameï¼šèµ„æºæ‹¥æœ‰è€…ç”¨æˆ·åã€‚</p><p>passwordï¼šèµ„æºæ‹¥æœ‰è€…å¯†ç ã€‚</p><p>2ã€æˆæƒæœåŠ¡å™¨å°†ä»¤ç‰Œï¼ˆaccess_tokenï¼‰å‘é€ç»™ client</p><p>ä½¿ç”¨ httpclient è¿›è¡Œæµ‹è¯•</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### å¯†ç æ¨¡å¼
POST {{auth_host}}/auth/oauth/token?client_id=XcWebApp&amp;client_secret=XcWebApp&amp;grant_type=password&amp;username=zhangsan&amp;password=123

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿”å›ç¤ºä¾‹ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;368b1ee7-a9ee-4e9a-aae6-0fcab243aad2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;token_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bearer&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;refresh_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3d56e139-0ee6-4ace-8cbe-1311dfaa991f&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;expires_in&quot;</span><span class="token operator">:</span> <span class="token number">6806</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ¨¡å¼ååˆ†ç®€å•ï¼Œä½†æ˜¯å´æ„å‘³ç€ç›´æ¥å°†ç”¨æˆ·æ•æ„Ÿä¿¡æ¯æ³„æ¼ç»™äº† clientï¼Œå› æ­¤è¿™å°±è¯´æ˜è¿™ç§æ¨¡å¼åªèƒ½ç”¨äº client æ˜¯æˆ‘ä»¬è‡ªå·±å¼€å‘çš„æƒ…å†µä¸‹ã€‚</p><h5 id="_2-3-3-4-æœ¬é¡¹ç›®çš„åº”ç”¨æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_2-3-3-4-æœ¬é¡¹ç›®çš„åº”ç”¨æ–¹å¼" aria-hidden="true">#</a> <strong>2.3.3.4 æœ¬é¡¹ç›®çš„åº”ç”¨æ–¹å¼</strong></h5><p>é€šè¿‡æ¼”ç¤ºæˆæƒç æ¨¡å¼å’Œå¯†ç æ¨¡å¼ï¼Œæˆæƒç æ¨¡å¼é€‚åˆå®¢æˆ·ç«¯å’Œè®¤è¯æœåŠ¡éåŒä¸€ä¸ªç³»ç»Ÿçš„æƒ…å†µï¼Œæ‰€ä»¥æœ¬é¡¹ç›®ä½¿ç”¨æˆæƒç æ¨¡å¼å®Œæˆå¾®ä¿¡æ‰«ç è®¤è¯ã€‚æœ¬é¡¹ç›®é‡‡ç”¨å¯†ç æ¨¡å¼ä½œä¸ºå‰ç«¯è¯·æ±‚å¾®æœåŠ¡çš„è®¤è¯æ–¹å¼ã€‚</p><h3 id="_2-4-jwt" tabindex="-1"><a class="header-anchor" href="#_2-4-jwt" aria-hidden="true">#</a> <strong>2.4 JWT</strong></h3><h4 id="_2-4-1-æ™®é€šä»¤ç‰Œçš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-4-1-æ™®é€šä»¤ç‰Œçš„é—®é¢˜" aria-hidden="true">#</a> <strong>2.4.1 æ™®é€šä»¤ç‰Œçš„é—®é¢˜</strong></h4><p>å®¢æˆ·ç«¯ç”³è¯·åˆ°ä»¤ç‰Œï¼Œæ¥ä¸‹æ¥å®¢æˆ·ç«¯æºå¸¦ä»¤ç‰Œå»è®¿é—®èµ„æºï¼Œåˆ°èµ„æºæœåŠ¡å™¨å°†ä¼šæ ¡éªŒä»¤ç‰Œçš„åˆæ³•æ€§ã€‚</p><p>èµ„æºæœåŠ¡å™¨å¦‚ä½•æ ¡éªŒä»¤ç‰Œçš„åˆæ³•æ€§ï¼Ÿ</p><p>æˆ‘ä»¬ä»¥ OAuth2 çš„å¯†ç æ¨¡å¼ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼š</p><p><img src="/MyBlog/assets/image-20230604180830380-13a0a576.png" alt="image-20230604180830380"></p><p>ä»ç¬¬ 4 æ­¥å¼€å§‹è¯´æ˜ï¼š</p><p>1ã€å®¢æˆ·ç«¯æºå¸¦ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡è·å–èµ„æºã€‚</p><p>2ã€èµ„æºæœåŠ¡è¿œç¨‹è¯·æ±‚è®¤è¯æœåŠ¡æ ¡éªŒä»¤ç‰Œçš„åˆæ³•æ€§</p><p>3ã€å¦‚æœä»¤ç‰Œåˆæ³•èµ„æºæœåŠ¡å‘å®¢æˆ·ç«¯è¿”å›èµ„æºã€‚</p><p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š</p><p>å°±æ˜¯æ ¡éªŒä»¤ç‰Œéœ€è¦è¿œç¨‹è¯·æ±‚è®¤è¯æœåŠ¡ï¼Œå®¢æˆ·ç«¯çš„æ¯æ¬¡è®¿é—®éƒ½ä¼šè¿œç¨‹æ ¡éªŒï¼Œæ‰§è¡Œæ€§èƒ½ä½ã€‚</p><p>å¦‚æœèƒ½å¤Ÿè®©èµ„æºæœåŠ¡è‡ªå·±æ ¡éªŒä»¤ç‰Œçš„åˆæ³•æ€§å°†çœå»è¿œç¨‹è¯·æ±‚è®¤è¯æœåŠ¡çš„æˆæœ¬ï¼Œæé«˜äº†æ€§èƒ½ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180837219-8a7ce0ff.png" alt="image-20230604180837219"></p><blockquote><p>å¦‚ä½•è§£å†³ä¸Šè¾¹çš„é—®é¢˜ï¼Œå®ç°èµ„æºæœåŠ¡è‡ªè¡Œæ ¡éªŒä»¤ç‰Œã€‚</p></blockquote><p>ä»¤ç‰Œé‡‡ç”¨ JWT æ ¼å¼å³å¯è§£å†³ä¸Šè¾¹çš„é—®é¢˜ï¼Œç”¨æˆ·è®¤è¯é€šè¿‡åä¼šå¾—åˆ°ä¸€ä¸ª JWT ä»¤ç‰Œï¼ŒJWT ä»¤ç‰Œä¸­å·²ç»åŒ…æ‹¬äº†ç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åªéœ€è¦æºå¸¦ JWT è®¿é—®èµ„æºæœåŠ¡ï¼Œèµ„æºæœåŠ¡æ ¹æ®äº‹å…ˆçº¦å®šçš„ç®—æ³•è‡ªè¡Œå®Œæˆä»¤ç‰Œæ ¡éªŒï¼Œæ— éœ€æ¯æ¬¡éƒ½è¯·æ±‚è®¤è¯æœåŠ¡å®Œæˆæˆæƒã€‚</p><h4 id="_2-4-2-ä»€ä¹ˆæ˜¯-jwt" tabindex="-1"><a class="header-anchor" href="#_2-4-2-ä»€ä¹ˆæ˜¯-jwt" aria-hidden="true">#</a> <strong>2.4.2 ä»€ä¹ˆæ˜¯ JWT</strong></h4><p>ä»€ä¹ˆæ˜¯ JWTï¼Ÿ</p><p>JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ç§ä½¿ç”¨ JSON æ ¼å¼ä¼ é€’æ•°æ®çš„ç½‘ç»œä»¤ç‰ŒæŠ€æœ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾çš„è¡Œä¸šæ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç®€æ´çš„ã€è‡ªåŒ…å«çš„åè®®æ ¼å¼ï¼Œç”¨äºåœ¨é€šä¿¡åŒæ–¹ä¼ é€’ json å¯¹è±¡ï¼Œä¼ é€’çš„ä¿¡æ¯ç»è¿‡æ•°å­—ç­¾åå¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ HMAC ç®—æ³•æˆ–ä½¿ç”¨ RSA çš„å…¬é’¥/ç§é’¥å¯¹æ¥ç­¾åï¼Œé˜²æ­¢å†…å®¹ç¯¡æ”¹ã€‚å®˜ç½‘ï¼š<a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">https://jwt.io/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä½¿ç”¨ JWT å¯ä»¥å®ç°æ— çŠ¶æ€è®¤è¯ï¼Œ<code>ä»€ä¹ˆæ˜¯æ— çŠ¶æ€è®¤è¯ï¼Ÿ</code></p><p>ä¼ ç»Ÿçš„åŸºäº session çš„æ–¹å¼æ˜¯æœ‰çŠ¶æ€è®¤è¯ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸå°†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œè¿™æ ·åŠ å¤§äº†æœåŠ¡ç«¯çš„å­˜å‚¨å‹åŠ›ï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼ä¸é€‚åˆåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åº”ç”¨ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œå½“ç”¨æˆ·è®¿é—®åº”ç”¨æœåŠ¡ï¼Œæ¯ä¸ªåº”ç”¨æœåŠ¡éƒ½ä¼šå»æœåŠ¡å™¨æŸ¥çœ‹ session ä¿¡æ¯ï¼Œå¦‚æœ session ä¸­æ²¡æœ‰è¯¥ç”¨æˆ·åˆ™è¯´æ˜ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œæ­¤æ—¶å°±ä¼šé‡æ–°è®¤è¯ï¼Œè€Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ Session å¤åˆ¶ã€Session é»è´´ã€‚</p><p><img src="/MyBlog/assets/image-20230604180906559-83538ea5.png" alt="image-20230604180906559"></p><p>å¦‚æœæ˜¯åŸºäºä»¤ç‰ŒæŠ€æœ¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°è®¤è¯åˆ™æœåŠ¡ç«¯ä¸ç”¨å­˜å‚¨ sessionï¼Œå¯ä»¥å°†ç”¨æˆ·èº«ä»½ä¿¡æ¯å­˜å‚¨åœ¨ä»¤ç‰Œä¸­ï¼Œç”¨æˆ·è®¤è¯é€šè¿‡åè®¤è¯æœåŠ¡é¢å‘ä»¤ç‰Œç»™ç”¨æˆ·ï¼Œç”¨æˆ·å°†ä»¤ç‰Œå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œå»è®¿é—®åº”ç”¨æœåŠ¡æ—¶æºå¸¦ä»¤ç‰Œå»è®¿é—®ï¼ŒæœåŠ¡ç«¯ä» jwt è§£æå‡ºç”¨æˆ·ä¿¡æ¯ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ— çŠ¶æ€è®¤è¯ã€‚</p><p><img src="/MyBlog/assets/image-20230604180911465-411ddfe2.png" alt="image-20230604180911465"></p><p>JWT ä»¤ç‰Œçš„ä¼˜ç‚¹ï¼š</p><p>1ã€jwt åŸºäº jsonï¼Œéå¸¸æ–¹ä¾¿è§£æã€‚</p><p>2ã€å¯ä»¥åœ¨ä»¤ç‰Œä¸­è‡ªå®šä¹‰ä¸°å¯Œçš„å†…å®¹ï¼Œæ˜“æ‰©å±•ã€‚</p><p>3ã€é€šè¿‡éå¯¹ç§°åŠ å¯†ç®—æ³•åŠæ•°å­—ç­¾åæŠ€æœ¯ï¼ŒJWT é˜²æ­¢ç¯¡æ”¹ï¼Œå®‰å…¨æ€§é«˜ã€‚</p><p>4ã€èµ„æºæœåŠ¡ä½¿ç”¨ JWT å¯ä¸ä¾èµ–è®¤è¯æœåŠ¡å³å¯å®Œæˆæˆæƒã€‚</p><p>ç¼ºç‚¹ï¼š</p><p>ï¼‘ã€JWT ä»¤ç‰Œè¾ƒé•¿ï¼Œå å­˜å‚¨ç©ºé—´æ¯”è¾ƒå¤§ã€‚</p><p>ä¸‹è¾¹æ˜¯ä¸€ä¸ª JWT ä»¤ç‰Œçš„ç¤ºä¾‹ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQyNTQ2NzIsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6Ijg4OTEyYjJkLTVkMDUtNGMxNC1iYmMzLWZkZTk5NzdmZWJjNiIsImNsaWVudF9pZCI6ImMxIn0.wkDBL7roLrvdBG2oGnXeoXq-zZRgE9IVV2nxd-ez_oA

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>JWT ä»¤ç‰Œç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œæ¯éƒ¨åˆ†ä¸­é—´ä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”ï¼Œæ¯”å¦‚ï¼šxxxxx.yyyyy.zzzzz</p><p>Header</p><p>å¤´éƒ¨åŒ…æ‹¬ä»¤ç‰Œçš„ç±»å‹ï¼ˆå³ JWTï¼‰åŠä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼ˆå¦‚ HMAC SHA256 æˆ– RSAï¼‰</p><p>ä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p><p>ä¸‹è¾¹æ˜¯ Header éƒ¨åˆ†çš„å†…å®¹</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;alg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;typ&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JWT&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†ä¸Šè¾¹çš„å†…å®¹ä½¿ç”¨ Base64Url ç¼–ç ï¼Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ JWT ä»¤ç‰Œçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><p>Payload</p><p>ç¬¬äºŒéƒ¨åˆ†æ˜¯è´Ÿè½½ï¼Œå†…å®¹ä¹Ÿæ˜¯ä¸€ä¸ª json å¯¹è±¡ï¼Œå®ƒæ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ï¼Œå®ƒå¯ä»¥å­˜æ”¾ jwt æä¾›çš„ä¿¡æ¯å­—æ®µï¼Œæ¯”å¦‚ï¼šissï¼ˆç­¾å‘è€…ï¼‰,expï¼ˆè¿‡æœŸæ—¶é—´æˆ³ï¼‰, subï¼ˆé¢å‘çš„ç”¨æˆ·ï¼‰ç­‰ï¼Œä¹Ÿå¯è‡ªå®šä¹‰å­—æ®µã€‚</p><p>æ­¤éƒ¨åˆ†ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºæ­¤éƒ¨åˆ†å¯ä»¥è§£ç è¿˜åŸåŸå§‹å†…å®¹ã€‚</p><p>æœ€åå°†ç¬¬äºŒéƒ¨åˆ†è´Ÿè½½ä½¿ç”¨ Base64Url ç¼–ç ï¼Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ JWT ä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†ã€‚</p><p>ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;sub&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;456&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;admin&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Signature</p><p>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ç­¾åï¼Œæ­¤éƒ¨åˆ†ç”¨äºé˜²æ­¢ jwt å†…å®¹è¢«ç¯¡æ”¹ã€‚</p><p>è¿™ä¸ªéƒ¨åˆ†ä½¿ç”¨ base64url å°†å‰ä¸¤éƒ¨åˆ†è¿›è¡Œç¼–ç ï¼Œç¼–ç åä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰è¿æ¥ç»„æˆå­—ç¬¦ä¸²ï¼Œæœ€åä½¿ç”¨ header ä¸­å£°æ˜çš„ç­¾åç®—æ³•è¿›è¡Œç­¾åã€‚</p><p>ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>  HMACSHA256(
    base64UrlEncode(header) + <span class="token string">&quot;.&quot;</span> +
    base64UrlEncode(payload)<span class="token punctuation">,</span>
    secret)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>base64UrlEncode(header)ï¼šjwt ä»¤ç‰Œçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><p>base64UrlEncode(payload)ï¼šjwt ä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†ã€‚</p><p>secretï¼šç­¾åæ‰€ä½¿ç”¨çš„å¯†é’¥ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆ JWT å¯ä»¥é˜²æ­¢ç¯¡æ”¹ï¼Ÿ</p></blockquote><p>ç¬¬ä¸‰éƒ¨åˆ†ä½¿ç”¨ç­¾åç®—æ³•å¯¹ç¬¬ä¸€éƒ¨åˆ†å’Œç¬¬äºŒéƒ¨åˆ†çš„å†…å®¹è¿›è¡Œç­¾åï¼Œå¸¸ç”¨çš„ç­¾åç®—æ³•æ˜¯ HS256ï¼Œå¸¸è§çš„è¿˜æœ‰ md5,sha ç­‰ï¼Œç­¾åç®—æ³•éœ€è¦ä½¿ç”¨å¯†é’¥è¿›è¡Œç­¾åï¼Œå¯†é’¥ä¸å¯¹å¤–å…¬å¼€ï¼Œå¹¶ä¸”ç­¾åæ˜¯ä¸å¯é€†çš„ï¼Œå¦‚æœç¬¬ä¸‰æ–¹æ›´æ”¹äº†å†…å®¹é‚£ä¹ˆæœåŠ¡å™¨éªŒè¯ç­¾åå°±ä¼šå¤±è´¥ï¼Œè¦æƒ³ä¿è¯éªŒè¯ç­¾åæ­£ç¡®å¿…é¡»ä¿è¯å†…å®¹ã€å¯†é’¥ä¸ç­¾åå‰ä¸€è‡´ã€‚</p><p><img src="/MyBlog/assets/image-20230604181025173-557d683a.png" alt="image-20230604181025173"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºè®¤è¯æœåŠ¡å’Œèµ„æºæœåŠ¡ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œè¿™å«å¯¹ç§°åŠ å¯†ï¼Œå¯¹ç§°åŠ å¯†æ•ˆç‡é«˜ï¼Œå¦‚æœä¸€æ—¦å¯†é’¥æ³„éœ²å¯ä»¥ä¼ªé€  jwt ä»¤ç‰Œã€‚</p><p>JWT è¿˜å¯ä»¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œè®¤è¯æœåŠ¡è‡ªå·±ä¿ç•™ç§é’¥ï¼Œå°†å…¬é’¥ä¸‹å‘ç»™å—ä¿¡ä»»çš„å®¢æˆ·ç«¯ã€èµ„æºæœåŠ¡ï¼Œå…¬é’¥å’Œç§é’¥æ˜¯é…å¯¹çš„ï¼Œæˆå¯¹çš„å…¬é’¥å’Œç§é’¥æ‰å¯ä»¥æ­£å¸¸åŠ å¯†å’Œè§£å¯†ï¼Œéå¯¹ç§°åŠ å¯†æ•ˆç‡ä½ä½†ç›¸æ¯”å¯¹ç§°åŠ å¯†éå¯¹ç§°åŠ å¯†æ›´å®‰å…¨ä¸€äº›ã€‚</p><h4 id="_2-4-3-æµ‹è¯•ç”Ÿæˆ-jwt-ä»¤ç‰Œ" tabindex="-1"><a class="header-anchor" href="#_2-4-3-æµ‹è¯•ç”Ÿæˆ-jwt-ä»¤ç‰Œ" aria-hidden="true">#</a> <strong>2.4.3 æµ‹è¯•ç”Ÿæˆ JWT ä»¤ç‰Œ</strong></h4><p>åœ¨è®¤è¯æœåŠ¡ä¸­é…ç½® jwt ä»¤ç‰ŒæœåŠ¡ï¼Œå³å¯å®ç°ç”Ÿæˆ jwt æ ¼å¼çš„ä»¤ç‰Œ,</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>token<span class="token punctuation">.</span></span><span class="token class-name">AuthorizationServerTokenServices</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>token<span class="token punctuation">.</span></span><span class="token class-name">DefaultTokenServices</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>token<span class="token punctuation">.</span></span><span class="token class-name">TokenEnhancerChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>token<span class="token punctuation">.</span></span><span class="token class-name">TokenStore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>token<span class="token punctuation">.</span>store<span class="token punctuation">.</span></span><span class="token class-name">InMemoryTokenStore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>token<span class="token punctuation">.</span>store<span class="token punctuation">.</span></span><span class="token class-name">JwtAccessTokenConverter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>token<span class="token punctuation">.</span>store<span class="token punctuation">.</span></span><span class="token class-name">JwtTokenStore</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Administrator
 * <span class="token keyword">@version</span> 1.0
 **/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TokenConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token constant">SIGNING_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;mq123&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">TokenStore</span> tokenStore<span class="token punctuation">;</span>

<span class="token comment">//    @Bean</span>
<span class="token comment">//    public TokenStore tokenStore() {</span>
<span class="token comment">//        //ä½¿ç”¨å†…å­˜å­˜å‚¨ä»¤ç‰Œï¼ˆæ™®é€šä»¤ç‰Œï¼‰</span>
<span class="token comment">//        return new InMemoryTokenStore();</span>
<span class="token comment">//    }</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtAccessTokenConverter</span> accessTokenConverter<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenStore</span> <span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JwtTokenStore</span><span class="token punctuation">(</span><span class="token function">accessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JwtAccessTokenConverter</span> <span class="token function">accessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtAccessTokenConverter</span> converter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        converter<span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span><span class="token constant">SIGNING_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> converter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ä»¤ç‰Œç®¡ç†æœåŠ¡</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;authorizationServerTokenServicesCustom&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthorizationServerTokenServices</span> <span class="token function">tokenService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultTokenServices</span> service<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DefaultTokenServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service<span class="token punctuation">.</span><span class="token function">setSupportRefreshToken</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ”¯æŒåˆ·æ–°ä»¤ç‰Œ</span>
        service<span class="token punctuation">.</span><span class="token function">setTokenStore</span><span class="token punctuation">(</span>tokenStore<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä»¤ç‰Œå­˜å‚¨ç­–ç•¥</span>

        <span class="token class-name">TokenEnhancerChain</span> tokenEnhancerChain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenEnhancerChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenEnhancerChain<span class="token punctuation">.</span><span class="token function">setTokenEnhancers</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>accessTokenConverter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service<span class="token punctuation">.</span><span class="token function">setTokenEnhancer</span><span class="token punctuation">(</span>tokenEnhancerChain<span class="token punctuation">)</span><span class="token punctuation">;</span>

        service<span class="token punctuation">.</span><span class="token function">setAccessTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">7200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ2å°æ—¶</span>
        service<span class="token punctuation">.</span><span class="token function">setRefreshTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">259200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ·æ–°ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ3å¤©</span>
        <span class="token keyword">return</span> service<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯è®¤è¯æœåŠ¡ã€‚</p><p>ä½¿ç”¨ httpclient é€šè¿‡å¯†ç æ¨¡å¼ç”³è¯·ä»¤ç‰Œ</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### å¯†ç æ¨¡å¼
POST {{auth_host}}/oauth/token?client_id=XcWebApp&amp;client_secret=XcWebApp&amp;grant_type=password&amp;username=zhangsan&amp;password=123

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”Ÿæˆ jwt çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzMzE2OTUsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6ImU5ZDNkMGZkLTI0Y2ItNDRjOC04YzEwLTI1NmIzNGY4ZGZjYyIsImNsaWVudF9pZCI6ImMxIn0.-9SKI-qUqKhKcs8Gb80Rascx-JxqsNZxxXoPo82d8SM&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;token_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bearer&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;refresh_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJhdGkiOiJlOWQzZDBmZC0yNGNiLTQ0YzgtOGMxMC0yNTZiMzRmOGRmY2MiLCJleHAiOjE2NjQ1ODM2OTUsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6ImRjNTRjNTRkLTA0YTMtNDIzNS04MmY3LTFkOWZkMmFjM2VmNSIsImNsaWVudF9pZCI6ImMxIn0.Wsw1Jc-Kd_GFqEugzdfoSsMY6inC8OQsraA21WjWtT8&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;expires_in&quot;</span><span class="token operator">:</span> <span class="token number">7199</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e9d3d0fd-24cb-44c8-8c10-256b34f8dfcc&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1ã€access_tokenï¼Œç”Ÿæˆçš„ jwt ä»¤ç‰Œï¼Œç”¨äºè®¿é—®èµ„æºä½¿ç”¨ã€‚</p><p>2ã€token_typeï¼Œbearer æ˜¯åœ¨ RFC6750 ä¸­å®šä¹‰çš„ä¸€ç§ token ç±»å‹ï¼Œåœ¨æºå¸¦ jwt è®¿é—®èµ„æºæ—¶éœ€è¦åœ¨ head ä¸­åŠ å…¥ bearer jwt ä»¤ç‰Œå†…å®¹</p><p>3ã€refresh_tokenï¼Œå½“ jwt ä»¤ç‰Œå¿«è¿‡æœŸæ—¶ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œå¯ä»¥å†æ¬¡ç”Ÿæˆ jwt ä»¤ç‰Œã€‚</p><p>4ã€expires_inï¼šè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</p><p>5ã€scopeï¼Œä»¤ç‰Œçš„æƒé™èŒƒå›´ï¼ŒæœåŠ¡ç«¯å¯ä»¥æ ¹æ®ä»¤ç‰Œçš„æƒé™èŒƒå›´å»å¯¹ä»¤ç‰Œæˆæƒã€‚</p><p>6ã€jtiï¼šä»¤ç‰Œçš„å”¯ä¸€æ ‡è¯†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ check_token æ¥å£æ ¡éªŒ jwt ä»¤ç‰Œ</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>####æ ¡éªŒjwtä»¤ç‰Œ
POST {{auth_host}}/oauth/check_token?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJzdHUxIiwic2NvcGUiOlsiYWxsIl0sImV4cCI6MTY2NDM3MTc4MCwiYXV0aG9yaXRpZXMiOlsicDEiXSwianRpIjoiZjBhM2NkZWItMzk5ZC00OGYwLTg4MDQtZWNhNjM4YWQ4ODU3IiwiY2xpZW50X2lkIjoiYzEifQ.qy46CSCJsH3eXWTHgdcntZhzcSzfRQlBU0dxAjZcsUw

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å“åº”ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;aud&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;res1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;user_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;active&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exp&quot;</span><span class="token operator">:</span> <span class="token number">1664371780</span><span class="token punctuation">,</span>
  <span class="token property">&quot;authorities&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;f0a3cdeb-399d-48f0-8804-eca638ad8857&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;client_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c1&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-4-æºå¸¦ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_2-4-4-æºå¸¦ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡" aria-hidden="true">#</a> <strong>2.4.4 æºå¸¦ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡</strong></h4><p>æ‹¿åˆ°äº† jwt ä»¤ç‰Œä¸‹ä¸€æ­¥å°±è¦æºå¸¦ä»¤ç‰Œå»è®¿é—®èµ„æºæœåŠ¡ä¸­çš„èµ„æºï¼Œæœ¬é¡¹ç›®å„ä¸ªå¾®æœåŠ¡å°±æ˜¯èµ„æºæœåŠ¡ï¼Œæ¯”å¦‚ï¼šå†…å®¹ç®¡ç†æœåŠ¡ï¼Œå®¢æˆ·ç«¯ç”³è¯·åˆ° jwt ä»¤ç‰Œï¼Œæºå¸¦ jwt å»å†…å®¹ç®¡ç†æœåŠ¡æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯ï¼Œæ­¤æ—¶å†…å®¹ç®¡ç†æœåŠ¡è¦å¯¹ jwt è¿›è¡Œæ ¡éªŒï¼Œåªæœ‰ jwt åˆæ³•æ‰å¯ä»¥ç»§ç»­è®¿é—®ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604181145053-f16844f4.png" alt="image-20230604181145053"></p><p>1ã€åœ¨å†…å®¹ç®¡ç†æœåŠ¡çš„ content-api å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--è®¤è¯ç›¸å…³--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-oauth2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€ä»èµ„æ–™ä¸­æ‹·è´ èµ„æºæœåŠ¡é…ç½®ç±» ä¸­çš„ TokenConfig å’Œ ResouceServerConfig åˆ°å†…å®¹ç®¡ç†çš„ api å·¥ç¨‹çš„ config åŒ…ä¸‹ã€‚</p><p>å¯ä»¥åœ¨ ResouceServerConfig ç±»ä¸­é…ç½®éœ€è¦è®¤è¯çš„ urlã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
 http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/course/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//æ‰€æœ‰/r/**çš„è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡</span>
         <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯å†…å®¹ç®¡ç†æœåŠ¡</p><p>ä½¿ç”¨ httpclient æµ‹è¯•ï¼š</p><p>1ã€è®¿é—®æ ¹æ®è¯¾ç¨‹ id æŸ¥è¯¢è¯¾ç¨‹æ¥å£</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯
GET http://localhost:63040/content/course/2

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿”å›ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;unauthorized&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error_description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Full authentication is required to access this resource&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»è¿”å›ä¿¡æ¯å¯çŸ¥å½“å‰æ²¡æœ‰è®¤è¯ã€‚</p><p>ä¸‹è¾¹æºå¸¦ JWT ä»¤ç‰Œè®¿é—®æ¥å£ï¼š</p><p>1ã€ç”³è¯· jwt ä»¤ç‰Œ</p><p>é‡‡ç”¨å¯†ç æ¨¡å¼ç”³è¯·ä»¤ç‰Œã€‚</p><p>2ã€æºå¸¦ jwt ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡åœ°å€</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### æºå¸¦tokenè®¿é—®èµ„æºæœåŠ¡
GET http://localhost:63040/content/course/2
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzMzM0OTgsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6IjhhM2M2OTk1LWU1ZGEtNDQ1Yy05ZDAyLTEwNDFlYzk3NTkwOSIsImNsaWVudF9pZCI6ImMxIn0.73eNDxTX5ifttGCjwc7xrd-Sbp_mCfcIerI3lGetZto</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  Authorizationï¼Œå†…å®¹ä¸º Bearer ä»¤ç‰Œï¼ŒBearer ç”¨äºé€šè¿‡ oauth2.0 åè®®è®¿é—®èµ„æºã€‚</p><p>å¦‚æœæºå¸¦ jwt ä»¤ç‰Œä¸” jwt æ­£ç¡®åˆ™æ­£å¸¸è®¿é—®èµ„æºæœåŠ¡çš„å†…å®¹ã€‚</p><p>å¦‚æœä¸æ­£ç¡®åˆ™æŠ¥ä»¤ç‰Œæ— æ•ˆçš„é”™è¯¯ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;invalid_token&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error_description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Cannot convert access token to JSON&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-5-æµ‹è¯•è·å–ç”¨æˆ·èº«ä»½" tabindex="-1"><a class="header-anchor" href="#_2-4-5-æµ‹è¯•è·å–ç”¨æˆ·èº«ä»½" aria-hidden="true">#</a> <strong>2.4.5 æµ‹è¯•è·å–ç”¨æˆ·èº«ä»½</strong></h4><p>jwt ä»¤ç‰Œä¸­è®°å½•äº†ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œå½“å®¢æˆ·ç«¯æºå¸¦ jwt è®¿é—®èµ„æºæœåŠ¡ï¼Œèµ„æºæœåŠ¡éªŒç­¾é€šè¿‡åå°†å‰ä¸¤éƒ¨åˆ†çš„å†…å®¹è¿˜åŸå³å¯å–å‡ºç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œå¹¶å°†ç”¨æˆ·èº«ä»½ä¿¡æ¯æ”¾åœ¨äº† SecurityContextHolder ä¸Šä¸‹æ–‡ï¼ŒSecurityContext ä¸å½“å‰çº¿ç¨‹è¿›è¡Œç»‘å®šï¼Œæ–¹ä¾¿è·å–ç”¨æˆ·èº«ä»½ã€‚</p><p>è¿˜ä»¥æŸ¥è¯¢è¯¾ç¨‹æ¥å£ä¸ºä¾‹ï¼Œè¿›å…¥æŸ¥è¯¢è¯¾ç¨‹æ¥å£çš„ä»£ç ä¸­ï¼Œæ·»åŠ è·å–ç”¨æˆ·èº«ä»½çš„ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ ¹æ®è¯¾ç¨‹idæŸ¥è¯¢è¯¾ç¨‹åŸºç¡€ä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/course/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CourseBaseInfoDto</span> <span class="token function">getCourseBaseById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//å–å‡ºå½“å‰ç”¨æˆ·èº«ä»½</span>
    <span class="token class-name">Object</span> principal <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> courseBaseInfoService<span class="token punctuation">.</span><span class="token function">getCourseBaseInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•æ—¶éœ€è¦æ³¨æ„ï¼š</p><p>1ã€é¦–å…ˆåœ¨èµ„æºæœåŠ¡é…ç½®ä¸­æŒ‡å®šå®‰å…¨æ‹¦æˆªæœºåˆ¶ /course/å¼€å¤´çš„è¯·æ±‚éœ€è¦è®¤è¯ï¼Œå³è¯·æ±‚/course/{courseId}æ¥å£éœ€è¦æºå¸¦ jwt ä»¤ç‰Œä¸”ç­¾è¯é€šè¿‡ã€‚</p><p>2ã€è®¤è¯æœåŠ¡ç”Ÿæˆ jwt ä»¤ç‰Œå°†ç”¨æˆ·èº«ä»½ä¿¡æ¯å†™å…¥ä»¤ç‰Œï¼Œç›®å‰è¿˜æ˜¯å°†ç”¨æˆ·ä¿¡æ¯ç¡¬ç¼–ç å¹¶æš‚æ”¾åœ¨å†…å­˜ä¸­ã€‚</p><p>å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è¿™é‡Œé…ç½®ç”¨æˆ·ä¿¡æ¯,è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼å°†ç”¨æˆ·å­˜å‚¨åœ¨å†…å­˜ä¸­</span>
    <span class="token class-name">InMemoryUserDetailsManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> manager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€æˆ‘ä»¬åœ¨ä½¿ç”¨å¯†ç æ¨¡å¼ç”Ÿæˆ jwt ä»¤ç‰Œæ—¶ç”¨çš„æ˜¯ zhangsan çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ jwt ä»¤ç‰Œä¸­å­˜å‚¨äº† zhangsan çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨èµ„æºæœåŠ¡ä¸­åº”è¯¥å–å‡º zhangsan çš„ä¿¡æ¯æ‰å¯¹ã€‚</p><p>æ¸…æ¥šäº†ä»¥ä¸Šå†…å®¹ï¼Œä¸‹è¾¹é‡å¯å†…å®¹ç®¡ç†æœåŠ¡ï¼Œè·Ÿè¸ªå–åˆ°çš„ç”¨æˆ·èº«ä»½æ˜¯å¦æ­£ç¡®ã€‚</p><h3 id="_2-5-ç½‘å…³è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_2-5-ç½‘å…³è®¤è¯" aria-hidden="true">#</a> <strong>2.5 ç½‘å…³è®¤è¯</strong></h3><h4 id="_2-5-1-æŠ€æœ¯æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_2-5-1-æŠ€æœ¯æ–¹æ¡ˆ" aria-hidden="true">#</a> <strong>2.5.1 æŠ€æœ¯æ–¹æ¡ˆ</strong></h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæµ‹è¯•é€šè¿‡äº†è®¤è¯æœåŠ¡é¢å‘ jwt ä»¤ç‰Œï¼Œå®¢æˆ·ç«¯æºå¸¦ jwt è®¿é—®èµ„æºæœåŠ¡ï¼Œèµ„æºæœåŠ¡å¯¹ jwt çš„åˆæ³•æ€§è¿›è¡ŒéªŒè¯ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604181331767-61286564.png" alt="image-20230604181331767"></p><p>ä»”ç»†è§‚å¯Ÿæ­¤å›¾ï¼Œé—æ¼äº†æœ¬é¡¹ç›®æ¶æ„ä¸­éå¸¸é‡è¦çš„ç»„ä»¶ï¼šç½‘å…³ï¼ŒåŠ ä¸Šç½‘å…³å¹¶å®Œå–„åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/MyBlog/assets/image-20230604181336604-65d280ad.png" alt="image-20230604181336604"></p><blockquote><p>æ‰€æœ‰è®¿é—®å¾®æœåŠ¡çš„è¯·æ±‚éƒ½è¦ç»è¿‡ç½‘å…³ï¼Œåœ¨ç½‘å…³è¿›è¡Œç”¨æˆ·èº«ä»½çš„è®¤è¯å¯ä»¥å°†å¾ˆå¤šéæ³•çš„è¯·æ±‚æ‹¦æˆªåˆ°å¾®æœåŠ¡ä»¥å¤–ï¼Œè¿™å«åšç½‘å…³è®¤è¯ã€‚</p></blockquote><p>ä¸‹è¾¹éœ€è¦æ˜ç¡®ç½‘å…³çš„èŒè´£ï¼š</p><p>1ã€ç½‘ç«™ç™½åå•ç»´æŠ¤</p><p>é’ˆå¯¹ä¸ç”¨è®¤è¯çš„ URL å…¨éƒ¨æ”¾è¡Œã€‚</p><p>2ã€æ ¡éªŒ jwt çš„åˆæ³•æ€§ã€‚</p><p>é™¤äº†ç™½åå•å‰©ä¸‹çš„å°±æ˜¯éœ€è¦è®¤è¯çš„è¯·æ±‚ï¼Œç½‘å…³éœ€è¦éªŒè¯ jwt çš„åˆæ³•æ€§ï¼Œjwt åˆæ³•åˆ™è¯´æ˜ç”¨æˆ·èº«ä»½åˆæ³•ï¼Œå¦åˆ™è¯´æ˜èº«ä»½ä¸åˆæ³•åˆ™æ‹’ç»ç»§ç»­è®¿é—®ã€‚</p><blockquote><p>ç½‘å…³è´Ÿè´£æˆæƒå—ï¼Ÿ</p></blockquote><p>ç½‘å…³ä¸è´Ÿè´£æˆæƒï¼Œå¯¹è¯·æ±‚çš„æˆæƒæ“ä½œåœ¨å„ä¸ªå¾®æœåŠ¡è¿›è¡Œï¼Œå› ä¸ºå¾®æœåŠ¡æœ€æ¸…æ¥šç”¨æˆ·æœ‰å“ªäº›æƒé™è®¿é—®å“ªäº›æ¥å£ã€‚</p><h4 id="_2-5-2-å®ç°ç½‘å…³è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_2-5-2-å®ç°ç½‘å…³è®¤è¯" aria-hidden="true">#</a> <strong>2.5.2 å®ç°ç½‘å…³è®¤è¯</strong></h4><p>ä¸‹è¾¹å®ç°ç½‘å…³è®¤è¯ï¼Œå®ç°ä»¥ä¸‹èŒè´£ï¼š</p><p>1ã€ç½‘ç«™ç™½åå•ç»´æŠ¤</p><p>é’ˆå¯¹ä¸ç”¨è®¤è¯çš„ URL å…¨éƒ¨æ”¾è¡Œã€‚</p><p>2ã€æ ¡éªŒ jwt çš„åˆæ³•æ€§ã€‚</p><p>é™¤äº†ç™½åå•å‰©ä¸‹çš„å°±æ˜¯éœ€è¦è®¤è¯çš„è¯·æ±‚ï¼Œç½‘å…³éœ€è¦éªŒè¯ jwt çš„åˆæ³•æ€§ï¼Œjwt åˆæ³•åˆ™è¯´æ˜ç”¨æˆ·èº«ä»½åˆæ³•ï¼Œå¦åˆ™è¯´æ˜èº«ä»½ä¸åˆæ³•åˆ™æ‹’ç»ç»§ç»­è®¿é—®ã€‚</p><p>1ã€åœ¨ç½‘å…³å·¥ç¨‹æ·»åŠ ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-oauth2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æ‹·è´è¯¾ç¨‹èµ„æ–™ä¸‹ç½‘å…³è®¤è¯é…ç½®ç±»åˆ°ç½‘å…³å·¥ç¨‹çš„ config åŒ…ä¸‹ã€‚</p><p>3ã€é…ç½®ç™½åå•æ–‡ä»¶ security-whitelist.properties</p><p>å†…å®¹å¦‚ä¸‹ï¼ˆæŒç»­è¡¥å……ï¼‰</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>/auth/**=è®¤è¯åœ°å€
/content/open/**=å†…å®¹ç®¡ç†å…¬å¼€è®¿é—®æ¥å£
/media/open/**=åª’èµ„ç®¡ç†å…¬å¼€è®¿é—®æ¥å£

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯ç½‘å…³å·¥ç¨‹ï¼Œè¿›è¡Œæµ‹è¯•</p><p>1ã€ç”³è¯·ä»¤ç‰Œ</p><p>2ã€é€šè¿‡ç½‘å…³è®¿é—®èµ„æºæœåŠ¡</p><p>è¿™é‡Œè®¿é—®å†…å®¹ç®¡ç†æœåŠ¡</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### é€šè¿‡ç½‘å…³è®¿é—®èµ„æºæœåŠ¡
GET http://localhost:63010/content/course/2
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzNjIzMTAsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6Ijc2OTkwMGNiLWM1ZjItNGRiNC1hZWJmLWY1MzgxZDQxZWMyZCIsImNsaWVudF9pZCI6ImMxIn0.lOITjUgYg2HCh5mDPK9EvJJqz-tIupKVfmP8yWJQIKs</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ token æ­£ç¡®æ—¶å¯ä»¥æ­£å¸¸è®¿é—®èµ„æºæœåŠ¡ï¼Œtoken éªŒè¯å¤±è´¥è¿”å› token æ— æ•ˆï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;errMessage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;è®¤è¯ä»¤ç‰Œæ— æ•ˆ&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šç½‘å…³é‰´æƒåŠŸèƒ½è°ƒè¯•é€šè¿‡åï¼Œç”±äºç›®å‰è¿˜æ²¡æœ‰å¼€å‘è®¤è¯åŠŸèƒ½ï¼Œå‰ç«¯è¯·æ±‚ç½‘å…³çš„ URL ä¸åœ¨ç™½åå•ä¸­é—´æ—¶ä¼šâ€œæ²¡æœ‰è®¤è¯â€çš„é”™è¯¯ï¼Œæš‚æ—¶åœ¨ç™½åå•ä¸­æ·»åŠ  å…¨éƒ¨æ”¾è¡Œé…ç½®ï¼Œå¾…è®¤è¯åŠŸèƒ½å¼€å‘å®Œæˆå†å±è”½å…¨éƒ¨æ”¾è¡Œé…ç½®ï¼Œ</p><p><img src="/MyBlog/assets/image-20230604181442674-ac74b82a.png" alt="image-20230604181442674"></p><p>ç”±äºæ˜¯åœ¨ç½‘å…³å¤„è¿›è¡Œä»¤ç‰Œæ ¡éªŒï¼Œæ‰€ä»¥åœ¨å¾®æœåŠ¡å¤„ä¸å†æ ¡éªŒä»¤ç‰Œçš„åˆæ³•æ€§ï¼Œä¿®æ”¹å†…å®¹ç®¡ç†æœåŠ¡çš„ ResouceServerConfig ç±»ï¼Œå±è”½ authenticated()ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//          .antMatchers(&quot;/r/**&quot;,&quot;/course/**&quot;).authenticated()//æ‰€æœ‰/r/**çš„è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡</span>
          <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-ç”¨æˆ·è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_3-ç”¨æˆ·è®¤è¯" aria-hidden="true">#</a> <strong>3 ç”¨æˆ·è®¤è¯</strong></h2><h3 id="_3-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_3-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>3.1 éœ€æ±‚åˆ†æ</strong></h3><p>è‡³æ­¤æˆ‘ä»¬äº†è§£äº†ä½¿ç”¨ Spring Security è¿›è¡Œè®¤è¯æˆæƒçš„è¿‡ç¨‹ï¼Œæœ¬èŠ‚å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½ã€‚</p><p>ç›®å‰å„å¤§ç½‘ç«™çš„è®¤è¯æ–¹å¼éå¸¸ä¸°å¯Œï¼šè´¦å·å¯†ç è®¤è¯ã€æ‰‹æœºéªŒè¯ç è®¤è¯ã€æ‰«ç ç™»å½•ç­‰ã€‚</p><p>æœ¬é¡¹ç›®ä¹Ÿè¦æ”¯æŒå¤šç§è®¤è¯è¯•ã€‚</p><h3 id="_3-2-è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#_3-2-è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“" aria-hidden="true">#</a> <strong>3.2 è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“</strong></h3><h4 id="_3-2-1-è¿æ¥æ•°æ®åº“è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_3-2-1-è¿æ¥æ•°æ®åº“è®¤è¯" aria-hidden="true">#</a> <strong>3.2.1 è¿æ¥æ•°æ®åº“è®¤è¯</strong></h4><p>åŸºäºçš„è®¤è¯æµç¨‹åœ¨ç ”ç©¶ Spring Security è¿‡ç¨‹ä¸­å·²ç»æµ‹è¯•é€šè¿‡ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ç”¨æˆ·è®¤è¯æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604181459231-287c7ae3.png" alt="image-20230604181459231"></p><p>è®¤è¯æ‰€éœ€è¦çš„ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“ï¼Œç°åœ¨éœ€è¦å°†è®¤è¯æœåŠ¡è¿æ¥æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>åœ¨ç ”ç©¶ Spring Security çš„è¿‡ç¨‹ä¸­æ˜¯å°†ç”¨æˆ·ä¿¡æ¯ç¡¬ç¼–ç ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è¿™é‡Œé…ç½®ç”¨æˆ·ä¿¡æ¯,è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼å°†ç”¨æˆ·å­˜å‚¨åœ¨å†…å­˜ä¸­</span>
    <span class="token class-name">InMemoryUserDetailsManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> manager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬è¦è®¤è¯æœåŠ¡ä¸­è¿æ¥ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>å¦‚ä½•ä½¿ç”¨ Spring Security è¿æ¥æ•°æ®åº“è¿›è¡Œè®¤è¯ï¼Ÿ</p><p>å‰è¾¹å­¦ä¹  Spring Security å·¥ä½œåŸç†æ—¶æœ‰ä¸€å¼ æ‰§è¡Œæµç¨‹å›¾ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604180517699-2ce2e59f.png" alt="image-20230604181515219"></p><p>ç”¨æˆ·æäº¤è´¦å·å’Œå¯†ç ç”± DaoAuthenticationProvider è°ƒç”¨ UserDetailsService çš„ loadUserByUsername()æ–¹æ³•è·å– UserDetails ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>æŸ¥è¯¢ DaoAuthenticationProvider çš„æºä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604181519705-6524decc.png" alt="image-20230604181519705"></p><p>UserDetailsService æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>UserDetails æ˜¯ç”¨æˆ·ä¿¡æ¯æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetails</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åªè¦å®ç° UserDetailsService æ¥å£æŸ¥è¯¢æ•°æ®åº“å¾—åˆ°ç”¨æˆ·ä¿¡æ¯è¿”å› UserDetails ç±»å‹çš„ç”¨æˆ·ä¿¡æ¯å³å¯,æ¡†æ¶è°ƒç”¨ loadUserByUsername()æ–¹æ³•æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ä¹‹åæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œè§ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604181543300-886ee27b.png" alt="image-20230604181543300"></p><p>é¦–å…ˆå±è”½åŸæ¥å®šä¹‰çš„ UserDetailsServiceã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">//é…ç½®ç”¨æˆ·ä¿¡æ¯æœåŠ¡</span>
<span class="token comment">//    @Bean</span>
<span class="token comment">//    public UserDetailsService userDetailsService() {</span>
<span class="token comment">//        //è¿™é‡Œé…ç½®ç”¨æˆ·ä¿¡æ¯,è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼å°†ç”¨æˆ·å­˜å‚¨åœ¨å†…å­˜ä¸­</span>
<span class="token comment">//        InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();</span>
<span class="token comment">//        manager.createUser(User.withUsername(&quot;zhangsan&quot;).password(&quot;123&quot;).authorities(&quot;p1&quot;).build());</span>
<span class="token comment">//        manager.createUser(User.withUsername(&quot;lisi&quot;).password(&quot;456&quot;).authorities(&quot;p2&quot;).build());</span>
<span class="token comment">//        return manager;</span>
<span class="token comment">//    }</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è¾¹è‡ªå®šä¹‰ UserDetailsService</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">XcUserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UsernameNotFoundException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/9/28 18:09
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcUserMapper</span> xcUserMapper<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æ ¹æ®è´¦å·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">s</span>  è´¦å·
     * <span class="token keyword">@return</span> org.springframework.security.core.userdetails.UserDetails
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/28 18:30
    */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>

        <span class="token class-name">XcUser</span> user <span class="token operator">=</span> xcUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcUser</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//å–å‡ºæ•°æ®åº“å­˜å‚¨çš„æ­£ç¡®å¯†ç </span>
        <span class="token class-name">String</span> password  <span class="token operator">=</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç”¨æˆ·æƒé™,å¦‚æœä¸åŠ æŠ¥Cannot pass a null GrantedAuthority collection</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> authorities<span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ›å»ºUserDetailså¯¹è±¡,æƒé™ä¿¡æ¯å¾…å®ç°æˆæƒåŠŸèƒ½æ—¶å†å‘UserDetailä¸­åŠ å…¥</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> userDetails<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ•°æ®åº“ä¸­çš„å¯†ç åŠ è¿‡å¯†çš„ï¼Œç”¨æˆ·è¾“å…¥çš„å¯†ç æ˜¯æ˜æ–‡ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å¯†ç <code>æ ¼å¼å™¨PasswordEncoder</code>ï¼ŒåŸæ¥ä½¿ç”¨çš„æ˜¯ NoOpPasswordEncoderï¼Œå®ƒæ˜¯é€šè¿‡æ˜æ–‡æ–¹å¼æ¯”è¾ƒå¯†ç ï¼Œç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸º BCryptPasswordEncoderï¼Œå®ƒæ˜¯å°†ç”¨æˆ·è¾“å…¥çš„å¯†ç ç¼–ç ä¸º BCrypt æ ¼å¼ä¸æ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œæ¯”å¯¹ã€‚</p><p>å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        //å¯†ç ä¸ºæ˜æ–‡æ–¹å¼</span>
<span class="token comment">//        return NoOpPasswordEncoder.getInstance();</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬é€šè¿‡æµ‹è¯•ä»£ç æµ‹è¯• BCryptPasswordEncoderï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;111111&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">PasswordEncoder</span> passwordEncoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ¯ä¸ªè®¡ç®—å‡ºçš„Hashå€¼éƒ½ä¸ä¸€æ ·</span>
        <span class="token class-name">String</span> hashPass <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hashPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è™½ç„¶æ¯æ¬¡è®¡ç®—çš„å¯†ç Hashå€¼ä¸ä¸€æ ·ä½†æ˜¯æ ¡éªŒæ˜¯é€šè¿‡çš„</span>
        <span class="token keyword">boolean</span> f <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> hashPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹æ•°æ®åº“ä¸­çš„å¯†ç ä¸º Bcrypt æ ¼å¼ï¼Œå¹¶ä¸”è®°å½•æ˜æ–‡å¯†ç ï¼Œç¨åç”³è¯·ä»¤ç‰Œæ—¶éœ€è¦ã€‚</p><p>ç”±äºä¿®æ”¹å¯†ç ç¼–ç æ–¹å¼è¿˜éœ€è¦å°†å®¢æˆ·ç«¯çš„å¯†é’¥æ›´æ”¹ä¸º Bcrypt æ ¼å¼.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">ClientDetailsServiceConfigurer</span> clients<span class="token punctuation">)</span>
          <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        clients<span class="token punctuation">.</span><span class="token function">inMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// ä½¿ç”¨in-memoryå­˜å‚¨</span>
                <span class="token punctuation">.</span><span class="token function">withClient</span><span class="token punctuation">(</span><span class="token string">&quot;XcWebApp&quot;</span><span class="token punctuation">)</span><span class="token comment">// client_id</span>
<span class="token comment">//                .secret(&quot;secret&quot;)//å®¢æˆ·ç«¯å¯†é’¥</span>
                <span class="token punctuation">.</span><span class="token function">secret</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;XcWebApp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//å®¢æˆ·ç«¯å¯†é’¥</span>
                <span class="token punctuation">.</span><span class="token function">resourceIds</span><span class="token punctuation">(</span><span class="token string">&quot;xuecheng-plus&quot;</span><span class="token punctuation">)</span><span class="token comment">//èµ„æºåˆ—è¡¨</span>
                <span class="token punctuation">.</span><span class="token function">authorizedGrantTypes</span><span class="token punctuation">(</span><span class="token string">&quot;authorization_code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;client_credentials&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;implicit&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">)</span><span class="token comment">// è¯¥clientå…è®¸çš„æˆæƒç±»å‹authorization_code,password,refresh_token,implicit,client_credentials</span>
                <span class="token punctuation">.</span><span class="token function">scopes</span><span class="token punctuation">(</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token comment">// å…è®¸çš„æˆæƒèŒƒå›´</span>
                <span class="token punctuation">.</span><span class="token function">autoApprove</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token comment">//falseè·³è½¬åˆ°æˆæƒé¡µé¢</span>
                <span class="token comment">//å®¢æˆ·ç«¯æ¥æ”¶æˆæƒç çš„é‡å®šå‘åœ°å€</span>
                <span class="token punctuation">.</span><span class="token function">redirectUris</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.51xuecheng.cn&quot;</span><span class="token punctuation">)</span>
   <span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨é‡å¯è®¤è¯æœåŠ¡ã€‚</p><p>ä¸‹è¾¹ä½¿ç”¨ httpclient è¿›è¡Œæµ‹è¯•ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### å¯†ç æ¨¡å¼
POST {{auth_host}}/oauth/token?client_id=XcWebApp&amp;client_secret=XcWebApp&amp;grant_type=password&amp;username=stu1&amp;password=111111

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å…¥æ­£ç¡®çš„è´¦å·å’Œå¯†ç ï¼Œç”³è¯·ä»¤ç‰ŒæˆåŠŸã€‚</p><p>è¾“å…¥é”™è¯¯çš„å¯†ç ï¼ŒæŠ¥é”™ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;invalid_grant&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error_description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å…¥é”™è¯¯çš„è´¦å·ï¼ŒæŠ¥é”™ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;unauthorized&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error_description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UserDetailsService returned null, which is an interface contract violation&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-æ‰©å±•ç”¨æˆ·èº«ä»½ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_3-2-2-æ‰©å±•ç”¨æˆ·èº«ä»½ä¿¡æ¯" aria-hidden="true">#</a> <strong>3.2.2 æ‰©å±•ç”¨æˆ·èº«ä»½ä¿¡æ¯</strong></h4><p>ç”¨æˆ·è¡¨ä¸­å­˜å‚¨äº†ç”¨æˆ·çš„è´¦å·ã€æ‰‹æœºå·ã€emailï¼Œæ˜µç§°ã€qq ç­‰ä¿¡æ¯ï¼ŒUserDetails æ¥å£åªè¿”å›äº† usernameã€å¯†ç ç­‰ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Java</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetails</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬éœ€è¦æ‰©å±•ç”¨æˆ·èº«ä»½çš„ä¿¡æ¯ï¼Œåœ¨ jwt ä»¤ç‰Œä¸­å­˜å‚¨ç”¨æˆ·çš„æ˜µç§°ã€å¤´åƒã€qq ç­‰ä¿¡æ¯ã€‚</p><blockquote><p>å¦‚ä½•æ‰©å±• Spring Security çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯å‘¢ï¼Ÿ</p></blockquote><p>åœ¨è®¤è¯é˜¶æ®µ DaoAuthenticationProvider ä¼šè°ƒç”¨ UserDetailService æŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¿™é‡Œæ˜¯å¯ä»¥è·å–åˆ°é½å…¨çš„ç”¨æˆ·ä¿¡æ¯çš„ã€‚ç”±äº JWT ä»¤ç‰Œä¸­ç”¨æˆ·èº«ä»½ä¿¡æ¯æ¥æºäº UserDetailsï¼ŒUserDetails ä¸­ä»…å®šä¹‰äº† username ä¸ºç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ€è·¯ï¼šç¬¬ä¸€æ˜¯å¯ä»¥æ‰©å±• UserDetailsï¼Œä½¿ä¹‹åŒ…æ‹¬æ›´å¤šçš„è‡ªå®šä¹‰å±æ€§ï¼Œç¬¬äºŒä¹Ÿå¯ä»¥æ‰©å±• username çš„å†…å®¹ ï¼Œæ¯”å¦‚å­˜å…¥ json æ•°æ®å†…å®¹ä½œä¸º username çš„å†…å®¹ã€‚ç›¸æ¯”è¾ƒè€Œè¨€ï¼Œæ–¹æ¡ˆäºŒæ¯”è¾ƒç®€å•è¿˜ä¸ç”¨ç ´å UserDetails çš„ç»“æ„ï¼Œæˆ‘ä»¬é‡‡ç”¨æ–¹æ¡ˆäºŒã€‚</p><p>ä¿®æ”¹ UserServiceImpl å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">XcUserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UsernameNotFoundException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> TODO
 * <span class="token keyword">@date</span> 2022/9/28 18:09
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcUserMapper</span> xcUserMapper<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æ ¹æ®è´¦å·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">s</span>  è´¦å·
     * <span class="token keyword">@return</span> org.springframework.security.core.userdetails.UserDetails
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/28 18:30
    */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>

        <span class="token class-name">XcUser</span> user <span class="token operator">=</span> xcUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcUser</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//å–å‡ºæ•°æ®åº“å­˜å‚¨çš„æ­£ç¡®å¯†ç </span>
        <span class="token class-name">String</span> password  <span class="token operator">=</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç”¨æˆ·æƒé™,å¦‚æœä¸åŠ æŠ¥Cannot pass a null GrantedAuthority collection</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> authorities <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
       <span class="token comment">//ä¸ºäº†å®‰å…¨åœ¨ä»¤ç‰Œä¸­ä¸æ”¾å¯†ç </span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†userå¯¹è±¡è½¬json</span>
        <span class="token class-name">String</span> userString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ›å»ºUserDetailså¯¹è±¡</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>userString<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> userDetails<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯è®¤è¯æœåŠ¡ï¼Œé‡æ–°ç”Ÿæˆä»¤ç‰Œï¼Œç”ŸæˆæˆåŠŸã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ check_token æŸ¥è¯¢ jwt çš„å†…å®¹</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>####æ ¡éªŒjwtä»¤ç‰Œ
POST {{auth_host}}/oauth/check_token?token=

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å“åº”ç¤ºä¾‹å¦‚ä¸‹ï¼Œ</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;aud&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;res1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;user_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;birthday\&quot;:\&quot;2022-09-28T19:28:46\&quot;,\&quot;createTime\&quot;:\&quot;2022-09-28T08:32:03\&quot;,\&quot;id\&quot;:\&quot;50\&quot;,\&quot;name\&quot;:\&quot;å­¦ç”Ÿ1\&quot;,\&quot;nickname\&quot;:\&quot;å¤§æ°´ç‰›\&quot;,\&quot;password\&quot;:\&quot;$2a$10$0pt7WlfTbnPDTcWtp/.2Mu5CTXvohnNQhR628qq4RoKSc0dGAdEgm\&quot;,\&quot;sex\&quot;:\&quot;1\&quot;,\&quot;status\&quot;:\&quot;1\&quot;,\&quot;username\&quot;:\&quot;stu1\&quot;,\&quot;userpic\&quot;:\&quot;http://file.51xuecheng.cn/dddf\&quot;,\&quot;utype\&quot;:\&quot;101001\&quot;}&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;active&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exp&quot;</span><span class="token operator">:</span> <span class="token number">1664372184</span><span class="token punctuation">,</span>
  <span class="token property">&quot;authorities&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;73da9f7b-bd8c-45ac-9add-46b711d11fb8&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;client_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c1&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>user_name å­˜å‚¨äº†ç”¨æˆ·ä¿¡æ¯çš„ json æ ¼å¼ï¼Œåœ¨èµ„æºæœåŠ¡ä¸­å°±å¯ä»¥å–å‡ºè¯¥ json æ ¼å¼çš„å†…å®¹è½¬ä¸ºç”¨æˆ·å¯¹è±¡å»ä½¿ç”¨ã€‚</p><h4 id="_3-2-3-èµ„æºæœåŠ¡è·å–ç”¨æˆ·èº«ä»½" tabindex="-1"><a class="header-anchor" href="#_3-2-3-èµ„æºæœåŠ¡è·å–ç”¨æˆ·èº«ä»½" aria-hidden="true">#</a> <strong>3.2.3 èµ„æºæœåŠ¡è·å–ç”¨æˆ·èº«ä»½</strong></h4><p>ä¸‹è¾¹ç¼–å†™ä¸€ä¸ªå·¥å…·ç±»åœ¨å„ä¸ªå¾®æœåŠ¡ä¸­å»ä½¿ç”¨ï¼Œè·å–å½“å‰ç™»å½•ç”¨æˆ·çš„å¯¹è±¡ã€‚</p><p>åœ¨ content-api ä¸­å®šä¹‰æ­¤ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>content<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SecurityContextHolder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> è·å–å½“å‰ç”¨æˆ·èº«ä»½å·¥å…·ç±»
 * <span class="token keyword">@date</span> 2022/10/18 18:02
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityUtil</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">XcUser</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> principalObj <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>principalObj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//å–å‡ºç”¨æˆ·èº«ä»½ä¿¡æ¯</span>
                <span class="token class-name">String</span> principal <span class="token operator">=</span> principalObj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//å°†jsonè½¬æˆå¯¹è±¡</span>
                <span class="token class-name">XcUser</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>principal<span class="token punctuation">,</span> <span class="token class-name">XcUser</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–å½“å‰ç™»å½•ç”¨æˆ·èº«ä»½å‡ºé”™:{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">XcUser</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> salt<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> nickname<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> wxUnionid<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> companyId<span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * å¤´åƒ
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> userpic<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> utype<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> birthday<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> cellphone<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> qq<span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * ç”¨æˆ·çŠ¶æ€
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updateTime<span class="token punctuation">;</span>


    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è¾¹åœ¨å†…å®¹ç®¡ç†æœåŠ¡ä¸­æµ‹è¯•æ­¤å·¥å…·ç±»ï¼Œä»¥æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£ä¸ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;æ ¹æ®è¯¾ç¨‹idæŸ¥è¯¢è¯¾ç¨‹åŸºç¡€ä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/course/{courseId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CourseBaseInfoDto</span> <span class="token function">getCourseBaseById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;courseId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> courseId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//å–å‡ºå½“å‰ç”¨æˆ·èº«ä»½</span>
<span class="token comment">//    Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span>
   <span class="token class-name">SecurityUtil<span class="token punctuation">.</span>XcUser</span> user <span class="token operator">=</span> <span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> courseBaseInfoService<span class="token punctuation">.</span><span class="token function">getCourseBaseInfo</span><span class="token punctuation">(</span>courseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯å†…å®¹ç®¡ç†æœåŠ¡ï¼š</p><p>1ã€å¯åŠ¨è®¤è¯æœåŠ¡ã€ç½‘å…³ã€å†…å®¹ç®¡ç†æœåŠ¡</p><p>2ã€ç”Ÿæˆæ–°çš„ä»¤ç‰Œ</p><p>3ã€æºå¸¦ä»¤ç‰Œè®¿é—®å†…å®¹ç®¡ç†æœåŠ¡çš„æŸ¥è¯¢è¯¾ç¨‹æ¥å£</p><p><img src="/MyBlog/assets/image-20230604181846179-f4b8a587.png" alt="image-20230604181846179"></p><h2 id="_3-3-æ”¯æŒè®¤è¯æ–¹å¼å¤šæ ·" tabindex="-1"><a class="header-anchor" href="#_3-3-æ”¯æŒè®¤è¯æ–¹å¼å¤šæ ·" aria-hidden="true">#</a> <strong>3.3 æ”¯æŒè®¤è¯æ–¹å¼å¤šæ ·</strong></h2><h4 id="_3-3-1-ç»Ÿä¸€è®¤è¯å…¥å£" tabindex="-1"><a class="header-anchor" href="#_3-3-1-ç»Ÿä¸€è®¤è¯å…¥å£" aria-hidden="true">#</a> <strong>3.3.1 ç»Ÿä¸€è®¤è¯å…¥å£</strong></h4><p>ç›®å‰å„å¤§ç½‘ç«™çš„è®¤è¯æ–¹å¼éå¸¸ä¸°å¯Œï¼šè´¦å·å¯†ç è®¤è¯ã€æ‰‹æœºéªŒè¯ç è®¤è¯ã€æ‰«ç ç™»å½•ç­‰ã€‚<code>åŸºäºå½“å‰ç ”ç©¶çš„Spring Securityè®¤è¯æµç¨‹å¦‚ä½•æ”¯æŒå¤šæ ·åŒ–çš„è®¤è¯æ–¹å¼å‘¢ï¼Ÿ</code></p><p>1ã€æ”¯æŒè´¦å·å’Œå¯†ç è®¤è¯</p><p>é‡‡ç”¨ OAuth2 åè®®çš„å¯†ç æ¨¡å¼å³å¯å®ç°ã€‚</p><p>2ã€æ”¯æŒæ‰‹æœºå·åŠ éªŒè¯ç è®¤è¯</p><p>ç”¨æˆ·è®¤è¯æäº¤çš„æ˜¯æ‰‹æœºå·å’ŒéªŒè¯ç ï¼Œå¹¶ä¸æ˜¯è´¦å·å’Œå¯†ç ã€‚</p><p>3ã€å¾®ä¿¡æ‰«ç è®¤è¯</p><p>åŸºäº OAuth2 åè®®ä¸å¾®ä¿¡äº¤äº’ï¼Œå­¦æˆåœ¨çº¿ç½‘ç«™å‘å¾®ä¿¡æœåŠ¡å™¨ç”³è¯·åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œç„¶åæºå¸¦ä»¤ç‰Œå»å¾®ä¿¡æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ŒæŸ¥è¯¢æˆåŠŸåˆ™ç”¨æˆ·åœ¨å­¦æˆåœ¨çº¿é¡¹ç›®è®¤è¯é€šè¿‡ã€‚</p><p>ç›®å‰æˆ‘ä»¬æµ‹è¯•é€šè¿‡ OAuth2 çš„å¯†ç æ¨¡å¼ï¼Œç”¨æˆ·è®¤è¯ä¼šæäº¤è´¦å·å’Œå¯†ç ï¼Œç”± DaoAuthenticationProvider è°ƒç”¨ UserDetailsService çš„ loadUserByUsername()æ–¹æ³•è·å– UserDetails ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>åœ¨å‰è¾¹æˆ‘ä»¬è‡ªå®šä¹‰äº† UserDetailsService æ¥å£å®ç°ç±»ï¼Œé€šè¿‡ loadUserByUsername()æ–¹æ³•æ ¹æ®è´¦å·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>è€Œä¸åŒçš„è®¤è¯æ–¹å¼æäº¤çš„æ•°æ®ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ï¼šæ‰‹æœºåŠ éªŒè¯ç æ–¹å¼ä¼šæäº¤æ‰‹æœºå·å’ŒéªŒè¯ç ï¼Œè´¦å·å¯†ç æ–¹å¼ä¼šæäº¤è´¦å·ã€å¯†ç ã€éªŒè¯ç ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ loadUserByUsername()æ–¹æ³•ä¸Šä½œæ–‡ç« ï¼Œå°†ç”¨æˆ·åŸæ¥æäº¤çš„è´¦å·æ•°æ®æ”¹ä¸ºæäº¤ json æ•°æ®ï¼Œjson æ•°æ®å¯ä»¥æ‰©å±•ä¸åŒè®¤è¯æ–¹å¼æ‰€æäº¤çš„å„ç§å‚æ•°ã€‚</p><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª DTO ç±»è¡¨ç¤ºè®¤è¯çš„å‚æ•°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> è®¤è¯ç”¨æˆ·è¯·æ±‚å‚æ•°
 * <span class="token keyword">@date</span> 2022/9/29 10:56
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthParamsDto</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span> <span class="token comment">//ç”¨æˆ·å</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span> <span class="token comment">//åŸŸ  ç”¨äºæ‰©å±•</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> cellphone<span class="token punctuation">;</span><span class="token comment">//æ‰‹æœºå·</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> checkcode<span class="token punctuation">;</span><span class="token comment">//éªŒè¯ç </span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> checkcodekey<span class="token punctuation">;</span><span class="token comment">//éªŒè¯ç key</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> authType<span class="token punctuation">;</span> <span class="token comment">// è®¤è¯çš„ç±»å‹   password:ç”¨æˆ·åå¯†ç æ¨¡å¼ç±»å‹    sms:çŸ­ä¿¡æ¨¡å¼ç±»å‹</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> payload <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é™„åŠ æ•°æ®ï¼Œä½œä¸ºæ‰©å±•ï¼Œä¸åŒè®¤è¯ç±»å‹å¯æ‹¥æœ‰ä¸åŒçš„é™„åŠ æ•°æ®ã€‚å¦‚è®¤è¯ç±»å‹ä¸ºçŸ­ä¿¡æ—¶åŒ…å«smsKey : sms:3d21042d054548b08477142bbca95cfa; æ‰€æœ‰æƒ…å†µä¸‹éƒ½åŒ…å«clientId</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶ loadUserByUsername()æ–¹æ³•å¯ä»¥ä¿®æ”¹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">XcUserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">AuthParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UsernameNotFoundException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> è‡ªå®šä¹‰UserDetailsServiceç”¨æ¥å¯¹æ¥Spring Security
 * <span class="token keyword">@date</span> 2022/9/28 18:09
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcUserMapper</span> xcUserMapper<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ç»„æˆç”¨æˆ·èº«ä»½ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">s</span>  AuthParamsDtoç±»å‹çš„jsonæ•°æ®
     * <span class="token keyword">@return</span> org.springframework.security.core.userdetails.UserDetails
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/28 18:30
    */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>

        <span class="token class-name">AuthParamsDto</span> authParamsDto <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//å°†è®¤è¯å‚æ•°è½¬ä¸ºAuthParamsDtoç±»å‹</span>
            authParamsDto <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">AuthParamsDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è®¤è¯è¯·æ±‚ä¸ç¬¦åˆé¡¹ç›®è¦æ±‚:{}&quot;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//è´¦å·</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XcUser</span> user <span class="token operator">=</span> xcUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcUser</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//å–å‡ºæ•°æ®åº“å­˜å‚¨çš„æ­£ç¡®å¯†ç </span>
        <span class="token class-name">String</span> password  <span class="token operator">=</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç”¨æˆ·æƒé™,å¦‚æœä¸åŠ æŠ¥Cannot pass a null GrantedAuthority collection</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> authorities <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†userå¯¹è±¡è½¬json</span>
        <span class="token class-name">String</span> userString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ›å»ºUserDetailså¯¹è±¡</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>userString<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> userDetails<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŸæ¥çš„ DaoAuthenticationProvider ä¼šè¿›è¡Œå¯†ç æ ¡éªŒï¼Œç°åœ¨é‡æ–°å®šä¹‰ DaoAuthenticationProviders ç±»ï¼Œé‡å†™ç±»çš„ additionalAuthenticationChecks æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span><span class="token class-name">BadCredentialsException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span><span class="token class-name">UsernamePasswordAuthenticationToken</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">DaoAuthenticationProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">AuthenticationException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è‡ªå®šä¹‰DaoAuthenticationProvider
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/29 10:31
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DaoAuthenticationProviderCustom</span> <span class="token keyword">extends</span> <span class="token class-name">DaoAuthenticationProvider</span> <span class="token punctuation">{</span>


 <span class="token annotation punctuation">@Autowired</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserDetailsService</span><span class="token punctuation">(</span><span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setUserDetailsService</span><span class="token punctuation">(</span>userDetailsService<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>


 <span class="token comment">//å±è”½å¯†ç å¯¹æ¯”</span>
 <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> userDetails<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>


 <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹ WebSecurityConfig ç±»æŒ‡å®š daoAuthenticationProviderCustom</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">DaoAuthenticationProviderCustom</span> daoAuthenticationProviderCustom<span class="token punctuation">;</span>


<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    auth<span class="token punctuation">.</span><span class="token function">authenticationProvider</span><span class="token punctuation">(</span>daoAuthenticationProviderCustom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶å¯ä»¥é‡å¯è®¤è¯æœåŠ¡ï¼Œæµ‹è¯•ç”³è¯·ä»¤ç‰Œæ¥å£ï¼Œä¼ å…¥çš„è´¦å·ä¿¡æ¯æ”¹ä¸º json æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#################æ‰©å±•è®¤è¯è¯·æ±‚å‚æ•°å######################
####å¯†ç æ¨¡å¼
POST {{auth_host}}/auth/oauth/token?client_id=XcWebApp&amp;client_secret=XcWebApp&amp;grant_type=password&amp;username={&quot;username&quot;:&quot;stu1&quot;,&quot;authType&quot;:&quot;password&quot;,&quot;password&quot;:&quot;111111&quot;}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»è¿‡æµ‹è¯•å‘ç° loadUserByUsername()æ–¹æ³•å¯ä»¥æ­£å¸¸æ¥æ”¶åˆ°è®¤è¯è¯·æ±‚ä¸­çš„ json æ•°æ®ã€‚</p><p>æœ‰äº†è¿™äº›è®¤è¯å‚æ•°æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªè®¤è¯ Service æ¥å£å»è¿›è¡Œå„ç§æ–¹å¼çš„è®¤è¯ã€‚</p><p>å®šä¹‰ç”¨æˆ·ä¿¡æ¯ï¼Œä¸ºäº†æ‰©å±•æ€§è®©å®ƒç»§æ‰¿ XcUser</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XcUserExt</span> <span class="token keyword">extends</span> <span class="token class-name">XcUser</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰è®¤è¯ Service æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">AuthParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è®¤è¯service
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/29 12:10
 * <span class="token keyword">@version</span> 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AuthService</span> <span class="token punctuation">{</span>

   <span class="token doc-comment comment">/**
    * <span class="token keyword">@description</span> è®¤è¯æ–¹æ³•
    * <span class="token keyword">@param</span> <span class="token parameter">authParamsDto</span> è®¤è¯å‚æ•°
    * <span class="token keyword">@return</span> com.xuecheng.ucenter.model.po.XcUser ç”¨æˆ·ä¿¡æ¯
    * <span class="token keyword">@author</span> Mr.M
    * <span class="token keyword">@date</span> 2022/9/29 12:11
   */</span>
   <span class="token class-name">XcUserExt</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">AuthParamsDto</span> authParamsDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>loadUserByUsername()ä¿®æ”¹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcUserMapper</span> xcUserMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>


    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ç»„æˆç”¨æˆ·èº«ä»½ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">s</span>  AuthParamsDtoç±»å‹çš„jsonæ•°æ®
     * <span class="token keyword">@return</span> org.springframework.security.core.userdetails.UserDetails
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/28 18:30
    */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>

        <span class="token class-name">AuthParamsDto</span> authParamsDto <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//å°†è®¤è¯å‚æ•°è½¬ä¸ºAuthParamsDtoç±»å‹</span>
            authParamsDto <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">AuthParamsDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è®¤è¯è¯·æ±‚ä¸ç¬¦åˆé¡¹ç›®è¦æ±‚:{}&quot;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//å¼€å§‹è®¤è¯</span>
        authService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>authParamsDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ°æ­¤æˆ‘ä»¬åŸºäº Spring Security è®¤è¯æµç¨‹ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604182038468-dd0bd473.png" alt="image-20230604182038468"></p><h4 id="_3-3-2-å®ç°è´¦å·å¯†ç è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_3-3-2-å®ç°è´¦å·å¯†ç è®¤è¯" aria-hidden="true">#</a> <strong>3.3.2 å®ç°è´¦å·å¯†ç è®¤è¯</strong></h4><p>ä¸ŠèŠ‚å®šä¹‰äº† AuthService è®¤è¯æ¥å£ï¼Œä¸‹è¾¹å®ç°è¯¥æ¥å£å®ç°è´¦å·å¯†ç è®¤è¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">XcUserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">AuthParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AuthService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>bcrypt<span class="token punctuation">.</span></span><span class="token class-name">BCryptPasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>password<span class="token punctuation">.</span></span><span class="token class-name">PasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è´¦å·å¯†ç è®¤è¯
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/29 12:12
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;password_authservice&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PasswordAuthServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthService</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">XcUserMapper</span> xcUserMapper<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>


 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">XcUserExt</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">AuthParamsDto</span> authParamsDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">//è´¦å·</span>
  <span class="token class-name">String</span> username <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">XcUser</span> user <span class="token operator">=</span> xcUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcUser</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;è´¦å·ä¸å­˜åœ¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token class-name">XcUserExt</span> xcUserExt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcUserExt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>xcUserExt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//æ ¡éªŒå¯†ç </span>
  <span class="token comment">//å–å‡ºæ•°æ®åº“å­˜å‚¨çš„æ­£ç¡®å¯†ç </span>
  <span class="token class-name">String</span> passwordDb  <span class="token operator">=</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> passwordForm <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> matches <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>passwordForm<span class="token punctuation">,</span> passwordDb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>matches<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> xcUserExt<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹ UserServiceImpl ç±»ï¼Œæ ¹æ®è®¤è¯æ–¹å¼ä½¿ç”¨ä¸åŒçš„è®¤è¯ bean</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">XcUserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">AuthParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AuthService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UsernameNotFoundException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> è‡ªå®šä¹‰UserDetailsServiceç”¨æ¥å¯¹æ¥Spring Security
 * <span class="token keyword">@date</span> 2022/9/28 18:09
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcUserMapper</span> xcUserMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>

<span class="token comment">//    @Autowired</span>
<span class="token comment">//    AuthService authService;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ç»„æˆç”¨æˆ·èº«ä»½ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">s</span>  AuthParamsDtoç±»å‹çš„jsonæ•°æ®
     * <span class="token keyword">@return</span> org.springframework.security.core.userdetails.UserDetails
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/28 18:30
    */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>

        <span class="token class-name">AuthParamsDto</span> authParamsDto <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//å°†è®¤è¯å‚æ•°è½¬ä¸ºAuthParamsDtoç±»å‹</span>
            authParamsDto <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">AuthParamsDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è®¤è¯è¯·æ±‚ä¸ç¬¦åˆé¡¹ç›®è¦æ±‚:{}&quot;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//è®¤è¯æ–¹æ³•</span>
        <span class="token class-name">String</span> authType <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getAuthType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AuthService</span> authService <span class="token operator">=</span>  applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>authType <span class="token operator">+</span> <span class="token string">&quot;_authservice&quot;</span><span class="token punctuation">,</span><span class="token class-name">AuthService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XcUserExt</span> user <span class="token operator">=</span> authService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>authParamsDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">getUserPrincipal</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span> æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">user</span>  ç”¨æˆ·idï¼Œä¸»é”®
     * <span class="token keyword">@return</span> com.xuecheng.ucenter.model.po.XcUser ç”¨æˆ·ä¿¡æ¯
     * <span class="token keyword">@author</span> Mr.M
     * <span class="token keyword">@date</span> 2022/9/29 12:19
    */</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">getUserPrincipal</span><span class="token punctuation">(</span><span class="token class-name">XcUserExt</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç”¨æˆ·æƒé™,å¦‚æœä¸åŠ æŠ¥Cannot pass a null GrantedAuthority collection</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> authorities <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¸ºäº†å®‰å…¨åœ¨ä»¤ç‰Œä¸­ä¸æ”¾å¯†ç </span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†userå¯¹è±¡è½¬json</span>
        <span class="token class-name">String</span> userString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ›å»ºUserDetailså¯¹è±¡</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>userString<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>password <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userDetails<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯è®¤è¯æœåŠ¡ï¼Œæµ‹è¯•ç”³è¯·ä»¤ç‰Œæ¥å£ã€‚</p><p>1ã€æµ‹è¯•è´¦å·å’Œå¯†ç éƒ½æ­£ç¡®çš„æƒ…å†µæ˜¯å¦å¯ä»¥ç”³è¯·ä»¤ç‰ŒæˆåŠŸã€‚</p><p>2ã€æµ‹è¯•å¯†ç é”™è¯¯çš„æƒ…å†µã€‚</p><p>3ã€æµ‹è¯•è´¦å·ä¸å­˜åœ¨æƒ…å†µã€‚</p><h3 id="_3-4-éªŒè¯ç æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_3-4-éªŒè¯ç æœåŠ¡" aria-hidden="true">#</a> <strong>3.4 éªŒè¯ç æœåŠ¡</strong></h3><h4 id="_3-4-1-éƒ¨ç½²éªŒè¯ç æœåŠ¡å·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-4-1-éƒ¨ç½²éªŒè¯ç æœåŠ¡å·¥ç¨‹" aria-hidden="true">#</a> <strong>3.4.1 éƒ¨ç½²éªŒè¯ç æœåŠ¡å·¥ç¨‹</strong></h4><p>åœ¨è®¤è¯æ—¶ä¸€èˆ¬éƒ½éœ€è¦è¾“å…¥éªŒè¯ç ï¼Œ<code>éªŒè¯ç æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</code></p><p>éªŒè¯ç å¯ä»¥é˜²æ­¢æ¶æ€§æ”»å‡»ï¼Œæ¯”å¦‚ï¼šXSS è·¨ç«™è„šæœ¬æ”»å‡»ã€CSRF è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼Œä¸€äº›æ¯”è¾ƒå¤æ‚çš„å›¾å½¢éªŒè¯ç å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢æ¶æ€§æ”»å‡»ã€‚</p><p>ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿçš„å®‰å…¨åœ¨ä¸€äº›æ¯”è¾ƒé‡è¦çš„æ“ä½œéƒ½éœ€è¦éªŒè¯ç ã€‚</p><p><img src="/MyBlog/assets/image-20230604182128014-143b0b55.png" alt="image-20230604182128014"></p><p>éªŒè¯ç çš„ç±»å‹ä¹Ÿæœ‰å¾ˆå¤šï¼šå›¾ç‰‡ã€è¯­éŸ³ã€æ‰‹æœºçŸ­ä¿¡éªŒè¯ç ç­‰ã€‚</p><p>æœ¬é¡¹ç›®åˆ›å»ºå•ç‹¬çš„éªŒè¯ç æœåŠ¡ä¸ºå„ä¸šåŠ¡æä¾›éªŒè¯ç çš„ç”Ÿæˆã€æ ¡éªŒç­‰æœåŠ¡ã€‚</p><p>æ‹·è´è¯¾ç¨‹èµ„æ–™ç›®å½• xuecheng-plus-checkcode éªŒè¯ç æœåŠ¡å·¥ç¨‹åˆ°è‡ªå·±çš„å·¥ç¨‹ç›®å½•ã€‚</p><p><img src="/MyBlog/assets/image-20230604182133296-f7a21e39.png" alt="image-20230604182133296"></p><p>å®šä¹‰ nacos é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /checkcode
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">63075</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ä¿®æ”¹ bootstrap.yml ä¸­çš„å‘½åç©ºé—´ä¸ºè‡ªå·±å®šä¹‰çš„å‘½åç©ºé—´ã€‚</p><p>é…ç½® redis-dev.yamlï¼Œä¿å­˜ redis æœåŠ¡å¯åŠ¨</p><p><img src="/MyBlog/assets/image-20230604182151328-3a1049f2.png" alt="image-20230604182151328"></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.101.65
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">20</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token comment">#redisson:</span>
    <span class="token comment">#é…ç½®æ–‡ä»¶ç›®å½•</span>
    <span class="token comment">#config: classpath:singleServerConfig.yaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-2-éªŒè¯ç æ¥å£æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-4-2-éªŒè¯ç æ¥å£æµ‹è¯•" aria-hidden="true">#</a> <strong>3.4.2 éªŒè¯ç æ¥å£æµ‹è¯•</strong></h4><p>éªŒè¯ç æœåŠ¡å¯¹å¤–æä¾›çš„æ¥å£æœ‰ï¼š</p><p>1ã€ç”ŸæˆéªŒè¯ç </p><p>2ã€æ ¡éªŒéªŒè¯ç ã€‚</p><p>å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604182209500-8174fa3f.png" alt="image-20230604182209500"></p><blockquote><p>éªŒè¯ç æœåŠ¡å¦‚ä½•ç”Ÿæˆå¹¶æ ¡éªŒéªŒè¯ç ï¼Ÿ</p></blockquote><p>æ‹¿å›¾ç‰‡éªŒè¯ç ä¸¾ä¾‹ï¼š</p><p>1ã€å…ˆç”Ÿæˆä¸€ä¸ªæŒ‡å®šä½æ•°çš„éªŒè¯ç ï¼Œæ ¹æ®éœ€è¦å¯èƒ½æ˜¯æ•°å­—ã€æ•°å­—å­—æ¯ç»„åˆæˆ–æ–‡å­—ã€‚</p><p>2ã€æ ¹æ®ç”Ÿæˆçš„éªŒè¯ç ç”Ÿæˆä¸€ä¸ªå›¾ç‰‡å¹¶è¿”å›ç»™é¡µé¢</p><p>3ã€ç»™ç”Ÿæˆçš„éªŒè¯ç åˆ†é…ä¸€ä¸ª keyï¼Œå°† key å’ŒéªŒè¯ç ä¸€åŒå­˜å…¥ç¼“å­˜ã€‚è¿™ä¸ª key å’Œå›¾ç‰‡ä¸€åŒè¿”å›ç»™é¡µé¢ã€‚</p><p>4ã€ç”¨æˆ·è¾“å…¥éªŒè¯ç ï¼Œè¿åŒ key ä¸€åŒæäº¤è‡³è®¤è¯æœåŠ¡ã€‚</p><p>5ã€è®¤è¯æœåŠ¡æ‹¿ key å’Œè¾“å…¥çš„éªŒè¯ç è¯·æ±‚éªŒè¯ç æœåŠ¡å»æ ¡éªŒ</p><p>6ã€éªŒè¯ç æœåŠ¡æ ¹æ® key ä»ç¼“å­˜å–å‡ºæ­£ç¡®çš„éªŒè¯ç å’Œç”¨æˆ·è¾“å…¥çš„éªŒè¯ç è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒåˆ™æ ¡éªŒé€šè¿‡ï¼Œå¦åˆ™ä¸é€šè¿‡ã€‚</p><p><img src="/MyBlog/assets/image-20230604182219723-56f9a38b.png" alt="image-20230604182219723"></p><p>æ ¹æ®æ¥å£åˆ†æï¼ŒéªŒè¯ç æœåŠ¡æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>checkcode<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>base<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">RestResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>checkcode<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">CheckCodeParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>checkcode<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">CheckCodeResultDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>checkcode<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CheckCodeService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiImplicitParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiImplicitParams</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> éªŒè¯ç æœåŠ¡æ¥å£
 * <span class="token keyword">@date</span> 2022/9/29 18:39
 */</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;éªŒè¯ç æœåŠ¡æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CheckCodeController</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;ç”ŸæˆéªŒè¯ä¿¡æ¯&quot;</span><span class="token punctuation">,</span> notes<span class="token operator">=</span><span class="token string">&quot;ç”ŸæˆéªŒè¯ä¿¡æ¯&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pic&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CheckCodeResultDto</span> <span class="token function">generatePicCheckCode</span><span class="token punctuation">(</span><span class="token class-name">CheckCodeParamsDto</span> checkCodeParamsDto<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;æ ¡éªŒ&quot;</span><span class="token punctuation">,</span> notes<span class="token operator">=</span><span class="token string">&quot;æ ¡éªŒ&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiImplicitParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;ä¸šåŠ¡åç§°&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> dataType <span class="token operator">=</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span> paramType<span class="token operator">=</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;éªŒè¯key&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> dataType <span class="token operator">=</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span> paramType<span class="token operator">=</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;éªŒè¯ç &quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> dataType <span class="token operator">=</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span> paramType<span class="token operator">=</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/verify&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1ã€ç”ŸæˆéªŒè¯ç æ¥å£</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### ç”³è¯·éªŒè¯ç 
POST {{checkcode_host}}/checkcode/pic

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æ ¡éªŒéªŒè¯ç æ¥å£</p><p>æ ¹æ®ç”ŸæˆéªŒè¯ç è¿”å›çš„ key ä»¥åŠæ—¥å¿—ä¸­è¾“å‡ºæ­£ç¡®çš„éªŒè¯ç å»æµ‹è¯•ã€‚</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>#### æ ¡éªŒéªŒè¯ç 
POST {{checkcode_host}}/checkcode/verify?key=checkcode4506b95bddbe46cdb0d56810b747db1b&amp;code=70dl

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-è´¦å·å¯†ç è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_3-5-è´¦å·å¯†ç è®¤è¯" aria-hidden="true">#</a> <strong>3.5 è´¦å·å¯†ç è®¤è¯</strong></h3><h4 id="_3-5-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_3-5-1-éœ€æ±‚åˆ†æ" aria-hidden="true">#</a> <strong>3.5.1 éœ€æ±‚åˆ†æ</strong></h4><p>åˆ°ç›®å‰ä¸ºæ­¢è´¦å·å’Œå¯†ç è®¤è¯æ‰€éœ€è¦çš„æŠ€æœ¯ã€ç»„ä»¶éƒ½å·²å¼€å‘å®Œæ¯•ï¼Œä¸‹è¾¹å®ç°è´¦å·å¯†ç è®¤è¯ï¼Œè¾“å‡ºå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604182307943-c773f12f.png" alt="image-20230604182307943"></p><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604182312498-a88e30c7.png" alt="image-20230604182312498"></p><h4 id="_3-5-2-è´¦å·å¯†ç è®¤è¯å¼€å‘" tabindex="-1"><a class="header-anchor" href="#_3-5-2-è´¦å·å¯†ç è®¤è¯å¼€å‘" aria-hidden="true">#</a> <strong>3.5.2 è´¦å·å¯†ç è®¤è¯å¼€å‘</strong></h4><p>1ã€åœ¨è®¤è¯æœåŠ¡å®šä¹‰è¿œç¨‹è°ƒç”¨éªŒè¯ç æœåŠ¡çš„æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>feignclient</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/20 20:29
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;checkcode&quot;</span><span class="token punctuation">,</span>fallbackFactory <span class="token operator">=</span> <span class="token class-name">CheckCodeClientFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/checkcode&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CheckCodeClient</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/verify&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CheckCodeClientFactory:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CheckCodeClientFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CheckCodeClient</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CheckCodeClient</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CheckCodeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨éªŒè¯ç æœåŠ¡ç†”æ–­å¼‚å¸¸:{}&quot;</span><span class="token punctuation">,</span> throwable<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨ç±»æ·»åŠ ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;com.xuecheng.*.feignclient&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶å¼•å…¥ feign-dev.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> feign<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yaml
  <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
  <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å®Œå–„ PasswordAuthServiceImpl</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>feignclient<span class="token punctuation">.</span></span><span class="token class-name">CheckCodeClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">XcUserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">AuthParamsDto</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>model<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token class-name">XcUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AuthService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>bcrypt<span class="token punctuation">.</span></span><span class="token class-name">BCryptPasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>password<span class="token punctuation">.</span></span><span class="token class-name">PasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> è´¦å·å¯†ç è®¤è¯
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@date</span> 2022/9/29 12:12
 * <span class="token keyword">@version</span> 1.0
 */</span>
 <span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;password_authservice&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PasswordAuthServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthService</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">XcUserMapper</span> xcUserMapper<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Autowired</span>
 <span class="token class-name">CheckCodeClient</span> checkCodeClient<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">XcUser</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">AuthParamsDto</span> authParamsDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">//æ ¡éªŒéªŒè¯ç </span>
  <span class="token class-name">String</span> checkcode <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getCheckcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> checkcodekey <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getCheckcodekey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>checkcodekey<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>checkcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;éªŒè¯ç ä¸ºç©º&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
  <span class="token class-name">Boolean</span> verify <span class="token operator">=</span> checkCodeClient<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>checkcodekey<span class="token punctuation">,</span> checkcode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>verify<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;éªŒè¯ç è¾“å…¥é”™è¯¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//è´¦å·</span>
  <span class="token class-name">String</span> username <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">XcUser</span> user <span class="token operator">=</span> xcUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcUser</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;è´¦å·ä¸å­˜åœ¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//æ ¡éªŒå¯†ç </span>
  <span class="token comment">//å–å‡ºæ•°æ®åº“å­˜å‚¨çš„æ­£ç¡®å¯†ç </span>
  <span class="token class-name">String</span> passwordDb  <span class="token operator">=</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> passwordForm <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> matches <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>passwordForm<span class="token punctuation">,</span> passwordDb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>matches<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> user<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°æŠ€å·§ï¼šç›®å‰è´¦å·å¯†ç æ–¹å¼æ·»åŠ äº†éªŒè¯ç æ ¡éªŒï¼Œä¸ºäº†åæœŸè·å–ä»¤ç‰Œæ–¹ä¾¿å¯ä»¥é‡æ–°å®šä¹‰ä¸€ä¸ªä¸éœ€è¦éªŒè¯ç æ ¡éªŒçš„è®¤è¯ç±» AuthService ï¼ŒAuthService ä¸­å»æ‰éªŒè¯ç çš„æ ¡éªŒï¼Œæ–¹ä¾¿ç”Ÿæˆä»¤ç‰Œã€‚</p><h4 id="_3-5-3-è´¦å·å¯†ç è®¤è¯æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-5-3-è´¦å·å¯†ç è®¤è¯æµ‹è¯•" aria-hidden="true">#</a> <strong>3.5.3 è´¦å·å¯†ç è®¤è¯æµ‹è¯•</strong></h4><p>1ã€ä½¿ç”¨æµè§ˆå™¨è®¿é—® http://www.51xuecheng.cn/sign.html</p><p><img src="/MyBlog/assets/image-20230604182430644-cd873d6b.png" alt="image-20230604182430644"></p><p>2ã€é¦–å…ˆæµ‹è¯•éªŒè¯ç ï¼Œåˆ†åˆ«è¾“å…¥æ­£ç¡®çš„éªŒè¯ç å’Œé”™è¯¯çš„éªŒè¯ç è¿›è¡Œæµ‹è¯•</p><p>3ã€è¾“å…¥æ­£ç¡®çš„è´¦å·å¯†ç å’Œé”™è¯¯çš„è´¦å·å¯†ç è¿›è¡Œæµ‹è¯•</p><p>ç™»å½•æˆåŠŸå°† jwt ä»¤ç‰Œå­˜å‚¨ cookie.</p><p>4ã€æµ‹è¯•è‡ªåŠ¨ç™»å½•</p><p>å‹¾é€‰è‡ªåŠ¨ç™»å½• cookie ç”Ÿæˆæ—¶é—´ä¸º 30 å¤©ï¼Œä¸å‹¾é€‰è‡ªåŠ¨ç™»å½•å…³é—­æµè§ˆå™¨çª—å£åè‡ªåŠ¨åˆ é™¤ cookieã€‚</p><h2 id="_4-å¾®ä¿¡æ‰«ç ç™»å½•" tabindex="-1"><a class="header-anchor" href="#_4-å¾®ä¿¡æ‰«ç ç™»å½•" aria-hidden="true">#</a> <strong>4 å¾®ä¿¡æ‰«ç ç™»å½•</strong></h2><h3 id="_4-1-æ¥å…¥è§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#_4-1-æ¥å…¥è§„èŒƒ" aria-hidden="true">#</a> <strong>4.1 æ¥å…¥è§„èŒƒ</strong></h3><h4 id="_4-1-1-æ¥å…¥æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-1-1-æ¥å…¥æµç¨‹" aria-hidden="true">#</a> <strong>4.1.1 æ¥å…¥æµç¨‹</strong></h4><p>å¾®ä¿¡æ‰«ç ç™»å½•åŸºäº OAuth2 åè®®çš„æˆæƒç æ¨¡å¼ï¼Œ</p><p>æ¥å£æ–‡æ¡£ï¼š</p><p>https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604182439594-3a6603ff.png" alt="image-20230604182439594"></p><p>ç¬¬ä¸‰æ–¹åº”ç”¨è·å– access_token ä»¤ç‰Œåå³å¯è¯·æ±‚å¾®ä¿¡è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼ŒæˆåŠŸè·å–åˆ°ç”¨æˆ·çš„ä¿¡æ¯è¡¨ç¤ºç”¨æˆ·åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨è®¤è¯æˆåŠŸã€‚</p><h4 id="_4-1-2-è¯·æ±‚è·å–æˆæƒç " tabindex="-1"><a class="header-anchor" href="#_4-1-2-è¯·æ±‚è·å–æˆæƒç " aria-hidden="true">#</a> <strong>4.1.2 è¯·æ±‚è·å–æˆæƒç </strong></h4><p>ç¬¬ä¸‰æ–¹ä½¿ç”¨ç½‘ç«™åº”ç”¨æˆæƒç™»å½•å‰è¯·æ³¨æ„å·²è·å–ç›¸åº”ç½‘é¡µæˆæƒä½œç”¨åŸŸï¼ˆscope=snsapi_loginï¼‰ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨ PC ç«¯æ‰“å¼€ä»¥ä¸‹é“¾æ¥ï¼š https://open.weixin.qq.com/connect/qrconnect?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect è‹¥æç¤ºâ€œè¯¥é“¾æ¥æ— æ³•è®¿é—®â€ï¼Œè¯·æ£€æŸ¥å‚æ•°æ˜¯å¦å¡«å†™é”™è¯¯ï¼Œå¦‚ redirect_uri çš„åŸŸåä¸å®¡æ ¸æ—¶å¡«å†™çš„æˆæƒåŸŸåä¸ä¸€è‡´æˆ– scope ä¸ä¸º snsapi_loginã€‚</p><p><strong>å‚æ•°è¯´æ˜</strong></p><p><img src="/MyBlog/assets/image-20230604182444308-55d5941e.png" alt="image-20230604182444308"></p><p><strong>è¿”å›è¯´æ˜</strong></p><p>ç”¨æˆ·å…è®¸æˆæƒåï¼Œå°†ä¼šé‡å®šå‘åˆ° redirect_uri çš„ç½‘å€ä¸Šï¼Œå¹¶ä¸”å¸¦ä¸Š code å’Œ state å‚æ•°</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>redirect_uri?code=CODE<span class="token punctuation">&amp;</span>state=STATE

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è‹¥ç”¨æˆ·ç¦æ­¢æˆæƒï¼Œåˆ™ä¸ä¼šå‘ç”Ÿé‡å®šå‘ã€‚</p><p>ç™»å½•ä¸€å·åº—ç½‘ç«™åº”ç”¨ https://test.yhd.com/wechat/login.do æ‰“å¼€åï¼Œä¸€å·åº—ä¼šç”Ÿæˆ state å‚æ•°ï¼Œè·³è½¬åˆ°https://open.weixin.qq.com/connect/qrconnect?appid=wxbdc5610cc59c1631&amp;redirect_uri=https%3A%2F%2Fpassport.yhd.com%2Fwechat%2Fcallback.do&amp;response_type=code&amp;scope=snsapi_login&amp;state=3d6be0a4035d839573b04816624a415e#wechat_redirectå¾®ä¿¡ç”¨æˆ·ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç å¹¶ä¸”ç¡®è®¤ç™»å½•åï¼ŒPCç«¯ä¼šè·³è½¬åˆ°https://test.yhd.com/wechat/callback.do?code=CODE&amp;state=3d6be0a40sssssxxxxx6624a415eä¸ºäº†æ»¡è¶³ç½‘ç«™æ›´å®šåˆ¶åŒ–çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ç¬¬äºŒç§è·å– code çš„æ–¹å¼ï¼Œæ”¯æŒç½‘ç«™å°†å¾®ä¿¡ç™»å½•äºŒç»´ç å†…åµŒåˆ°è‡ªå·±é¡µé¢ä¸­ï¼Œç”¨æˆ·ä½¿ç”¨å¾®ä¿¡æ‰«ç æˆæƒåé€šè¿‡ JS å°† code è¿”å›ç»™ç½‘ç«™ã€‚ JS å¾®ä¿¡ç™»å½•ä¸»è¦ç”¨é€”ï¼šç½‘ç«™å¸Œæœ›ç”¨æˆ·åœ¨ç½‘ç«™å†…å°±èƒ½å®Œæˆç™»å½•ï¼Œæ— éœ€è·³è½¬åˆ°å¾®ä¿¡åŸŸä¸‹ç™»å½•åå†è¿”å›ï¼Œæå‡å¾®ä¿¡ç™»å½•çš„æµç•…æ€§ä¸æˆåŠŸç‡ã€‚ ç½‘ç«™å†…åµŒäºŒç»´ç å¾®ä¿¡ç™»å½• JS å®ç°åŠæ³•ï¼š</p><p>æ­¥éª¤ 1ï¼šåœ¨é¡µé¢ä¸­å…ˆå¼•å…¥å¦‚ä¸‹ JS æ–‡ä»¶ï¼ˆæ”¯æŒ httpsï¼‰ï¼š</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¥éª¤ 2ï¼šåœ¨éœ€è¦ä½¿ç”¨å¾®ä¿¡ç™»å½•çš„åœ°æ–¹å®ä¾‹ä»¥ä¸‹ JS å¯¹è±¡ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WxLogin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">self_redirect</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;login_container&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">appid</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">redirect_uri</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">href</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/MyBlog/assets/image-20230604182545966-83a300ba.png" alt="image-20230604182545966"></p><p><img src="/MyBlog/assets/image-20230604182549928-5f501d7d.png" alt="image-20230604182549928"></p><h4 id="_4-1-3-é€šè¿‡-code-è·å–-access-token" tabindex="-1"><a class="header-anchor" href="#_4-1-3-é€šè¿‡-code-è·å–-access-token" aria-hidden="true">#</a> <strong>4.1.3 é€šè¿‡ code è·å– access_token</strong></h4><p>é€šè¿‡ code è·å– access_token</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">https</span><span class="token punctuation">:</span><span class="token header-value">//api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="/MyBlog/assets/image-20230604182621304-848d24e6.png" alt="image-20230604182621304"></p><p><strong>è¿”å›è¯´æ˜</strong></p><p>æ­£ç¡®çš„è¿”å›ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ACCESS_TOKEN&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;expires_in&quot;</span><span class="token operator">:</span> <span class="token number">7200</span><span class="token punctuation">,</span>
  <span class="token property">&quot;refresh_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;REFRESH_TOKEN&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;openid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OPENID&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCOPE&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;unionid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;o6_bmasdasdsad6_2sgVt7hMZOPfL&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å‚æ•°è¯´æ˜</strong></p><p><img src="/MyBlog/assets/image-20230604182646345-c8866982.png" alt="image-20230604182646345"></p><p>é”™è¯¯è¿”å›æ ·ä¾‹ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;errcode&quot;</span><span class="token operator">:</span> <span class="token number">40029</span><span class="token punctuation">,</span> <span class="token property">&quot;errmsg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;invalid code&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_4-1-4-é€šè¿‡-access-token-è°ƒç”¨æ¥å£" tabindex="-1"><a class="header-anchor" href="#_4-1-4-é€šè¿‡-access-token-è°ƒç”¨æ¥å£" aria-hidden="true">#</a> <strong>4.1.4 é€šè¿‡ access_token è°ƒç”¨æ¥å£</strong></h4><p>è·å– access_token åï¼Œè¿›è¡Œæ¥å£è°ƒç”¨ï¼Œæœ‰ä»¥ä¸‹å‰æï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>access_tokenæœ‰æ•ˆä¸”æœªè¶…æ—¶ï¼›
å¾®ä¿¡ç”¨æˆ·å·²æˆæƒç»™ç¬¬ä¸‰æ–¹åº”ç”¨å¸å·ç›¸åº”æ¥å£ä½œç”¨åŸŸï¼ˆscopeï¼‰ã€‚

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºæ¥å£ä½œç”¨åŸŸï¼ˆscopeï¼‰ï¼Œèƒ½è°ƒç”¨çš„æ¥å£æœ‰ä»¥ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604182722906-50824e4d.png" alt="image-20230604182722906"></p><p>å…¶ä¸­ snsapi_base å±äºåŸºç¡€æ¥å£ï¼Œè‹¥åº”ç”¨å·²æ‹¥æœ‰å…¶å®ƒ scope æƒé™ï¼Œåˆ™é»˜è®¤æ‹¥æœ‰ snsapi_base çš„æƒé™ã€‚ä½¿ç”¨ snsapi_base å¯ä»¥è®©ç§»åŠ¨ç«¯ç½‘é¡µæˆæƒç»•è¿‡è·³è½¬æˆæƒç™»å½•é¡µè¯·æ±‚ç”¨æˆ·æˆæƒçš„åŠ¨ä½œï¼Œç›´æ¥è·³è½¬ç¬¬ä¸‰æ–¹ç½‘é¡µå¸¦ä¸Šæˆæƒä¸´æ—¶ç¥¨æ®ï¼ˆcodeï¼‰ï¼Œä½†ä¼šä½¿å¾—ç”¨æˆ·å·²æˆæƒä½œç”¨åŸŸï¼ˆscopeï¼‰ä»…ä¸º snsapi_baseï¼Œä»è€Œå¯¼è‡´æ— æ³•è·å–åˆ°éœ€è¦ç”¨æˆ·æˆæƒæ‰å…è®¸è·å¾—çš„æ•°æ®å’ŒåŸºç¡€åŠŸèƒ½ã€‚ æ¥å£è°ƒç”¨æ–¹æ³•å¯æŸ¥é˜…<a href="https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Authorized_Interface_Calling_UnionID.html" target="_blank" rel="noopener noreferrer">ã€Šå¾®ä¿¡æˆæƒå…³ç³»æ¥å£è°ƒç”¨æŒ‡å—ã€‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£æ–‡æ¡£ï¼šhttps://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Authorized_Interface_Calling_UnionID.html</p><p>æ¥å£åœ°å€</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>httpè¯·æ±‚æ–¹å¼: GET
<span class="token header"><span class="token header-name keyword">https</span><span class="token punctuation">:</span><span class="token header-value">//api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&amp;openid=OPENID</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604182747702-88e26e49.png" alt="image-20230604182747702"></p><p>å“åº”ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;openid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OPENID&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;nickname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NICKNAME&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;province&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PROVINCE&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CITY&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;country&quot;</span><span class="token operator">:</span> <span class="token string">&quot;COUNTRY&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;headimgurl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://thirdwx.qlogo.cn/mmopen/g3MonUZtNHkdmzicIlibx6iaFqAc56vxLSUfpb6n5WKSYVY0ChQKkiaJSgQ1dZuTOgvLLrhJbERQQ4eMsv84eavHiaiceqxibJxCfHe/0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;privilege&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;PRIVILEGE1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PRIVILEGE2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;unionid&quot;</span><span class="token operator">:</span> <span class="token string">&quot; o6_bmasdasdsad6_2sgVt7hMZOPfL&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>
å‚æ•°            è¯´æ˜
openid        æ™®é€šç”¨æˆ·çš„æ ‡è¯†ï¼Œå¯¹å½“å‰å¼€å‘è€…å¸å·å”¯ä¸€
nickname        æ™®é€šç”¨æˆ·æ˜µç§°
sex            æ™®é€šç”¨æˆ·æ€§åˆ«ï¼Œ1ä¸ºç”·æ€§ï¼Œ2ä¸ºå¥³æ€§
province        æ™®é€šç”¨æˆ·ä¸ªäººèµ„æ–™å¡«å†™çš„çœä»½
city            æ™®é€šç”¨æˆ·ä¸ªäººèµ„æ–™å¡«å†™çš„åŸå¸‚
country        å›½å®¶ï¼Œå¦‚ä¸­å›½ä¸ºCN
headimgurl        ç”¨æˆ·å¤´åƒï¼Œæœ€åä¸€ä¸ªæ•°å€¼ä»£è¡¨æ­£æ–¹å½¢å¤´åƒå¤§å°ï¼ˆæœ‰0ã€46ã€64ã€96ã€132æ•°å€¼å¯é€‰ï¼Œ0ä»£è¡¨640*640æ­£æ–¹å½¢å¤´åƒï¼‰ï¼Œç”¨æˆ·æ²¡æœ‰å¤´åƒæ—¶è¯¥é¡¹ä¸ºç©º
privilege        ç”¨æˆ·ç‰¹æƒä¿¡æ¯ï¼Œjsonæ•°ç»„ï¼Œå¦‚å¾®ä¿¡æ²ƒå¡ç”¨æˆ·ä¸ºï¼ˆchinaunicomï¼‰
unionid          ç”¨æˆ·ç»Ÿä¸€æ ‡è¯†ã€‚é’ˆå¯¹ä¸€ä¸ªå¾®ä¿¡å¼€æ”¾å¹³å°å¸å·ä¸‹çš„åº”ç”¨ï¼ŒåŒä¸€ç”¨æˆ·çš„ unionid æ˜¯å”¯ä¸€çš„ã€‚

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-å‡†å¤‡å¼€å‘ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_4-2-å‡†å¤‡å¼€å‘ç¯å¢ƒ" aria-hidden="true">#</a> <strong>4.2 å‡†å¤‡å¼€å‘ç¯å¢ƒ</strong></h3><h4 id="_4-2-1-æ·»åŠ åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_4-2-1-æ·»åŠ åº”ç”¨" aria-hidden="true">#</a> <strong>4.2.1 æ·»åŠ åº”ç”¨</strong></h4><p>1ã€æ³¨å†Œå¾®ä¿¡å¼€æ”¾å¹³å°</p><p>https://open.weixin.qq.com/</p><p>2ã€æ·»åŠ åº”ç”¨</p><p>è¿›å…¥ç½‘ç«™åº”ç”¨ï¼Œæ·»åŠ åº”ç”¨</p><p><img src="/MyBlog/assets/image-20230604182816152-e136a2b4.png" alt="image-20230604182816152"></p><p>3ã€æ·»åŠ åº”ç”¨éœ€è¦æŒ‡å®šä¸€ä¸ªå¤–ç½‘åŸŸåä½œä¸ºå¾®ä¿¡å›è°ƒåŸŸå</p><p>å®¡æ ¸é€šè¿‡åï¼Œç”Ÿæˆ app å¯†é’¥ã€‚</p><p>æœ€ç»ˆè·å– appID å’Œ AppSecret</p><h4 id="_4-2-2-å†…ç½‘ç©¿é€" tabindex="-1"><a class="header-anchor" href="#_4-2-2-å†…ç½‘ç©¿é€" aria-hidden="true">#</a> <strong>4.2.2 å†…ç½‘ç©¿é€</strong></h4><p>æˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒåœ¨å±€åŸŸç½‘ï¼Œå¾®ä¿¡å›è°ƒæŒ‡å‘ä¸€ä¸ªå…¬ç½‘åŸŸåã€‚</p><blockquote><p>å¦‚ä½•è®©å¾®ä¿¡å›è°ƒè¯·æ±‚è‡³æˆ‘ä»¬çš„å¼€å‘è®¡ç®—æœºä¸Šå‘¢ï¼Ÿ</p></blockquote><p>å¯ä»¥ä½¿ç”¨å†…ç½‘ç©¿é€æŠ€æœ¯ï¼Œ<code>ä»€ä¹ˆæ˜¯å†…ç½‘ç©¿é€ï¼Ÿ</code></p><p>å†…ç½‘ç©¿é€ç®€å•æ¥è¯´å°±æ˜¯å°†å†…ç½‘å¤–ç½‘é€šè¿‡éš§é“æ‰“é€š,è®©å†…ç½‘çš„æ•°æ®è®©å¤–ç½‘å¯ä»¥è·å–ã€‚æ¯”å¦‚å¸¸ç”¨çš„åŠå…¬å®¤è½¯ä»¶ç­‰ï¼Œä¸€èˆ¬åœ¨åŠå…¬å®¤æˆ–å®¶é‡Œï¼Œé€šè¿‡æ‹¨å·ä¸Šç½‘ï¼Œè¿™æ ·åŠå…¬è½¯ä»¶åªæœ‰åœ¨æœ¬åœ°çš„å±€åŸŸç½‘ä¹‹å†…æ‰èƒ½è®¿é—®ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæ˜¯æ‰‹æœºä¸Šï¼Œæˆ–è€…å…¬å¸å¤–åœ°çš„åŠå…¬äººå‘˜ï¼Œå¦‚ä½•è®¿é—®åˆ°åŠå…¬è½¯ä»¶å‘¢ï¼Ÿè¿™å°±éœ€è¦å†…ç½‘ç©¿é€å·¥å…·äº†ã€‚å¼€å¯éš§é“ä¹‹åï¼Œç½‘ç©¿é€å·¥å…·ä¼šåˆ†é…ä¸€ä¸ªä¸“å±åŸŸå/ç«¯å£,åŠå…¬è½¯ä»¶å°±å·²ç»åœ¨å…¬ç½‘ä¸Šäº†,åœ¨å¤–åœ°çš„åŠå…¬äººå‘˜å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æ„‰å¿«çš„è®¿é—®åŠå…¬è½¯ä»¶äº†~~</p><p><img src="/MyBlog/assets/image-20230604182827483-3d64a7c8.png" alt="image-20230604182827483"></p><p>1ã€åœ¨å†…ç½‘ç©¿é€æœåŠ¡å™¨ä¸Šå¼€é€šéš§é“ï¼Œé…ç½®å¤–ç½‘åŸŸåï¼Œé…ç½®ç©¿é€å†…ç½‘çš„ç«¯å£å³æœ¬åœ°ç”µè„‘ä¸Šçš„ç«¯å£ã€‚</p><p><img src="/MyBlog/assets/image-20230604182831376-9990bb86.png" alt="image-20230604182831376"></p><p>è¿™é‡Œæˆ‘ä»¬é…ç½®è®¤è¯æœåŠ¡ç«¯å£ï¼Œæœ€ç»ˆå®ç°é€šè¿‡å¤–ç½‘åŸŸåè®¿é—®æœ¬åœ°è®¤è¯æœåŠ¡ã€‚</p><p>2ã€åœ¨æœ¬åœ°ç”µè„‘ä¸Šå®‰è£…å†…ç½‘ç©¿é€çš„å·¥å…·ï¼Œå·¥å…·ä¸Šé…ç½®å†…ç½‘ç©¿é€æœåŠ¡å™¨éš§é“ tokenã€‚</p><p>å¸‚é¢ä¸Šåšå†…ç½‘ç©¿é€çš„å•†å®¶å¾ˆå¤šï¼Œéœ€è¦æ—¶å¯ä»¥æŸ¥é˜…èµ„æ–™äº†è§£ä¸‹ã€‚</p><h3 id="_4-3-æ¥å…¥å¾®ä¿¡ç™»å½•" tabindex="-1"><a class="header-anchor" href="#_4-3-æ¥å…¥å¾®ä¿¡ç™»å½•" aria-hidden="true">#</a> <strong>4.3 æ¥å…¥å¾®ä¿¡ç™»å½•</strong></h3><h4 id="_4-3-1-æ¥å…¥åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-3-1-æ¥å…¥åˆ†æ" aria-hidden="true">#</a> <strong>4.3.1 æ¥å…¥åˆ†æ</strong></h4><p>æ ¹æ® OAuth2 åè®®æˆæƒç æµç¨‹ï¼Œç»“åˆæœ¬é¡¹ç›®è‡ªèº«ç‰¹ç‚¹ï¼Œåˆ†ææ¥å…¥å¾®ä¿¡æ‰«ç ç™»å½•çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604182837011-01e03588.png" alt="image-20230604182837011"></p><p>æœ¬é¡¹ç›®è®¤è¯æœåŠ¡éœ€è¦åšå“ªäº›äº‹ï¼Ÿ</p><p>1ã€éœ€è¦å®šä¹‰æ¥å£æ¥æ”¶å¾®ä¿¡ä¸‹å‘çš„æˆæƒç ã€‚</p><p>2ã€æ”¶åˆ°æˆæƒç è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·ä»¤ç‰Œã€‚</p><p>3ã€ç”³è¯·åˆ°ä»¤ç‰Œè°ƒç”¨å¾®ä¿¡è·å–ç”¨æˆ·ä¿¡æ¯</p><p>4ã€è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸå°†å…¶å†™å…¥æœ¬é¡¹ç›®ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“ã€‚</p><p>5ã€æœ€åé‡å®šå‘åˆ°æµè§ˆå™¨è‡ªåŠ¨ç™»å½•ã€‚</p><h4 id="_4-3-2-å®šä¹‰æ¥å£" tabindex="-1"><a class="header-anchor" href="#_4-3-2-å®šä¹‰æ¥å£" aria-hidden="true">#</a> <strong>4.3.2 å®šä¹‰æ¥å£</strong></h4><p>å‚è€ƒæ¥å£è§„èŒƒä¸­â€œè¯·æ±‚è·å–æˆæƒç â€ å®šä¹‰æ¥æ”¶å¾®ä¿¡ä¸‹å‘çš„æˆæƒç æ¥å£ï¼Œ</p><p>å®šä¹‰ WxLoginController ç±»ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxLoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/wxLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">wxLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¾®ä¿¡æ‰«ç å›è°ƒ,code:{},state:{}&quot;</span><span class="token punctuation">,</span>code<span class="token punctuation">,</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¯·æ±‚å¾®ä¿¡ç”³è¯·ä»¤ç‰Œï¼Œæ‹¿åˆ°ä»¤ç‰ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å†™å…¥æœ¬é¡¹ç›®æ•°æ®åº“</span>
        <span class="token class-name">XcUser</span> xcUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æš‚æ—¶ç¡¬ç¼–å†™ï¼Œç›®çš„æ˜¯è°ƒè¯•ç¯å¢ƒ</span>
        xcUser<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xcUser<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://www.51xuecheng.cn/error.html&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> xcUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://www.51xuecheng.cn/sign.html?username=&quot;</span><span class="token operator">+</span>username<span class="token operator">+</span><span class="token string">&quot;&amp;authType=wx&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰å¾®ä¿¡è®¤è¯çš„ service</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xuecheng<span class="token punctuation">.</span>ucenter<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> å¾®ä¿¡æ‰«ç è®¤è¯
 * <span class="token keyword">@date</span> 2022/9/29 12:12
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;wx_authservice&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxAuthServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">XcUserMapper</span> xcUserMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">XcUserExt</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">AuthParamsDto</span> authParamsDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//è´¦å·</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> authParamsDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XcUser</span> user <span class="token operator">=</span> xcUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcUser</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;è´¦å·ä¸å­˜åœ¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">XcUserExt</span> xcUserExt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcUserExt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>xcUserExt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> xcUserExt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-3-æ¥å£ç¯å¢ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-3-3-æ¥å£ç¯å¢ƒæµ‹è¯•" aria-hidden="true">#</a> <strong>4.3.3 æ¥å£ç¯å¢ƒæµ‹è¯•</strong></h4><p>æ¥å£å®šä¹‰å¥½ä¸‹è¾¹è¿›è¡Œæµ‹è¯•ä¸‹ï¼Œä¸»è¦ç›®çš„æ˜¯æµ‹è¯•æ¥å£è°ƒåº¦çš„ç¯å¢ƒã€‚</p><p>1ã€å¯åŠ¨å†…ç½‘ç©¿é€å·¥å…·</p><p>2ã€åœ¨/wxLogin æ¥å£ä¸­æ‰“æ–­ç‚¹</p><p>3ã€æ‰“å¼€å‰ç«¯å¾®ä¿¡æ‰«ç é¡µé¢</p><p><img src="/MyBlog/assets/image-20230604182911877-6b809596.png" alt="image-20230604182911877"></p><p>ç‚¹å‡»å¾®ä¿¡å›¾æ ‡æ‰“å¼€äºŒç»´ç </p><p><img src="/MyBlog/assets/image-20230604182917079-8d0dc706.png" alt="image-20230604182917079"></p><p>ç”¨æˆ·æ‰«ç ï¼Œç¡®è®¤æˆæƒ</p><p>æ­¤æ—¶æ­£å¸¸è¿›å…¥ /wxLogin æ–¹æ³•ï¼Œæœ€åè·³è½¬åˆ°http://www.51xuecheng.cn/sign.html?username=t1&amp;authType=wxã€‚</p><h4 id="_4-3-4-æ¥å…¥å¾®ä¿¡è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_4-3-4-æ¥å…¥å¾®ä¿¡è®¤è¯" aria-hidden="true">#</a> <strong>4.3.4 æ¥å…¥å¾®ä¿¡è®¤è¯</strong></h4><p>æ¥ä¸‹æ¥è¯·æ±‚å¾®ä¿¡ç”³è¯·ä»¤ç‰Œã€‚</p><p>1ã€ä½¿ç”¨ restTemplate è¯·æ±‚å¾®ä¿¡ï¼Œé…ç½® RestTemplate bean</p><p>åœ¨å¯åŠ¨ç±»é…ç½® restTemplate</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">RestTemplate</span> restTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OkHttp3ClientHttpRequestFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  restTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å®šä¹‰ä¸å¾®ä¿¡è®¤è¯çš„ service æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> Mr.M
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@description</span> å¾®ä¿¡è®¤è¯æ¥å£
 * <span class="token keyword">@date</span> 2023/2/21 22:15
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WxAuthService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">XcUser</span> <span class="token function">wxAuth</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€ä¸‹è¾¹åœ¨ controller ä¸­è°ƒç”¨ wxAuth æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxLoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">WxAuthService</span> wxAuthService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/wxLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">wxLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¾®ä¿¡æ‰«ç å›è°ƒ,code:{},state:{}&quot;</span><span class="token punctuation">,</span>code<span class="token punctuation">,</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¯·æ±‚å¾®ä¿¡ç”³è¯·ä»¤ç‰Œï¼Œæ‹¿åˆ°ä»¤ç‰ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å†™å…¥æœ¬é¡¹ç›®æ•°æ®åº“</span>
        <span class="token class-name">XcUser</span> xcUser <span class="token operator">=</span> wxAuthService<span class="token punctuation">.</span><span class="token function">wxAuth</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xcUser<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://www.51xuecheng.cn/error.html&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> xcUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://www.51xuecheng.cn/sign.html?username=&quot;</span><span class="token operator">+</span>username<span class="token operator">+</span><span class="token string">&quot;&amp;authType=wx&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/MyBlog/assets/image-20230608211738183-098a5993.png" alt="image-20230608211738183"></p><p>é…ç½® appid å’Œ ç§˜é’¥</p><p>4ã€åœ¨ WxAuthService çš„ wxAuth æ–¹æ³•ä¸­å®ç°ç”³è¯·ä»¤ç‰Œã€æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ç­‰å†…å®¹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;wx_authservice&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxAuthServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthService</span><span class="token punctuation">,</span> <span class="token class-name">WxAuthService</span> <span class="token punctuation">{</span>


<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${weixin.appid}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> appid<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${weixin.secret}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> secret<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">XcUser</span> <span class="token function">wxAuth</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">//æ”¶åˆ°codeè°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> access_token_map <span class="token operator">=</span> <span class="token function">getAccess_token</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>access_token_map<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>access_token_map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> openid <span class="token operator">=</span> access_token_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;openid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> access_token <span class="token operator">=</span> access_token_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ‹¿access_tokenæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userinfo <span class="token operator">=</span> <span class="token function">getUserinfo</span><span class="token punctuation">(</span>access_token<span class="token punctuation">,</span> openid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>userinfo<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ·»åŠ ç”¨æˆ·åˆ°æ•°æ®åº“</span>
    <span class="token class-name">XcUser</span> xcUser <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> xcUser<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * ç”³è¯·è®¿é—®ä»¤ç‰Œ,å“åº”ç¤ºä¾‹
 <span class="token punctuation">{</span>
 &quot;access_token&quot;:&quot;ACCESS_TOKEN&quot;,
 &quot;expires_in&quot;:7200,
 &quot;refresh_token&quot;:&quot;REFRESH_TOKEN&quot;,
 &quot;openid&quot;:&quot;OPENID&quot;,
 &quot;scope&quot;:&quot;SCOPE&quot;,
 &quot;unionid&quot;: &quot;o6_bmasdasdsad6_2sgVt7hMZOPfL&quot;
 <span class="token punctuation">}</span>
*/</span>
<span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAccess_token</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> wxUrl_template <span class="token operator">=</span> <span class="token string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=%s&amp;secret=%s&amp;code=%s&amp;grant_type=authorization_code&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//è¯·æ±‚å¾®ä¿¡åœ°å€</span>
    <span class="token class-name">String</span> wxUrl <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>wxUrl_template<span class="token punctuation">,</span> appid<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token, url:{}&quot;</span><span class="token punctuation">,</span> wxUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exchange <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>wxUrl<span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> result <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token: è¿”å›å€¼:{}&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> resultMap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
 <span class="token punctuation">{</span>
 &quot;openid&quot;:&quot;OPENID&quot;,
 &quot;nickname&quot;:&quot;NICKNAME&quot;,
 &quot;sex&quot;:1,
 &quot;province&quot;:&quot;PROVINCE&quot;,
 &quot;city&quot;:&quot;CITY&quot;,
 &quot;country&quot;:&quot;COUNTRY&quot;,
 &quot;headimgurl&quot;: &quot;https://thirdwx.qlogo.cn/mmopen/g3MonUZtNHkdmzicIlibx6iaFqAc56vxLSUfpb6n5WKSYVY0ChQKkiaJSgQ1dZuTOgvLLrhJbERQQ4eMsv84eavHiaiceqxibJxCfHe/0&quot;,
 &quot;privilege&quot;:[
 &quot;PRIVILEGE1&quot;,
 &quot;PRIVILEGE2&quot;
 ],
 &quot;unionid&quot;: &quot; o6_bmasdasdsad6_2sgVt7hMZOPfL&quot;
 <span class="token punctuation">}</span>
*/</span>
<span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserinfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> access_token<span class="token punctuation">,</span><span class="token class-name">String</span> openid<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> wxUrl_template <span class="token operator">=</span> <span class="token string">&quot;https://api.weixin.qq.com/sns/userinfo?access_token=%s&amp;openid=%s&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//è¯·æ±‚å¾®ä¿¡åœ°å€</span>
    <span class="token class-name">String</span> wxUrl <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>wxUrl_template<span class="token punctuation">,</span> access_token<span class="token punctuation">,</span>openid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token, url:{}&quot;</span><span class="token punctuation">,</span> wxUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exchange <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>wxUrl<span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//é˜²æ­¢ä¹±ç è¿›è¡Œè½¬ç </span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token keyword">new</span>     <span class="token class-name">String</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">ISO_8859_1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token: è¿”å›å€¼:{}&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> resultMap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯</p><p>1ã€åœ¨è·å–ç”¨æˆ·ä¿¡æ¯å¤„æ‰“æ–­ç‚¹</p><p>2ã€è¿›å…¥http://www.51xuecheng.cn/wxsign.html</p><p>3ã€æ‰‹æœºæ‰«ç æˆæƒ</p><h4 id="_4-3-5-ä¿å­˜ç”¨æˆ·ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_4-3-5-ä¿å­˜ç”¨æˆ·ä¿¡æ¯" aria-hidden="true">#</a> <strong>4.3.5 ä¿å­˜ç”¨æˆ·ä¿¡æ¯</strong></h4><p>å‘æ•°æ®åº“ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨å°†å…¶ä¿å­˜åœ¨æ•°æ®åº“ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">XcUserRoleMapper</span> xcUserRoleMapper<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">XcUser</span> <span class="token function">addWxUser</span><span class="token punctuation">(</span><span class="token class-name">Map</span> userInfo_map<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> unionid <span class="token operator">=</span> userInfo_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;unionid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ ¹æ®unionidæŸ¥è¯¢æ•°æ®åº“</span>
    <span class="token class-name">XcUser</span> xcUser <span class="token operator">=</span> xcUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">XcUser</span><span class="token operator">::</span><span class="token function">getWxUnionid</span><span class="token punctuation">,</span> unionid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xcUser<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> xcUser<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setWxUnionid</span><span class="token punctuation">(</span>unionid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®°å½•ä»å¾®ä¿¡å¾—åˆ°çš„æ˜µç§°</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setNickname</span><span class="token punctuation">(</span>userInfo_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nickname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setUserpic</span><span class="token punctuation">(</span>userInfo_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;headimgurl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>userInfo_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nickname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>unionid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>unionid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setUtype</span><span class="token punctuation">(</span><span class="token string">&quot;101001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å­¦ç”Ÿç±»å‹</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”¨æˆ·çŠ¶æ€</span>
    xcUser<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUserMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>xcUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">XcUserRole</span> xcUserRole <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XcUserRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUserRole<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUserRole<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xcUserRole<span class="token punctuation">.</span><span class="token function">setRoleId</span><span class="token punctuation">(</span><span class="token string">&quot;17&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å­¦ç”Ÿè§’è‰²</span>
    xcUserRoleMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>xcUserRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xcUser<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ä¿å­˜ç”¨æˆ·ä¿¡æ¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">WxAuthServiceImpl</span> currentProxy<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">XcUser</span> <span class="token function">wxAuth</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">//æ”¶åˆ°codeè°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> access_token_map <span class="token operator">=</span> <span class="token function">getAccess_token</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>access_token_map<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>access_token_map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> openid <span class="token operator">=</span> access_token_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;openid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> access_token <span class="token operator">=</span> access_token_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ‹¿access_tokenæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userinfo <span class="token operator">=</span> <span class="token function">getUserinfo</span><span class="token punctuation">(</span>access_token<span class="token punctuation">,</span> openid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>userinfo<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“</span>
    <span class="token class-name">XcUser</span> xcUser <span class="token operator">=</span> currentProxy<span class="token punctuation">.</span><span class="token function">addWxUser</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xcUser<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ä¿å­˜ç”¨æˆ·ä¿¡æ¯</p><p>1ã€åœ¨ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤„æ‰“æ–­ç‚¹</p><p>2ã€è¿›å…¥http://www.51xuecheng.cn/wxsign.html</p><p>3ã€æ‰‹æœºæ‰«ç æˆæƒ</p><p>4ã€è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œæäº¤è®¤è¯æˆåŠŸã€‚</p><h2 id="_5-ç”¨æˆ·æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_5-ç”¨æˆ·æˆæƒ" aria-hidden="true">#</a> <strong>5 ç”¨æˆ·æˆæƒ</strong></h2><h3 id="_5-1-rbac" tabindex="-1"><a class="header-anchor" href="#_5-1-rbac" aria-hidden="true">#</a> <strong>5.1 RBAC</strong></h3><p>å¦‚ä½•å®ç°æˆæƒï¼Ÿä¸šç•Œé€šå¸¸åŸºäº RBAC å®ç°æˆæƒã€‚</p><p>RBAC åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š</p><p>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRole-Based Access Controlï¼‰</p><p>åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶ï¼ˆResource-Based Access Controlï¼‰</p><p>è§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRole-Based Access Controlï¼‰æ˜¯æŒ‰è§’è‰²è¿›è¡Œæˆæƒï¼Œæ¯”å¦‚ï¼šä¸»ä½“çš„è§’è‰²ä¸ºæ€»ç»ç†å¯ä»¥æŸ¥è¯¢ä¼ä¸šè¿è¥æŠ¥è¡¨ï¼ŒæŸ¥è¯¢å‘˜å·¥å·¥èµ„ä¿¡æ¯ç­‰ï¼Œè®¿é—®æ§åˆ¶æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604183050092-53b2c84e.png" alt="image-20230604183050092"></p><p>æ ¹æ®ä¸Šå›¾ä¸­çš„åˆ¤æ–­é€»è¾‘ï¼Œæˆæƒä»£ç å¯è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>ä¸»ä½“<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;æ€»ç»ç†è§’è‰²id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
æŸ¥è¯¢å·¥èµ„
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä¸Šå›¾ä¸­æŸ¥è¯¢å·¥èµ„æ‰€éœ€è¦çš„è§’è‰²å˜åŒ–ä¸ºæ€»ç»ç†å’Œéƒ¨é—¨ç»ç†ï¼Œæ­¤æ—¶å°±éœ€è¦ä¿®æ”¹åˆ¤æ–­é€»è¾‘ä¸ºâ€œåˆ¤æ–­ç”¨æˆ·çš„è§’è‰²æ˜¯å¦æ˜¯æ€»ç»ç†æˆ–éƒ¨é—¨ç»ç†â€ï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>ä¸»ä½“<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;æ€»ç»ç†è§’è‰²id&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span>  ä¸»ä½“<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;éƒ¨é—¨ç»ç†è§’è‰²id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    æŸ¥è¯¢å·¥èµ„
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®ä¸Šè¾¹çš„ä¾‹å­å‘ç°ï¼Œå½“éœ€è¦ä¿®æ”¹è§’è‰²çš„æƒé™æ—¶å°±éœ€è¦ä¿®æ”¹æˆæƒçš„ç›¸å…³ä»£ç ï¼Œç³»ç»Ÿå¯æ‰©å±•æ€§å·®ã€‚</p><p>åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶ï¼ˆResource-Based Access</p><p>Controlï¼‰æ˜¯æŒ‰èµ„æºï¼ˆæˆ–æƒé™ï¼‰è¿›è¡Œæˆæƒï¼Œæ¯”å¦‚ï¼šç”¨æˆ·å¿…é¡»å…·æœ‰æŸ¥è¯¢å·¥èµ„æƒé™æ‰å¯ä»¥æŸ¥è¯¢å‘˜å·¥å·¥èµ„ä¿¡æ¯ç­‰ï¼Œè®¿é—®æ§åˆ¶æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604183118856-8efaa20f.png" alt="image-20230604183118856"></p><p>æ ¹æ®ä¸Šå›¾ä¸­çš„åˆ¤æ–­ï¼Œæˆæƒä»£ç å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>ä¸»ä½“<span class="token punctuation">.</span><span class="token function">hasPermission</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢å·¥èµ„æƒé™æ ‡è¯†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    æŸ¥è¯¢å·¥èµ„
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¼˜ç‚¹ï¼šç³»ç»Ÿè®¾è®¡æ—¶å®šä¹‰å¥½æŸ¥è¯¢å·¥èµ„çš„æƒé™æ ‡è¯†ï¼Œå³ä½¿æŸ¥è¯¢å·¥èµ„æ‰€éœ€è¦çš„è§’è‰²å˜åŒ–ä¸ºæ€»ç»ç†å’Œéƒ¨é—¨ç»ç†ä¹Ÿä¸éœ€è¦ä¿®æ”¹æˆæƒä»£ç ï¼Œç³»ç»Ÿå¯æ‰©å±•æ€§å¼ºã€‚</p><h3 id="_5-2-èµ„æºæœåŠ¡æˆæƒæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_5-2-èµ„æºæœåŠ¡æˆæƒæµç¨‹" aria-hidden="true">#</a> <strong>5.2 èµ„æºæœåŠ¡æˆæƒæµç¨‹</strong></h3><p>æœ¬é¡¹ç›®åœ¨èµ„æºæœåŠ¡å†…éƒ¨è¿›è¡Œæˆæƒï¼ŒåŸºäºèµ„æºçš„æˆæƒæ¨¡å¼ï¼Œå› ä¸ºæ¥å£åœ¨èµ„æºæœåŠ¡ï¼Œé€šè¿‡åœ¨æ¥å£å¤„æ·»åŠ æˆæƒæ³¨è§£å®ç°æˆæƒã€‚</p><p>1ã€é¦–å…ˆé…ç½® nginx ä»£ç†</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>   http <span class="token punctuation">{</span>
    server_names_hash_bucket_size <span class="token number">64</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

   #å‰ç«¯å¼€å‘æœåŠ¡
  upstream uidevserver<span class="token punctuation">{</span>
    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8601</span> weight<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
   server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  teacher<span class="token punctuation">.</span><span class="token number">51</span>xuecheng<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>
        #charset koi8<span class="token operator">-</span>r<span class="token punctuation">;</span>
        ssi on<span class="token punctuation">;</span>
        ssi_silent_errors on<span class="token punctuation">;</span>
        #access_log  logs<span class="token operator">/</span>host<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>
        #location <span class="token operator">/</span> <span class="token punctuation">{</span>
         #   alias   <span class="token class-name">D</span><span class="token operator">:</span><span class="token operator">/</span>itcast2022<span class="token operator">/</span>xc_edu3<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">/</span>code_1<span class="token operator">/</span>dist<span class="token operator">/</span><span class="token punctuation">;</span>
         #   index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        #<span class="token punctuation">}</span>
        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            proxy_pass   http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>uidevserver<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        location <span class="token operator">/</span>api<span class="token operator">/</span> <span class="token punctuation">{</span>
            proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>gatewayserver<span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


   <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŠ è½½ nginx é…ç½®ã€‚</p><p>2ã€åœ¨èµ„æºæœåŠ¡é›†æˆ Spring Security</p><p>åœ¨éœ€è¦æˆæƒçš„æ¥å£å¤„ä½¿ç”¨<code>@PreAuthorize(&quot;hasAuthority(&#39;æƒé™æ ‡è¯†ç¬¦&#39;)&quot;)</code>è¿›è¡Œæ§åˆ¶</p><p>ä¸‹è¾¹ä»£ç æŒ‡å®š/course/list æ¥å£éœ€è¦æ‹¥æœ‰ xc_teachmanager_course_list æƒé™ã€‚</p><p><img src="/MyBlog/assets/image-20230604183146449-1b0bc60c.png" alt="image-20230604183146449"></p><p>è®¾ç½®äº†@PreAuthorize è¡¨ç¤ºæ‰§è¡Œæ­¤æ–¹æ³•éœ€è¦æˆæƒï¼Œå¦‚æœå½“å‰ç”¨æˆ·è¯·æ±‚æ¥å£æ²¡æœ‰æƒé™åˆ™æŠ›å‡ºå¼‚å¸¸</p><p>org.springframework.security.access.AccessDeniedException: ä¸å…è®¸è®¿é—®</p><p>3ã€åœ¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†å¤„è§£ææ­¤å¼‚å¸¸ä¿¡æ¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">RestErrorResponse</span> <span class="token function">exception</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

   log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ã€ç³»ç»Ÿå¼‚å¸¸ã€‘{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸å…è®¸è®¿é—®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestErrorResponse</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡æœ‰æ“ä½œæ­¤åŠŸèƒ½çš„æƒé™&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestErrorResponse</span><span class="token punctuation">(</span><span class="token class-name">CommonError</span><span class="token punctuation">.</span><span class="token constant">UNKOWN_ERROR</span><span class="token punctuation">.</span><span class="token function">getErrMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€é‡å¯èµ„æºæœåŠ¡è¿›è¡Œæµ‹è¯•</p><p>ä½¿ç”¨æ•™å­¦æœºæ„ç”¨æˆ·ç™»å½•ç³»ç»Ÿ</p><p>è¿™é‡Œä½¿ç”¨ t1 ç”¨æˆ·ç™»å½•ï¼Œè´¦å·:t1ã€å¯†ç ï¼š111111</p><p>ç™»å½•æˆåŠŸï¼Œç‚¹å‡»â€œæ•™å­¦æœºæ„â€</p><p><img src="/MyBlog/assets/image-20230604183204291-7dbd299b.png" alt="image-20230604183204291"></p><p>å½“ç”¨æˆ·æ²¡æœ‰æƒé™æ—¶é¡µé¢æç¤ºï¼šæ²¡æœ‰æ“ä½œæ­¤åŠŸèƒ½çš„æƒé™ã€‚</p><p><img src="/MyBlog/assets/image-20230604183207873-5a3a243a.png" alt="image-20230604183207873"></p><h3 id="_5-3-æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_5-3-æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> <strong>5.3 æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹</strong></h3><blockquote><p>å¦‚ä½•ç»™ç”¨æˆ·åˆ†é…æƒé™å‘¢ï¼Ÿ</p></blockquote><p>é¦–å…ˆè¦å­¦ä¹ æ•°æ®æ¨¡å‹ï¼Œæœ¬é¡¹ç›®æˆæƒç›¸å…³çš„æ•°æ®è¡¨å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604183218592-e5db4b3e.png" alt="image-20230604183218592"></p><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><p>xc_userï¼šç”¨æˆ·è¡¨ï¼Œå­˜å‚¨äº†ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·ç±»å‹åŒ…æ‹¬ï¼šå­¦ç”Ÿã€è€å¸ˆã€ç®¡ç†å‘˜ç­‰</p><p>xc_roleï¼šè§’è‰²è¡¨ï¼Œå­˜å‚¨äº†ç³»ç»Ÿçš„è§’è‰²ä¿¡æ¯ï¼Œå­¦ç”Ÿã€è€å¸ˆã€æ•™å­¦ç®¡ç†å‘˜ã€ç³»ç»Ÿç®¡ç†å‘˜ç­‰ã€‚</p><p>xc_user_roleï¼šç”¨æˆ·è§’è‰²è¡¨ï¼Œä¸€ä¸ªç”¨æˆ·å¯æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œä¸€ä¸ªè§’è‰²å¯è¢«å¤šä¸ªç”¨æˆ·æ‰€æ‹¥æœ‰</p><p>xc_menu:æ¨¡å—è¡¨ï¼Œè®°å½•äº†èœå•åŠèœå•ä¸‹çš„æƒé™</p><p>xc_permission:è§’è‰²æƒé™è¡¨ï¼Œä¸€ä¸ªè§’è‰²å¯æ‹¥æœ‰å¤šä¸ªæƒé™ï¼Œä¸€ä¸ªæƒé™å¯è¢«å¤šä¸ªè§’è‰²æ‰€æ‹¥æœ‰</p><p>æœ¬é¡¹ç›®æ•™å­¦é˜¶æ®µä¸å†å®ç°æƒé™å®šä¹‰åŠç”¨æˆ·æƒé™åˆ†é…çš„åŠŸèƒ½ï¼Œæƒé™åˆ†é…çš„ç•Œé¢åŸå‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/MyBlog/assets/image-20230604183224065-c9f0dce9.png" alt="image-20230604183224065"></p><p>æœ¬é¡¹ç›®è¦æ±‚æŒæ¡åŸºäºæƒé™æ•°æ®æ¨¡å‹ï¼ˆ5 å¼ æ•°æ®è¡¨ï¼‰ï¼Œè¦æ±‚åœ¨æ•°æ®åº“ä¸­æ“ä½œå®Œæˆç»™ç”¨æˆ·åˆ†é…æƒé™ã€æŸ¥è¯¢ç”¨æˆ·æƒé™ç­‰éœ€æ±‚ã€‚</p><p>1ã€æŸ¥è¯¢ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æƒé™</p><p>æ­¥éª¤ï¼š</p><p>æŸ¥è¯¢ç”¨æˆ·çš„ id</p><p>æŸ¥è¯¢ç”¨æˆ·æ‰€æ‹¥æœ‰çš„è§’è‰²</p><p>æŸ¥è¯¢ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æƒé™</p><p>ä¾‹å­ï¼š</p><p>SELECT * FROM xc_menu WHERE id IN(<br> SELECT menu_id FROM xc_permission WHERE role_id IN(<br> SELECT role_id FROM xc_user_role WHERE user_id = &#39;52&#39;<br> )<br> )</p><p>2ã€ç»™ç”¨æˆ·åˆ†é…æƒé™</p><p>1ï¼‰æ·»åŠ æƒé™</p><p>æŸ¥è¯¢ç”¨æˆ·çš„ id</p><p>æŸ¥è¯¢æƒé™çš„ id</p><p>æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰²ï¼Œå¦‚æœæ²¡æœ‰è§’è‰²éœ€è¦å…ˆç»™ç”¨æˆ·æŒ‡å®šè§’è‰²</p><p>å‘è§’è‰²æƒé™è¡¨æ·»åŠ è®°å½•</p><p>2ï¼‰åˆ é™¤ç”¨æˆ·æƒé™</p><p>æœ¬é¡¹ç›®æ˜¯åŸºäºè§’è‰²åˆ†é…æƒé™ï¼Œå¦‚æœè¦åˆ é™¤ç”¨æˆ·çš„æƒé™å¯ä»¥ç»™ç”¨æˆ·æ¢è§’è‰²ï¼Œé‚£ä¹ˆæ–°è§’è‰²ä¸‹çš„æƒé™å°±æ˜¯ç”¨æˆ·çš„æƒé™ï¼›å¦‚æœä¸æ¢ç”¨æˆ·çš„è§’è‰²å¯ä»¥åˆ é™¤è§’è‰²ä¸‹çš„æƒé™å³åˆ é™¤è§’è‰²æƒé™å…³ç³»è¡¨ç›¸åº”è®°å½•ï¼Œè¿™æ ·æ“ä½œæ˜¯å°†è§’è‰²ä¸‹çš„æƒé™åˆ é™¤ï¼Œå±äºè¯¥è§’è‰²çš„ç”¨æˆ·éƒ½å°†åˆ é™¤æ­¤æƒé™ã€‚</p><h3 id="_5-4-æŸ¥è¯¢ç”¨æˆ·æƒé™" tabindex="-1"><a class="header-anchor" href="#_5-4-æŸ¥è¯¢ç”¨æˆ·æƒé™" aria-hidden="true">#</a> <strong>5.4 æŸ¥è¯¢ç”¨æˆ·æƒé™</strong></h3><p>ä½¿ç”¨ Spring Security è¿›è¡Œæˆæƒï¼Œé¦–å…ˆåœ¨ç”Ÿæˆ jwt å‰ä¼šæŸ¥è¯¢ç”¨æˆ·çš„æƒé™ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/MyBlog/assets/image-20230604183238823-7900ac85.png" alt="image-20230604183238823"></p><p>æ¥ä¸‹æ¥éœ€è¦ä¿®æ”¹ UserServiceImpl å’Œ PasswordAuthServiceImpl ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·çš„æƒé™ã€‚</p><p>1ã€å®šä¹‰ mapper æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">XcMenuMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcMenu</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT    * FROM xc_menu WHERE id IN (SELECT menu_id FROM xc_permission WHERE role_id IN ( SELECT role_id FROM xc_user_role WHERE user_id = #{userId} ))&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcMenu</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectPermissionByUserId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€ä¿®æ”¹ PasswordAuthServiceImpl</p><p>ä¿®æ”¹ UserServiceImpl ç±»çš„ getUserPrincipal æ–¹æ³•ï¼ŒæŸ¥è¯¢æƒé™ä¿¡æ¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//æŸ¥è¯¢ç”¨æˆ·èº«ä»½</span>
<span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">getUserPrincipal</span><span class="token punctuation">(</span><span class="token class-name">XcUserExt</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æŸ¥è¯¢ç”¨æˆ·æƒé™</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">XcMenu</span><span class="token punctuation">&gt;</span></span> xcMenus <span class="token operator">=</span> menuMapper<span class="token punctuation">.</span><span class="token function">selectPermissionByUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xcMenus<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç”¨æˆ·æƒé™,å¦‚æœä¸åŠ åˆ™æŠ¥Cannot pass a null GrantedAuthority collection</span>
        permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        xcMenus<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>menu<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>menu<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å°†ç”¨æˆ·æƒé™æ”¾åœ¨XcUserExtä¸­</span>
    user<span class="token punctuation">.</span><span class="token function">setPermissions</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//ä¸ºäº†å®‰å…¨åœ¨ä»¤ç‰Œä¸­ä¸æ”¾å¯†ç </span>
    user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å°†userå¯¹è±¡è½¬json</span>
    <span class="token class-name">String</span> userString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> authorities <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>userString<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> userDetails<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-æˆæƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-5-æˆæƒæµ‹è¯•" aria-hidden="true">#</a> <strong>5.5 æˆæƒæµ‹è¯•</strong></h3><p>ä»¥ä¸Šå®ç°äº†è®¤è¯æ—¶ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·çš„æƒé™ï¼Œä¸‹è¾¹è¿›è¡Œç”¨æˆ·æˆæƒæµ‹è¯•ã€‚</p><p>é‡å¯è®¤è¯æœåŠ¡ï¼Œä½¿ç”¨å†…å®¹ç®¡ç†è¯¾ç¨‹åˆ—è¡¨æŸ¥è¯¢ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/MyBlog/assets/image-20230604183306637-52d29130.png" alt="image-20230604183306637"></p><p>ç”¨æˆ·æ‹¥æœ‰ xc_teachmanager_course_list æƒé™æ–¹å¯è®¿é—®è¯¾ç¨‹æŸ¥è¯¢æ¥å£ã€‚</p><p>ä»¥ç”¨æˆ· stu1 ä¸ºä¾‹ï¼Œå½“å®ƒæ²¡æœ‰æ­¤æƒé™æ—¶é¡µé¢æŠ¥â€œæ²¡æœ‰æ­¤æ“ä½œçš„æƒé™â€é”™è¯¯</p><p><img src="/MyBlog/assets/image-20230604183309879-169eefa4.png" alt="image-20230604183309879"></p><p>å°† xc_teachmanager_course_list æƒé™åˆ†é…ç»™ç”¨æˆ·ã€‚</p><p>1ï¼‰é¦–å…ˆæ‰¾åˆ°å½“å‰ç”¨æˆ·çš„è§’è‰²</p><p>2ï¼‰æ‰¾åˆ° xc_teachmanager_course_list æƒé™çš„ä¸»é”®</p><p>3ï¼‰åœ¨è§’è‰²æƒé™å…³ç³»è¡¨ä¸­æ·»åŠ è®°å½•</p><p>åˆ†é…å®Œæƒé™éœ€è¦é‡æ–°ç™»å½•</p><p>ç”±äºç”¨æˆ·åˆ†é…äº† xc_teachmanager_course_list æƒé™ï¼Œç”¨æˆ·å…·æœ‰è®¿é—®è¯¾ç¨‹æŸ¥è¯¢æ¥å£çš„æƒé™ã€‚</p><h3 id="_5-6-ç»†ç²’åº¦æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_5-6-ç»†ç²’åº¦æˆæƒ" aria-hidden="true">#</a> <strong>5.6 ç»†ç²’åº¦æˆæƒ</strong></h3><h4 id="_5-6-1-ä»€ä¹ˆæ˜¯ç»†ç²’åº¦æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_5-6-1-ä»€ä¹ˆæ˜¯ç»†ç²’åº¦æˆæƒ" aria-hidden="true">#</a> <strong>5.6.1 ä»€ä¹ˆæ˜¯ç»†ç²’åº¦æˆæƒ</strong></h4><blockquote><p>ä»€ä¹ˆæ˜¯ç»†ç²’åº¦æˆæƒï¼Ÿ</p></blockquote><p>ç»†ç²’åº¦æˆæƒä¹Ÿå«æ•°æ®èŒƒå›´æˆæƒï¼Œå³ä¸åŒçš„ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æ“ä½œæƒé™ç›¸åŒï¼Œä½†æ˜¯èƒ½å¤Ÿæ“ä½œçš„æ•°æ®èŒƒå›´æ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸€ä¸ªä¾‹å­ï¼šç”¨æˆ· A å’Œç”¨æˆ· B éƒ½æ˜¯æ•™å­¦æœºæ„ï¼Œä»–ä»¬éƒ½æ‹¥æœ‰â€œæˆ‘çš„è¯¾ç¨‹â€æƒé™ï¼Œä½†æ˜¯ä¸¤ä¸ªç”¨æˆ·æ‰€æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>æœ¬é¡¹ç›®æœ‰å“ªäº›ç»†ç²’åº¦æˆæƒï¼Ÿ</p><p>æ¯”å¦‚ï¼š</p><p>æˆ‘çš„è¯¾ç¨‹ï¼Œæ•™å­¦æœºæ„åªå…è®¸æŸ¥è¯¢æœ¬æ•™å­¦æœºæ„ä¸‹çš„è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>æˆ‘çš„é€‰è¯¾ï¼Œå­¦ç”Ÿåªå…è®¸æŸ¥è¯¢è‡ªå·±æ‰€é€‰è¯¾ã€‚</p><p>å¦‚ä½•å®ç°ç»†ç²’åº¦æˆæƒï¼Ÿ</p><p>ç»†ç²’åº¦æˆæƒæ¶‰åŠåˆ°ä¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼Œé€šå¸¸åœ¨ service å±‚å®ç°ï¼Œæ ¹æ®ä¸åŒçš„ç”¨æˆ·è¿›è¡Œæ ¡éªŒï¼Œæ ¹æ®ä¸åŒçš„å‚æ•°æŸ¥è¯¢ä¸åŒçš„æ•°æ®æˆ–æ“ä½œä¸åŒçš„æ•°æ®ã€‚</p><h4 id="_5-6-2-æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_5-6-2-æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒ" aria-hidden="true">#</a> <strong>5.6.2 æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒ</strong></h4><p>æ•™å­¦æœºæ„åœ¨ç»´æŠ¤è¯¾ç¨‹æ—¶åªå…è®¸ç»´æŠ¤æœ¬æœºæ„çš„è¯¾ç¨‹ï¼Œæ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>1ï¼‰è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·èº«ä»½</p><p>2ï¼‰å¾—åˆ°ç”¨æˆ·æ‰€å±æ•™è‚²æœºæ„çš„ Id</p><p>3ï¼‰æŸ¥è¯¢è¯¥æ•™å­¦æœºæ„ä¸‹çš„è¯¾ç¨‹ä¿¡æ¯</p><p>æœ€ç»ˆå®ç°äº†ç”¨æˆ·åªå…è®¸æŸ¥è¯¢è‡ªå·±æœºæ„çš„è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>æ ¹æ®å…¬å¸ Id æŸ¥è¯¢è¯¾ç¨‹ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>1ï¼‰æ•™å­¦æœºæ„ç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼Œä»ç”¨æˆ·èº«ä»½ä¸­å–å‡ºæ‰€å±æœºæ„çš„ id</p><p>åœ¨ç”¨æˆ·è¡¨ä¸­è®¾è®¡äº† company_id å­—æ®µå­˜å‚¨è¯¥ç”¨æˆ·æ‰€å±çš„æœºæ„ id.</p><p>2ï¼‰æ¥å£å±‚å–å‡ºå½“å‰ç™»å½•ç”¨æˆ·çš„èº«ä»½ï¼Œå–å‡ºæœºæ„ id</p><p>3) å°†æœºæ„ id ä¼ å…¥ service æ–¹æ³•ã€‚</p><p>4) service æ–¹æ³•å°†æœºæ„ id ä¼ å…¥ Dao æ–¹æ³•ï¼Œæœ€ç»ˆæŸ¥è¯¢å‡ºæœ¬æœºæ„çš„è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¾ç¨‹æŸ¥è¯¢æ¥å£&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;xc_teachmanager_course_list&#39;)&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ‹¥æœ‰è¯¾ç¨‹åˆ—è¡¨æŸ¥è¯¢çš„æƒé™æ–¹å¯è®¿é—®</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/course/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseBase</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">PageParams</span> pageParams<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">QueryCourseParamsDto</span> queryCourseParams<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//å–å‡ºç”¨æˆ·èº«ä»½</span>
    <span class="token class-name">XcUser</span> user <span class="token operator">=</span> <span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æœºæ„id</span>
    <span class="token class-name">String</span> companyId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> courseBaseInfoService<span class="token punctuation">.</span><span class="token function">queryCourseBaseList</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">,</span>pageParams<span class="token punctuation">,</span>queryCourseParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseBase</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryCourseBaseList</span><span class="token punctuation">(</span><span class="token class-name">Long</span> companyId<span class="token punctuation">,</span><span class="token class-name">PageParams</span> pageParams<span class="token punctuation">,</span> <span class="token class-name">QueryCourseParamsDto</span> queryCourseParamsDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

 <span class="token comment">//æ„å»ºæŸ¥è¯¢æ¡ä»¶å¯¹è±¡</span>
 <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseBase</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//æœºæ„id</span>
 queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">CourseBase</span><span class="token operator">::</span><span class="token function">getCompanyId</span><span class="token punctuation">,</span>companyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-6-3-æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-6-3-æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒæµ‹è¯•" aria-hidden="true">#</a> <strong>5.6.3 æ•™å­¦æœºæ„ç»†ç²’åº¦æˆæƒæµ‹è¯•</strong></h4><p>ä½¿ç”¨ä¸€ä¸ªæ•™å­¦æœºæ„çš„ç”¨æˆ·ç™»å½•é¡¹ç›®ï¼Œå¹¶ä¸”æ­¤ç”¨æˆ·å…·æœ‰æŸ¥è¯¢è¯¾ç¨‹çš„æƒé™ã€‚</p><p>æ‰‹æœºä¿®æ”¹æ•°æ®åº“æŒ‡å®šç”¨æˆ·å½’å±åˆ°ä¸€ä¸ªæœºæ„ä¸­ï¼Œæ¶‰åŠä»¥ä¸‹æ•°æ®è¡¨ï¼š</p><p>xc_company ä¸ºæœºæ„è¡¨</p><p>xc_company_user ä¸ºæœºæ„ç”¨æˆ·å…³ç³»è¡¨</p><p>xc_user è¡¨ä¸­æœ‰ company_id å­—æ®µã€‚</p><p>æˆ‘ä»¬å‡†å¤‡äº† t1 ç”¨æˆ·ä½œä¸ºæ­¤æ¬¡æµ‹è¯•çš„ç”¨æˆ·ï¼Œä½¿ç”¨æ­¤ç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼š</p><p>æå‰åœ¨æŸ¥è¯¢è¯¾ç¨‹åˆ—è¡¨æ¥å£å¤„æ‰“ä¸Šæ–­ç‚¹ã€‚</p><p>ç»è¿‡æµ‹è¯•å¯ä»¥æ­£å¸¸å–å‡ºç”¨æˆ·æ‰€å±çš„æœºæ„ id</p><p><img src="/MyBlog/assets/image-20230604183347236-6f134fd4.png" alt="image-20230604183347236"></p><p>è·Ÿè¸ªæŒä¹…å±‚æ—¥å¿—å‘ç°å·²å°†æœºæ„ id ä¼ å…¥ dao æ–¹æ³•ï¼Œæ‹¼è£… sql è¯­å¥ï¼ŒæŸ¥è¯¢æœ¬æœºæ„çš„è¯¾ç¨‹ä¿¡æ¯</p><p><img src="/MyBlog/assets/image-20230604183417411-8056ab9f.png" alt="image-20230604183417411"></p><h2 id="_6-å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_6-å®æˆ˜" aria-hidden="true">#</a> <strong>6 å®æˆ˜</strong></h2><h3 id="_6-1-æ‰¾å›å¯†ç -å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_6-1-æ‰¾å›å¯†ç -å®æˆ˜" aria-hidden="true">#</a> <strong>6.1 æ‰¾å›å¯†ç (å®æˆ˜)</strong></h3><p>éœ€æ±‚ï¼šå¿˜è®°å¯†ç éœ€è¦æ‰¾å›ï¼Œå¯ä»¥é€šè¿‡æ‰‹æœºå·æ‰¾å›å¯†ç ï¼Œé€šè¿‡é‚®ç®±æ‰¾å›å¯†ç ä»¥åŠäººå·¥é€šé“ã€‚</p><p>ç•Œé¢è®¿é—®åœ°å€ï¼šhttp://www.51xuecheng.cn/findpassword.html</p><p><img src="/MyBlog/assets/image-20230604183353300-9a63564b.png" alt="image-20230604183353300"></p><blockquote><p>ç”±äºé‚®ä»¶å‘é€æ¯”æ‰‹æœºéªŒè¯ç è¦æ–¹ä¾¿çš„å¤šï¼Œæ‰€ä»¥è¿™é‡Œå°±åªåšé‚®ä»¶æ³¨å†Œã€æ‰¾å›å¯†ç äº†</p></blockquote><p>æ¥å£ï¼š</p><p>æ‰‹æœºéªŒè¯ç ï¼š/api/checkcode/phone?param1=æ‰‹æœºå·</p><p>é‚®ç®±éªŒè¯ç ï¼š/api/checkcode/phone?param1=ç”µå­é‚®ç®±åœ°å€</p><p>æ‰¾å›å¯†ç ï¼š/api/auth/findpassword</p><p>è¯·æ±‚ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;cellphone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;checkcodekey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;checkcode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;confirmpwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å“åº”ï¼š</p><p>200: æ‰¾å›æˆåŠŸ</p><p>å…¶å®ƒï¼šæ‰¾å›å¤±è´¥ï¼Œå¤±è´¥åŸå› ä½¿ç”¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†è¿”å›çš„ä¿¡æ¯æ ¼å¼</p><p>æ‰§è¡Œæµç¨‹<br> 1ã€æ ¡éªŒéªŒè¯ç ï¼Œä¸ä¸€è‡´åˆ™æŠ›å‡ºå¼‚å¸¸</p><p>2ã€åˆ¤æ–­ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´åˆ™æŠ›å‡ºå¼‚å¸¸</p><p>3ã€æ ¹æ®æ‰‹æœºå·å’Œé‚®ç®±æŸ¥è¯¢ç”¨æˆ·</p><p>4ã€å¦‚æœæ‰¾åˆ°ç”¨æˆ·æ›´æ–°ä¸ºæ–°å¯†ç </p><h3 id="_6-2-æ³¨å†Œ-å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_6-2-æ³¨å†Œ-å®æˆ˜" aria-hidden="true">#</a> <strong>6.2 æ³¨å†Œ(å®æˆ˜)</strong></h3><p>éœ€æ±‚ï¼šä¸ºå­¦ç”Ÿæä¾›æ³¨å†Œå…¥å£ï¼Œé€šè¿‡æ­¤å…¥å£æ³¨å†Œçš„ç”¨æˆ·ä¸ºå­¦ç”Ÿç”¨æˆ·ã€‚</p><p>ç•Œé¢è®¿é—®åœ°å€ï¼šhttp://www.51xuecheng.cn/register.html</p><p><img src="/MyBlog/assets/image-20230604183444148-b9f138f9.png" alt="image-20230604183444148"></p><p>æ¥å£ï¼š</p><p>æ‰‹æœºéªŒè¯ç ï¼š/api/checkcode/phone?param1=æ‰‹æœºå·</p><p>æ³¨å†Œï¼š/api/auth/register</p><p>è¯·æ±‚ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;cellphone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;nickname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;confirmpwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;checkcodekey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;checkcode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å“åº”ï¼š</p><p>200: æ³¨å†ŒæˆåŠŸ</p><p>å…¶å®ƒï¼šæ³¨å†Œå¤±è´¥ï¼Œå¤±è´¥åŸå› ä½¿ç”¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†è¿”å›çš„ä¿¡æ¯æ ¼å¼</p><p>æ‰§è¡Œæµç¨‹ï¼š</p><p>1ã€æ ¡éªŒéªŒè¯ç ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™æŠ›å‡ºå¼‚å¸¸</p><p>2ã€æ ¡éªŒä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™æŠ›å‡ºå¼‚å¸¸</p><p>3ã€æ ¡éªŒç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸</p><p>4ã€å‘ç”¨æˆ·è¡¨ã€ç”¨æˆ·è§’è‰²å…³ç³»è¡¨æ·»åŠ æ•°æ®ã€‚è§’è‰²ä¸ºå­¦ç”Ÿè§’è‰²ã€‚</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ZyKunn/edit/main/notes/project/02/ç¬¬5ç« -è®¤è¯æˆæƒv3.1/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">è´¡çŒ®è€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 814342838@qq.com">ZyKun</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/MyBlog/notes/project/02/%E7%AC%AC4%E7%AB%A0-%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83v3.1/" class="" aria-label="ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1"><!--[--><!--]--> ç¬¬ 4 ç«  è¯¾ç¨‹å‘å¸ƒ v3.1 <!--[--><!--]--></a></span><span class="next"><a href="/MyBlog/notes/project/02/%E7%AC%AC6%E7%AB%A0-%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0v3.1/" class="" aria-label="ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1"><!--[--><!--]--> ç¬¬ 6 ç«  é€‰è¯¾å­¦ä¹  v3.1 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/MyBlog/assets/app-a153c100.js" defer></script>
  </body>
</html>
