import{_ as r,r as t,o as c,c as d,a as s,e as a,w as e,b as n,d as l}from"./app-a153c100.js";const o="/MyBlog/assets/image-20210629114325516-55d98da4.png",m="/MyBlog/assets/image-20210629114830642-a4fad52f.png",u="/MyBlog/assets/image-20210629114941810-13d44338.png",v="/MyBlog/assets/image-20210630111505799-f3b356ee.png",b="/MyBlog/assets/image-20210630113929868-c6aeaea2.png",g="/MyBlog/assets/image-20210630183914491-47e437ad.png",k="/MyBlog/assets/image-20210630201258802-0e593f2f.png",h="/MyBlog/assets/image-20210701215227018-c409376c.png",f="/MyBlog/assets/image-20210701215534714-895e8aac.png",_="/MyBlog/assets/image-20210701220714104-7942057d.png",x="/MyBlog/assets/image-20210701222857997-b201237a.png",y="/MyBlog/assets/image-20210701223025709-d7b062c0.png",B="/MyBlog/assets/image-20210701223131264-db153330.png",R="/MyBlog/assets/image-20210702164116027-6c4dec39.png",M="/MyBlog/assets/image-20210702174255799-3c962190.png",I="/MyBlog/assets/image-20210702181101969-04b19dc2.png",P="/MyBlog/assets/image-20210702181215705-2c240f05.png",w="/MyBlog/assets/image-20210702181922809-e5b841a4.png",O="/MyBlog/assets/image-20210702182343979-92510d8b.png",q="/MyBlog/assets/image-20210702182602145-c1a7a399.png",N={},T=s("h1",{id:"redis-é›†ç¾¤-ğŸ§™",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#redis-é›†ç¾¤-ğŸ§™","aria-hidden":"true"},"#"),n(" Redis é›†ç¾¤ ğŸ§™")],-1),V={class:"table-of-contents"},z=l(`<p>æœ¬ç« æ˜¯åŸºäº CentOS7 ä¸‹çš„ Redis é›†ç¾¤æ•™ç¨‹ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å•æœºå®‰è£… Redis</li><li>Redis ä¸»ä»</li><li>Redis åˆ†ç‰‡é›†ç¾¤</li></ul><h1 id="_1-å•æœºå®‰è£…-redis" tabindex="-1"><a class="header-anchor" href="#_1-å•æœºå®‰è£…-redis" aria-hidden="true">#</a> 1.å•æœºå®‰è£… Redis</h1><p>é¦–å…ˆéœ€è¦å®‰è£… Redis æ‰€éœ€è¦çš„ä¾èµ–ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gcc tcl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç„¶åå°†è¯¾å‰èµ„æ–™æä¾›çš„ Redis å®‰è£…åŒ…ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ï¼š</p><p><img src="`+o+'" alt="image-20210629114325516"></p><p>ä¾‹å¦‚ï¼Œæˆ‘æ”¾åˆ°äº†/tmp ç›®å½•ï¼š</p><p><img src="'+m+`" alt="image-20210629114830642"></p><p>è§£å‹ç¼©ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-xvf</span> redis-6.2.4.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è§£å‹åï¼š</p><p><img src="`+u+`" alt="image-20210629114941810"></p><p>è¿›å…¥ redis ç›®å½•ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> redis-6.2.4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿è¡Œç¼–è¯‘å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œåº”è¯¥å°±å®‰è£…æˆåŠŸäº†ã€‚</p><p>ç„¶åä¿®æ”¹ redis.conf æ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># ç»‘å®šåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®</span>
<span class="token key attr-name">bind</span> <span class="token value attr-value">0.0.0.0</span>
<span class="token comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1</span>
<span class="token key attr-name">databases</span> <span class="token value attr-value">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨ Redisï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-server redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœæ­¢ redis æœåŠ¡ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-cli <span class="token function">shutdown</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="_2-redis-ä¸»ä»é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_2-redis-ä¸»ä»é›†ç¾¤" aria-hidden="true">#</a> 2.Redis ä¸»ä»é›†ç¾¤</h1><h2 id="_2-1-é›†ç¾¤ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-1-é›†ç¾¤ç»“æ„" aria-hidden="true">#</a> 2.1.é›†ç¾¤ç»“æ„</h2><p>æˆ‘ä»¬æ­å»ºçš„ä¸»ä»é›†ç¾¤ç»“æ„å¦‚å›¾ï¼š</p><p><img src="`+v+`" alt="image-20210630111505799"></p><p>å…±åŒ…å«ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¼šåœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯ 3 ä¸ª redis å®ä¾‹ï¼Œæ¨¡æ‹Ÿä¸»ä»é›†ç¾¤ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:center;">IP</th><th style="text-align:center;">PORT</th><th style="text-align:center;">è§’è‰²</th></tr></thead><tbody><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">7001</td><td style="text-align:center;">master</td></tr><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">7002</td><td style="text-align:center;">slave</td></tr><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">7003</td><td style="text-align:center;">slave</td></tr></tbody></table><h2 id="_2-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" aria-hidden="true">#</a> 2.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®</h2><p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºå¼€å¯ 3 ä¸ªå®ä¾‹ï¼Œå¿…é¡»å‡†å¤‡ä¸‰ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ã€‚</p><p>1ï¼‰åˆ›å»ºç›®å½•</p><p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—åˆ†åˆ«å« 7001ã€7002ã€7003ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿›å…¥/tmpç›®å½•</span>
<span class="token builtin class-name">cd</span> /tmp
<span class="token comment"># åˆ›å»ºç›®å½•</span>
<span class="token function">mkdir</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚å›¾ï¼š</p><p><img src="`+b+`" alt="image-20210630113929868"></p><p>2ï¼‰æ¢å¤åŸå§‹é…ç½®</p><p>ä¿®æ”¹ redis-6.2.4/redis.conf æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„æŒä¹…åŒ–æ¨¡å¼æ”¹ä¸ºé»˜è®¤çš„ RDB æ¨¡å¼ï¼ŒAOF ä¿æŒå…³é—­çŠ¶æ€ã€‚</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># å¼€å¯RDB</span>
<span class="token comment"># save &quot;&quot;</span>
<span class="token key attr-name">save</span> <span class="token value attr-value">3600 1</span>
<span class="token key attr-name">save</span> <span class="token value attr-value">300 100</span>
<span class="token key attr-name">save</span> <span class="token value attr-value">60 10000</span>

<span class="token comment"># å…³é—­AOF</span>
<span class="token key attr-name">appendonly</span> <span class="token value attr-value">no</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰æ‹·è´é…ç½®æ–‡ä»¶åˆ°æ¯ä¸ªå®ä¾‹ç›®å½•</p><p>ç„¶åå°† redis-6.2.4/redis.conf æ–‡ä»¶æ‹·è´åˆ°ä¸‰ä¸ªç›®å½•ä¸­ï¼ˆåœ¨/tmp ç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´</span>
<span class="token function">cp</span> redis-6.2.4/redis.conf <span class="token number">7001</span>
<span class="token function">cp</span> redis-6.2.4/redis.conf <span class="token number">7002</span>
<span class="token function">cp</span> redis-6.2.4/redis.conf <span class="token number">7003</span>
<span class="token comment"># æ–¹å¼äºŒï¼šç®¡é“ç»„åˆå‘½ä»¤ï¼Œä¸€é”®æ‹·è´</span>
<span class="token builtin class-name">echo</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token function">cp</span> redis-6.2.4/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ï¼‰ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„ç«¯å£ã€å·¥ä½œç›®å½•</p><p>ä¿®æ”¹æ¯ä¸ªæ–‡ä»¶å¤¹å†…çš„é…ç½®æ–‡ä»¶ï¼Œå°†ç«¯å£åˆ†åˆ«ä¿®æ”¹ä¸º 7001ã€7002ã€7003ï¼Œå°† rdb æ–‡ä»¶ä¿å­˜ä½ç½®éƒ½ä¿®æ”¹ä¸ºè‡ªå·±æ‰€åœ¨ç›®å½•ï¼ˆåœ¨/tmp ç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/6379/7001/g&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/dir .\\//dir \\/tmp\\/7001\\//g&#39;</span> <span class="token number">7001</span>/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/6379/7002/g&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/dir .\\//dir \\/tmp\\/7002\\//g&#39;</span> <span class="token number">7002</span>/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/6379/7003/g&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/dir .\\//dir \\/tmp\\/7003\\//g&#39;</span> <span class="token number">7003</span>/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5ï¼‰ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„å£°æ˜ IP</p><p>è™šæ‹Ÿæœºæœ¬èº«æœ‰å¤šä¸ª IPï¼Œä¸ºäº†é¿å…å°†æ¥æ··ä¹±ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ redis.conf æ–‡ä»¶ä¸­æŒ‡å®šæ¯ä¸€ä¸ªå®ä¾‹çš„ç»‘å®š ip ä¿¡æ¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># rediså®ä¾‹çš„å£°æ˜ IP</span>
<span class="token key attr-name">replica-announce-ip</span> <span class="token value attr-value">192.168.150.101</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸ªç›®å½•éƒ½è¦æ”¹ï¼Œæˆ‘ä»¬ä¸€é”®å®Œæˆä¿®æ”¹ï¼ˆåœ¨/tmp ç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># é€ä¸€æ‰§è¡Œ</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;1a replica-announce-ip 192.168.150.101&#39;</span> <span class="token number">7001</span>/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;1a replica-announce-ip 192.168.150.101&#39;</span> <span class="token number">7002</span>/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;1a replica-announce-ip 192.168.150.101&#39;</span> <span class="token number">7003</span>/redis.conf

<span class="token comment"># æˆ–è€…ä¸€é”®ä¿®æ”¹</span>
<span class="token builtin class-name">printf</span> <span class="token string">&#39;%s\\n&#39;</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token parameter variable">-t</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;1a replica-announce-ip 192.168.126.129&#39;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-3-å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_2-3-å¯åŠ¨" aria-hidden="true">#</a> 2.3.å¯åŠ¨</h2><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬æ‰“å¼€ 3 ä¸ª ssh çª—å£ï¼Œåˆ†åˆ«å¯åŠ¨ 3 ä¸ª redis å®ä¾‹ï¼Œå¯åŠ¨å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ç¬¬1ä¸ª</span>
redis-server <span class="token number">7001</span>/redis.conf
<span class="token comment"># ç¬¬2ä¸ª</span>
redis-server <span class="token number">7002</span>/redis.conf
<span class="token comment"># ç¬¬3ä¸ª</span>
redis-server <span class="token number">7003</span>/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨åï¼š</p><p><img src="`+g+`" alt="image-20210630183914491"></p><p>å¦‚æœè¦ä¸€é”®åœæ­¢ï¼Œå¯ä»¥è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">printf</span> <span class="token string">&#39;%s\\n&#39;</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token parameter variable">-t</span> redis-cli <span class="token parameter variable">-p</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token function">shutdown</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-4-å¼€å¯ä¸»ä»å…³ç³»" tabindex="-1"><a class="header-anchor" href="#_2-4-å¼€å¯ä¸»ä»å…³ç³»" aria-hidden="true">#</a> 2.4.å¼€å¯ä¸»ä»å…³ç³»</h2><p>ç°åœ¨ä¸‰ä¸ªå®ä¾‹è¿˜æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè¦é…ç½®ä¸»ä»å¯ä»¥ä½¿ç”¨ replicaof æˆ–è€… slaveofï¼ˆ5.0 ä»¥å‰ï¼‰å‘½ä»¤ã€‚</p><p>æœ‰ä¸´æ—¶å’Œæ°¸ä¹…ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰</p><ul><li>åœ¨ redis.conf ä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š<code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></li></ul></li><li><p>ä½¿ç”¨ redis-cli å®¢æˆ·ç«¯è¿æ¥åˆ° redis æœåŠ¡ï¼Œæ‰§è¡Œ slaveof å‘½ä»¤ï¼ˆé‡å¯åå¤±æ•ˆï¼‰ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>slaveof <span class="token operator">&lt;</span>masterip<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>masterport<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul>`,63),C=l(`<p>è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œä½¿ç”¨æ–¹å¼äºŒã€‚</p><p>é€šè¿‡ redis-cli å‘½ä»¤è¿æ¥ 7002ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿æ¥ 7002</span>
redis-cli <span class="token parameter variable">-p</span> <span class="token number">7002</span>
<span class="token comment"># æ‰§è¡Œslaveof</span>
slaveof <span class="token number">192.168</span>.126.129 <span class="token number">7001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ redis-cli å‘½ä»¤è¿æ¥ 7003ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿æ¥ 7003</span>
redis-cli <span class="token parameter variable">-p</span> <span class="token number">7003</span>
<span class="token comment"># æ‰§è¡Œslaveof</span>
slaveof <span class="token number">192.168</span>.126.129 <span class="token number">7001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åè¿æ¥ 7001 èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿æ¥ 7001</span>
redis-cli <span class="token parameter variable">-p</span> <span class="token number">7001</span>
<span class="token comment"># æŸ¥çœ‹çŠ¶æ€</span>
info replication
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœï¼š</p><p><img src="`+k+'" alt="image-20210630201258802"></p><h2 id="_2-5-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-5-æµ‹è¯•" aria-hidden="true">#</a> 2.5.æµ‹è¯•</h2><p>æ‰§è¡Œä¸‹åˆ—æ“ä½œä»¥æµ‹è¯•ï¼š</p><ul><li><p>åˆ©ç”¨ redis-cli è¿æ¥ 7001ï¼Œæ‰§è¡Œ<code>set num 123</code></p></li><li><p>åˆ©ç”¨ redis-cli è¿æ¥ 7002ï¼Œæ‰§è¡Œ<code>get num</code>ï¼Œå†æ‰§è¡Œ<code>set num 666</code></p></li><li><p>åˆ©ç”¨ redis-cli è¿æ¥ 7003ï¼Œæ‰§è¡Œ<code>get num</code>ï¼Œå†æ‰§è¡Œ<code>set num 888</code></p></li></ul><p>å¯ä»¥å‘ç°ï¼Œåªæœ‰åœ¨ 7001 è¿™ä¸ª master èŠ‚ç‚¹ä¸Šå¯ä»¥æ‰§è¡Œå†™æ“ä½œï¼Œ7002 å’Œ 7003 è¿™ä¸¤ä¸ª slave èŠ‚ç‚¹åªèƒ½æ‰§è¡Œè¯»æ“ä½œã€‚</p><h1 id="_3-æ­å»ºå“¨å…µé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_3-æ­å»ºå“¨å…µé›†ç¾¤" aria-hidden="true">#</a> 3.æ­å»ºå“¨å…µé›†ç¾¤</h1><h2 id="_3-1-é›†ç¾¤ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_3-1-é›†ç¾¤ç»“æ„" aria-hidden="true">#</a> 3.1.é›†ç¾¤ç»“æ„</h2><p>è¿™é‡Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹å½¢æˆçš„ Sentinel é›†ç¾¤ï¼Œæ¥ç›‘ç®¡ä¹‹å‰çš„ Redis ä¸»ä»é›†ç¾¤ã€‚å¦‚å›¾ï¼š</p><p><img src="'+h+`" alt="image-20210701215227018"></p><p>ä¸‰ä¸ª sentinel å®ä¾‹ä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th>èŠ‚ç‚¹</th><th style="text-align:center;">IP</th><th style="text-align:center;">PORT</th></tr></thead><tbody><tr><td>s1</td><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">27001</td></tr><tr><td>s2</td><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">27002</td></tr><tr><td>s3</td><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">27003</td></tr></tbody></table><h2 id="_3-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" aria-hidden="true">#</a> 3.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®</h2><p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºå¼€å¯ 3 ä¸ªå®ä¾‹ï¼Œå¿…é¡»å‡†å¤‡ä¸‰ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ã€‚</p><p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—åˆ†åˆ«å« s1ã€s2ã€s3ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿›å…¥/tmpç›®å½•</span>
<span class="token builtin class-name">cd</span> /tmp
<span class="token comment"># åˆ›å»ºç›®å½•</span>
<span class="token function">mkdir</span> s1 s2 s3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚å›¾ï¼š</p><p><img src="`+f+`" alt="image-20210701215534714"></p><p>ç„¶åæˆ‘ä»¬åœ¨ s1 ç›®å½•åˆ›å»ºä¸€ä¸ª sentinel.conf æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code>port 27001
sentinel announce-ip 192.168.126.129
sentinel monitor mymaster 192.168.126.129 7001 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 60000
dir &quot;/tmp/s1&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£è¯»ï¼š</p><ul><li><code>port 27001</code>ï¼šæ˜¯å½“å‰ sentinel å®ä¾‹çš„ç«¯å£</li><li><code>sentinel monitor mymaster 192.168.150.101 7001 2</code>ï¼šæŒ‡å®šä¸»èŠ‚ç‚¹ä¿¡æ¯ <ul><li><code>mymaster</code>ï¼šä¸»èŠ‚ç‚¹åç§°ï¼Œè‡ªå®šä¹‰ï¼Œä»»æ„å†™</li><li><code>192.168.150.101 7001</code>ï¼šä¸»èŠ‚ç‚¹çš„ ip å’Œç«¯å£</li><li><code>2</code>ï¼šé€‰ä¸¾ master æ—¶çš„ quorum å€¼</li></ul></li></ul><p>ç„¶åå°† s1/sentinel.conf æ–‡ä»¶æ‹·è´åˆ° s2ã€s3 ä¸¤ä¸ªç›®å½•ä¸­ï¼ˆåœ¨/tmp ç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´</span>
<span class="token function">cp</span> s1/sentinel.conf s2
<span class="token function">cp</span> s1/sentinel.conf s3
<span class="token comment"># æ–¹å¼äºŒï¼šç®¡é“ç»„åˆå‘½ä»¤ï¼Œä¸€é”®æ‹·è´</span>
<span class="token builtin class-name">echo</span> s2 s3 <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token function">cp</span> s1/sentinel.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹ s2ã€s3 ä¸¤ä¸ªæ–‡ä»¶å¤¹å†…çš„é…ç½®æ–‡ä»¶ï¼Œå°†ç«¯å£åˆ†åˆ«ä¿®æ”¹ä¸º 27002ã€27003ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/27001/27002/g&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/s1/s2/g&#39;</span> s2/sentinel.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/27001/27003/g&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/s1/s3/g&#39;</span> s3/sentinel.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-3-å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_3-3-å¯åŠ¨" aria-hidden="true">#</a> 3.3.å¯åŠ¨</h2><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬æ‰“å¼€ 3 ä¸ª ssh çª—å£ï¼Œåˆ†åˆ«å¯åŠ¨ 3 ä¸ª redis å®ä¾‹ï¼Œå¯åŠ¨å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ç¬¬1ä¸ª</span>
redis-sentinel s1/sentinel.conf
<span class="token comment"># ç¬¬2ä¸ª</span>
redis-sentinel s2/sentinel.conf
<span class="token comment"># ç¬¬3ä¸ª</span>
redis-sentinel s3/sentinel.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨åï¼š</p><p><img src="`+_+'" alt="image-20210701220714104"></p><h2 id="_3-4-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-4-æµ‹è¯•" aria-hidden="true">#</a> 3.4.æµ‹è¯•</h2><p>å°è¯•è®© master èŠ‚ç‚¹ 7001 å®•æœºï¼ŒæŸ¥çœ‹ sentinel æ—¥å¿—ï¼š</p><p><img src="'+x+'" alt="image-20210701222857997"></p><p>æŸ¥çœ‹ 7003 çš„æ—¥å¿—ï¼š</p><p><img src="'+y+'" alt="image-20210701223025709"></p><p>æŸ¥çœ‹ 7002 çš„æ—¥å¿—ï¼š</p><p><img src="'+B+'" alt="image-20210701223131264"></p><h1 id="_4-æ­å»ºåˆ†ç‰‡é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-æ­å»ºåˆ†ç‰‡é›†ç¾¤" aria-hidden="true">#</a> 4.æ­å»ºåˆ†ç‰‡é›†ç¾¤</h1><h2 id="_4-1-é›†ç¾¤ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_4-1-é›†ç¾¤ç»“æ„" aria-hidden="true">#</a> 4.1.é›†ç¾¤ç»“æ„</h2><p>åˆ†ç‰‡é›†ç¾¤éœ€è¦çš„èŠ‚ç‚¹æ•°é‡è¾ƒå¤šï¼Œè¿™é‡Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªæœ€å°çš„åˆ†ç‰‡é›†ç¾¤ï¼ŒåŒ…å« 3 ä¸ª master èŠ‚ç‚¹ï¼Œæ¯ä¸ª master åŒ…å«ä¸€ä¸ª slave èŠ‚ç‚¹ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="'+R+`" alt="image-20210702164116027"></p><p>è¿™é‡Œæˆ‘ä»¬ä¼šåœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯ 6 ä¸ª redis å®ä¾‹ï¼Œæ¨¡æ‹Ÿåˆ†ç‰‡é›†ç¾¤ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:center;">IP</th><th style="text-align:center;">PORT</th><th style="text-align:center;">è§’è‰²</th></tr></thead><tbody><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">7001</td><td style="text-align:center;">master</td></tr><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">7002</td><td style="text-align:center;">master</td></tr><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">7003</td><td style="text-align:center;">master</td></tr><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">8001</td><td style="text-align:center;">slave</td></tr><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">8002</td><td style="text-align:center;">slave</td></tr><tr><td style="text-align:center;">192.168.150.101</td><td style="text-align:center;">8003</td><td style="text-align:center;">slave</td></tr></tbody></table><h2 id="_4-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" tabindex="-1"><a class="header-anchor" href="#_4-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" aria-hidden="true">#</a> 4.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®</h2><p>åˆ é™¤ä¹‹å‰çš„ 7001ã€7002ã€7003 è¿™å‡ ä¸ªç›®å½•ï¼Œé‡æ–°åˆ›å»ºå‡º 7001ã€7002ã€7003ã€8001ã€8002ã€8003 ç›®å½•ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿›å…¥/tmpç›®å½•</span>
<span class="token builtin class-name">cd</span> /tmp
<span class="token comment"># åˆ é™¤æ—§çš„ï¼Œé¿å…é…ç½®å¹²æ‰°</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span>
<span class="token comment"># åˆ›å»ºç›®å½•</span>
<span class="token function">mkdir</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token number">8001</span> <span class="token number">8002</span> <span class="token number">8003</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨/tmp ä¸‹å‡†å¤‡ä¸€ä¸ªæ–°çš„ redis.conf æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code>port 6379
<span class="token comment"># å¼€å¯é›†ç¾¤åŠŸèƒ½</span>
cluster-enabled yes
<span class="token comment"># é›†ç¾¤çš„é…ç½®æ–‡ä»¶åç§°ï¼Œä¸éœ€è¦æˆ‘ä»¬åˆ›å»ºï¼Œç”±redisè‡ªå·±ç»´æŠ¤</span>
cluster-config-file /tmp/6379/nodes.conf
<span class="token comment"># èŠ‚ç‚¹å¿ƒè·³å¤±è´¥çš„è¶…æ—¶æ—¶é—´</span>
cluster-node-timeout 5000
<span class="token comment"># æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ç›®å½•</span>
dir /tmp/6379
<span class="token comment"># ç»‘å®šåœ°å€</span>
bind 0.0.0.0
<span class="token comment"># è®©redisåå°è¿è¡Œ</span>
daemonize yes
<span class="token comment"># æ³¨å†Œçš„å®ä¾‹ip</span>
replica-announce-ip 192.168.150.101
<span class="token comment"># ä¿æŠ¤æ¨¡å¼</span>
protected-mode no
<span class="token comment"># æ•°æ®åº“æ•°é‡</span>
databases 1
<span class="token comment"># æ—¥å¿—</span>
logfile /tmp/6379/run.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†è¿™ä¸ªæ–‡ä»¶æ‹·è´åˆ°æ¯ä¸ªç›®å½•ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿›å…¥/tmpç›®å½•</span>
<span class="token builtin class-name">cd</span> /tmp
<span class="token comment"># æ‰§è¡Œæ‹·è´</span>
<span class="token builtin class-name">echo</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token number">8001</span> <span class="token number">8002</span> <span class="token number">8003</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token function">cp</span> redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹æ¯ä¸ªç›®å½•ä¸‹çš„ redis.confï¼Œå°†å…¶ä¸­çš„ 6379 ä¿®æ”¹ä¸ºä¸æ‰€åœ¨ç›®å½•ä¸€è‡´ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿›å…¥/tmpç›®å½•</span>
<span class="token builtin class-name">cd</span> /tmp
<span class="token comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
<span class="token builtin class-name">printf</span> <span class="token string">&#39;%s\\n&#39;</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token number">8001</span> <span class="token number">8002</span> <span class="token number">8003</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token parameter variable">-t</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/6379/{}/g&#39;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-3-å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_4-3-å¯åŠ¨" aria-hidden="true">#</a> 4.3.å¯åŠ¨</h2><p>å› ä¸ºå·²ç»é…ç½®äº†åå°å¯åŠ¨æ¨¡å¼ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¯åŠ¨æœåŠ¡ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿›å…¥/tmpç›®å½•</span>
<span class="token builtin class-name">cd</span> /tmp
<span class="token comment"># ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡</span>
<span class="token builtin class-name">printf</span> <span class="token string">&#39;%s\\n&#39;</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token number">8001</span> <span class="token number">8002</span> <span class="token number">8003</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token parameter variable">-t</span> redis-server <span class="token punctuation">{</span><span class="token punctuation">}</span>/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ ps æŸ¥çœ‹çŠ¶æ€ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‘ç°æœåŠ¡éƒ½å·²ç»æ­£å¸¸å¯åŠ¨ï¼š</p><p><img src="`+M+`" alt="image-20210702174255799"></p><p>å¦‚æœè¦å…³é—­æ‰€æœ‰è¿›ç¨‹ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> redis <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">kill</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ–è€…ï¼ˆæ¨èè¿™ç§æ–¹å¼ï¼‰ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">printf</span> <span class="token string">&#39;%s\\n&#39;</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token number">8001</span> <span class="token number">8002</span> <span class="token number">8003</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token parameter variable">-t</span> redis-cli <span class="token parameter variable">-p</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token function">shutdown</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_4-4-åˆ›å»ºé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-4-åˆ›å»ºé›†ç¾¤" aria-hidden="true">#</a> 4.4.åˆ›å»ºé›†ç¾¤</h2><p>è™½ç„¶æœåŠ¡å¯åŠ¨äº†ï¼Œä½†æ˜¯ç›®å‰æ¯ä¸ªæœåŠ¡ä¹‹é—´éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰ä»»ä½•å…³è”ã€‚</p><p>æˆ‘ä»¬éœ€è¦æ‰§è¡Œå‘½ä»¤æ¥åˆ›å»ºé›†ç¾¤ï¼Œåœ¨ Redis5.0 ä¹‹å‰åˆ›å»ºé›†ç¾¤æ¯”è¾ƒéº»çƒ¦ï¼Œ5.0 ä¹‹åé›†ç¾¤ç®¡ç†å‘½ä»¤éƒ½é›†æˆåˆ°äº† redis-cli ä¸­ã€‚</p><p>1ï¼‰Redis5.0 ä¹‹å‰</p><p>Redis5.0 ä¹‹å‰é›†ç¾¤å‘½ä»¤éƒ½æ˜¯ç”¨ redis å®‰è£…åŒ…ä¸‹çš„ src/redis-trib.rb æ¥å®ç°çš„ã€‚å› ä¸º redis-trib.rb æ˜¯æœ‰ ruby è¯­è¨€ç¼–å†™çš„æ‰€ä»¥éœ€è¦å®‰è£… ruby ç¯å¢ƒã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å®‰è£…ä¾èµ–</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> zlib ruby rubygems
gem <span class="token function">install</span> redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åé€šè¿‡å‘½ä»¤æ¥ç®¡ç†é›†ç¾¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿›å…¥redisçš„srcç›®å½•</span>
<span class="token builtin class-name">cd</span> /tmp/redis-6.2.4/src
<span class="token comment"># åˆ›å»ºé›†ç¾¤</span>
./redis-trib.rb create <span class="token parameter variable">--replicas</span> <span class="token number">1</span> <span class="token number">192.168</span>.150.101:7001 <span class="token number">192.168</span>.150.101:7002 <span class="token number">192.168</span>.150.101:7003 <span class="token number">192.168</span>.150.101:8001 <span class="token number">192.168</span>.150.101:8002 <span class="token number">192.168</span>.150.101:8003
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰Redis5.0 ä»¥å</p><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Redis6.2.4 ç‰ˆæœ¬ï¼Œé›†ç¾¤ç®¡ç†ä»¥åŠé›†æˆåˆ°äº† redis-cli ä¸­ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">--cluster</span> create --cluster-replicas <span class="token number">1</span> <span class="token number">192.168</span>.126.129:7001 <span class="token number">192.168</span>.126.129:7002 <span class="token number">192.168</span>.126.129:7003 <span class="token number">192.168</span>.126.129:8001 <span class="token number">192.168</span>.126.129:8002  <span class="token number">192.168</span>.126.129:8003
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‘½ä»¤è¯´æ˜ï¼š</p><ul><li><code>redis-cli --cluster</code>æˆ–è€…<code>./redis-trib.rb</code>ï¼šä»£è¡¨é›†ç¾¤æ“ä½œå‘½ä»¤</li><li><code>create</code>ï¼šä»£è¡¨æ˜¯åˆ›å»ºé›†ç¾¤</li><li><code>--replicas 1</code>æˆ–è€…<code>--cluster-replicas 1</code> ï¼šæŒ‡å®šé›†ç¾¤ä¸­æ¯ä¸ª master çš„å‰¯æœ¬ä¸ªæ•°ä¸º 1ï¼Œæ­¤æ—¶<code>èŠ‚ç‚¹æ€»æ•° Ã· (replicas + 1)</code> å¾—åˆ°çš„å°±æ˜¯ master çš„æ•°é‡ã€‚å› æ­¤èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„å‰ n ä¸ªå°±æ˜¯ masterï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½æ˜¯ slave èŠ‚ç‚¹ï¼Œéšæœºåˆ†é…åˆ°ä¸åŒ master</li></ul><p>è¿è¡Œåçš„æ ·å­ï¼š</p><p><img src="`+I+'" alt="image-20210702181101969"></p><p>è¿™é‡Œè¾“å…¥ yesï¼Œåˆ™é›†ç¾¤å¼€å§‹åˆ›å»ºï¼š</p><p><img src="'+P+`" alt="image-20210702181215705"></p><p>é€šè¿‡å‘½ä»¤å¯ä»¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">-p</span> <span class="token number">7001</span> cluster nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+w+`" alt="image-20210702181922809"></p><h2 id="_4-5-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-5-æµ‹è¯•" aria-hidden="true">#</a> 4.5.æµ‹è¯•</h2><p>å°è¯•è¿æ¥ 7001 èŠ‚ç‚¹ï¼Œå­˜å‚¨ä¸€ä¸ªæ•°æ®ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿æ¥</span>
redis-cli <span class="token parameter variable">-p</span> <span class="token number">7001</span>
<span class="token comment"># å­˜å‚¨æ•°æ®</span>
<span class="token builtin class-name">set</span> num <span class="token number">123</span>
<span class="token comment"># è¯»å–æ•°æ®</span>
get num
<span class="token comment"># å†æ¬¡å­˜å‚¨</span>
<span class="token builtin class-name">set</span> a <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœæ‚²å‰§äº†ï¼š</p><p><img src="`+O+`" alt="image-20210702182343979"></p><p>é›†ç¾¤æ“ä½œæ—¶ï¼Œéœ€è¦ç»™<code>redis-cli</code>åŠ ä¸Š<code>-c</code>å‚æ•°æ‰å¯ä»¥ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-p</span> <span class="token number">7001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ¬¡å¯ä»¥äº†ï¼š</p><p><img src="`+q+'" alt="image-20210702182602145"></p>',100);function S(A,D){const i=t("router-link"),p=t("font");return c(),d("div",null,[T,s("nav",V,[s("ul",null,[s("li",null,[a(i,{to:"#_2-1-é›†ç¾¤ç»“æ„"},{default:e(()=>[n("2.1.é›†ç¾¤ç»“æ„")]),_:1})]),s("li",null,[a(i,{to:"#_2-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®"},{default:e(()=>[n("2.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®")]),_:1})]),s("li",null,[a(i,{to:"#_2-3-å¯åŠ¨"},{default:e(()=>[n("2.3.å¯åŠ¨")]),_:1})]),s("li",null,[a(i,{to:"#_2-4-å¼€å¯ä¸»ä»å…³ç³»"},{default:e(()=>[n("2.4.å¼€å¯ä¸»ä»å…³ç³»")]),_:1})]),s("li",null,[a(i,{to:"#_2-5-æµ‹è¯•"},{default:e(()=>[n("2.5.æµ‹è¯•")]),_:1})]),s("li",null,[a(i,{to:"#_3-1-é›†ç¾¤ç»“æ„"},{default:e(()=>[n("3.1.é›†ç¾¤ç»“æ„")]),_:1})]),s("li",null,[a(i,{to:"#_3-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®"},{default:e(()=>[n("3.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®")]),_:1})]),s("li",null,[a(i,{to:"#_3-3-å¯åŠ¨"},{default:e(()=>[n("3.3.å¯åŠ¨")]),_:1})]),s("li",null,[a(i,{to:"#_3-4-æµ‹è¯•"},{default:e(()=>[n("3.4.æµ‹è¯•")]),_:1})]),s("li",null,[a(i,{to:"#_4-1-é›†ç¾¤ç»“æ„"},{default:e(()=>[n("4.1.é›†ç¾¤ç»“æ„")]),_:1})]),s("li",null,[a(i,{to:"#_4-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®"},{default:e(()=>[n("4.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®")]),_:1})]),s("li",null,[a(i,{to:"#_4-3-å¯åŠ¨"},{default:e(()=>[n("4.3.å¯åŠ¨")]),_:1})]),s("li",null,[a(i,{to:"#_4-4-åˆ›å»ºé›†ç¾¤"},{default:e(()=>[n("4.4.åˆ›å»ºé›†ç¾¤")]),_:1})]),s("li",null,[a(i,{to:"#_4-5-æµ‹è¯•"},{default:e(()=>[n("4.5.æµ‹è¯•")]),_:1})])])]),z,s("p",null,[s("strong",null,[a(p,{color:"red"},{default:e(()=>[n("æ³¨æ„")]),_:1})]),n("ï¼šåœ¨ 5.0 ä»¥åæ–°å¢å‘½ä»¤ replicaofï¼Œä¸ salveof æ•ˆæœä¸€è‡´ã€‚")]),C])}const E=r(N,[["render",S],["__file","index.html.vue"]]);export{E as default};
