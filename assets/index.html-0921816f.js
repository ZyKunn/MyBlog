import{_ as p,r as l,o as c,c as o,a as n,e as t,w as e,b as s,d as i}from"./app-a153c100.js";const u="/MyBlog/assets/1611714365509-1595ccbf.png",k={},r=n("h1",{id:"_06-servlet-äº”",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_06-servlet-äº”","aria-hidden":"true"},"#"),s(" 06 - Servletï¼ˆäº”ï¼‰ ğŸª‚")],-1),d={class:"table-of-contents"},v=i('<h2 id="è¿‡æ»¤å™¨-filter" tabindex="-1"><a class="header-anchor" href="#è¿‡æ»¤å™¨-filter" aria-hidden="true">#</a> è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</h2><h3 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°" aria-hidden="true">#</a> æ¦‚è¿°</h3><p>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰æ˜¯ Servlet2.3 ä¹‹åæ–°å¢çš„ä¸€é¡¹ web åç«¯æŠ€æœ¯ï¼Œå¯ä»¥å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°è¾¾ç›®æ ‡ä¹‹å‰è¿›è¡Œæ‹¦æˆªï¼Œå¹¶ä¸”å¯ä»¥å°†è¯·æ±‚è¿›è¡Œæˆªè·ï¼Œå¹¶ä½œå‡ºå¤„ç†ä¹‹åå†æ”¾è¡Œï¼Œæ˜¯åŸºäº<strong>è´£ä»»é“¾æ¨¡å¼</strong>ï¼Œæ‰§è¡ŒåŸç†å¦‚ä¸‹ï¼š</p><p><img src="'+u+`" alt="1611714365509"></p><h3 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯" aria-hidden="true">#</a> åº”ç”¨åœºæ™¯</h3><p>è¿‡æ»¤å™¨çš„åº”ç”¨åœºæ™¯ååˆ†å¹¿æ³›ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ç¼–ç è¿‡æ»¤å™¨</li><li>éæ³•è®¿é—®è¿‡æ»¤</li><li>æ•æ„Ÿè¯è¿‡æ»¤</li><li>XSS æ”»å‡»è¿‡æ»¤</li><li>é€šç”¨è·¨åŸŸè¯·æ±‚è¿‡æ»¤</li><li>....</li></ul><h3 id="è¿‡æ»¤å™¨åˆ›å»ºä¸ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#è¿‡æ»¤å™¨åˆ›å»ºä¸ä½¿ç”¨" aria-hidden="true">#</a> è¿‡æ»¤å™¨åˆ›å»ºä¸ä½¿ç”¨</h3><p>Filter çš„åˆ›å»ºåˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><h4 id="_1-åˆ›å»ºæ™®é€š-java-ç±»å®ç°-filter-æ¥å£" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºæ™®é€š-java-ç±»å®ç°-filter-æ¥å£" aria-hidden="true">#</a> 1. åˆ›å»ºæ™®é€š Java ç±»å®ç° Filter æ¥å£</h4><p>ç”±äºå®ç° Filter æ¥å£ï¼Œè¯¥æ¥å£ä¸­åŒ…å«ä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ä¸¤ä¸ªæ–¹æ³•(<code>init()</code>,<code>destroy()</code>)ä¸ºé»˜è®¤æ–¹æ³•,å”¯ä¸€éœ€è¦å®ç°çš„æ–¹æ³•åªæœ‰<code>doFilter</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;filteråˆå§‹åŒ–&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œè¿‡æ»¤å™¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¯·æ±‚æ”¾è¡Œ</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é”€æ¯Filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-é…ç½®-filter" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®-filter" aria-hidden="true">#</a> 2. é…ç½® Filter</h4><p>Filter çš„é…ç½®ä¸ Servlet çš„é…ç½®å‡ ä¹ä¸€è‡´ï¼Œéƒ½åŒ…å«ä¸¤ç§é…ç½®æ–¹å¼ï¼š</p><ol><li><p>åŸºäºæ³¨è§£çš„é…ç½®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//å¯¹æ‰€æœ‰çš„è¯·æ±‚è¿‡æ»¤</span>
<span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span><span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
	<span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åŸºäºé…ç½®æ–‡ä»¶ï¼ˆweb.xmlï¼‰é…ç½®</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--è¿‡æ»¤å™¨é…ç½®--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>com.softeem.filter.EncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--è¿‡æ»¤å™¨æ˜ å°„é…ç½®--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="æ¡ˆä¾‹è®²è§£" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹è®²è§£" aria-hidden="true">#</a> æ¡ˆä¾‹è®²è§£</h3><h4 id="ç¼–ç è¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#ç¼–ç è¿‡æ»¤" aria-hidden="true">#</a> ç¼–ç è¿‡æ»¤</h4><p>è¯·æ±‚å“åº”ä¹±ç æ–‡ä»¶ååˆ†å¸¸è§ï¼Œä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½åœ¨ Servlet ä¸­å•ç‹¬å¤„ç†ï¼Œä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šé‡å¤æ€§çš„å·¥ä½œï¼Œå› æ­¤å¯ä»¥å°†å¯¹äºä¹±ç çš„å¤„ç†ç»Ÿä¸€ç”±è¿‡æ»¤è§£å†³ï¼š</p><p>ç¼–ç è¿‡æ»¤å™¨çš„ç¼–å†™æ–¹å¼:</p><p><strong>EncodingFilter.java</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EncodingFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> encoding<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        encoding <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getInitParameter</span><span class="token punctuation">(</span><span class="token string">&quot;encoding&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//response.setContentType(&quot;text/html;charset=&quot;+encoding);</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>web.xml é…ç½®</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>com.softeem.filter.EncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--åˆå§‹åŒ–å‚æ•°--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>encoding<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="éæ³•ç™»å½•è¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#éæ³•ç™»å½•è¿‡æ»¤" aria-hidden="true">#</a> éæ³•ç™»å½•è¿‡æ»¤</h4><p>éæ³•ç™»å½•è¿‡æ»¤ï¼Œå³å¯¹äºä¸€äº›å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„ç³»ç»Ÿæ¥è¯´ï¼Œè¿›è¡Œåå°ç®¡ç†æ—¶å¿…é¡»ç¡®ä¿å­˜åœ¨ç™»å½•è¿‡ç¨‹ï¼Œå¦åˆ™è§†ä¸ºéæ³•çš„è®¿é—®ï¼›éæ³•ç™»å½•è¿‡æ»¤æ‹¦æˆªçš„åŸç†ä¸ºï¼š</p><ul><li>è¯·æ±‚ç›®æ ‡èµ„æºå‰å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨ç”¨æˆ·ä¿¡æ¯(session)</li><li>å¦‚æœå­˜åœ¨åˆ™å°†è¯·æ±‚æ”¾è¡Œï¼Œå¦åˆ™é‡æ–°å®šå‘åˆ°ç™»å½•é¡µé¢</li></ul><ol><li><p><strong>ç¼–å†™è¿‡æ»¤å™¨</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//@WebFilter(&quot;/admin/*&quot;)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//å°†ServletRequestå¼ºåˆ¶è½¬æ¢ä¸ºHttpServletRequest</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> resp<span class="token punctuation">;</span>

        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> user <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ¤æ–­sessionä¸­æ˜¯å¦å­˜åœ¨ç”¨æˆ·ä¿¡æ¯</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//å¦‚æœå­˜åœ¨åˆ™è®¤ä¸ºç”¨æˆ·å·²ç»ç™»å½•ï¼Œå¯ä»¥æ”¾è¡Œ</span>
            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token comment">//å¦‚æœsessionä¸­æ²¡æœ‰æ•°æ®ï¼Œè®¤ä¸ºç”¨æˆ·æœªç™»å½•ï¼Œè¿›è¡Œæ‹¦æˆª</span>
            <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;script&gt;alert(&#39;ç™»å½•åå†è¯•!&#39;);location.href=&#39;../login.html&#39;&lt;/script&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¿‡æ»¤å™¨çš„é…ç½®ï¼ˆä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ‰§è¡Œ è°å…ˆé…ç½®è°å…ˆæ‰§è¡Œï¼‰</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--æƒé™è¿‡æ»¤é…ç½®--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>EncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>com.goover.filter.EncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--        åˆå§‹å‚æ•°--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--            å‚æ•°åç§°--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>encoding<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--            å‚æ•°å€¼--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>EncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>authFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>com.softeem.filter.AuthFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>authFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--æ‹¦æˆªæ‰€æœ‰å¯¹äºadmin/*èµ„æºçš„è¯·æ±‚--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/admin/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Servlet ä»£ç </strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;softeem&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">User</span> u <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            u<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            u<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ç™»å½•æˆåŠŸåéœ€è¦å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°sessionä¸­</span>
            req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;admin/index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;script&gt;alert(&#39;è¯·æ£€æŸ¥è´¦å·æˆ–å¯†ç !&#39;);location.href=&#39;login.html&#39;&lt;/script&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="xss-è¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#xss-è¿‡æ»¤" aria-hidden="true">#</a> XSS è¿‡æ»¤</h4><p>â€‹ XSSï¼ˆCross Site Scriptingï¼‰,è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯ä¸€ç§å¸¸è§çš„ç½‘ç»œæ”»å‡»æ–¹å¼ï¼ŒæŒ‡çš„æ˜¯åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ï¼Œæˆ–è€…å…¶ä»–ç»ˆç«¯è®¾å¤‡ï¼Œåˆ©ç”¨è¡¨å•æˆ–è€…è¯·æ±‚å‚æ•°ï¼Œå‘æœåŠ¡ç«¯å‘é€ä¸€äº›æ¶æ„çš„ä»£ç ç‰‡æ®µï¼Œä¸€èˆ¬è¿™äº›æ¶æ„çš„ä»£ç ç‰‡æ®µå¤šæ•°ä»¥ javascript ä¸ºè„šæœ¬ï¼Œä½†æ˜¯ä¸é™äº javascriptï¼Œå¦å¤–å¯èƒ½ä¹Ÿæœ‰å…¶ä»–ç±»å‹çš„è„šæœ¬ï¼Œæ¯”å¦‚ï¼šVBScriptï¼ŒActiveXï¼ŒFlash,æˆ–è€…æ˜¯æ™®é€šçš„ htmlï¼›åŸºäºè¿™ç§æ¼æ´ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šå¾—åˆ°ä¸€äº›æ¯”è¾ƒé«˜çš„æ“ä½œæƒé™ï¼Œæ¯”å¦‚ä¸€äº›ç½‘é¡µç§å¯†å†…å®¹ï¼Œcookie ç­‰ä¿¡æ¯ï¼Œä»è€Œå¯¹ç½‘ç«™çš„å¨èƒå·¨å¤§ã€‚</p><p>ä»¥ä¸Šé—®é¢˜å³è·¨ç«™è„šæœ¬æ”»å‡»æ‰€å¸¦æ¥çš„çš„é—®é¢˜ï¼›åœ¨ web åº”ç”¨ä¸­å¦‚ä½•è§£å†³ XSS é—®é¢˜å‘¢ï¼Ÿ</p><ol><li><p>å‰ç«¯é¡µé¢</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>è¯·è¾“å…¥è¯„è®ºä¿¡æ¯:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>å‘è¡¨è¯„è®º<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>servlet ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/comm&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token comment">//è·å–æäº¤çš„æ•°æ®</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;show.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>xss è¿‡æ»¤å™¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span><span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XSSFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è½¬æ¢Request</span>
        <span class="token class-name">HttpServletRequest</span> request  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span>req<span class="token punctuation">;</span>
        <span class="token comment">//æ”¾è¡Œè¯·æ±‚ï¼ˆå¯¹requesté‡æ–°åŒ…è£…ï¼‰</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">XssRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Xss è¯·æ±‚åŒ…è£…å™¨(å¯¹åŸå§‹çš„è¯·æ±‚æ•°æ®è¿›è¡ŒåŒ…è£…å¤„ç†)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XssRequest</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServletRequestWrapper</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">XssRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–åŸå§‹çš„å®¢æˆ·ç«¯æäº¤å†…å®¹</span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†åŸå§‹å†…å®¹å¤„ç†ä¹‹åé‡æ–°è¿”å›</span>
        <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getParameterValues</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–åŸå§‹çš„ æ ¹æ®nameå–åˆ°çš„æ‰€æœ‰valuesï¼ˆæœªç»å¤„ç†çš„æ•°æ®ï¼‰</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getParameterValues</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//åˆ›å»ºæ–°çš„æ•°ç»„ç”¨äºå­˜å‚¨å¤„ç†ä¹‹åçš„æ•°æ®å€¼</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newValues <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>values<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//å¤„ç†</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">handler</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> newValues<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦ï¼Œä»¥åŠè„šæœ¬å†…å®¹</span>
        <span class="token comment">// &lt;  &amp;lt;</span>
        <span class="token comment">// &gt;  &amp;gt;</span>
        <span class="token comment">//ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ï¼šcommons-langã€commons-text</span>
        <span class="token keyword">return</span> <span class="token class-name">StringEscapeUtils</span><span class="token punctuation">.</span><span class="token function">escapeHtml4</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><blockquote><p>è¿‡æ»¤å™¨çš„é¢è¯•é¢˜ï¼š</p><ol><li>Filter æ˜¯å¦‚ä½•å®ç°çš„ï¼š</li></ol><p>â€‹ Filter æ˜¯åŸºäºè´£ä»»é“¾çš„è®¾è®¡æ¨¡å¼å®ç°ï¼Œå†…éƒ¨åŸºäºå›è°ƒæœºåˆ¶ï¼Œåœ¨è¯·æ±‚åˆ°è¾¾ç›®æ ‡èµ„æºä¹‹å‰æ‰§è¡Œè¿‡æ»¤ï¼Œ</p><ol start="2"><li>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰åŒºåˆ«ï¼Ÿ</li></ol></blockquote><h2 id="ç›‘å¬å™¨-listener" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬å™¨-listener" aria-hidden="true">#</a> ç›‘å¬å™¨ ï¼ˆListenerï¼‰</h2><h3 id="æ¦‚è¿°-1" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°-1" aria-hidden="true">#</a> æ¦‚è¿°</h3><p>â€‹ Listener æ˜¯ Servlet ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œç”¨äºç›‘å¬ HttpServletRequest,HttpSession,ServletContext ä¸‰å¤§ä½œç”¨åŸŸçš„çŠ¶æ€å˜åŒ–ï¼Œæ¯”å¦‚ session çš„äº§ç”Ÿï¼Œrequest ä¸­å…ƒç´ çš„æ–°å¢ä¸é”€æ¯ï¼ŒServletContext çš„å¯åŠ¨ä¸é”€æ¯ç­‰ï¼›ç›‘å¬å™¨ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼Œé€šå¸¸æ˜¯åœ¨æœåŠ¡å™¨è¿è¡Œæ—¶æ¡ä»¶æ»¡è¶³åè‡ªåŠ¨äº§ç”Ÿäº‹ä»¶å¯¹è±¡ï¼Œå¹¶ä¸”è‡ªåŠ¨æ‰§è¡Œç›¸å…³çš„æ–¹æ³•ã€‚</p><h3 id="ç›‘å¬å™¨åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬å™¨åˆ†ç±»" aria-hidden="true">#</a> ç›‘å¬å™¨åˆ†ç±»</h3><p>Servlet ä¸­çš„ç›‘å¬å™¨åˆ†ä¸ºä»¥ä¸‹ä¸‰å¤§ç±»</p><ol><li><strong>ServletRquest ç›‘å¬</strong><ol><li>ServletRequestListenerï¼šç›‘å¬ request å¯¹è±¡çš„äº§ç”Ÿä¸é”€æ¯</li><li>ServletRequestAttributeListenerï¼šç›‘å¬ request ä½œç”¨åŸŸä¸­å…ƒç´ çš„äº§ç”Ÿï¼Œç§»é™¤ä»¥åŠæ›¿æ¢</li></ol></li><li><strong>HttpSession ç›‘å¬</strong><ol><li>HttpSessionListenerï¼šç›‘å¬ session çš„äº§ç”Ÿä¸é”€æ¯</li><li>HttpSessionAttributeListenerï¼šç›‘å¬ session ä¸­å±æ€§çš„äº§ç”Ÿï¼Œç§»é™¤ä»¥åŠæ›¿æ¢</li></ol></li><li><strong>ServletContext ç›‘å¬</strong><ol><li>ServletContextListenerï¼šç›‘å¬æ•´ä¸ªåº”ç”¨çš„åˆå§‹åŒ–ä¸é”€æ¯</li><li>ServletContextAttributeListenerï¼šç›‘å¬ ServletContext ä½œç”¨åŸŸä¸­å…ƒç´ çš„äº§ç”Ÿï¼Œç§»é™¤ä»¥åŠæ›¿æ¢</li></ol></li></ol><blockquote><p>ç›‘å¬å™¨çš„åº”ç”¨åœºæ™¯ï¼š</p><ol><li>ç›‘å¬ç½‘ç«™çš„æ€»è®¿é—®äººæ•°ï¼ˆsessionï¼‰</li><li>ç½‘ç«™çš„åŒæ—¶åœ¨çº¿äººæ•°ï¼ˆsessionï¼‰</li><li>åœ¨ javaEE é¡¹ç›®ä¸­ï¼Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€äº›åˆå§‹åŒ–èµ„æºçš„åŠ è½½å·¥ä½œç›‘å¬ï¼ˆservletContextï¼‰</li></ol></blockquote><h3 id="åˆ›å»ºä¸ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸ä½¿ç”¨" aria-hidden="true">#</a> åˆ›å»ºä¸ä½¿ç”¨</h3><p>ç›‘å¬å™¨çš„åˆ›å»ºæœ‰ä¸¤ä¸ªæ­¥éª¤</p><ol><li><p>åˆ›å»ºä¸€ä¸ªç±»å®ç°ä¸€ä¸ªå…·ä½“çš„ç›‘å¬å™¨æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageViewCountListener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * sessionè¢«åˆ›å»ºæ—¶æ‰§è¡Œ
     * <span class="token keyword">@param</span> <span class="token parameter">e</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionCreated</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;viewCount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//è·å–å­˜å‚¨æ€»è®¿é—®äººæ•°</span>
            count <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        context<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;viewCount&quot;</span><span class="token punctuation">,</span><span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰æ–°çš„sessionäº§ç”Ÿã€‚ã€‚ã€‚&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * sessioné”€æ¯æ—¶æ‰§è¡Œ
     * <span class="token keyword">@param</span> <span class="token parameter">e</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionDestroyed</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sessionè¢«é”€æ¯....&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>é…ç½®ç›‘å¬å™¨</p><p>ç›‘å¬å™¨çš„é…ç½®ä¹ŸåŒ…å«ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><p>åŸºäºæ³¨è§£çš„é…ç½®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebListener</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageViewCountListener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span><span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>é€šè¿‡åœ¨ web.xml ä¸­é…ç½®</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--ç›‘å¬å™¨é…ç½®--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">&gt;</span></span>com.softeem.listener.PageViewCountListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ol><h2 id="ä½œä¸šé¢˜" tabindex="-1"><a class="header-anchor" href="#ä½œä¸šé¢˜" aria-hidden="true">#</a> ä½œä¸šé¢˜</h2><ol><li>åŸºäº Filte æŠ€æœ¯ï¼Œå®ç°ä¸€ä¸ªï¼Œæ•æ„Ÿè¯è¿‡æ»¤åŠŸèƒ½ï¼Œè¦æ±‚:å¯ä»¥åŠ¨æ€æ·»åŠ æ•æ„Ÿè¯ï¼Œå¯¹äºæ•æ„Ÿè¯è¦æ±‚ä½¿ç”¨<code>*</code>ä»£æ›¿</li><li>åŸºäº Listener æŠ€æœ¯ï¼Œè¦æ±‚å®ç°ç½‘ç«™<strong>åœ¨çº¿äººæ•°</strong>çš„ç»Ÿè®¡</li></ol>`,44);function m(g,b){const a=l("router-link");return c(),o("div",null,[r,n("nav",d,[n("ul",null,[n("li",null,[t(a,{to:"#è¿‡æ»¤å™¨-filter"},{default:e(()=>[s("è¿‡æ»¤å™¨ï¼ˆFilterï¼‰")]),_:1}),n("ul",null,[n("li",null,[t(a,{to:"#æ¦‚è¿°"},{default:e(()=>[s("æ¦‚è¿°")]),_:1})]),n("li",null,[t(a,{to:"#åº”ç”¨åœºæ™¯"},{default:e(()=>[s("åº”ç”¨åœºæ™¯")]),_:1})]),n("li",null,[t(a,{to:"#è¿‡æ»¤å™¨åˆ›å»ºä¸ä½¿ç”¨"},{default:e(()=>[s("è¿‡æ»¤å™¨åˆ›å»ºä¸ä½¿ç”¨")]),_:1})]),n("li",null,[t(a,{to:"#æ¡ˆä¾‹è®²è§£"},{default:e(()=>[s("æ¡ˆä¾‹è®²è§£")]),_:1})])])]),n("li",null,[t(a,{to:"#ç›‘å¬å™¨-listener"},{default:e(()=>[s("ç›‘å¬å™¨ ï¼ˆListenerï¼‰")]),_:1}),n("ul",null,[n("li",null,[t(a,{to:"#æ¦‚è¿°-1"},{default:e(()=>[s("æ¦‚è¿°")]),_:1})]),n("li",null,[t(a,{to:"#ç›‘å¬å™¨åˆ†ç±»"},{default:e(()=>[s("ç›‘å¬å™¨åˆ†ç±»")]),_:1})]),n("li",null,[t(a,{to:"#åˆ›å»ºä¸ä½¿ç”¨"},{default:e(()=>[s("åˆ›å»ºä¸ä½¿ç”¨")]),_:1})])])]),n("li",null,[t(a,{to:"#ä½œä¸šé¢˜"},{default:e(()=>[s("ä½œä¸šé¢˜")]),_:1})])])]),v])}const h=p(k,[["render",m],["__file","index.html.vue"]]);export{h as default};
